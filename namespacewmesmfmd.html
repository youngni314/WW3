<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.17"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>WAVEWATCH III: wmesmfmd Module Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
  $(document).ready(function() { init_search(); });
/* @license-end */
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">WAVEWATCH III
   &#160;<span id="projectnumber">beta 0.0.1</span>
   </div>
  </td>
   <td>        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
</td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.17 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('namespacewmesmfmd.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="summary">
<a href="#func-members">Functions/Subroutines</a>  </div>
  <div class="headertitle">
<div class="title">wmesmfmd Module Reference</div>  </div>
</div><!--header-->
<div class="contents">

<p>National Unified Prediction Capability (NUOPC) based Earth System Modeling Framework (ESMF) interface module for multi-grid wave model.  
<a href="namespacewmesmfmd.html#details">More...</a></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions/Subroutines</h2></td></tr>
<tr class="memitem:a7518f8f78d77552ecc8860b09fc117dc"><td class="memItemLeft" align="right" valign="top">subroutine, public&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacewmesmfmd.html#a7518f8f78d77552ecc8860b09fc117dc">setservices</a> (gcomp, rc)</td></tr>
<tr class="memdesc:a7518f8f78d77552ecc8860b09fc117dc"><td class="mdescLeft">&#160;</td><td class="mdescRight">Wave model ESMF set services.  <a href="namespacewmesmfmd.html#a7518f8f78d77552ecc8860b09fc117dc">More...</a><br /></td></tr>
<tr class="separator:a7518f8f78d77552ecc8860b09fc117dc"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:afbf45ae6cb571a7f5a847b1fe12742a3"><td class="memItemLeft" align="right" valign="top">subroutine&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacewmesmfmd.html#afbf45ae6cb571a7f5a847b1fe12742a3">setexport</a> (gcomp, rc)</td></tr>
<tr class="memdesc:afbf45ae6cb571a7f5a847b1fe12742a3"><td class="mdescLeft">&#160;</td><td class="mdescRight">Set export fields from internal data structures.  <a href="namespacewmesmfmd.html#afbf45ae6cb571a7f5a847b1fe12742a3">More...</a><br /></td></tr>
<tr class="separator:afbf45ae6cb571a7f5a847b1fe12742a3"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:abb7958f7e4f953e69c0d63d81b55d3bf"><td class="memItemLeft" align="right" valign="top">subroutine&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacewmesmfmd.html#abb7958f7e4f953e69c0d63d81b55d3bf">createexpmesh</a> (gcomp, rc)</td></tr>
<tr class="memdesc:abb7958f7e4f953e69c0d63d81b55d3bf"><td class="mdescLeft">&#160;</td><td class="mdescRight">Create ESMF mesh (unstructured) for export fields.  <a href="namespacewmesmfmd.html#abb7958f7e4f953e69c0d63d81b55d3bf">More...</a><br /></td></tr>
<tr class="separator:abb7958f7e4f953e69c0d63d81b55d3bf"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:af66fcedda6573f5f88a3385e288b8864"><td class="memItemLeft" align="right" valign="top">subroutine&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacewmesmfmd.html#af66fcedda6573f5f88a3385e288b8864">setupimpbmsk</a> (bmskField, impField, missingVal, rc)</td></tr>
<tr class="memdesc:af66fcedda6573f5f88a3385e288b8864"><td class="mdescLeft">&#160;</td><td class="mdescRight">Setup background blending mask field for an import field.  <a href="namespacewmesmfmd.html#af66fcedda6573f5f88a3385e288b8864">More...</a><br /></td></tr>
<tr class="separator:af66fcedda6573f5f88a3385e288b8864"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a096ddfff532dfd7fad224cf71efe740d"><td class="memItemLeft" align="right" valign="top">integer function&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacewmesmfmd.html#a096ddfff532dfd7fad224cf71efe740d">fieldindex</a> (fnameList, fname, rc)</td></tr>
<tr class="memdesc:a096ddfff532dfd7fad224cf71efe740d"><td class="mdescLeft">&#160;</td><td class="mdescRight">Return index associated with field name.  <a href="namespacewmesmfmd.html#a096ddfff532dfd7fad224cf71efe740d">More...</a><br /></td></tr>
<tr class="separator:a096ddfff532dfd7fad224cf71efe740d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a7d9f645bc86d17610b8ae4180ac6ee5d"><td class="memItemLeft" align="right" valign="top">subroutine&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacewmesmfmd.html#a7d9f645bc86d17610b8ae4180ac6ee5d">calcstokes3d</a> (a, usxField, usyField, rc)</td></tr>
<tr class="memdesc:a7d9f645bc86d17610b8ae4180ac6ee5d"><td class="mdescLeft">&#160;</td><td class="mdescRight">Calculate 3D Stokes drift current for export.  <a href="namespacewmesmfmd.html#a7d9f645bc86d17610b8ae4180ac6ee5d">More...</a><br /></td></tr>
<tr class="separator:a7d9f645bc86d17610b8ae4180ac6ee5d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a9aacdbe6b0276055261efea9e328c953"><td class="memItemLeft" align="right" valign="top">subroutine&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacewmesmfmd.html#a9aacdbe6b0276055261efea9e328c953">readfromfile</a> (idfld, fldwx, fldwy, time0, timen, rc)</td></tr>
<tr class="memdesc:a9aacdbe6b0276055261efea9e328c953"><td class="mdescLeft">&#160;</td><td class="mdescRight">Read input file to fill unmapped point for regional applications.  <a href="namespacewmesmfmd.html#a9aacdbe6b0276055261efea9e328c953">More...</a><br /></td></tr>
<tr class="separator:a9aacdbe6b0276055261efea9e328c953"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>National Unified Prediction Capability (NUOPC) based Earth System Modeling Framework (ESMF) interface module for multi-grid wave model. </p>
<p>All module variables and types are scoped private by default. The private module variables and types are not listed in this section.</p>
<dl class="section author"><dt>Author</dt><dd>T. J. Campell </dd>
<dd>
J. Meixner </dd>
<dd>
A. J. van der Westhuysen </dd></dl>
<dl class="section date"><dt>Date</dt><dd>09-Aug-2017</dd></dl>
<dl class="section copyright"><dt>Copyright</dt><dd>Copyright 2009-2022 National Weather Service (NWS), National Oceanic and Atmospheric Administration. All rights reserved. WAVEWATCH III is a trademark of the NWS. No unauthorized use without permission. </dd></dl>
</div><h2 class="groupheader">Function/Subroutine Documentation</h2>
<a id="a7d9f645bc86d17610b8ae4180ac6ee5d"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a7d9f645bc86d17610b8ae4180ac6ee5d">&#9670;&nbsp;</a></span>calcstokes3d()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">subroutine wmesmfmd::calcstokes3d </td>
          <td>(</td>
          <td class="paramtype">real, dimension(nth,nk,0:nseal)&#160;</td>
          <td class="paramname"><em>a</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">type(esmf_field)&#160;</td>
          <td class="paramname"><em>usxField</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">type(esmf_field)&#160;</td>
          <td class="paramname"><em>usyField</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">integer&#160;</td>
          <td class="paramname"><em>rc</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Calculate 3D Stokes drift current for export. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">a</td><td>Input spectra (in par list to change shape) </td></tr>
    <tr><td class="paramname">usxField</td><td>3D SDC eastward-component export field </td></tr>
    <tr><td class="paramname">usyField</td><td>3D SDC northward-component export field </td></tr>
    <tr><td class="paramname">rc</td><td>Return code</td></tr>
  </table>
  </dd>
</dl>
<dl class="section author"><dt>Author</dt><dd>T. J. Campbell </dd></dl>
<dl class="section date"><dt>Date</dt><dd>09-Aug-2017 </dd></dl>

<p class="definition">Definition at line <a class="el" href="wmesmfmd_8F90_source.html#l07232">7232</a> of file <a class="el" href="wmesmfmd_8F90_source.html">wmesmfmd.F90</a>.</p>
<div class="fragment"><div class="line"><a name="l07232"></a><span class="lineno"> 7232</span>&#160;    <span class="comment">!/</span></div>
<div class="line"><a name="l07233"></a><span class="lineno"> 7233</span>&#160;    <span class="comment">!/                  +-----------------------------------+</span></div>
<div class="line"><a name="l07234"></a><span class="lineno"> 7234</span>&#160;    <span class="comment">!/                  | WAVEWATCH III           NOAA/NCEP |</span></div>
<div class="line"><a name="l07235"></a><span class="lineno"> 7235</span>&#160;    <span class="comment">!/                  |        T. J. Campbell, NRL        |</span></div>
<div class="line"><a name="l07236"></a><span class="lineno"> 7236</span>&#160;    <span class="comment">!/                  |                        FORTRAN 90 |</span></div>
<div class="line"><a name="l07237"></a><span class="lineno"> 7237</span>&#160;    <span class="comment">!/                  | Last update :         09-Aug-2017 |</span></div>
<div class="line"><a name="l07238"></a><span class="lineno"> 7238</span>&#160;    <span class="comment">!/                  +-----------------------------------+</span></div>
<div class="line"><a name="l07239"></a><span class="lineno"> 7239</span>&#160;    <span class="comment">!/</span></div>
<div class="line"><a name="l07240"></a><span class="lineno"> 7240</span>&#160;    <span class="comment">!/    09-Aug-2017 : Origination.                        ( version 6.03 )</span></div>
<div class="line"><a name="l07241"></a><span class="lineno"> 7241</span>&#160;    <span class="comment">!/</span></div>
<div class="line"><a name="l07242"></a><span class="lineno"> 7242</span>&#160;    <span class="comment">!  1. Purpose :</span></div>
<div class="line"><a name="l07243"></a><span class="lineno"> 7243</span>&#160;    <span class="comment">!</span></div>
<div class="line"><a name="l07244"></a><span class="lineno"> 7244</span>&#160;    <span class="comment">!     Calculate 3D Stokes drift current for export</span></div>
<div class="line"><a name="l07245"></a><span class="lineno"> 7245</span>&#160;    <span class="comment">!</span></div>
<div class="line"><a name="l07246"></a><span class="lineno"> 7246</span>&#160;    <span class="comment">!  2. Method :</span></div>
<div class="line"><a name="l07247"></a><span class="lineno"> 7247</span>&#160;    <span class="comment">!</span></div>
<div class="line"><a name="l07248"></a><span class="lineno"> 7248</span>&#160;    <span class="comment">!    Kenyon, K. E. (1969), J. Geophys. R., Vol 74, No 28, p 6991</span></div>
<div class="line"><a name="l07249"></a><span class="lineno"> 7249</span>&#160;    <span class="comment">!</span></div>
<div class="line"><a name="l07250"></a><span class="lineno"> 7250</span>&#160;    <span class="comment">!    U_vec(z)</span></div>
<div class="line"><a name="l07251"></a><span class="lineno"> 7251</span>&#160;    <span class="comment">!             //</span></div>
<div class="line"><a name="l07252"></a><span class="lineno"> 7252</span>&#160;    <span class="comment">!      = 2 g || ( F(f,theta) k_vec/C cosh(2k(D+z))/sinh(2kD) ) dsig dtheta</span></div>
<div class="line"><a name="l07253"></a><span class="lineno"> 7253</span>&#160;    <span class="comment">!           //</span></div>
<div class="line"><a name="l07254"></a><span class="lineno"> 7254</span>&#160;    <span class="comment">!</span></div>
<div class="line"><a name="l07255"></a><span class="lineno"> 7255</span>&#160;    <span class="comment">!          //</span></div>
<div class="line"><a name="l07256"></a><span class="lineno"> 7256</span>&#160;    <span class="comment">!      =  || (Ac(k,theta) sig^2 k_vec/Cg cosh(2k(D+z))/sinh^2(kD) ) dsig dtheta</span></div>
<div class="line"><a name="l07257"></a><span class="lineno"> 7257</span>&#160;    <span class="comment">!        //</span></div>
<div class="line"><a name="l07258"></a><span class="lineno"> 7258</span>&#160;    <span class="comment">!</span></div>
<div class="line"><a name="l07259"></a><span class="lineno"> 7259</span>&#160;    <span class="comment">! Where:</span></div>
<div class="line"><a name="l07260"></a><span class="lineno"> 7260</span>&#160;    <span class="comment">!   Ac(k,theta) = wave action density</span></div>
<div class="line"><a name="l07261"></a><span class="lineno"> 7261</span>&#160;    <span class="comment">!   k_vec = k*[cos(theta),sin(theta)]</span></div>
<div class="line"><a name="l07262"></a><span class="lineno"> 7262</span>&#160;    <span class="comment">!   D = depth</span></div>
<div class="line"><a name="l07263"></a><span class="lineno"> 7263</span>&#160;    <span class="comment">!   z = height (0 = mean sea level)</span></div>
<div class="line"><a name="l07264"></a><span class="lineno"> 7264</span>&#160;    <span class="comment">!</span></div>
<div class="line"><a name="l07265"></a><span class="lineno"> 7265</span>&#160;    <span class="comment">! In deep water (kD large):  cosh(2k(D+z))/sinh^2(kD) --&gt; 2*exp(2kz)</span></div>
<div class="line"><a name="l07266"></a><span class="lineno"> 7266</span>&#160;    <span class="comment">!</span></div>
<div class="line"><a name="l07267"></a><span class="lineno"> 7267</span>&#160;    <span class="comment">!  3. Parameters :</span></div>
<div class="line"><a name="l07268"></a><span class="lineno"> 7268</span>&#160;    <span class="comment">!</span></div>
<div class="line"><a name="l07269"></a><span class="lineno"> 7269</span>&#160;    <span class="comment">!     Parameter list</span></div>
<div class="line"><a name="l07270"></a><span class="lineno"> 7270</span>&#160;    <span class="comment">!     ----------------------------------------------------------------</span></div>
<div class="line"><a name="l07271"></a><span class="lineno"> 7271</span>&#160;    <span class="comment">!       a         Real   I   Input spectra (in par list to change shape)</span></div>
<div class="line"><a name="l07272"></a><span class="lineno"> 7272</span>&#160;    <span class="comment">!       usxField  Type   I/O 3D SDC eastward-component export field</span></div>
<div class="line"><a name="l07273"></a><span class="lineno"> 7273</span>&#160;    <span class="comment">!       usyField  Type   I/O 3D SDC northward-component export field</span></div>
<div class="line"><a name="l07274"></a><span class="lineno"> 7274</span>&#160;    <span class="comment">!       rc        Int    O   Return code</span></div>
<div class="line"><a name="l07275"></a><span class="lineno"> 7275</span>&#160;    <span class="comment">!     ----------------------------------------------------------------</span></div>
<div class="line"><a name="l07276"></a><span class="lineno"> 7276</span>&#160;    <span class="comment">!</span></div>
<div class="line"><a name="l07277"></a><span class="lineno"> 7277</span>&#160;    <span class="comment">!  4. Subroutines used :</span></div>
<div class="line"><a name="l07278"></a><span class="lineno"> 7278</span>&#160;    <span class="comment">!</span></div>
<div class="line"><a name="l07279"></a><span class="lineno"> 7279</span>&#160;    <span class="comment">!      Name      Type  Module   Description</span></div>
<div class="line"><a name="l07280"></a><span class="lineno"> 7280</span>&#160;    <span class="comment">!     ----------------------------------------------------------------</span></div>
<div class="line"><a name="l07281"></a><span class="lineno"> 7281</span>&#160;    <span class="comment">!      NONE</span></div>
<div class="line"><a name="l07282"></a><span class="lineno"> 7282</span>&#160;    <span class="comment">!     ----------------------------------------------------------------</span></div>
<div class="line"><a name="l07283"></a><span class="lineno"> 7283</span>&#160;    <span class="comment">!</span></div>
<div class="line"><a name="l07284"></a><span class="lineno"> 7284</span>&#160;    <span class="comment">!  5. Called by :</span></div>
<div class="line"><a name="l07285"></a><span class="lineno"> 7285</span>&#160;    <span class="comment">!</span></div>
<div class="line"><a name="l07286"></a><span class="lineno"> 7286</span>&#160;    <span class="comment">!  6. Error messages :</span></div>
<div class="line"><a name="l07287"></a><span class="lineno"> 7287</span>&#160;    <span class="comment">!</span></div>
<div class="line"><a name="l07288"></a><span class="lineno"> 7288</span>&#160;    <span class="comment">!  7. Remarks :</span></div>
<div class="line"><a name="l07289"></a><span class="lineno"> 7289</span>&#160;    <span class="comment">!</span></div>
<div class="line"><a name="l07290"></a><span class="lineno"> 7290</span>&#160;    <span class="comment">!  8. Structure :</span></div>
<div class="line"><a name="l07291"></a><span class="lineno"> 7291</span>&#160;    <span class="comment">!</span></div>
<div class="line"><a name="l07292"></a><span class="lineno"> 7292</span>&#160;    <span class="comment">!  9. Switches :</span></div>
<div class="line"><a name="l07293"></a><span class="lineno"> 7293</span>&#160;    <span class="comment">!</span></div>
<div class="line"><a name="l07294"></a><span class="lineno"> 7294</span>&#160;    <span class="comment">! 10. Source code :</span></div>
<div class="line"><a name="l07295"></a><span class="lineno"> 7295</span>&#160;    <span class="comment">!</span></div>
<div class="line"><a name="l07296"></a><span class="lineno"> 7296</span>&#160;    <span class="comment">!/ ------------------------------------------------------------------- /</span></div>
<div class="line"><a name="l07297"></a><span class="lineno"> 7297</span>&#160;    <span class="comment">!/</span></div>
<div class="line"><a name="l07298"></a><span class="lineno"> 7298</span>&#160;    <span class="comment">!/ ------------------------------------------------------------------- /</span></div>
<div class="line"><a name="l07299"></a><span class="lineno"> 7299</span>&#160;    <span class="comment">!/ Parameter list</span></div>
<div class="line"><a name="l07300"></a><span class="lineno"> 7300</span>&#160;    <span class="comment">!/</span></div>
<div class="line"><a name="l07301"></a><span class="lineno"> 7301</span>&#160;    <span class="keywordtype">implicit none</span></div>
<div class="line"><a name="l07302"></a><span class="lineno"> 7302</span>&#160;<span class="keywordtype">    real</span>             :: a(nth,nk,0:nseal)</div>
<div class="line"><a name="l07303"></a><span class="lineno"> 7303</span>&#160;    <span class="keywordtype">type</span>(ESMF_Field) :: usxField</div>
<div class="line"><a name="l07304"></a><span class="lineno"> 7304</span>&#160;    <span class="keywordtype">type</span>(ESMF_Field) :: usyField</div>
<div class="line"><a name="l07305"></a><span class="lineno"> 7305</span>&#160;    <span class="keywordtype">integer</span>          :: rc</div>
<div class="line"><a name="l07306"></a><span class="lineno"> 7306</span>&#160;    <span class="comment">!/</span></div>
<div class="line"><a name="l07307"></a><span class="lineno"> 7307</span>&#160;    <span class="comment">!/ ------------------------------------------------------------------- /</span></div>
<div class="line"><a name="l07308"></a><span class="lineno"> 7308</span>&#160;    <span class="comment">!/ Local parameters</span></div>
<div class="line"><a name="l07309"></a><span class="lineno"> 7309</span>&#160;    <span class="comment">!/</span></div>
<div class="line"><a name="l07310"></a><span class="lineno"> 7310</span>&#160;<span class="keywordtype">    real</span>(8), <span class="keywordtype">parameter</span> :: zero  = 0.0</div>
<div class="line"><a name="l07311"></a><span class="lineno"> 7311</span>&#160;<span class="keywordtype">    real</span>(8), <span class="keywordtype">parameter</span> :: half  = 0.5</div>
<div class="line"><a name="l07312"></a><span class="lineno"> 7312</span>&#160;<span class="keywordtype">    real</span>(8), <span class="keywordtype">parameter</span> ::  one  = 1.0</div>
<div class="line"><a name="l07313"></a><span class="lineno"> 7313</span>&#160;<span class="keywordtype">    real</span>(8), <span class="keywordtype">parameter</span> ::  two  = 2.0</div>
<div class="line"><a name="l07314"></a><span class="lineno"> 7314</span>&#160;    <span class="comment">! kdmin = 1e-7: sinh(kdmin)**2 ~ 1e-14</span></div>
<div class="line"><a name="l07315"></a><span class="lineno"> 7315</span>&#160;<span class="keywordtype">    real</span>(8), <span class="keywordtype">parameter</span> :: kdmin = 1e-7</div>
<div class="line"><a name="l07316"></a><span class="lineno"> 7316</span>&#160;    <span class="comment">! kdmax = 18.0:  cosh(2*(kdmax+kz))/sinh(kdmax)**2 - 2*exp(2*kz) &lt; 1e-14</span></div>
<div class="line"><a name="l07317"></a><span class="lineno"> 7317</span>&#160;<span class="keywordtype">    real</span>(8), <span class="keywordtype">parameter</span> :: kdmax = 18.0</div>
<div class="line"><a name="l07318"></a><span class="lineno"> 7318</span>&#160;    <span class="comment">! kdmin &amp; kdmax settings used in w3iogomd</span></div>
<div class="line"><a name="l07319"></a><span class="lineno"> 7319</span>&#160;<span class="keywordtype">    real</span>(8), <span class="keywordtype">parameter</span> :: kdmin_us3d = 1e-3</div>
<div class="line"><a name="l07320"></a><span class="lineno"> 7320</span>&#160;<span class="keywordtype">    real</span>(8), <span class="keywordtype">parameter</span> :: kdmax_us3d = 6.0</div>
<div class="line"><a name="l07321"></a><span class="lineno"> 7321</span>&#160;    <span class="keywordtype">integer</span> :: isea, jsea, ik, ith, iz</div>
<div class="line"><a name="l07322"></a><span class="lineno"> 7322</span>&#160;<span class="keywordtype">    real</span>(8) :: depth</div>
<div class="line"><a name="l07323"></a><span class="lineno"> 7323</span>&#160;<span class="keywordtype">    real</span>(8) :: akx, aky, kd, kz, fac1, fac2, fac3</div>
<div class="line"><a name="l07324"></a><span class="lineno"> 7324</span>&#160;<span class="keywordtype">    real</span>(8) :: uzx(nz), uzy(nz)</div>
<div class="line"><a name="l07325"></a><span class="lineno"> 7325</span>&#160;<span class="keywordtype">    real</span>(8), <span class="keywordtype">allocatable</span> :: fack(:)</div>
<div class="line"><a name="l07326"></a><span class="lineno"> 7326</span>&#160;    <span class="keywordtype">type</span>(ESMF_Field) :: usxnField, usynField</div>
<div class="line"><a name="l07327"></a><span class="lineno"> 7327</span>&#160;<span class="keywordtype">    real</span>(ESMF_KIND_RX), <span class="keywordtype">pointer</span> :: usxn(:,:), usyn(:,:)</div>
<div class="line"><a name="l07328"></a><span class="lineno"> 7328</span>&#160;    <span class="keywordtype">integer</span>, <span class="keywordtype">save</span> :: timeSlice = 1</div>
<div class="line"><a name="l07329"></a><span class="lineno"> 7329</span>&#160;    <span class="comment">! Need this workaround to deal with ESMF_FieldCreate not setting up the</span></div>
<div class="line"><a name="l07330"></a><span class="lineno"> 7330</span>&#160;    <span class="comment">! Fortran arrays with the ungridded dimension as the first array dimension</span></div>
<div class="line"><a name="l07331"></a><span class="lineno"> 7331</span>&#160;<span class="preprocessor">#define ESMF_ARBSEQ_WORKAROUND</span></div>
<div class="line"><a name="l07332"></a><span class="lineno"> 7332</span>&#160;<span class="preprocessor"></span><span class="preprocessor">#ifdef ESMF_ARBSEQ_WORKAROUND</span></div>
<div class="line"><a name="l07333"></a><span class="lineno"> 7333</span>&#160;<span class="preprocessor"></span>    <span class="keywordtype">type</span>(ESMF_DistGrid) :: natDistGrid</div>
<div class="line"><a name="l07334"></a><span class="lineno"> 7334</span>&#160;    <span class="keywordtype">type</span>(ESMF_Array) :: usxnArray, usynArray</div>
<div class="line"><a name="l07335"></a><span class="lineno"> 7335</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l07336"></a><span class="lineno"> 7336</span>&#160;<span class="preprocessor"></span>    <span class="comment">!</span></div>
<div class="line"><a name="l07337"></a><span class="lineno"> 7337</span>&#160;    <span class="comment">! -------------------------------------------------------------------- /</span></div>
<div class="line"><a name="l07338"></a><span class="lineno"> 7338</span>&#160;    <span class="comment">!</span></div>
<div class="line"><a name="l07339"></a><span class="lineno"> 7339</span>&#160;    rc = esmf_success</div>
<div class="line"><a name="l07340"></a><span class="lineno"> 7340</span>&#160; </div>
<div class="line"><a name="l07341"></a><span class="lineno"> 7341</span>&#160;<span class="preprocessor">#ifdef ESMF_ARBSEQ_WORKAROUND</span></div>
<div class="line"><a name="l07342"></a><span class="lineno"> 7342</span>&#160;<span class="preprocessor"></span>    <span class="keyword">call </span>esmf_gridget( natgrid, distgrid=natdistgrid, rc=rc )</div>
<div class="line"><a name="l07343"></a><span class="lineno"> 7343</span>&#160;    <span class="keywordflow">if</span> (esmf_logfounderror(rc, passthru)) <span class="keywordflow">return</span></div>
<div class="line"><a name="l07344"></a><span class="lineno"> 7344</span>&#160;    usxnarray = esmf_arraycreate( natdistgrid, esmf_typekind_rx, &amp;</div>
<div class="line"><a name="l07345"></a><span class="lineno"> 7345</span>&#160;         distgridtoarraymap=(/2/), undistlbound=(/1/), undistubound=(/nz/), rc=rc )</div>
<div class="line"><a name="l07346"></a><span class="lineno"> 7346</span>&#160;    <span class="keywordflow">if</span> (esmf_logfounderror(rc, passthru)) <span class="keywordflow">return</span></div>
<div class="line"><a name="l07347"></a><span class="lineno"> 7347</span>&#160;    usxnfield = esmf_fieldcreate( natgrid, usxnarray, &amp;</div>
<div class="line"><a name="l07348"></a><span class="lineno"> 7348</span>&#160;         gridtofieldmap=(/2,3/), ungriddedlbound=(/1/), ungriddedubound=(/nz/), &amp;</div>
<div class="line"><a name="l07349"></a><span class="lineno"> 7349</span>&#160;         staggerloc=natstaggerloc, rc=rc )</div>
<div class="line"><a name="l07350"></a><span class="lineno"> 7350</span>&#160;    <span class="keywordflow">if</span> (esmf_logfounderror(rc, passthru)) <span class="keywordflow">return</span></div>
<div class="line"><a name="l07351"></a><span class="lineno"> 7351</span>&#160;    usynarray = esmf_arraycreate( natdistgrid, esmf_typekind_rx, &amp;</div>
<div class="line"><a name="l07352"></a><span class="lineno"> 7352</span>&#160;         distgridtoarraymap=(/2/), undistlbound=(/1/), undistubound=(/nz/), rc=rc )</div>
<div class="line"><a name="l07353"></a><span class="lineno"> 7353</span>&#160;    <span class="keywordflow">if</span> (esmf_logfounderror(rc, passthru)) <span class="keywordflow">return</span></div>
<div class="line"><a name="l07354"></a><span class="lineno"> 7354</span>&#160;    usynfield = esmf_fieldcreate( natgrid, usynarray, &amp;</div>
<div class="line"><a name="l07355"></a><span class="lineno"> 7355</span>&#160;         gridtofieldmap=(/2,3/), ungriddedlbound=(/1/), ungriddedubound=(/nz/), &amp;</div>
<div class="line"><a name="l07356"></a><span class="lineno"> 7356</span>&#160;         staggerloc=natstaggerloc, rc=rc )</div>
<div class="line"><a name="l07357"></a><span class="lineno"> 7357</span>&#160;    <span class="keywordflow">if</span> (esmf_logfounderror(rc, passthru)) <span class="keywordflow">return</span></div>
<div class="line"><a name="l07358"></a><span class="lineno"> 7358</span>&#160;<span class="preprocessor">#else</span></div>
<div class="line"><a name="l07359"></a><span class="lineno"> 7359</span>&#160;<span class="preprocessor"></span>    usxnfield = esmf_fieldcreate( natgrid, natarrayspec3d, &amp;</div>
<div class="line"><a name="l07360"></a><span class="lineno"> 7360</span>&#160;         gridtofieldmap=(/2,3/), ungriddedlbound=(/1/), ungriddedubound=(/nz/), &amp;</div>
<div class="line"><a name="l07361"></a><span class="lineno"> 7361</span>&#160;         staggerloc=natstaggerloc, rc=rc )</div>
<div class="line"><a name="l07362"></a><span class="lineno"> 7362</span>&#160;    <span class="keywordflow">if</span> (esmf_logfounderror(rc, passthru)) <span class="keywordflow">return</span></div>
<div class="line"><a name="l07363"></a><span class="lineno"> 7363</span>&#160;    usynfield = esmf_fieldcreate( natgrid, natarrayspec3d, &amp;</div>
<div class="line"><a name="l07364"></a><span class="lineno"> 7364</span>&#160;         gridtofieldmap=(/2,3/), ungriddedlbound=(/1/), ungriddedubound=(/nz/), &amp;</div>
<div class="line"><a name="l07365"></a><span class="lineno"> 7365</span>&#160;         staggerloc=natstaggerloc, rc=rc )</div>
<div class="line"><a name="l07366"></a><span class="lineno"> 7366</span>&#160;    <span class="keywordflow">if</span> (esmf_logfounderror(rc, passthru)) <span class="keywordflow">return</span></div>
<div class="line"><a name="l07367"></a><span class="lineno"> 7367</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l07368"></a><span class="lineno"> 7368</span>&#160;<span class="preprocessor"></span> </div>
<div class="line"><a name="l07369"></a><span class="lineno"> 7369</span>&#160;    <span class="keyword">call </span>fieldfill( usxnfield, zerovalue, rc=rc )</div>
<div class="line"><a name="l07370"></a><span class="lineno"> 7370</span>&#160;    <span class="keywordflow">if</span> (esmf_logfounderror(rc, passthru)) <span class="keywordflow">return</span></div>
<div class="line"><a name="l07371"></a><span class="lineno"> 7371</span>&#160;    <span class="keyword">call </span>fieldfill( usynfield, zerovalue, rc=rc )</div>
<div class="line"><a name="l07372"></a><span class="lineno"> 7372</span>&#160;    <span class="keywordflow">if</span> (esmf_logfounderror(rc, passthru)) <span class="keywordflow">return</span></div>
<div class="line"><a name="l07373"></a><span class="lineno"> 7373</span>&#160; </div>
<div class="line"><a name="l07374"></a><span class="lineno"> 7374</span>&#160;    <span class="keywordflow">if</span> ( natgridislocal ) <span class="keywordflow">then</span></div>
<div class="line"><a name="l07375"></a><span class="lineno"> 7375</span>&#160; </div>
<div class="line"><a name="l07376"></a><span class="lineno"> 7376</span>&#160;      <span class="keyword">call </span>esmf_fieldget( usxnfield, farrayptr=usxn, rc=rc )</div>
<div class="line"><a name="l07377"></a><span class="lineno"> 7377</span>&#160;      <span class="keywordflow">if</span> (esmf_logfounderror(rc, passthru)) <span class="keywordflow">return</span></div>
<div class="line"><a name="l07378"></a><span class="lineno"> 7378</span>&#160;      <span class="keyword">call </span>esmf_fieldget( usynfield, farrayptr=usyn, rc=rc )</div>
<div class="line"><a name="l07379"></a><span class="lineno"> 7379</span>&#160;      <span class="keywordflow">if</span> (esmf_logfounderror(rc, passthru)) <span class="keywordflow">return</span></div>
<div class="line"><a name="l07380"></a><span class="lineno"> 7380</span>&#160; </div>
<div class="line"><a name="l07381"></a><span class="lineno"> 7381</span>&#160;      <span class="keyword">allocate</span>( fack(1:nk) )</div>
<div class="line"><a name="l07382"></a><span class="lineno"> 7382</span>&#160;      fack(1:nk) = dden(1:nk) * sig(1:nk)</div>
<div class="line"><a name="l07383"></a><span class="lineno"> 7383</span>&#160; </div>
<div class="line"><a name="l07384"></a><span class="lineno"> 7384</span>&#160;      jsea_loop: <span class="keywordflow">do</span> jsea = 1,nseal</div>
<div class="line"><a name="l07385"></a><span class="lineno"> 7385</span>&#160;<span class="preprocessor">#ifdef W3_DIST</span></div>
<div class="line"><a name="l07386"></a><span class="lineno"> 7386</span>&#160;<span class="preprocessor"></span>        isea = <a class="code" href="namespacew3odatmd.html#a36a4047055987bb52cab303f0207f676">iaproc</a> + (jsea-1)*<a class="code" href="namespacew3odatmd.html#a5fb3206737f511149173f90ece6bb54f">naproc</a></div>
<div class="line"><a name="l07387"></a><span class="lineno"> 7387</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l07388"></a><span class="lineno"> 7388</span>&#160;<span class="preprocessor"></span><span class="preprocessor">#ifdef W3_SHRD</span></div>
<div class="line"><a name="l07389"></a><span class="lineno"> 7389</span>&#160;<span class="preprocessor"></span>        isea = jsea</div>
<div class="line"><a name="l07390"></a><span class="lineno"> 7390</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l07391"></a><span class="lineno"> 7391</span>&#160;<span class="preprocessor"></span>        <span class="keywordflow">if</span> ( <a class="code" href="namespacew3adatmd.html#afa9c18e382373af88df0f16b91a82065">dw</a>(isea).le.<a class="code" href="namespacescrip__constants.html#a8f7ef7b037191fbbeb9b568788a77405">zero</a> ) cycle jsea_loop</div>
<div class="line"><a name="l07392"></a><span class="lineno"> 7392</span>&#160;        depth = max(dmin,<a class="code" href="namespacew3adatmd.html#afa9c18e382373af88df0f16b91a82065">dw</a>(isea))</div>
<div class="line"><a name="l07393"></a><span class="lineno"> 7393</span>&#160;        uzx(:) = <a class="code" href="namespacescrip__constants.html#a8f7ef7b037191fbbeb9b568788a77405">zero</a></div>
<div class="line"><a name="l07394"></a><span class="lineno"> 7394</span>&#160;        uzy(:) = <a class="code" href="namespacescrip__constants.html#a8f7ef7b037191fbbeb9b568788a77405">zero</a></div>
<div class="line"><a name="l07395"></a><span class="lineno"> 7395</span>&#160;<span class="preprocessor">#ifdef USE_W3OUTG_FOR_EXPORT</span></div>
<div class="line"><a name="l07396"></a><span class="lineno"> 7396</span>&#160;<span class="preprocessor"></span>        ik_loop: <span class="keywordflow">do</span> ik = us3df(2),us3df(3)</div>
<div class="line"><a name="l07397"></a><span class="lineno"> 7397</span>&#160;          fac1 = tpiinv*dsii(ik)</div>
<div class="line"><a name="l07398"></a><span class="lineno"> 7398</span>&#160;          kd = max(kdmin_us3d,<a class="code" href="namespacew3adatmd.html#a2087a76dd0ef641047dfa5788f9833fd">wn</a>(ik,isea)*<a class="code" href="namespacew3adatmd.html#afa9c18e382373af88df0f16b91a82065">dw</a>(isea))</div>
<div class="line"><a name="l07399"></a><span class="lineno"> 7399</span>&#160;          iz_loop: <span class="keywordflow">do</span> iz = 1,nz</div>
<div class="line"><a name="l07400"></a><span class="lineno"> 7400</span>&#160;            <span class="keywordflow">if</span> ( <a class="code" href="namespacew3adatmd.html#afa9c18e382373af88df0f16b91a82065">dw</a>(isea)+zl(iz).le.<a class="code" href="namespacescrip__constants.html#a8f7ef7b037191fbbeb9b568788a77405">zero</a> ) cycle iz_loop</div>
<div class="line"><a name="l07401"></a><span class="lineno"> 7401</span>&#160;            kz = <a class="code" href="namespacew3adatmd.html#a2087a76dd0ef641047dfa5788f9833fd">wn</a>(ik,isea)*zl(iz)</div>
<div class="line"><a name="l07402"></a><span class="lineno"> 7402</span>&#160;            <span class="keywordflow">if</span> ( kd .lt. kdmax_us3d ) <span class="keywordflow">then</span></div>
<div class="line"><a name="l07403"></a><span class="lineno"> 7403</span>&#160;              fac2 = fac1*cosh(<a class="code" href="namespacescrip__constants.html#a02fdf10dccdc4cfbb4218e5f8df5d6fb">two</a>*max(<a class="code" href="namespacescrip__constants.html#a8f7ef7b037191fbbeb9b568788a77405">zero</a>,kd+kz))/cosh(<a class="code" href="namespacescrip__constants.html#a02fdf10dccdc4cfbb4218e5f8df5d6fb">two</a>*kd)</div>
<div class="line"><a name="l07404"></a><span class="lineno"> 7404</span>&#160;            <span class="keywordflow">else</span></div>
<div class="line"><a name="l07405"></a><span class="lineno"> 7405</span>&#160;              fac2 = fac1*exp(<a class="code" href="namespacescrip__constants.html#a02fdf10dccdc4cfbb4218e5f8df5d6fb">two</a>*kz)</div>
<div class="line"><a name="l07406"></a><span class="lineno"> 7406</span>&#160;<span class="keywordflow">            endif</span></div>
<div class="line"><a name="l07407"></a><span class="lineno"> 7407</span>&#160;            uzx(iz) = uzx(iz) + <a class="code" href="namespacew3adatmd.html#a699e1ebfc57530e36053a26ad9530c0f">us3d</a>(jsea,ik   )*fac2</div>
<div class="line"><a name="l07408"></a><span class="lineno"> 7408</span>&#160;            uzy(iz) = uzy(iz) + <a class="code" href="namespacew3adatmd.html#a699e1ebfc57530e36053a26ad9530c0f">us3d</a>(jsea,nk+ik)*fac2</div>
<div class="line"><a name="l07409"></a><span class="lineno"> 7409</span>&#160;<span class="keywordflow">          enddo</span> iz_loop</div>
<div class="line"><a name="l07410"></a><span class="lineno"> 7410</span>&#160;<span class="keywordflow">        enddo</span> ik_loop</div>
<div class="line"><a name="l07411"></a><span class="lineno"> 7411</span>&#160;<span class="preprocessor">#else</span></div>
<div class="line"><a name="l07412"></a><span class="lineno"> 7412</span>&#160;<span class="preprocessor"></span>        ik_loop: <span class="keywordflow">do</span> ik = 1,nk</div>
<div class="line"><a name="l07413"></a><span class="lineno"> 7413</span>&#160;          akx = <a class="code" href="namespacescrip__constants.html#a8f7ef7b037191fbbeb9b568788a77405">zero</a></div>
<div class="line"><a name="l07414"></a><span class="lineno"> 7414</span>&#160;          aky = <a class="code" href="namespacescrip__constants.html#a8f7ef7b037191fbbeb9b568788a77405">zero</a></div>
<div class="line"><a name="l07415"></a><span class="lineno"> 7415</span>&#160;          ith_loop: <span class="keywordflow">do</span> ith = 1,nth</div>
<div class="line"><a name="l07416"></a><span class="lineno"> 7416</span>&#160;            akx = akx + a(ith,ik,jsea)*ecos(ith)</div>
<div class="line"><a name="l07417"></a><span class="lineno"> 7417</span>&#160;            aky = aky + a(ith,ik,jsea)*esin(ith)</div>
<div class="line"><a name="l07418"></a><span class="lineno"> 7418</span>&#160;<span class="keywordflow">          enddo</span> ith_loop</div>
<div class="line"><a name="l07419"></a><span class="lineno"> 7419</span>&#160;          fac1 = fack(ik)*<a class="code" href="namespacew3adatmd.html#a2087a76dd0ef641047dfa5788f9833fd">wn</a>(ik,isea)/<a class="code" href="namespacew3adatmd.html#adaccc46c70348e68ea06c9e0977522e6">cg</a>(ik,isea)</div>
<div class="line"><a name="l07420"></a><span class="lineno"> 7420</span>&#160;          kd = max(kdmin,<a class="code" href="namespacew3adatmd.html#a2087a76dd0ef641047dfa5788f9833fd">wn</a>(ik,isea)*depth)</div>
<div class="line"><a name="l07421"></a><span class="lineno"> 7421</span>&#160;          <span class="keywordflow">if</span> ( kd .lt. kdmax ) <span class="keywordflow">then</span></div>
<div class="line"><a name="l07422"></a><span class="lineno"> 7422</span>&#160;            fac2 = fac1/sinh(kd)**2</div>
<div class="line"><a name="l07423"></a><span class="lineno"> 7423</span>&#160;          <span class="keywordflow">else</span></div>
<div class="line"><a name="l07424"></a><span class="lineno"> 7424</span>&#160;            fac2 = fac1*<a class="code" href="namespacescrip__constants.html#a02fdf10dccdc4cfbb4218e5f8df5d6fb">two</a></div>
<div class="line"><a name="l07425"></a><span class="lineno"> 7425</span>&#160;<span class="keywordflow">          endif</span></div>
<div class="line"><a name="l07426"></a><span class="lineno"> 7426</span>&#160;          akx = akx*fac2</div>
<div class="line"><a name="l07427"></a><span class="lineno"> 7427</span>&#160;          aky = aky*fac2</div>
<div class="line"><a name="l07428"></a><span class="lineno"> 7428</span>&#160;          iz_loop: <span class="keywordflow">do</span> iz = 1,nz</div>
<div class="line"><a name="l07429"></a><span class="lineno"> 7429</span>&#160;            <span class="keywordflow">if</span> ( depth+zl(iz).le.<a class="code" href="namespacescrip__constants.html#a8f7ef7b037191fbbeb9b568788a77405">zero</a> ) cycle iz_loop</div>
<div class="line"><a name="l07430"></a><span class="lineno"> 7430</span>&#160;            kz = <a class="code" href="namespacew3adatmd.html#a2087a76dd0ef641047dfa5788f9833fd">wn</a>(ik,isea)*zl(iz)</div>
<div class="line"><a name="l07431"></a><span class="lineno"> 7431</span>&#160;            <span class="keywordflow">if</span> ( kd .lt. kdmax ) <span class="keywordflow">then</span></div>
<div class="line"><a name="l07432"></a><span class="lineno"> 7432</span>&#160;              fac3 = cosh(<a class="code" href="namespacescrip__constants.html#a02fdf10dccdc4cfbb4218e5f8df5d6fb">two</a>*max(<a class="code" href="namespacescrip__constants.html#a8f7ef7b037191fbbeb9b568788a77405">zero</a>,kd+kz))</div>
<div class="line"><a name="l07433"></a><span class="lineno"> 7433</span>&#160;            <span class="keywordflow">else</span></div>
<div class="line"><a name="l07434"></a><span class="lineno"> 7434</span>&#160;              fac3 = exp(<a class="code" href="namespacescrip__constants.html#a02fdf10dccdc4cfbb4218e5f8df5d6fb">two</a>*kz)</div>
<div class="line"><a name="l07435"></a><span class="lineno"> 7435</span>&#160;<span class="keywordflow">            endif</span></div>
<div class="line"><a name="l07436"></a><span class="lineno"> 7436</span>&#160;            uzx(iz) = uzx(iz) + akx*fac3</div>
<div class="line"><a name="l07437"></a><span class="lineno"> 7437</span>&#160;            uzy(iz) = uzy(iz) + aky*fac3</div>
<div class="line"><a name="l07438"></a><span class="lineno"> 7438</span>&#160;<span class="keywordflow">          enddo</span> iz_loop</div>
<div class="line"><a name="l07439"></a><span class="lineno"> 7439</span>&#160;<span class="keywordflow">        enddo</span> ik_loop</div>
<div class="line"><a name="l07440"></a><span class="lineno"> 7440</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l07441"></a><span class="lineno"> 7441</span>&#160;<span class="preprocessor"></span>        usxn(:,jsea) = uzx(:)</div>
<div class="line"><a name="l07442"></a><span class="lineno"> 7442</span>&#160;        usyn(:,jsea) = uzy(:)</div>
<div class="line"><a name="l07443"></a><span class="lineno"> 7443</span>&#160;<span class="keywordflow">      enddo</span> jsea_loop</div>
<div class="line"><a name="l07444"></a><span class="lineno"> 7444</span>&#160; </div>
<div class="line"><a name="l07445"></a><span class="lineno"> 7445</span>&#160;      <span class="keyword">deallocate</span>( fack )</div>
<div class="line"><a name="l07446"></a><span class="lineno"> 7446</span>&#160; </div>
<div class="line"><a name="l07447"></a><span class="lineno"> 7447</span>&#160;<span class="keywordflow">    endif</span> <span class="comment">!natGridIsLocal</span></div>
<div class="line"><a name="l07448"></a><span class="lineno"> 7448</span>&#160; </div>
<div class="line"><a name="l07449"></a><span class="lineno"> 7449</span>&#160;    <span class="keyword">call </span>esmf_fieldredist( usxnfield, usxfield, n2erh, rc=rc )</div>
<div class="line"><a name="l07450"></a><span class="lineno"> 7450</span>&#160;    <span class="keywordflow">if</span> (esmf_logfounderror(rc, passthru)) <span class="keywordflow">return</span></div>
<div class="line"><a name="l07451"></a><span class="lineno"> 7451</span>&#160;    <span class="keyword">call </span>esmf_fieldredist( usynfield, usyfield, n2erh, rc=rc )</div>
<div class="line"><a name="l07452"></a><span class="lineno"> 7452</span>&#160;    <span class="keywordflow">if</span> (esmf_logfounderror(rc, passthru)) <span class="keywordflow">return</span></div>
<div class="line"><a name="l07453"></a><span class="lineno"> 7453</span>&#160; </div>
<div class="line"><a name="l07454"></a><span class="lineno"> 7454</span>&#160;<span class="preprocessor">#ifdef ESMF_ARBSEQ_WORKAROUND</span></div>
<div class="line"><a name="l07455"></a><span class="lineno"> 7455</span>&#160;<span class="preprocessor"></span>    <span class="keyword">call </span>esmf_arraydestroy( usxnarray, rc=rc )</div>
<div class="line"><a name="l07456"></a><span class="lineno"> 7456</span>&#160;    <span class="keywordflow">if</span> (esmf_logfounderror(rc, passthru)) <span class="keywordflow">return</span></div>
<div class="line"><a name="l07457"></a><span class="lineno"> 7457</span>&#160;    <span class="keyword">call </span>esmf_arraydestroy( usynarray, rc=rc )</div>
<div class="line"><a name="l07458"></a><span class="lineno"> 7458</span>&#160;    <span class="keywordflow">if</span> (esmf_logfounderror(rc, passthru)) <span class="keywordflow">return</span></div>
<div class="line"><a name="l07459"></a><span class="lineno"> 7459</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l07460"></a><span class="lineno"> 7460</span>&#160;<span class="preprocessor"></span>    <span class="keyword">call </span>esmf_fielddestroy( usxnfield, rc=rc )</div>
<div class="line"><a name="l07461"></a><span class="lineno"> 7461</span>&#160;    <span class="keywordflow">if</span> (esmf_logfounderror(rc, passthru)) <span class="keywordflow">return</span></div>
<div class="line"><a name="l07462"></a><span class="lineno"> 7462</span>&#160;    <span class="keyword">call </span>esmf_fielddestroy( usynfield, rc=rc )</div>
<div class="line"><a name="l07463"></a><span class="lineno"> 7463</span>&#160;    <span class="keywordflow">if</span> (esmf_logfounderror(rc, passthru)) <span class="keywordflow">return</span></div>
<div class="line"><a name="l07464"></a><span class="lineno"> 7464</span>&#160; </div>
<div class="line"><a name="l07465"></a><span class="lineno"> 7465</span>&#160;<span class="preprocessor">#ifdef TEST_WMESMFMD_STOKES3D</span></div>
<div class="line"><a name="l07466"></a><span class="lineno"> 7466</span>&#160;<span class="preprocessor"></span>    <span class="keyword">call </span>esmf_fieldwrite( usxfield, <span class="stringliteral">&quot;wmesmfmd_stokes3d_usx.nc&quot;</span>, &amp;</div>
<div class="line"><a name="l07467"></a><span class="lineno"> 7467</span>&#160;         overwrite=.true., timeslice=timeslice, rc=rc )</div>
<div class="line"><a name="l07468"></a><span class="lineno"> 7468</span>&#160;    <span class="keywordflow">if</span> (esmf_logfounderror(rc, passthru)) <span class="keywordflow">return</span></div>
<div class="line"><a name="l07469"></a><span class="lineno"> 7469</span>&#160;    <span class="keyword">call </span>esmf_fieldwrite( usyfield, <span class="stringliteral">&quot;wmesmfmd_stokes3d_usy.nc&quot;</span>, &amp;</div>
<div class="line"><a name="l07470"></a><span class="lineno"> 7470</span>&#160;         overwrite=.true., timeslice=timeslice, rc=rc )</div>
<div class="line"><a name="l07471"></a><span class="lineno"> 7471</span>&#160;    <span class="keywordflow">if</span> (esmf_logfounderror(rc, passthru)) <span class="keywordflow">return</span></div>
<div class="line"><a name="l07472"></a><span class="lineno"> 7472</span>&#160;    timeslice = timeslice + 1</div>
<div class="line"><a name="l07473"></a><span class="lineno"> 7473</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l07474"></a><span class="lineno"> 7474</span>&#160;<span class="preprocessor"></span>    <span class="comment">!/</span></div>
<div class="line"><a name="l07475"></a><span class="lineno"> 7475</span>&#160;    <span class="comment">!/ End of CalcStokes3D ----------------------------------------------- /</span></div>
<div class="line"><a name="l07476"></a><span class="lineno"> 7476</span>&#160;    <span class="comment">!/</span></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="w3iogomd_8F90_source.html#l04156">w3iogomd::calc_u3stokes()</a>, <a class="el" href="w3adatmd_8F90_source.html#l00575">w3adatmd::cg</a>, <a class="el" href="w3gdatmd_8F90_source.html#l01234">w3gdatmd::dden</a>, <a class="el" href="w3gdatmd_8F90_source.html#l01183">w3gdatmd::dmin</a>, <a class="el" href="w3gdatmd_8F90_source.html#l01234">w3gdatmd::dsii</a>, <a class="el" href="w3adatmd_8F90_source.html#l00584">w3adatmd::dw</a>, <a class="el" href="w3gdatmd_8F90_source.html#l01234">w3gdatmd::ecos</a>, <a class="el" href="w3gdatmd_8F90_source.html#l01234">w3gdatmd::esin</a>, <a class="el" href="w3odatmd_8F90_source.html#l00457">w3odatmd::iaproc</a>, <a class="el" href="w3odatmd_8F90_source.html#l00457">w3odatmd::naproc</a>, <a class="el" href="w3gdatmd_8F90_source.html#l01234">w3gdatmd::sig</a>, <a class="el" href="constants_8F90_source.html#l00074">constants::tpiinv</a>, <a class="el" href="w3adatmd_8F90_source.html#l00612">w3adatmd::us3d</a>, <a class="el" href="w3gdatmd_8F90_source.html#l01098">w3gdatmd::us3df</a>, <a class="el" href="w3adatmd_8F90_source.html#l00612">w3adatmd::ussp</a>, and <a class="el" href="w3adatmd_8F90_source.html#l00575">w3adatmd::wn</a>.</p>

</div>
</div>
<a id="abb7958f7e4f953e69c0d63d81b55d3bf"></a>
<h2 class="memtitle"><span class="permalink"><a href="#abb7958f7e4f953e69c0d63d81b55d3bf">&#9670;&nbsp;</a></span>createexpmesh()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">subroutine wmesmfmd::createexpmesh </td>
          <td>(</td>
          <td class="paramtype">type(esmf_gridcomp)&#160;</td>
          <td class="paramname"><em>gcomp</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">integer, intent(out)&#160;</td>
          <td class="paramname"><em>rc</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Create ESMF mesh (unstructured) for export fields. </p>
<p>Create an ESMF Mesh for export using the unstructured mesh description in W3GDATMD. At present, this export mesh is not domain decomposed, but instead is defined on PET 0 only. (In future, when the unstructured mesh will run on domain decomposition, we will use that decomposition.)</p>
<p>Since the internal parallel data is currently stored accross grid points in a "card deck" fashion, we will define an intermediate native grid, as is done for regular/curvilinear grids, and perform an ESMF regrid to the export mesh. This code segment is taken from T. J. Campbell, and modified to 1D, because the internal data structure for unstructred meshes is an array with dimensions [NX,NY=1].</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir"></td><td class="paramname">gcomp</td><td>Gridded component </td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">rc</td><td>Return code</td></tr>
  </table>
  </dd>
</dl>
<dl class="section author"><dt>Author</dt><dd>A. J. van der Westhuysen </dd></dl>
<dl class="section date"><dt>Date</dt><dd>28-Feb-2018 </dd></dl>

<p class="definition">Definition at line <a class="el" href="wmesmfmd_8F90_source.html#l04554">4554</a> of file <a class="el" href="wmesmfmd_8F90_source.html">wmesmfmd.F90</a>.</p>
<div class="fragment"><div class="line"><a name="l04554"></a><span class="lineno"> 4554</span>&#160;    <span class="comment">!/</span></div>
<div class="line"><a name="l04555"></a><span class="lineno"> 4555</span>&#160;    <span class="comment">!/                  +-----------------------------------+</span></div>
<div class="line"><a name="l04556"></a><span class="lineno"> 4556</span>&#160;    <span class="comment">!/                  | WAVEWATCH III           NOAA/NCEP |</span></div>
<div class="line"><a name="l04557"></a><span class="lineno"> 4557</span>&#160;    <span class="comment">!/                  |     A. J. van der Westhuysen      |</span></div>
<div class="line"><a name="l04558"></a><span class="lineno"> 4558</span>&#160;    <span class="comment">!/                  |                        FORTRAN 90 |</span></div>
<div class="line"><a name="l04559"></a><span class="lineno"> 4559</span>&#160;    <span class="comment">!/                  | Last update :         28-FEB-2018 |</span></div>
<div class="line"><a name="l04560"></a><span class="lineno"> 4560</span>&#160;    <span class="comment">!/                  +-----------------------------------+</span></div>
<div class="line"><a name="l04561"></a><span class="lineno"> 4561</span>&#160;    <span class="comment">!/</span></div>
<div class="line"><a name="l04562"></a><span class="lineno"> 4562</span>&#160;    <span class="comment">!/    28-Feb-2018 : Origination.                        ( version 6.06 )</span></div>
<div class="line"><a name="l04563"></a><span class="lineno"> 4563</span>&#160;    <span class="comment">!/</span></div>
<div class="line"><a name="l04564"></a><span class="lineno"> 4564</span>&#160;    <span class="comment">!  1. Purpose :</span></div>
<div class="line"><a name="l04565"></a><span class="lineno"> 4565</span>&#160;    <span class="comment">!</span></div>
<div class="line"><a name="l04566"></a><span class="lineno"> 4566</span>&#160;    <span class="comment">!     Create ESMF mesh (unstructured) for export fields</span></div>
<div class="line"><a name="l04567"></a><span class="lineno"> 4567</span>&#160;    <span class="comment">!</span></div>
<div class="line"><a name="l04568"></a><span class="lineno"> 4568</span>&#160;    <span class="comment">!  2. Method :</span></div>
<div class="line"><a name="l04569"></a><span class="lineno"> 4569</span>&#160;    <span class="comment">!</span></div>
<div class="line"><a name="l04570"></a><span class="lineno"> 4570</span>&#160;    <span class="comment">!     Create an ESMF Mesh for export using the unstructured mesh description</span></div>
<div class="line"><a name="l04571"></a><span class="lineno"> 4571</span>&#160;    <span class="comment">!     in W3GDATMD. At present, this export mesh is not domain decomposed,</span></div>
<div class="line"><a name="l04572"></a><span class="lineno"> 4572</span>&#160;    <span class="comment">!     but instead is defined on PET 0 only. (In future, when the unstructured</span></div>
<div class="line"><a name="l04573"></a><span class="lineno"> 4573</span>&#160;    <span class="comment">!     mesh will run on domain decomposition, we will use that decomposition.)</span></div>
<div class="line"><a name="l04574"></a><span class="lineno"> 4574</span>&#160;    <span class="comment">!</span></div>
<div class="line"><a name="l04575"></a><span class="lineno"> 4575</span>&#160;    <span class="comment">!     Since the internal parallel data is currently stored accross grid points</span></div>
<div class="line"><a name="l04576"></a><span class="lineno"> 4576</span>&#160;    <span class="comment">!     in a &quot;card deck&quot; fashion, we will define an intermediate native grid, as</span></div>
<div class="line"><a name="l04577"></a><span class="lineno"> 4577</span>&#160;    <span class="comment">!     is done for regular/curvilinear grids, and perform an ESMF regrid to the</span></div>
<div class="line"><a name="l04578"></a><span class="lineno"> 4578</span>&#160;    <span class="comment">!     export mesh. This code segment is taken from T. J. Campbell, and</span></div>
<div class="line"><a name="l04579"></a><span class="lineno"> 4579</span>&#160;    <span class="comment">!     modified to 1D, because the internal data structure for unstructred</span></div>
<div class="line"><a name="l04580"></a><span class="lineno"> 4580</span>&#160;    <span class="comment">!     meshes is an array with dimensions [NX,NY=1].</span></div>
<div class="line"><a name="l04581"></a><span class="lineno"> 4581</span>&#160;    <span class="comment">!</span></div>
<div class="line"><a name="l04582"></a><span class="lineno"> 4582</span>&#160;    <span class="comment">!  3. Parameters :</span></div>
<div class="line"><a name="l04583"></a><span class="lineno"> 4583</span>&#160;    <span class="comment">!</span></div>
<div class="line"><a name="l04584"></a><span class="lineno"> 4584</span>&#160;    <span class="comment">!     Parameter list</span></div>
<div class="line"><a name="l04585"></a><span class="lineno"> 4585</span>&#160;    <span class="comment">!     ----------------------------------------------------------------</span></div>
<div class="line"><a name="l04586"></a><span class="lineno"> 4586</span>&#160;    <span class="comment">!       gcomp     Type   I/O Gridded component</span></div>
<div class="line"><a name="l04587"></a><span class="lineno"> 4587</span>&#160;    <span class="comment">!       rc        Int.   O   Return code</span></div>
<div class="line"><a name="l04588"></a><span class="lineno"> 4588</span>&#160;    <span class="comment">!     ----------------------------------------------------------------</span></div>
<div class="line"><a name="l04589"></a><span class="lineno"> 4589</span>&#160;    <span class="comment">!</span></div>
<div class="line"><a name="l04590"></a><span class="lineno"> 4590</span>&#160;    <span class="comment">!  4. Subroutines used :</span></div>
<div class="line"><a name="l04591"></a><span class="lineno"> 4591</span>&#160;    <span class="comment">!</span></div>
<div class="line"><a name="l04592"></a><span class="lineno"> 4592</span>&#160;    <span class="comment">!      Name      Type  Module   Description</span></div>
<div class="line"><a name="l04593"></a><span class="lineno"> 4593</span>&#160;    <span class="comment">!     ----------------------------------------------------------------</span></div>
<div class="line"><a name="l04594"></a><span class="lineno"> 4594</span>&#160;    <span class="comment">!      NONE</span></div>
<div class="line"><a name="l04595"></a><span class="lineno"> 4595</span>&#160;    <span class="comment">!     ----------------------------------------------------------------</span></div>
<div class="line"><a name="l04596"></a><span class="lineno"> 4596</span>&#160;    <span class="comment">!</span></div>
<div class="line"><a name="l04597"></a><span class="lineno"> 4597</span>&#160;    <span class="comment">!  5. Called by :</span></div>
<div class="line"><a name="l04598"></a><span class="lineno"> 4598</span>&#160;    <span class="comment">!</span></div>
<div class="line"><a name="l04599"></a><span class="lineno"> 4599</span>&#160;    <span class="comment">!  6. Error messages :</span></div>
<div class="line"><a name="l04600"></a><span class="lineno"> 4600</span>&#160;    <span class="comment">!</span></div>
<div class="line"><a name="l04601"></a><span class="lineno"> 4601</span>&#160;    <span class="comment">!  7. Remarks :</span></div>
<div class="line"><a name="l04602"></a><span class="lineno"> 4602</span>&#160;    <span class="comment">!</span></div>
<div class="line"><a name="l04603"></a><span class="lineno"> 4603</span>&#160;    <span class="comment">!  8. Structure :</span></div>
<div class="line"><a name="l04604"></a><span class="lineno"> 4604</span>&#160;    <span class="comment">!</span></div>
<div class="line"><a name="l04605"></a><span class="lineno"> 4605</span>&#160;    <span class="comment">!  9. Switches :</span></div>
<div class="line"><a name="l04606"></a><span class="lineno"> 4606</span>&#160;    <span class="comment">!</span></div>
<div class="line"><a name="l04607"></a><span class="lineno"> 4607</span>&#160;    <span class="comment">!       !/SHRD  Switch for shared / distributed memory architecture.</span></div>
<div class="line"><a name="l04608"></a><span class="lineno"> 4608</span>&#160;    <span class="comment">!       !/DIST  Id.</span></div>
<div class="line"><a name="l04609"></a><span class="lineno"> 4609</span>&#160;    <span class="comment">!</span></div>
<div class="line"><a name="l04610"></a><span class="lineno"> 4610</span>&#160;    <span class="comment">! 10. Source code :</span></div>
<div class="line"><a name="l04611"></a><span class="lineno"> 4611</span>&#160;    <span class="comment">!</span></div>
<div class="line"><a name="l04612"></a><span class="lineno"> 4612</span>&#160;    <span class="comment">!/ ------------------------------------------------------------------- /</span></div>
<div class="line"><a name="l04613"></a><span class="lineno"> 4613</span>&#160;    <span class="comment">!/</span></div>
<div class="line"><a name="l04614"></a><span class="lineno"> 4614</span>&#160;<span class="preprocessor">#ifdef W3_PDLIB</span></div>
<div class="line"><a name="l04615"></a><span class="lineno"> 4615</span>&#160;<span class="preprocessor"></span>    <span class="keywordtype">use </span><a class="code" href="namespaceyownodepool.html">yownodepool</a>, <span class="keywordtype">only</span>: <a class="code" href="namespaceyownodepool.html#ab77f5a6052a07d32d3f2debc49086fdc">npa</a>, <a class="code" href="namespaceyownodepool.html#aeb9586089a351e66fced1e5fa617e2ec">iplg</a>, <a class="code" href="namespaceyownodepool.html#a37e8a2849d4567665802bff23fa43a4d">nodes_global</a></div>
<div class="line"><a name="l04616"></a><span class="lineno"> 4616</span>&#160;    <span class="keywordtype">use </span><a class="code" href="namespaceyowelementpool.html">yowelementpool</a>, <span class="keywordtype">only</span>: <a class="code" href="namespaceyowelementpool.html#a7a6d4803690fc091c26d02151a507c25">ne</a>, <a class="code" href="namespaceyowelementpool.html#a0bd51f375cd41b9805d1185ed8e0d1e4">ielg</a>, <a class="code" href="namespaceyowelementpool.html#a814bfeb4a7ea372cb338c9885dd82a7c">ine</a></div>
<div class="line"><a name="l04617"></a><span class="lineno"> 4617</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l04618"></a><span class="lineno"> 4618</span>&#160;<span class="preprocessor"></span>    <span class="comment">!/</span></div>
<div class="line"><a name="l04619"></a><span class="lineno"> 4619</span>&#160;    <span class="comment">!/ ------------------------------------------------------------------- /</span></div>
<div class="line"><a name="l04620"></a><span class="lineno"> 4620</span>&#160;    <span class="comment">!/ Parameter list</span></div>
<div class="line"><a name="l04621"></a><span class="lineno"> 4621</span>&#160;    <span class="comment">!/</span></div>
<div class="line"><a name="l04622"></a><span class="lineno"> 4622</span>&#160;    <span class="keywordtype">implicit none</span></div>
<div class="line"><a name="l04623"></a><span class="lineno"> 4623</span>&#160;    <span class="keywordtype">type</span>(ESMF_GridComp) :: gcomp</div>
<div class="line"><a name="l04624"></a><span class="lineno"> 4624</span>&#160;    <span class="keywordtype">integer</span>,<span class="keywordtype">intent(out)</span> :: rc</div>
<div class="line"><a name="l04625"></a><span class="lineno"> 4625</span>&#160;    <span class="comment">!/</span></div>
<div class="line"><a name="l04626"></a><span class="lineno"> 4626</span>&#160;    <span class="comment">!/ ------------------------------------------------------------------- /</span></div>
<div class="line"><a name="l04627"></a><span class="lineno"> 4627</span>&#160;    <span class="comment">!/ Local parameters</span></div>
<div class="line"><a name="l04628"></a><span class="lineno"> 4628</span>&#160;    <span class="comment">!/</span></div>
<div class="line"><a name="l04629"></a><span class="lineno"> 4629</span>&#160;    <span class="keywordtype">character(ESMF_MAXSTR)</span> :: cname</div>
<div class="line"><a name="l04630"></a><span class="lineno"> 4630</span>&#160;    <span class="keywordtype">character(128)</span> :: msg</div>
<div class="line"><a name="l04631"></a><span class="lineno"> 4631</span>&#160;    <span class="keywordtype">integer</span> :: nproc, nxproc, nyproc, n, nfac, irp</div>
<div class="line"><a name="l04632"></a><span class="lineno"> 4632</span>&#160;<span class="keywordtype">    real</span>    :: gr, rp, pr, diff</div>
<div class="line"><a name="l04633"></a><span class="lineno"> 4633</span>&#160;    <span class="keywordtype">integer</span>, <span class="keywordtype">parameter</span> :: lde = 0</div>
<div class="line"><a name="l04634"></a><span class="lineno"> 4634</span>&#160;    <span class="keywordtype">integer</span> :: ldecnt</div>
<div class="line"><a name="l04635"></a><span class="lineno"> 4635</span>&#160;    <span class="keywordtype">integer</span> :: i, j, pos, ix, iy, isea, jsea, iproc</div>
<div class="line"><a name="l04636"></a><span class="lineno"> 4636</span>&#160;    <span class="keywordtype">integer</span> :: elb(2), eub(2)</div>
<div class="line"><a name="l04637"></a><span class="lineno"> 4637</span>&#160;    <span class="keywordtype">integer(ESMF_KIND_I4)</span>, <span class="keywordtype">pointer</span> :: iptr(:,:)</div>
<div class="line"><a name="l04638"></a><span class="lineno"> 4638</span>&#160;<span class="keywordtype">    real</span>(ESMF_KIND_RX), <span class="keywordtype">pointer</span> :: rptrx(:,:), rptry(:,:)</div>
<div class="line"><a name="l04639"></a><span class="lineno"> 4639</span>&#160;<span class="keywordtype">    real</span>(ESMF_KIND_RX), <span class="keywordtype">pointer</span> :: rptr(:,:)</div>
<div class="line"><a name="l04640"></a><span class="lineno"> 4640</span>&#160;    <span class="keywordtype">integer</span> :: arbIndexCount</div>
<div class="line"><a name="l04641"></a><span class="lineno"> 4641</span>&#160;    <span class="keywordtype">integer</span>, <span class="keywordtype">allocatable</span> :: arbIndexList(:,:)</div>
<div class="line"><a name="l04642"></a><span class="lineno"> 4642</span>&#160;    <span class="keywordtype">type</span>(ESMF_Field) :: nField, eField</div>
<div class="line"><a name="l04643"></a><span class="lineno"> 4643</span>&#160;    <span class="keywordtype">type</span>(ESMF_Field) :: tmpField</div>
<div class="line"><a name="l04644"></a><span class="lineno"> 4644</span>&#160;    <span class="keywordtype">integer(ESMF_KIND_I4)</span>, <span class="keywordtype">allocatable</span> :: nodeIds(:)</div>
<div class="line"><a name="l04645"></a><span class="lineno"> 4645</span>&#160;<span class="keywordtype">    real</span>(ESMF_KIND_R8), <span class="keywordtype">allocatable</span>    :: nodeCoords(:)</div>
<div class="line"><a name="l04646"></a><span class="lineno"> 4646</span>&#160;    <span class="keywordtype">integer(ESMF_KIND_I4)</span>, <span class="keywordtype">allocatable</span> :: nodeOwners(:)</div>
<div class="line"><a name="l04647"></a><span class="lineno"> 4647</span>&#160;    <span class="keywordtype">integer(ESMF_KIND_I4)</span>, <span class="keywordtype">allocatable</span> :: elemIds(:)</div>
<div class="line"><a name="l04648"></a><span class="lineno"> 4648</span>&#160;    <span class="keywordtype">integer(ESMF_KIND_I4)</span>, <span class="keywordtype">allocatable</span> :: elemTypes(:)</div>
<div class="line"><a name="l04649"></a><span class="lineno"> 4649</span>&#160;    <span class="keywordtype">integer(ESMF_KIND_I4)</span>, <span class="keywordtype">allocatable</span> :: elemConn(:)</div>
<div class="line"><a name="l04650"></a><span class="lineno"> 4650</span>&#160;    <span class="comment">!</span></div>
<div class="line"><a name="l04651"></a><span class="lineno"> 4651</span>&#160;    <span class="comment">! -------------------------------------------------------------------- /</span></div>
<div class="line"><a name="l04652"></a><span class="lineno"> 4652</span>&#160;    <span class="comment">! Prep</span></div>
<div class="line"><a name="l04653"></a><span class="lineno"> 4653</span>&#160;    <span class="comment">!</span></div>
<div class="line"><a name="l04654"></a><span class="lineno"> 4654</span>&#160;    rc = esmf_success</div>
<div class="line"><a name="l04655"></a><span class="lineno"> 4655</span>&#160;    <span class="keywordflow">if</span> ( noactiveexpfields ) <span class="keywordflow">return</span></div>
<div class="line"><a name="l04656"></a><span class="lineno"> 4656</span>&#160;    <span class="keyword">call </span>esmf_gridcompget(gcomp, name=cname, rc=rc)</div>
<div class="line"><a name="l04657"></a><span class="lineno"> 4657</span>&#160;    <span class="keywordflow">if</span> (esmf_logfounderror(rc, passthru)) <span class="keywordflow">return</span></div>
<div class="line"><a name="l04658"></a><span class="lineno"> 4658</span>&#160;    <span class="keywordflow">if</span> (verbosity.gt.0) <span class="keyword">call </span>esmf_logwrite(trim(cname)// &amp;</div>
<div class="line"><a name="l04659"></a><span class="lineno"> 4659</span>&#160;         <span class="stringliteral">&#39;: entered CreateExpMesh&#39;</span>, esmf_logmsg_info)</div>
<div class="line"><a name="l04660"></a><span class="lineno"> 4660</span>&#160;    <span class="comment">!</span></div>
<div class="line"><a name="l04661"></a><span class="lineno"> 4661</span>&#160;    <span class="comment">! -------------------------------------------------------------------- /</span></div>
<div class="line"><a name="l04662"></a><span class="lineno"> 4662</span>&#160;    <span class="comment">!     Set flag to indicate that this processor has local native grid storage</span></div>
<div class="line"><a name="l04663"></a><span class="lineno"> 4663</span>&#160;    <span class="comment">!</span></div>
<div class="line"><a name="l04664"></a><span class="lineno"> 4664</span>&#160;    natgridislocal = <a class="code" href="namespacew3odatmd.html#a36a4047055987bb52cab303f0207f676">iaproc</a> .gt. 0 .and. <a class="code" href="namespacew3odatmd.html#a36a4047055987bb52cab303f0207f676">iaproc</a> .le. <a class="code" href="namespacew3odatmd.html#a5fb3206737f511149173f90ece6bb54f">naproc</a></div>
<div class="line"><a name="l04665"></a><span class="lineno"> 4665</span>&#160; </div>
<div class="line"><a name="l04666"></a><span class="lineno"> 4666</span>&#160;    <span class="comment">! 1.  Setup</span></div>
<div class="line"><a name="l04667"></a><span class="lineno"> 4667</span>&#160;    <span class="comment">!</span></div>
<div class="line"><a name="l04668"></a><span class="lineno"> 4668</span>&#160;    <span class="comment">! 1.a Set grid pointers</span></div>
<div class="line"><a name="l04669"></a><span class="lineno"> 4669</span>&#160;    <span class="comment">!</span></div>
<div class="line"><a name="l04670"></a><span class="lineno"> 4670</span>&#160;    expgridid = 1 <span class="comment">!TODO: only export from grid 1</span></div>
<div class="line"><a name="l04671"></a><span class="lineno"> 4671</span>&#160;    <span class="keyword">call </span>w3setg ( expgridid, mdse, mdst )</div>
<div class="line"><a name="l04672"></a><span class="lineno"> 4672</span>&#160;    <span class="keyword">call </span><a class="code" href="namespacew3wdatmd.html#ac0bd6dc2f0effae7dce2f111cde16802">w3setw</a> ( expgridid, mdse, mdst )</div>
<div class="line"><a name="l04673"></a><span class="lineno"> 4673</span>&#160;    <span class="keyword">call </span><a class="code" href="namespacew3adatmd.html#ab2c0f2e6e7524fb061d841ba7a7324a1">w3seta</a> ( expgridid, mdse, mdst )</div>
<div class="line"><a name="l04674"></a><span class="lineno"> 4674</span>&#160;    <span class="keyword">call </span><a class="code" href="namespacew3idatmd.html#a0d197238708114cc861c919bb7b0f04f">w3seti</a> ( expgridid, mdse, mdst )</div>
<div class="line"><a name="l04675"></a><span class="lineno"> 4675</span>&#160;    <span class="keyword">call </span>w3seto ( expgridid, mdse, mdst )</div>
<div class="line"><a name="l04676"></a><span class="lineno"> 4676</span>&#160;    <span class="keyword">call </span>wmsetm ( expgridid, mdse, mdst )</div>
<div class="line"><a name="l04677"></a><span class="lineno"> 4677</span>&#160;    natgridid = expgridid</div>
<div class="line"><a name="l04678"></a><span class="lineno"> 4678</span>&#160;    nproc = <a class="code" href="namespacew3odatmd.html#a5fb3206737f511149173f90ece6bb54f">naproc</a></div>
<div class="line"><a name="l04679"></a><span class="lineno"> 4679</span>&#160;    <span class="comment">!</span></div>
<div class="line"><a name="l04680"></a><span class="lineno"> 4680</span>&#160;    <span class="comment">! 1.b Set arraySpec, staggerLoc, and indexFlag for native fields.</span></div>
<div class="line"><a name="l04681"></a><span class="lineno"> 4681</span>&#160;    <span class="comment">!     NOTE: For unstructured meshes the native grid is a 1D array (NY=1)</span></div>
<div class="line"><a name="l04682"></a><span class="lineno"> 4682</span>&#160;    <span class="comment">!</span></div>
<div class="line"><a name="l04683"></a><span class="lineno"> 4683</span>&#160;    <span class="keyword">call </span>esmf_arrayspecset( natarrayspec1d, <a class="code" href="namespaceyowrankmodule.html#aed43dc1f570b5625e119a367999116e2">rank</a>=1, &amp;</div>
<div class="line"><a name="l04684"></a><span class="lineno"> 4684</span>&#160;         typekind=esmf_typekind_rx, rc=rc )</div>
<div class="line"><a name="l04685"></a><span class="lineno"> 4685</span>&#160;    <span class="keywordflow">if</span> (esmf_logfounderror(rc, passthru)) <span class="keywordflow">return</span></div>
<div class="line"><a name="l04686"></a><span class="lineno"> 4686</span>&#160;    natstaggerloc = esmf_staggerloc_center</div>
<div class="line"><a name="l04687"></a><span class="lineno"> 4687</span>&#160;    natindexflag = esmf_index_delocal</div>
<div class="line"><a name="l04688"></a><span class="lineno"> 4688</span>&#160;    <span class="comment">!</span></div>
<div class="line"><a name="l04689"></a><span class="lineno"> 4689</span>&#160;    <span class="comment">! -------------------------------------------------------------------- /</span></div>
<div class="line"><a name="l04690"></a><span class="lineno"> 4690</span>&#160;    <span class="comment">! 2.  Create ESMF mesh for export</span></div>
<div class="line"><a name="l04691"></a><span class="lineno"> 4691</span>&#160;    <span class="comment">!</span></div>
<div class="line"><a name="l04692"></a><span class="lineno"> 4692</span>&#160;    <span class="comment">! 2.a Create ESMF export mesh</span></div>
<div class="line"><a name="l04693"></a><span class="lineno"> 4693</span>&#160;    <span class="comment">!</span></div>
<div class="line"><a name="l04694"></a><span class="lineno"> 4694</span>&#160;    <span class="comment">! Allocate and fill the node id array.</span></div>
<div class="line"><a name="l04695"></a><span class="lineno"> 4695</span>&#160;<span class="preprocessor">#ifdef W3_PDLIB</span></div>
<div class="line"><a name="l04696"></a><span class="lineno"> 4696</span>&#160;<span class="preprocessor"></span>    <span class="keywordflow">if</span> ( <a class="code" href="namespaceconstants.html#ad8b244917fc2f2b94d397086522af7a1">lpdlib</a> .EQV. .false. ) <span class="keywordflow">then</span></div>
<div class="line"><a name="l04697"></a><span class="lineno"> 4697</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l04698"></a><span class="lineno"> 4698</span>&#160;<span class="preprocessor"></span>      <span class="keyword">allocate</span>(nodeids(nx))</div>
<div class="line"><a name="l04699"></a><span class="lineno"> 4699</span>&#160;      <span class="keywordflow">do</span> i = 1,nx</div>
<div class="line"><a name="l04700"></a><span class="lineno"> 4700</span>&#160;        nodeids(i)=i</div>
<div class="line"><a name="l04701"></a><span class="lineno"> 4701</span>&#160;<span class="keywordflow">      enddo</span></div>
<div class="line"><a name="l04702"></a><span class="lineno"> 4702</span>&#160;<span class="preprocessor">#ifdef W3_PDLIB</span></div>
<div class="line"><a name="l04703"></a><span class="lineno"> 4703</span>&#160;<span class="preprocessor"></span>    <span class="keywordflow">else</span></div>
<div class="line"><a name="l04704"></a><span class="lineno"> 4704</span>&#160;      <span class="comment">!        -------------------------------------------------------------------</span></div>
<div class="line"><a name="l04705"></a><span class="lineno"> 4705</span>&#160;      <span class="comment">!        ESMF Definition: The global id&#39;s of the nodes resident on this processor</span></div>
<div class="line"><a name="l04706"></a><span class="lineno"> 4706</span>&#160;      <span class="comment">!        -------------------------------------------------------------------</span></div>
<div class="line"><a name="l04707"></a><span class="lineno"> 4707</span>&#160;      <span class="comment">!        Allocate global node ids, including ghost nodes (npa=np+ng)</span></div>
<div class="line"><a name="l04708"></a><span class="lineno"> 4708</span>&#160;      <span class="keyword">allocate</span>(nodeids(<a class="code" href="namespaceyownodepool.html#ab77f5a6052a07d32d3f2debc49086fdc">npa</a>))</div>
<div class="line"><a name="l04709"></a><span class="lineno"> 4709</span>&#160;      <span class="keywordflow">do</span> i = 1,<a class="code" href="namespaceyownodepool.html#ab77f5a6052a07d32d3f2debc49086fdc">npa</a></div>
<div class="line"><a name="l04710"></a><span class="lineno"> 4710</span>&#160;        nodeids(i)=<a class="code" href="namespaceyownodepool.html#aeb9586089a351e66fced1e5fa617e2ec">iplg</a>(i)</div>
<div class="line"><a name="l04711"></a><span class="lineno"> 4711</span>&#160;<span class="keywordflow">      enddo</span></div>
<div class="line"><a name="l04712"></a><span class="lineno"> 4712</span>&#160;<span class="keywordflow">    endif</span></div>
<div class="line"><a name="l04713"></a><span class="lineno"> 4713</span>&#160;    <span class="comment">!</span></div>
<div class="line"><a name="l04714"></a><span class="lineno"> 4714</span>&#160;    <span class="comment">!      call ESMF_LogWrite(trim(cname)//&#39;: In CreateExpMesh, nodeIds=&#39;, &amp;</span></div>
<div class="line"><a name="l04715"></a><span class="lineno"> 4715</span>&#160;    <span class="comment">!          ESMF_LOGMSG_INFO)</span></div>
<div class="line"><a name="l04716"></a><span class="lineno"> 4716</span>&#160;    <span class="comment">!         do i = 1,npa</span></div>
<div class="line"><a name="l04717"></a><span class="lineno"> 4717</span>&#160;    <span class="comment">!         write(msg,*) trim(cname)//&#39;: nodeIds(i)&#39;,i, &amp;</span></div>
<div class="line"><a name="l04718"></a><span class="lineno"> 4718</span>&#160;    <span class="comment">!          &#39; &#39;,nodeIds(i)</span></div>
<div class="line"><a name="l04719"></a><span class="lineno"> 4719</span>&#160;    <span class="comment">!        call ESMF_LogWrite(trim(msg), ESMF_LOGMSG_INFO)</span></div>
<div class="line"><a name="l04720"></a><span class="lineno"> 4720</span>&#160;    <span class="comment">!      enddo</span></div>
<div class="line"><a name="l04721"></a><span class="lineno"> 4721</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l04722"></a><span class="lineno"> 4722</span>&#160;<span class="preprocessor"></span> </div>
<div class="line"><a name="l04723"></a><span class="lineno"> 4723</span>&#160;    <span class="comment">!      call ESMF_LogWrite(trim(cname)//&#39;: In CreateExpMesh, nodeIds=&#39;, &amp;</span></div>
<div class="line"><a name="l04724"></a><span class="lineno"> 4724</span>&#160;    <span class="comment">!          ESMF_LOGMSG_INFO)</span></div>
<div class="line"><a name="l04725"></a><span class="lineno"> 4725</span>&#160;    <span class="comment">!      do i = 1,NX</span></div>
<div class="line"><a name="l04726"></a><span class="lineno"> 4726</span>&#160;    <span class="comment">!        write(msg,*) trim(cname)//&#39;: &#39;,i, &amp;</span></div>
<div class="line"><a name="l04727"></a><span class="lineno"> 4727</span>&#160;    <span class="comment">!          &#39; &#39;,nodeIds(i)</span></div>
<div class="line"><a name="l04728"></a><span class="lineno"> 4728</span>&#160;    <span class="comment">!        call ESMF_LogWrite(trim(msg), ESMF_LOGMSG_INFO)</span></div>
<div class="line"><a name="l04729"></a><span class="lineno"> 4729</span>&#160;    <span class="comment">!      enddo</span></div>
<div class="line"><a name="l04730"></a><span class="lineno"> 4730</span>&#160; </div>
<div class="line"><a name="l04731"></a><span class="lineno"> 4731</span>&#160;    <span class="comment">! Allocate and fill node coordinate array.</span></div>
<div class="line"><a name="l04732"></a><span class="lineno"> 4732</span>&#160;    <span class="comment">! Since this is a 2D Mesh the size is 2x the</span></div>
<div class="line"><a name="l04733"></a><span class="lineno"> 4733</span>&#160;    <span class="comment">! number of nodes.</span></div>
<div class="line"><a name="l04734"></a><span class="lineno"> 4734</span>&#160;<span class="preprocessor">#ifdef W3_PDLIB</span></div>
<div class="line"><a name="l04735"></a><span class="lineno"> 4735</span>&#160;<span class="preprocessor"></span>    <span class="keywordflow">if</span> ( <a class="code" href="namespaceconstants.html#ad8b244917fc2f2b94d397086522af7a1">lpdlib</a> .EQV. .false. ) <span class="keywordflow">then</span></div>
<div class="line"><a name="l04736"></a><span class="lineno"> 4736</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l04737"></a><span class="lineno"> 4737</span>&#160;<span class="preprocessor"></span>      <span class="keyword">allocate</span>(nodecoords(2*nx))</div>
<div class="line"><a name="l04738"></a><span class="lineno"> 4738</span>&#160;      <span class="keywordflow">do</span> i = 1,nx</div>
<div class="line"><a name="l04739"></a><span class="lineno"> 4739</span>&#160;        <span class="keywordflow">do</span> j = 1,2</div>
<div class="line"><a name="l04740"></a><span class="lineno"> 4740</span>&#160;          pos=2*(i-1)+j</div>
<div class="line"><a name="l04741"></a><span class="lineno"> 4741</span>&#160;          <span class="keywordflow">if</span> (j == 1) <span class="keywordflow">then</span></div>
<div class="line"><a name="l04742"></a><span class="lineno"> 4742</span>&#160;            nodecoords(pos) = xgrd(1,i)</div>
<div class="line"><a name="l04743"></a><span class="lineno"> 4743</span>&#160;          <span class="keywordflow">else</span></div>
<div class="line"><a name="l04744"></a><span class="lineno"> 4744</span>&#160;            nodecoords(pos) = ygrd(1,i)</div>
<div class="line"><a name="l04745"></a><span class="lineno"> 4745</span>&#160;<span class="keywordflow">          endif</span></div>
<div class="line"><a name="l04746"></a><span class="lineno"> 4746</span>&#160;<span class="keywordflow">        enddo</span></div>
<div class="line"><a name="l04747"></a><span class="lineno"> 4747</span>&#160;<span class="keywordflow">      enddo</span></div>
<div class="line"><a name="l04748"></a><span class="lineno"> 4748</span>&#160;<span class="preprocessor">#ifdef W3_PDLIB</span></div>
<div class="line"><a name="l04749"></a><span class="lineno"> 4749</span>&#160;<span class="preprocessor"></span>    <span class="keywordflow">else</span></div>
<div class="line"><a name="l04750"></a><span class="lineno"> 4750</span>&#160;      <span class="comment">!        -------------------------------------------------------------------</span></div>
<div class="line"><a name="l04751"></a><span class="lineno"> 4751</span>&#160;      <span class="comment">!        ESMF Definition: Physical coordinates of the nodes</span></div>
<div class="line"><a name="l04752"></a><span class="lineno"> 4752</span>&#160;      <span class="comment">!        -------------------------------------------------------------------</span></div>
<div class="line"><a name="l04753"></a><span class="lineno"> 4753</span>&#160;      <span class="keyword">allocate</span>(nodecoords(2*<a class="code" href="namespaceyownodepool.html#ab77f5a6052a07d32d3f2debc49086fdc">npa</a>))</div>
<div class="line"><a name="l04754"></a><span class="lineno"> 4754</span>&#160;      <span class="keywordflow">do</span> i = 1,<a class="code" href="namespaceyownodepool.html#ab77f5a6052a07d32d3f2debc49086fdc">npa</a></div>
<div class="line"><a name="l04755"></a><span class="lineno"> 4755</span>&#160;        <span class="keywordflow">do</span> j = 1,2</div>
<div class="line"><a name="l04756"></a><span class="lineno"> 4756</span>&#160;          pos=2*(i-1)+j</div>
<div class="line"><a name="l04757"></a><span class="lineno"> 4757</span>&#160;          <span class="keywordflow">if</span> ( j == 1) <span class="keywordflow">then</span></div>
<div class="line"><a name="l04758"></a><span class="lineno"> 4758</span>&#160;            nodecoords(pos) = xgrd(1,<a class="code" href="namespaceyownodepool.html#aeb9586089a351e66fced1e5fa617e2ec">iplg</a>(i))</div>
<div class="line"><a name="l04759"></a><span class="lineno"> 4759</span>&#160;          <span class="keywordflow">else</span></div>
<div class="line"><a name="l04760"></a><span class="lineno"> 4760</span>&#160;            nodecoords(pos) = ygrd(1,<a class="code" href="namespaceyownodepool.html#aeb9586089a351e66fced1e5fa617e2ec">iplg</a>(i))</div>
<div class="line"><a name="l04761"></a><span class="lineno"> 4761</span>&#160;<span class="keywordflow">          endif</span></div>
<div class="line"><a name="l04762"></a><span class="lineno"> 4762</span>&#160;<span class="keywordflow">        enddo</span></div>
<div class="line"><a name="l04763"></a><span class="lineno"> 4763</span>&#160;<span class="keywordflow">      enddo</span></div>
<div class="line"><a name="l04764"></a><span class="lineno"> 4764</span>&#160;<span class="keywordflow">    endif</span></div>
<div class="line"><a name="l04765"></a><span class="lineno"> 4765</span>&#160;    <span class="comment">!</span></div>
<div class="line"><a name="l04766"></a><span class="lineno"> 4766</span>&#160;    <span class="comment">!      call ESMF_LogWrite(trim(cname)//&#39;: In CreateExpMesh, nodeCoords=&#39;, &amp;</span></div>
<div class="line"><a name="l04767"></a><span class="lineno"> 4767</span>&#160;    <span class="comment">!          ESMF_LOGMSG_INFO)</span></div>
<div class="line"><a name="l04768"></a><span class="lineno"> 4768</span>&#160;    <span class="comment">!      do i = 1,(2*npa)</span></div>
<div class="line"><a name="l04769"></a><span class="lineno"> 4769</span>&#160;    <span class="comment">!        write(msg,*) trim(cname)//&#39;: nodeCoords(i)&#39;,i, &amp;</span></div>
<div class="line"><a name="l04770"></a><span class="lineno"> 4770</span>&#160;    <span class="comment">!          &#39; &#39;,nodeCoords(i)</span></div>
<div class="line"><a name="l04771"></a><span class="lineno"> 4771</span>&#160;    <span class="comment">!        call ESMF_LogWrite(trim(msg), ESMF_LOGMSG_INFO)</span></div>
<div class="line"><a name="l04772"></a><span class="lineno"> 4772</span>&#160;    <span class="comment">!      enddo</span></div>
<div class="line"><a name="l04773"></a><span class="lineno"> 4773</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l04774"></a><span class="lineno"> 4774</span>&#160;<span class="preprocessor"></span> </div>
<div class="line"><a name="l04775"></a><span class="lineno"> 4775</span>&#160;    <span class="comment">!      call ESMF_LogWrite(trim(cname)//&#39;: In CreateExpMesh, nodeCoords=&#39;, &amp;</span></div>
<div class="line"><a name="l04776"></a><span class="lineno"> 4776</span>&#160;    <span class="comment">!          ESMF_LOGMSG_INFO)</span></div>
<div class="line"><a name="l04777"></a><span class="lineno"> 4777</span>&#160;    <span class="comment">!      do i = 1,(2*NX)</span></div>
<div class="line"><a name="l04778"></a><span class="lineno"> 4778</span>&#160;    <span class="comment">!        write(msg,*) trim(cname)//&#39;: &#39;,i, &amp;</span></div>
<div class="line"><a name="l04779"></a><span class="lineno"> 4779</span>&#160;    <span class="comment">!          &#39; &#39;,nodeCoords(i)</span></div>
<div class="line"><a name="l04780"></a><span class="lineno"> 4780</span>&#160;    <span class="comment">!        call ESMF_LogWrite(trim(msg), ESMF_LOGMSG_INFO)</span></div>
<div class="line"><a name="l04781"></a><span class="lineno"> 4781</span>&#160;    <span class="comment">!      enddo</span></div>
<div class="line"><a name="l04782"></a><span class="lineno"> 4782</span>&#160; </div>
<div class="line"><a name="l04783"></a><span class="lineno"> 4783</span>&#160;    <span class="comment">! Allocate and fill the node owner array.</span></div>
<div class="line"><a name="l04784"></a><span class="lineno"> 4784</span>&#160;<span class="preprocessor">#ifdef W3_PDLIB</span></div>
<div class="line"><a name="l04785"></a><span class="lineno"> 4785</span>&#160;<span class="preprocessor"></span>    <span class="keywordflow">if</span> ( <a class="code" href="namespaceconstants.html#ad8b244917fc2f2b94d397086522af7a1">lpdlib</a> .EQV. .false. ) <span class="keywordflow">then</span></div>
<div class="line"><a name="l04786"></a><span class="lineno"> 4786</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l04787"></a><span class="lineno"> 4787</span>&#160;<span class="preprocessor"></span>      <span class="keyword">allocate</span>(nodeowners(nx))</div>
<div class="line"><a name="l04788"></a><span class="lineno"> 4788</span>&#160;      nodeowners=0 <span class="comment">! TODO: For now, export everything via PET 0</span></div>
<div class="line"><a name="l04789"></a><span class="lineno"> 4789</span>&#160;<span class="preprocessor">#ifdef W3_PDLIB</span></div>
<div class="line"><a name="l04790"></a><span class="lineno"> 4790</span>&#160;<span class="preprocessor"></span>    <span class="keywordflow">else</span></div>
<div class="line"><a name="l04791"></a><span class="lineno"> 4791</span>&#160;      <span class="comment">!        -------------------------------------------------------------------</span></div>
<div class="line"><a name="l04792"></a><span class="lineno"> 4792</span>&#160;      <span class="comment">!        ESMF Definition: Processor that owns the node</span></div>
<div class="line"><a name="l04793"></a><span class="lineno"> 4793</span>&#160;      <span class="comment">!        -------------------------------------------------------------------</span></div>
<div class="line"><a name="l04794"></a><span class="lineno"> 4794</span>&#160;      <span class="keyword">allocate</span>(nodeowners(<a class="code" href="namespaceyownodepool.html#ab77f5a6052a07d32d3f2debc49086fdc">npa</a>))</div>
<div class="line"><a name="l04795"></a><span class="lineno"> 4795</span>&#160;      nodeowners=<a class="code" href="namespaceyownodepool.html#a37e8a2849d4567665802bff23fa43a4d">nodes_global</a>(<a class="code" href="namespaceyownodepool.html#aeb9586089a351e66fced1e5fa617e2ec">iplg</a>(1:<a class="code" href="namespaceyownodepool.html#ab77f5a6052a07d32d3f2debc49086fdc">npa</a>))%domainID-1</div>
<div class="line"><a name="l04796"></a><span class="lineno"> 4796</span>&#160;<span class="keywordflow">    endif</span></div>
<div class="line"><a name="l04797"></a><span class="lineno"> 4797</span>&#160;    <span class="comment">!</span></div>
<div class="line"><a name="l04798"></a><span class="lineno"> 4798</span>&#160;    <span class="comment">!      call ESMF_LogWrite(trim(cname)//&#39;: In CreateExpMesh, nodeOwners=&#39;, &amp;</span></div>
<div class="line"><a name="l04799"></a><span class="lineno"> 4799</span>&#160;    <span class="comment">!          ESMF_LOGMSG_INFO)</span></div>
<div class="line"><a name="l04800"></a><span class="lineno"> 4800</span>&#160;    <span class="comment">!      do i = 1,npa</span></div>
<div class="line"><a name="l04801"></a><span class="lineno"> 4801</span>&#160;    <span class="comment">!        write(msg,*) trim(cname)//&#39;: nodeOwners(i)&#39;,i, &amp;</span></div>
<div class="line"><a name="l04802"></a><span class="lineno"> 4802</span>&#160;    <span class="comment">!          &#39; &#39;,nodeOwners(i)</span></div>
<div class="line"><a name="l04803"></a><span class="lineno"> 4803</span>&#160;    <span class="comment">!        call ESMF_LogWrite(trim(msg), ESMF_LOGMSG_INFO)</span></div>
<div class="line"><a name="l04804"></a><span class="lineno"> 4804</span>&#160;    <span class="comment">!      enddo</span></div>
<div class="line"><a name="l04805"></a><span class="lineno"> 4805</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l04806"></a><span class="lineno"> 4806</span>&#160;<span class="preprocessor"></span> </div>
<div class="line"><a name="l04807"></a><span class="lineno"> 4807</span>&#160;    <span class="comment">!      call ESMF_LogWrite(trim(cname)//&#39;: In CreateExpMesh, nodeOwners=&#39;, &amp;</span></div>
<div class="line"><a name="l04808"></a><span class="lineno"> 4808</span>&#160;    <span class="comment">!          ESMF_LOGMSG_INFO)</span></div>
<div class="line"><a name="l04809"></a><span class="lineno"> 4809</span>&#160;    <span class="comment">!      do i = 1,NX</span></div>
<div class="line"><a name="l04810"></a><span class="lineno"> 4810</span>&#160;    <span class="comment">!        write(msg,*) trim(cname)//&#39;: &#39;,i, &amp;</span></div>
<div class="line"><a name="l04811"></a><span class="lineno"> 4811</span>&#160;    <span class="comment">!          &#39; &#39;,nodeOwners(i)</span></div>
<div class="line"><a name="l04812"></a><span class="lineno"> 4812</span>&#160;    <span class="comment">!        call ESMF_LogWrite(trim(msg), ESMF_LOGMSG_INFO)</span></div>
<div class="line"><a name="l04813"></a><span class="lineno"> 4813</span>&#160;    <span class="comment">!      enddo</span></div>
<div class="line"><a name="l04814"></a><span class="lineno"> 4814</span>&#160; </div>
<div class="line"><a name="l04815"></a><span class="lineno"> 4815</span>&#160;    <span class="comment">! Allocate and fill the element id array.</span></div>
<div class="line"><a name="l04816"></a><span class="lineno"> 4816</span>&#160;<span class="preprocessor">#ifdef W3_PDLIB</span></div>
<div class="line"><a name="l04817"></a><span class="lineno"> 4817</span>&#160;<span class="preprocessor"></span>    <span class="keywordflow">if</span> ( <a class="code" href="namespaceconstants.html#ad8b244917fc2f2b94d397086522af7a1">lpdlib</a> .EQV. .false. ) <span class="keywordflow">then</span></div>
<div class="line"><a name="l04818"></a><span class="lineno"> 4818</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l04819"></a><span class="lineno"> 4819</span>&#160;<span class="preprocessor"></span>      <span class="keyword">allocate</span>(elemids(ntri))</div>
<div class="line"><a name="l04820"></a><span class="lineno"> 4820</span>&#160;      <span class="keywordflow">do</span> i = 1,ntri</div>
<div class="line"><a name="l04821"></a><span class="lineno"> 4821</span>&#160;        elemids(i)=i</div>
<div class="line"><a name="l04822"></a><span class="lineno"> 4822</span>&#160;<span class="keywordflow">      enddo</span></div>
<div class="line"><a name="l04823"></a><span class="lineno"> 4823</span>&#160;<span class="preprocessor">#ifdef W3_PDLIB</span></div>
<div class="line"><a name="l04824"></a><span class="lineno"> 4824</span>&#160;<span class="preprocessor"></span>    <span class="keywordflow">else</span></div>
<div class="line"><a name="l04825"></a><span class="lineno"> 4825</span>&#160;      <span class="comment">!        -------------------------------------------------------------------</span></div>
<div class="line"><a name="l04826"></a><span class="lineno"> 4826</span>&#160;      <span class="comment">!        ESMF Definition: The global id&#39;s of the elements resident on this processor</span></div>
<div class="line"><a name="l04827"></a><span class="lineno"> 4827</span>&#160;      <span class="comment">!        -------------------------------------------------------------------</span></div>
<div class="line"><a name="l04828"></a><span class="lineno"> 4828</span>&#160;      <span class="keyword">allocate</span>(elemids(<a class="code" href="namespaceyowelementpool.html#a7a6d4803690fc091c26d02151a507c25">ne</a>))</div>
<div class="line"><a name="l04829"></a><span class="lineno"> 4829</span>&#160;      <span class="keywordflow">do</span> i = 1,<a class="code" href="namespaceyowelementpool.html#a7a6d4803690fc091c26d02151a507c25">ne</a></div>
<div class="line"><a name="l04830"></a><span class="lineno"> 4830</span>&#160;        elemids(i)=<a class="code" href="namespaceyowelementpool.html#a0bd51f375cd41b9805d1185ed8e0d1e4">ielg</a>(i)</div>
<div class="line"><a name="l04831"></a><span class="lineno"> 4831</span>&#160;<span class="keywordflow">      enddo</span></div>
<div class="line"><a name="l04832"></a><span class="lineno"> 4832</span>&#160;<span class="keywordflow">    endif</span></div>
<div class="line"><a name="l04833"></a><span class="lineno"> 4833</span>&#160;    <span class="comment">!</span></div>
<div class="line"><a name="l04834"></a><span class="lineno"> 4834</span>&#160;    <span class="comment">!      call ESMF_LogWrite(trim(cname)//&#39;: In CreateExpMesh, elemIds=&#39;, &amp;</span></div>
<div class="line"><a name="l04835"></a><span class="lineno"> 4835</span>&#160;    <span class="comment">!          ESMF_LOGMSG_INFO)</span></div>
<div class="line"><a name="l04836"></a><span class="lineno"> 4836</span>&#160;    <span class="comment">!      do i = 1,ne</span></div>
<div class="line"><a name="l04837"></a><span class="lineno"> 4837</span>&#160;    <span class="comment">!        write(msg,*) trim(cname)//&#39;: elemIds(i)&#39;,i, &amp;</span></div>
<div class="line"><a name="l04838"></a><span class="lineno"> 4838</span>&#160;    <span class="comment">!          &#39; &#39;,elemIds(i)</span></div>
<div class="line"><a name="l04839"></a><span class="lineno"> 4839</span>&#160;    <span class="comment">!        call ESMF_LogWrite(trim(msg), ESMF_LOGMSG_INFO)</span></div>
<div class="line"><a name="l04840"></a><span class="lineno"> 4840</span>&#160;    <span class="comment">!      enddo</span></div>
<div class="line"><a name="l04841"></a><span class="lineno"> 4841</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l04842"></a><span class="lineno"> 4842</span>&#160;<span class="preprocessor"></span> </div>
<div class="line"><a name="l04843"></a><span class="lineno"> 4843</span>&#160;    <span class="comment">!      call ESMF_LogWrite(trim(cname)//&#39;: In CreateExpMesh, elemIds=&#39;, &amp;</span></div>
<div class="line"><a name="l04844"></a><span class="lineno"> 4844</span>&#160;    <span class="comment">!          ESMF_LOGMSG_INFO)</span></div>
<div class="line"><a name="l04845"></a><span class="lineno"> 4845</span>&#160;    <span class="comment">!      do i = 1,NTRI</span></div>
<div class="line"><a name="l04846"></a><span class="lineno"> 4846</span>&#160;    <span class="comment">!        write(msg,*) trim(cname)//&#39;: &#39;,i, &amp;</span></div>
<div class="line"><a name="l04847"></a><span class="lineno"> 4847</span>&#160;    <span class="comment">!          &#39; &#39;,elemIds(i)</span></div>
<div class="line"><a name="l04848"></a><span class="lineno"> 4848</span>&#160;    <span class="comment">!        call ESMF_LogWrite(trim(msg), ESMF_LOGMSG_INFO)</span></div>
<div class="line"><a name="l04849"></a><span class="lineno"> 4849</span>&#160;    <span class="comment">!      enddo</span></div>
<div class="line"><a name="l04850"></a><span class="lineno"> 4850</span>&#160; </div>
<div class="line"><a name="l04851"></a><span class="lineno"> 4851</span>&#160;    <span class="comment">! Allocate and fill the element topology type array.</span></div>
<div class="line"><a name="l04852"></a><span class="lineno"> 4852</span>&#160;<span class="preprocessor">#ifdef W3_PDLIB</span></div>
<div class="line"><a name="l04853"></a><span class="lineno"> 4853</span>&#160;<span class="preprocessor"></span>    <span class="keywordflow">if</span> ( <a class="code" href="namespaceconstants.html#ad8b244917fc2f2b94d397086522af7a1">lpdlib</a> .EQV. .false. ) <span class="keywordflow">then</span></div>
<div class="line"><a name="l04854"></a><span class="lineno"> 4854</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l04855"></a><span class="lineno"> 4855</span>&#160;<span class="preprocessor"></span>      <span class="keyword">allocate</span>(elemtypes(ntri))</div>
<div class="line"><a name="l04856"></a><span class="lineno"> 4856</span>&#160;      <span class="keywordflow">do</span> i = 1,ntri</div>
<div class="line"><a name="l04857"></a><span class="lineno"> 4857</span>&#160;        elemtypes(i)=esmf_meshelemtype_tri</div>
<div class="line"><a name="l04858"></a><span class="lineno"> 4858</span>&#160;<span class="keywordflow">      enddo</span></div>
<div class="line"><a name="l04859"></a><span class="lineno"> 4859</span>&#160;<span class="preprocessor">#ifdef W3_PDLIB</span></div>
<div class="line"><a name="l04860"></a><span class="lineno"> 4860</span>&#160;<span class="preprocessor"></span>    <span class="keywordflow">else</span></div>
<div class="line"><a name="l04861"></a><span class="lineno"> 4861</span>&#160;      <span class="comment">!        -------------------------------------------------------------------</span></div>
<div class="line"><a name="l04862"></a><span class="lineno"> 4862</span>&#160;      <span class="comment">!        ESMF Definition: Topology of the given element (one of ESMF_MeshElement)</span></div>
<div class="line"><a name="l04863"></a><span class="lineno"> 4863</span>&#160;      <span class="comment">!        -------------------------------------------------------------------</span></div>
<div class="line"><a name="l04864"></a><span class="lineno"> 4864</span>&#160;      <span class="keyword">allocate</span>(elemtypes(<a class="code" href="namespaceyowelementpool.html#a7a6d4803690fc091c26d02151a507c25">ne</a>))</div>
<div class="line"><a name="l04865"></a><span class="lineno"> 4865</span>&#160;      <span class="keywordflow">do</span> i = 1,<a class="code" href="namespaceyowelementpool.html#a7a6d4803690fc091c26d02151a507c25">ne</a></div>
<div class="line"><a name="l04866"></a><span class="lineno"> 4866</span>&#160;        elemtypes(i)=esmf_meshelemtype_tri</div>
<div class="line"><a name="l04867"></a><span class="lineno"> 4867</span>&#160;<span class="keywordflow">      enddo</span></div>
<div class="line"><a name="l04868"></a><span class="lineno"> 4868</span>&#160;<span class="keywordflow">    endif</span></div>
<div class="line"><a name="l04869"></a><span class="lineno"> 4869</span>&#160;    <span class="comment">!</span></div>
<div class="line"><a name="l04870"></a><span class="lineno"> 4870</span>&#160;    <span class="comment">!      call ESMF_LogWrite(trim(cname)//&#39;: In CreateExpMesh, elemTypes=&#39;, &amp;</span></div>
<div class="line"><a name="l04871"></a><span class="lineno"> 4871</span>&#160;    <span class="comment">!          ESMF_LOGMSG_INFO)</span></div>
<div class="line"><a name="l04872"></a><span class="lineno"> 4872</span>&#160;    <span class="comment">!      do i = 1,ne</span></div>
<div class="line"><a name="l04873"></a><span class="lineno"> 4873</span>&#160;    <span class="comment">!        write(msg,*) trim(cname)//&#39;: elemTypes(i)&#39;,i, &amp;</span></div>
<div class="line"><a name="l04874"></a><span class="lineno"> 4874</span>&#160;    <span class="comment">!          &#39; &#39;,elemTypes(i)</span></div>
<div class="line"><a name="l04875"></a><span class="lineno"> 4875</span>&#160;    <span class="comment">!        call ESMF_LogWrite(trim(msg), ESMF_LOGMSG_INFO)</span></div>
<div class="line"><a name="l04876"></a><span class="lineno"> 4876</span>&#160;    <span class="comment">!      enddo</span></div>
<div class="line"><a name="l04877"></a><span class="lineno"> 4877</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l04878"></a><span class="lineno"> 4878</span>&#160;<span class="preprocessor"></span> </div>
<div class="line"><a name="l04879"></a><span class="lineno"> 4879</span>&#160;    <span class="comment">!      call ESMF_LogWrite(trim(cname)//&#39;: In CreateExpMesh, elemTypes=&#39;, &amp;</span></div>
<div class="line"><a name="l04880"></a><span class="lineno"> 4880</span>&#160;    <span class="comment">!          ESMF_LOGMSG_INFO)</span></div>
<div class="line"><a name="l04881"></a><span class="lineno"> 4881</span>&#160;    <span class="comment">!      do i = 1,NTRI</span></div>
<div class="line"><a name="l04882"></a><span class="lineno"> 4882</span>&#160;    <span class="comment">!        write(msg,*) trim(cname)//&#39;: &#39;,i, &amp;</span></div>
<div class="line"><a name="l04883"></a><span class="lineno"> 4883</span>&#160;    <span class="comment">!          &#39; &#39;,elemTypes(i)</span></div>
<div class="line"><a name="l04884"></a><span class="lineno"> 4884</span>&#160;    <span class="comment">!        call ESMF_LogWrite(trim(msg), ESMF_LOGMSG_INFO)</span></div>
<div class="line"><a name="l04885"></a><span class="lineno"> 4885</span>&#160;    <span class="comment">!      enddo</span></div>
<div class="line"><a name="l04886"></a><span class="lineno"> 4886</span>&#160; </div>
<div class="line"><a name="l04887"></a><span class="lineno"> 4887</span>&#160;    <span class="comment">! Allocate and fill the element connection type array.</span></div>
<div class="line"><a name="l04888"></a><span class="lineno"> 4888</span>&#160;<span class="preprocessor">#ifdef W3_PDLIB</span></div>
<div class="line"><a name="l04889"></a><span class="lineno"> 4889</span>&#160;<span class="preprocessor"></span>    <span class="keywordflow">if</span> ( <a class="code" href="namespaceconstants.html#ad8b244917fc2f2b94d397086522af7a1">lpdlib</a> .EQV. .false. ) <span class="keywordflow">then</span></div>
<div class="line"><a name="l04890"></a><span class="lineno"> 4890</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l04891"></a><span class="lineno"> 4891</span>&#160;<span class="preprocessor"></span>      <span class="keyword">allocate</span>(elemconn(3*ntri))</div>
<div class="line"><a name="l04892"></a><span class="lineno"> 4892</span>&#160;      <span class="keywordflow">do</span> i = 1,ntri</div>
<div class="line"><a name="l04893"></a><span class="lineno"> 4893</span>&#160;        <span class="keywordflow">do</span> j = 1,3</div>
<div class="line"><a name="l04894"></a><span class="lineno"> 4894</span>&#160;          pos=3*(i-1)+j</div>
<div class="line"><a name="l04895"></a><span class="lineno"> 4895</span>&#160;          elemconn(pos)=trigp(j,i)</div>
<div class="line"><a name="l04896"></a><span class="lineno"> 4896</span>&#160;<span class="keywordflow">        enddo</span></div>
<div class="line"><a name="l04897"></a><span class="lineno"> 4897</span>&#160;<span class="keywordflow">      enddo</span></div>
<div class="line"><a name="l04898"></a><span class="lineno"> 4898</span>&#160;<span class="preprocessor">#ifdef W3_PDLIB</span></div>
<div class="line"><a name="l04899"></a><span class="lineno"> 4899</span>&#160;<span class="preprocessor"></span>    <span class="keywordflow">else</span></div>
<div class="line"><a name="l04900"></a><span class="lineno"> 4900</span>&#160;      <span class="comment">!        -------------------------------------------------------------------</span></div>
<div class="line"><a name="l04901"></a><span class="lineno"> 4901</span>&#160;      <span class="comment">!        ESMF Definition: Connectivity table. The number of entries should</span></div>
<div class="line"><a name="l04902"></a><span class="lineno"> 4902</span>&#160;      <span class="comment">!        be equal to the number of nodes in the given topology. The indices</span></div>
<div class="line"><a name="l04903"></a><span class="lineno"> 4903</span>&#160;      <span class="comment">!        should be the local index (1 based) into the array of nodes that</span></div>
<div class="line"><a name="l04904"></a><span class="lineno"> 4904</span>&#160;      <span class="comment">!        was declared with MeshAddNodes.</span></div>
<div class="line"><a name="l04905"></a><span class="lineno"> 4905</span>&#160;      <span class="comment">!        -------------------------------------------------------------------</span></div>
<div class="line"><a name="l04906"></a><span class="lineno"> 4906</span>&#160;      <span class="comment">!        &gt; INE is local element array. it stores the local node IDs</span></div>
<div class="line"><a name="l04907"></a><span class="lineno"> 4907</span>&#160;      <span class="comment">!        &gt; first index from 1 to 3.</span></div>
<div class="line"><a name="l04908"></a><span class="lineno"> 4908</span>&#160;      <span class="comment">!        &gt; second index from 1 to ne.</span></div>
<div class="line"><a name="l04909"></a><span class="lineno"> 4909</span>&#160;      <span class="keyword">allocate</span>(elemconn(3*<a class="code" href="namespaceyowelementpool.html#a7a6d4803690fc091c26d02151a507c25">ne</a>))</div>
<div class="line"><a name="l04910"></a><span class="lineno"> 4910</span>&#160;      <span class="keywordflow">do</span> i = 1,<a class="code" href="namespaceyowelementpool.html#a7a6d4803690fc091c26d02151a507c25">ne</a></div>
<div class="line"><a name="l04911"></a><span class="lineno"> 4911</span>&#160;        <span class="keywordflow">do</span> j = 1,3</div>
<div class="line"><a name="l04912"></a><span class="lineno"> 4912</span>&#160;          pos=3*(i-1)+j</div>
<div class="line"><a name="l04913"></a><span class="lineno"> 4913</span>&#160;          elemconn(pos)=<a class="code" href="namespaceyowelementpool.html#a814bfeb4a7ea372cb338c9885dd82a7c">ine</a>(j,i)</div>
<div class="line"><a name="l04914"></a><span class="lineno"> 4914</span>&#160;<span class="keywordflow">        enddo</span></div>
<div class="line"><a name="l04915"></a><span class="lineno"> 4915</span>&#160;<span class="keywordflow">      enddo</span></div>
<div class="line"><a name="l04916"></a><span class="lineno"> 4916</span>&#160;<span class="keywordflow">    endif</span></div>
<div class="line"><a name="l04917"></a><span class="lineno"> 4917</span>&#160;    <span class="comment">!</span></div>
<div class="line"><a name="l04918"></a><span class="lineno"> 4918</span>&#160;    <span class="comment">!      call ESMF_LogWrite(trim(cname)//&#39;: In CreateExpMesh, elemConn=&#39;, &amp;</span></div>
<div class="line"><a name="l04919"></a><span class="lineno"> 4919</span>&#160;    <span class="comment">!          ESMF_LOGMSG_INFO)</span></div>
<div class="line"><a name="l04920"></a><span class="lineno"> 4920</span>&#160;    <span class="comment">!      do i = 1,(3*ne)</span></div>
<div class="line"><a name="l04921"></a><span class="lineno"> 4921</span>&#160;    <span class="comment">!        write(msg,*) trim(cname)//&#39;: elemConn(i)&#39;,i, &amp;</span></div>
<div class="line"><a name="l04922"></a><span class="lineno"> 4922</span>&#160;    <span class="comment">!          &#39; &#39;,elemConn(i)</span></div>
<div class="line"><a name="l04923"></a><span class="lineno"> 4923</span>&#160;    <span class="comment">!        call ESMF_LogWrite(trim(msg), ESMF_LOGMSG_INFO)</span></div>
<div class="line"><a name="l04924"></a><span class="lineno"> 4924</span>&#160;    <span class="comment">!      enddo</span></div>
<div class="line"><a name="l04925"></a><span class="lineno"> 4925</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l04926"></a><span class="lineno"> 4926</span>&#160;<span class="preprocessor"></span> </div>
<div class="line"><a name="l04927"></a><span class="lineno"> 4927</span>&#160;    <span class="comment">!      call ESMF_LogWrite(trim(cname)//&#39;: In CreateExpMesh, elemConn=&#39;, &amp;</span></div>
<div class="line"><a name="l04928"></a><span class="lineno"> 4928</span>&#160;    <span class="comment">!          ESMF_LOGMSG_INFO)</span></div>
<div class="line"><a name="l04929"></a><span class="lineno"> 4929</span>&#160;    <span class="comment">!      do i = 1,(3*NTRI)</span></div>
<div class="line"><a name="l04930"></a><span class="lineno"> 4930</span>&#160;    <span class="comment">!        write(msg,*) trim(cname)//&#39;: &#39;,i, &amp;</span></div>
<div class="line"><a name="l04931"></a><span class="lineno"> 4931</span>&#160;    <span class="comment">!          &#39; &#39;,elemConn(i)</span></div>
<div class="line"><a name="l04932"></a><span class="lineno"> 4932</span>&#160;    <span class="comment">!        call ESMF_LogWrite(trim(msg), ESMF_LOGMSG_INFO)</span></div>
<div class="line"><a name="l04933"></a><span class="lineno"> 4933</span>&#160;    <span class="comment">!      enddo</span></div>
<div class="line"><a name="l04934"></a><span class="lineno"> 4934</span>&#160; </div>
<div class="line"><a name="l04935"></a><span class="lineno"> 4935</span>&#160;    expmesh = esmf_meshcreate( parametricdim=2,spatialdim=2, &amp;</div>
<div class="line"><a name="l04936"></a><span class="lineno"> 4936</span>&#160;         nodeids=nodeids, nodecoords=nodecoords, &amp;</div>
<div class="line"><a name="l04937"></a><span class="lineno"> 4937</span>&#160;         nodeowners=nodeowners, elementids=elemids,&amp;</div>
<div class="line"><a name="l04938"></a><span class="lineno"> 4938</span>&#160;         elementtypes=elemtypes, elementconn=elemconn, &amp;</div>
<div class="line"><a name="l04939"></a><span class="lineno"> 4939</span>&#160;         rc=rc )</div>
<div class="line"><a name="l04940"></a><span class="lineno"> 4940</span>&#160;    <span class="keywordflow">if</span> (esmf_logfounderror(rc, passthru)) <span class="keywordflow">return</span></div>
<div class="line"><a name="l04941"></a><span class="lineno"> 4941</span>&#160; </div>
<div class="line"><a name="l04942"></a><span class="lineno"> 4942</span>&#160;    <span class="keyword">deallocate</span>(nodeids)</div>
<div class="line"><a name="l04943"></a><span class="lineno"> 4943</span>&#160;    <span class="keyword">deallocate</span>(nodecoords)</div>
<div class="line"><a name="l04944"></a><span class="lineno"> 4944</span>&#160;    <span class="keyword">deallocate</span>(nodeowners)</div>
<div class="line"><a name="l04945"></a><span class="lineno"> 4945</span>&#160;    <span class="keyword">deallocate</span>(elemids)</div>
<div class="line"><a name="l04946"></a><span class="lineno"> 4946</span>&#160;    <span class="keyword">deallocate</span>(elemtypes)</div>
<div class="line"><a name="l04947"></a><span class="lineno"> 4947</span>&#160;    <span class="keyword">deallocate</span>(elemconn)</div>
<div class="line"><a name="l04948"></a><span class="lineno"> 4948</span>&#160;    <span class="comment">!</span></div>
<div class="line"><a name="l04949"></a><span class="lineno"> 4949</span>&#160;    <span class="comment">!     Set flag to indicate that this processor has local export grid storage</span></div>
<div class="line"><a name="l04950"></a><span class="lineno"> 4950</span>&#160;    <span class="comment">!</span></div>
<div class="line"><a name="l04951"></a><span class="lineno"> 4951</span>&#160;    <span class="comment">!AW      if (lpet == 0) then</span></div>
<div class="line"><a name="l04952"></a><span class="lineno"> 4952</span>&#160;    <span class="comment">!AW         call ESMF_GridGet( expMesh, localDECount=ldecnt, rc=rc )</span></div>
<div class="line"><a name="l04953"></a><span class="lineno"> 4953</span>&#160;    <span class="comment">!AW         if (ESMF_LogFoundError(rc, PASSTHRU)) return</span></div>
<div class="line"><a name="l04954"></a><span class="lineno"> 4954</span>&#160;    <span class="comment">!AW         expGridIsLocal = ldecnt.gt.0</span></div>
<div class="line"><a name="l04955"></a><span class="lineno"> 4955</span>&#160;    <span class="comment">!AW      endif</span></div>
<div class="line"><a name="l04956"></a><span class="lineno"> 4956</span>&#160; </div>
<div class="line"><a name="l04957"></a><span class="lineno"> 4957</span>&#160;    <span class="comment">!</span></div>
<div class="line"><a name="l04958"></a><span class="lineno"> 4958</span>&#160;    <span class="comment">! -------------------------------------------------------------------- /</span></div>
<div class="line"><a name="l04959"></a><span class="lineno"> 4959</span>&#160;    <span class="comment">! 3.  Create ESMF grid with arbitrary domain decomposition to match</span></div>
<div class="line"><a name="l04960"></a><span class="lineno"> 4960</span>&#160;    <span class="comment">!     the native domain decomposition of the non-excluded points</span></div>
<div class="line"><a name="l04961"></a><span class="lineno"> 4961</span>&#160;    <span class="comment">!     Note that the native grid layout is dim1=Y, dim2=X</span></div>
<div class="line"><a name="l04962"></a><span class="lineno"> 4962</span>&#160;    <span class="comment">!     Note that coordinates and mask are not needed since this</span></div>
<div class="line"><a name="l04963"></a><span class="lineno"> 4963</span>&#160;    <span class="comment">!     grid is only used to define fields for a redist operation</span></div>
<div class="line"><a name="l04964"></a><span class="lineno"> 4964</span>&#160;    <span class="comment">!</span></div>
<div class="line"><a name="l04965"></a><span class="lineno"> 4965</span>&#160;    <span class="comment">! 3.a Set flag to indicate that this processor has local native grid storage</span></div>
<div class="line"><a name="l04966"></a><span class="lineno"> 4966</span>&#160;    <span class="comment">!</span></div>
<div class="line"><a name="l04967"></a><span class="lineno"> 4967</span>&#160;    natgridislocal = <a class="code" href="namespacew3odatmd.html#a36a4047055987bb52cab303f0207f676">iaproc</a> .gt. 0 .and. <a class="code" href="namespacew3odatmd.html#a36a4047055987bb52cab303f0207f676">iaproc</a> .le. <a class="code" href="namespacew3odatmd.html#a5fb3206737f511149173f90ece6bb54f">naproc</a></div>
<div class="line"><a name="l04968"></a><span class="lineno"> 4968</span>&#160; </div>
<div class="line"><a name="l04969"></a><span class="lineno"> 4969</span>&#160;<span class="preprocessor">#ifdef W3_PDLIB</span></div>
<div class="line"><a name="l04970"></a><span class="lineno"> 4970</span>&#160;<span class="preprocessor"></span>    <span class="keywordflow">if</span> ( <a class="code" href="namespaceconstants.html#ad8b244917fc2f2b94d397086522af7a1">lpdlib</a> .EQV. .false. ) <span class="keywordflow">then</span></div>
<div class="line"><a name="l04971"></a><span class="lineno"> 4971</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l04972"></a><span class="lineno"> 4972</span>&#160;<span class="preprocessor"></span>      <span class="comment">!</span></div>
<div class="line"><a name="l04973"></a><span class="lineno"> 4973</span>&#160;      <span class="comment">! 3.b Setup arbitrary sequence index list</span></div>
<div class="line"><a name="l04974"></a><span class="lineno"> 4974</span>&#160;      <span class="comment">!</span></div>
<div class="line"><a name="l04975"></a><span class="lineno"> 4975</span>&#160;      <span class="keywordflow">do</span> <a class="code" href="namespacew3adatmd.html#a982588d9c5fbf625de3abe149df867ad">ipass</a> = 1,2</div>
<div class="line"><a name="l04976"></a><span class="lineno"> 4976</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="namespacew3adatmd.html#a982588d9c5fbf625de3abe149df867ad">ipass</a>.eq.2) <span class="keywordflow">then</span></div>
<div class="line"><a name="l04977"></a><span class="lineno"> 4977</span>&#160;          <span class="keyword">allocate</span> (arbindexlist(arbindexcount,2), stat=rc)</div>
<div class="line"><a name="l04978"></a><span class="lineno"> 4978</span>&#160;          <span class="keywordflow">if</span> (esmf_logfoundallocerror(rc, passthru)) <span class="keywordflow">return</span></div>
<div class="line"><a name="l04979"></a><span class="lineno"> 4979</span>&#160;<span class="keywordflow">        endif</span></div>
<div class="line"><a name="l04980"></a><span class="lineno"> 4980</span>&#160;        arbindexcount = 0</div>
<div class="line"><a name="l04981"></a><span class="lineno"> 4981</span>&#160;        <span class="comment">! list local native grid non-excluded points</span></div>
<div class="line"><a name="l04982"></a><span class="lineno"> 4982</span>&#160;        <span class="keywordflow">if</span> ( natgridislocal ) <span class="keywordflow">then</span></div>
<div class="line"><a name="l04983"></a><span class="lineno"> 4983</span>&#160;          <span class="keywordflow">do</span> jsea = 1,nseal</div>
<div class="line"><a name="l04984"></a><span class="lineno"> 4984</span>&#160;<span class="preprocessor">#ifdef W3_DIST</span></div>
<div class="line"><a name="l04985"></a><span class="lineno"> 4985</span>&#160;<span class="preprocessor"></span>            isea = <a class="code" href="namespacew3odatmd.html#a36a4047055987bb52cab303f0207f676">iaproc</a> + (jsea-1)*<a class="code" href="namespacew3odatmd.html#a5fb3206737f511149173f90ece6bb54f">naproc</a></div>
<div class="line"><a name="l04986"></a><span class="lineno"> 4986</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l04987"></a><span class="lineno"> 4987</span>&#160;<span class="preprocessor"></span><span class="preprocessor">#ifdef W3_SHRD</span></div>
<div class="line"><a name="l04988"></a><span class="lineno"> 4988</span>&#160;<span class="preprocessor"></span>            isea = jsea</div>
<div class="line"><a name="l04989"></a><span class="lineno"> 4989</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l04990"></a><span class="lineno"> 4990</span>&#160;<span class="preprocessor"></span>            arbindexcount = arbindexcount+1</div>
<div class="line"><a name="l04991"></a><span class="lineno"> 4991</span>&#160;            <span class="keywordflow">if</span> (<a class="code" href="namespacew3adatmd.html#a982588d9c5fbf625de3abe149df867ad">ipass</a>.eq.2) <span class="keywordflow">then</span></div>
<div class="line"><a name="l04992"></a><span class="lineno"> 4992</span>&#160;              ix = mapsf(isea,1)</div>
<div class="line"><a name="l04993"></a><span class="lineno"> 4993</span>&#160;              iy = mapsf(isea,2)</div>
<div class="line"><a name="l04994"></a><span class="lineno"> 4994</span>&#160;              <span class="comment">! native grid layout: dim1=Y, dim2=X</span></div>
<div class="line"><a name="l04995"></a><span class="lineno"> 4995</span>&#160;              arbindexlist(arbindexcount,1) = iy</div>
<div class="line"><a name="l04996"></a><span class="lineno"> 4996</span>&#160;              arbindexlist(arbindexcount,2) = ix</div>
<div class="line"><a name="l04997"></a><span class="lineno"> 4997</span>&#160;<span class="keywordflow">            endif</span></div>
<div class="line"><a name="l04998"></a><span class="lineno"> 4998</span>&#160;<span class="keywordflow">          enddo</span></div>
<div class="line"><a name="l04999"></a><span class="lineno"> 4999</span>&#160;<span class="keywordflow">        endif</span></div>
<div class="line"><a name="l05000"></a><span class="lineno"> 5000</span>&#160;<span class="keywordflow">      enddo</span> <span class="comment">!ipass</span></div>
<div class="line"><a name="l05001"></a><span class="lineno"> 5001</span>&#160;      <span class="comment">!</span></div>
<div class="line"><a name="l05002"></a><span class="lineno"> 5002</span>&#160;      <span class="comment">! 3.c Create ESMF native grid</span></div>
<div class="line"><a name="l05003"></a><span class="lineno"> 5003</span>&#160;      <span class="comment">!</span></div>
<div class="line"><a name="l05004"></a><span class="lineno"> 5004</span>&#160;      natgrid = esmf_gridcreatenoperidim( &amp;</div>
<div class="line"><a name="l05005"></a><span class="lineno"> 5005</span>&#160;           minindex=(/ 1, 1/), &amp;</div>
<div class="line"><a name="l05006"></a><span class="lineno"> 5006</span>&#160;           maxindex=(/ny,nx/), &amp;</div>
<div class="line"><a name="l05007"></a><span class="lineno"> 5007</span>&#160;           coorddep1=(/esmf_dim_arb,esmf_dim_arb/), &amp;</div>
<div class="line"><a name="l05008"></a><span class="lineno"> 5008</span>&#160;           coorddep2=(/esmf_dim_arb,esmf_dim_arb/), &amp;</div>
<div class="line"><a name="l05009"></a><span class="lineno"> 5009</span>&#160;           arbindexcount=arbindexcount, &amp;</div>
<div class="line"><a name="l05010"></a><span class="lineno"> 5010</span>&#160;           arbindexlist=arbindexlist, &amp;</div>
<div class="line"><a name="l05011"></a><span class="lineno"> 5011</span>&#160;           coordtypekind=esmf_typekind_rx, &amp;</div>
<div class="line"><a name="l05012"></a><span class="lineno"> 5012</span>&#160;           coordsys=esmf_coordsys_sph_deg, &amp;</div>
<div class="line"><a name="l05013"></a><span class="lineno"> 5013</span>&#160;           name=trim(cname)//<span class="stringliteral">&quot;_native_grid&quot;</span>, rc=rc )</div>
<div class="line"><a name="l05014"></a><span class="lineno"> 5014</span>&#160;      <span class="keywordflow">if</span> (esmf_logfounderror(rc, passthru)) <span class="keywordflow">return</span></div>
<div class="line"><a name="l05015"></a><span class="lineno"> 5015</span>&#160;      <span class="comment">!</span></div>
<div class="line"><a name="l05016"></a><span class="lineno"> 5016</span>&#160;      <span class="comment">! 3.d Deallocate arbitrary sequence index list</span></div>
<div class="line"><a name="l05017"></a><span class="lineno"> 5017</span>&#160;      <span class="comment">!</span></div>
<div class="line"><a name="l05018"></a><span class="lineno"> 5018</span>&#160;      <span class="keyword">deallocate</span> (arbindexlist, stat=rc)</div>
<div class="line"><a name="l05019"></a><span class="lineno"> 5019</span>&#160;      <span class="keywordflow">if</span> (esmf_logfounddeallocerror(rc, passthru)) <span class="keywordflow">return</span></div>
<div class="line"><a name="l05020"></a><span class="lineno"> 5020</span>&#160;      <span class="comment">!</span></div>
<div class="line"><a name="l05021"></a><span class="lineno"> 5021</span>&#160;      <span class="comment">! -------------------------------------------------------------------- /</span></div>
<div class="line"><a name="l05022"></a><span class="lineno"> 5022</span>&#160;      <span class="comment">! 4.  Create route handle for redist between native grid domain</span></div>
<div class="line"><a name="l05023"></a><span class="lineno"> 5023</span>&#160;      <span class="comment">!     decomposition and the export grid domain decomposition</span></div>
<div class="line"><a name="l05024"></a><span class="lineno"> 5024</span>&#160;      <span class="comment">!</span></div>
<div class="line"><a name="l05025"></a><span class="lineno"> 5025</span>&#160;      <span class="comment">! 4.a Create temporary fields</span></div>
<div class="line"><a name="l05026"></a><span class="lineno"> 5026</span>&#160;      <span class="comment">!</span></div>
<div class="line"><a name="l05027"></a><span class="lineno"> 5027</span>&#160;      nfield = esmf_fieldcreate( natgrid, natarrayspec1d, &amp;</div>
<div class="line"><a name="l05028"></a><span class="lineno"> 5028</span>&#160;           staggerloc=natstaggerloc, rc=rc )</div>
<div class="line"><a name="l05029"></a><span class="lineno"> 5029</span>&#160;      <span class="keywordflow">if</span> (esmf_logfounderror(rc, passthru)) <span class="keywordflow">return</span></div>
<div class="line"><a name="l05030"></a><span class="lineno"> 5030</span>&#160;      efield = esmf_fieldcreate(expmesh, typekind=esmf_typekind_rx, rc=rc)</div>
<div class="line"><a name="l05031"></a><span class="lineno"> 5031</span>&#160;      <span class="keywordflow">if</span> (esmf_logfounderror(rc, passthru)) <span class="keywordflow">return</span></div>
<div class="line"><a name="l05032"></a><span class="lineno"> 5032</span>&#160;      <span class="comment">!</span></div>
<div class="line"><a name="l05033"></a><span class="lineno"> 5033</span>&#160;      <span class="comment">! 4.b Store route handle</span></div>
<div class="line"><a name="l05034"></a><span class="lineno"> 5034</span>&#160;      <span class="comment">!</span></div>
<div class="line"><a name="l05035"></a><span class="lineno"> 5035</span>&#160;      <span class="keyword">call </span>esmf_fieldrediststore( nfield, efield, n2erh, rc=rc )</div>
<div class="line"><a name="l05036"></a><span class="lineno"> 5036</span>&#160;      <span class="keywordflow">if</span> (esmf_logfounderror(rc, passthru)) <span class="keywordflow">return</span></div>
<div class="line"><a name="l05037"></a><span class="lineno"> 5037</span>&#160;      <span class="comment">!</span></div>
<div class="line"><a name="l05038"></a><span class="lineno"> 5038</span>&#160;      <span class="comment">! 4.c Clean up</span></div>
<div class="line"><a name="l05039"></a><span class="lineno"> 5039</span>&#160;      <span class="comment">!</span></div>
<div class="line"><a name="l05040"></a><span class="lineno"> 5040</span>&#160;      <span class="keyword">call </span>esmf_fielddestroy( nfield, rc=rc )</div>
<div class="line"><a name="l05041"></a><span class="lineno"> 5041</span>&#160;      <span class="keywordflow">if</span> (esmf_logfounderror(rc, passthru)) <span class="keywordflow">return</span></div>
<div class="line"><a name="l05042"></a><span class="lineno"> 5042</span>&#160;      <span class="keyword">call </span>esmf_fielddestroy( efield, rc=rc )</div>
<div class="line"><a name="l05043"></a><span class="lineno"> 5043</span>&#160;      <span class="keywordflow">if</span> (esmf_logfounderror(rc, passthru)) <span class="keywordflow">return</span></div>
<div class="line"><a name="l05044"></a><span class="lineno"> 5044</span>&#160; </div>
<div class="line"><a name="l05045"></a><span class="lineno"> 5045</span>&#160;<span class="preprocessor">#ifdef W3_PDLIB</span></div>
<div class="line"><a name="l05046"></a><span class="lineno"> 5046</span>&#160;<span class="preprocessor"></span><span class="keywordflow">    endif</span></div>
<div class="line"><a name="l05047"></a><span class="lineno"> 5047</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l05048"></a><span class="lineno"> 5048</span>&#160;<span class="preprocessor"></span> </div>
<div class="line"><a name="l05049"></a><span class="lineno"> 5049</span>&#160;    <span class="keyword">call </span>esmf_logwrite(trim(cname)//<span class="stringliteral">&#39;: In CreateExpMesh, created expMesh&#39;</span>, &amp;</div>
<div class="line"><a name="l05050"></a><span class="lineno"> 5050</span>&#160;         esmf_logmsg_info)</div>
<div class="line"><a name="l05051"></a><span class="lineno"> 5051</span>&#160; </div>
<div class="line"><a name="l05052"></a><span class="lineno"> 5052</span>&#160;    rc = esmf_success</div>
<div class="line"><a name="l05053"></a><span class="lineno"> 5053</span>&#160;    <span class="keywordflow">if</span> (verbosity.gt.0) <span class="keyword">call </span>esmf_logwrite(trim(cname)// &amp;</div>
<div class="line"><a name="l05054"></a><span class="lineno"> 5054</span>&#160;         <span class="stringliteral">&#39;: leaving CreateExpMesh&#39;</span>, esmf_logmsg_info)</div>
<div class="line"><a name="l05055"></a><span class="lineno"> 5055</span>&#160;    <span class="comment">!/</span></div>
<div class="line"><a name="l05056"></a><span class="lineno"> 5056</span>&#160;    <span class="comment">!/ End of CreateExpMesh ---------------------------------------------- /</span></div>
<div class="line"><a name="l05057"></a><span class="lineno"> 5057</span>&#160;    <span class="comment">!/</span></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="w3odatmd_8F90_source.html#l00457">w3odatmd::iaproc</a>, <a class="el" href="yowelementpool_8F90_source.html#l00065">yowelementpool::ielg</a>, <a class="el" href="yowelementpool_8F90_source.html#l00056">yowelementpool::ine</a>, <a class="el" href="w3adatmd_8F90_source.html#l00686">w3adatmd::ipass</a>, <a class="el" href="yownodepool_8F90_source.html#l00116">yownodepool::iplg</a>, <a class="el" href="constants_8F90_source.html#l00101">constants::lpdlib</a>, <a class="el" href="w3gdatmd_8F90_source.html#l01163">w3gdatmd::mapsf</a>, <a class="el" href="wmmdatmd_8F90_source.html#l00316">wmmdatmd::mdse</a>, <a class="el" href="wmmdatmd_8F90_source.html#l00315">wmmdatmd::mdst</a>, <a class="el" href="w3odatmd_8F90_source.html#l00457">w3odatmd::naproc</a>, <a class="el" href="yowelementpool_8F90_source.html#l00048">yowelementpool::ne</a>, <a class="el" href="yownodepool_8F90_source.html#l00103">yownodepool::nodes_global</a>, <a class="el" href="yownodepool_8F90_source.html#l00099">yownodepool::npa</a>, <a class="el" href="w3gdatmd_8F90_source.html#l01097">w3gdatmd::nseal</a>, <a class="el" href="w3gdatmd_8F90_source.html#l01109">w3gdatmd::ntri</a>, <a class="el" href="w3gdatmd_8F90_source.html#l01097">w3gdatmd::nx</a>, <a class="el" href="w3gdatmd_8F90_source.html#l01097">w3gdatmd::ny</a>, <a class="el" href="w3gdatmd_8F90_source.html#l01111">w3gdatmd::trigp</a>, <a class="el" href="w3adatmd_8F90_source.html#l02645">w3adatmd::w3seta()</a>, <a class="el" href="w3gdatmd_8F90_source.html#l02152">w3gdatmd::w3setg()</a>, <a class="el" href="w3idatmd_8F90_source.html#l00819">w3idatmd::w3seti()</a>, <a class="el" href="w3odatmd_8F90_source.html#l01523">w3odatmd::w3seto()</a>, <a class="el" href="w3wdatmd_8F90_source.html#l00660">w3wdatmd::w3setw()</a>, <a class="el" href="wmmdatmd_8F90_source.html#l01169">wmmdatmd::wmsetm()</a>, <a class="el" href="w3gdatmd_8F90_source.html#l01205">w3gdatmd::xgrd</a>, and <a class="el" href="w3gdatmd_8F90_source.html#l01205">w3gdatmd::ygrd</a>.</p>

</div>
</div>
<a id="a096ddfff532dfd7fad224cf71efe740d"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a096ddfff532dfd7fad224cf71efe740d">&#9670;&nbsp;</a></span>fieldindex()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">integer function wmesmfmd::fieldindex </td>
          <td>(</td>
          <td class="paramtype">character (len=*), dimension(:)&#160;</td>
          <td class="paramname"><em>fnameList</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">character (len=*)&#160;</td>
          <td class="paramname"><em>fname</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">integer&#160;</td>
          <td class="paramname"><em>rc</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Return index associated with field name. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">fnameList</td><td>Array of field names </td></tr>
    <tr><td class="paramname">fname</td><td>Field name </td></tr>
    <tr><td class="paramname">rc</td><td>Return code </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>indx Returned index of fname</dd></dl>
<dl class="section author"><dt>Author</dt><dd>T. J. Campbell </dd></dl>
<dl class="section date"><dt>Date</dt><dd>20-Jan-2017 </dd></dl>

<p class="definition">Definition at line <a class="el" href="wmesmfmd_8F90_source.html#l05857">5857</a> of file <a class="el" href="wmesmfmd_8F90_source.html">wmesmfmd.F90</a>.</p>
<div class="fragment"><div class="line"><a name="l05857"></a><span class="lineno"> 5857</span>&#160;    <span class="comment">!/</span></div>
<div class="line"><a name="l05858"></a><span class="lineno"> 5858</span>&#160;    <span class="comment">!/                  +-----------------------------------+</span></div>
<div class="line"><a name="l05859"></a><span class="lineno"> 5859</span>&#160;    <span class="comment">!/                  | WAVEWATCH III           NOAA/NCEP |</span></div>
<div class="line"><a name="l05860"></a><span class="lineno"> 5860</span>&#160;    <span class="comment">!/                  |        T. J. Campbell, NRL        |</span></div>
<div class="line"><a name="l05861"></a><span class="lineno"> 5861</span>&#160;    <span class="comment">!/                  |                        FORTRAN 90 |</span></div>
<div class="line"><a name="l05862"></a><span class="lineno"> 5862</span>&#160;    <span class="comment">!/                  | Last update :         20-Jan-2017 |</span></div>
<div class="line"><a name="l05863"></a><span class="lineno"> 5863</span>&#160;    <span class="comment">!/                  +-----------------------------------+</span></div>
<div class="line"><a name="l05864"></a><span class="lineno"> 5864</span>&#160;    <span class="comment">!/</span></div>
<div class="line"><a name="l05865"></a><span class="lineno"> 5865</span>&#160;    <span class="comment">!/    20-Jan-2017 : Origination.                        ( version 6.02 )</span></div>
<div class="line"><a name="l05866"></a><span class="lineno"> 5866</span>&#160;    <span class="comment">!/</span></div>
<div class="line"><a name="l05867"></a><span class="lineno"> 5867</span>&#160;    <span class="comment">!  1. Purpose :</span></div>
<div class="line"><a name="l05868"></a><span class="lineno"> 5868</span>&#160;    <span class="comment">!</span></div>
<div class="line"><a name="l05869"></a><span class="lineno"> 5869</span>&#160;    <span class="comment">!     Return index associated with field name</span></div>
<div class="line"><a name="l05870"></a><span class="lineno"> 5870</span>&#160;    <span class="comment">!</span></div>
<div class="line"><a name="l05871"></a><span class="lineno"> 5871</span>&#160;    <span class="comment">!  2. Method :</span></div>
<div class="line"><a name="l05872"></a><span class="lineno"> 5872</span>&#160;    <span class="comment">!</span></div>
<div class="line"><a name="l05873"></a><span class="lineno"> 5873</span>&#160;    <span class="comment">!  3. Parameters :</span></div>
<div class="line"><a name="l05874"></a><span class="lineno"> 5874</span>&#160;    <span class="comment">!</span></div>
<div class="line"><a name="l05875"></a><span class="lineno"> 5875</span>&#160;    <span class="comment">!     Parameter list</span></div>
<div class="line"><a name="l05876"></a><span class="lineno"> 5876</span>&#160;    <span class="comment">!     ----------------------------------------------------------------</span></div>
<div class="line"><a name="l05877"></a><span class="lineno"> 5877</span>&#160;    <span class="comment">!       fnameList StrA   I   Array of field names</span></div>
<div class="line"><a name="l05878"></a><span class="lineno"> 5878</span>&#160;    <span class="comment">!       fname     Str    I   Field name</span></div>
<div class="line"><a name="l05879"></a><span class="lineno"> 5879</span>&#160;    <span class="comment">!       rc        Int.   O   Return code</span></div>
<div class="line"><a name="l05880"></a><span class="lineno"> 5880</span>&#160;    <span class="comment">!       indx      Int    I   Returned index of fname</span></div>
<div class="line"><a name="l05881"></a><span class="lineno"> 5881</span>&#160;    <span class="comment">!     ----------------------------------------------------------------</span></div>
<div class="line"><a name="l05882"></a><span class="lineno"> 5882</span>&#160;    <span class="comment">!</span></div>
<div class="line"><a name="l05883"></a><span class="lineno"> 5883</span>&#160;    <span class="comment">!  4. Subroutines used :</span></div>
<div class="line"><a name="l05884"></a><span class="lineno"> 5884</span>&#160;    <span class="comment">!</span></div>
<div class="line"><a name="l05885"></a><span class="lineno"> 5885</span>&#160;    <span class="comment">!      Name      Type  Module   Description</span></div>
<div class="line"><a name="l05886"></a><span class="lineno"> 5886</span>&#160;    <span class="comment">!     ----------------------------------------------------------------</span></div>
<div class="line"><a name="l05887"></a><span class="lineno"> 5887</span>&#160;    <span class="comment">!      NONE</span></div>
<div class="line"><a name="l05888"></a><span class="lineno"> 5888</span>&#160;    <span class="comment">!     ----------------------------------------------------------------</span></div>
<div class="line"><a name="l05889"></a><span class="lineno"> 5889</span>&#160;    <span class="comment">!</span></div>
<div class="line"><a name="l05890"></a><span class="lineno"> 5890</span>&#160;    <span class="comment">!  5. Called by :</span></div>
<div class="line"><a name="l05891"></a><span class="lineno"> 5891</span>&#160;    <span class="comment">!</span></div>
<div class="line"><a name="l05892"></a><span class="lineno"> 5892</span>&#160;    <span class="comment">!  6. Error messages :</span></div>
<div class="line"><a name="l05893"></a><span class="lineno"> 5893</span>&#160;    <span class="comment">!</span></div>
<div class="line"><a name="l05894"></a><span class="lineno"> 5894</span>&#160;    <span class="comment">!  7. Remarks :</span></div>
<div class="line"><a name="l05895"></a><span class="lineno"> 5895</span>&#160;    <span class="comment">!</span></div>
<div class="line"><a name="l05896"></a><span class="lineno"> 5896</span>&#160;    <span class="comment">!  8. Structure :</span></div>
<div class="line"><a name="l05897"></a><span class="lineno"> 5897</span>&#160;    <span class="comment">!</span></div>
<div class="line"><a name="l05898"></a><span class="lineno"> 5898</span>&#160;    <span class="comment">!  9. Switches :</span></div>
<div class="line"><a name="l05899"></a><span class="lineno"> 5899</span>&#160;    <span class="comment">!</span></div>
<div class="line"><a name="l05900"></a><span class="lineno"> 5900</span>&#160;    <span class="comment">! 10. Source code :</span></div>
<div class="line"><a name="l05901"></a><span class="lineno"> 5901</span>&#160;    <span class="comment">!</span></div>
<div class="line"><a name="l05902"></a><span class="lineno"> 5902</span>&#160;    <span class="comment">!/ ------------------------------------------------------------------- /</span></div>
<div class="line"><a name="l05903"></a><span class="lineno"> 5903</span>&#160;    <span class="comment">!/</span></div>
<div class="line"><a name="l05904"></a><span class="lineno"> 5904</span>&#160;    <span class="comment">!/ ------------------------------------------------------------------- /</span></div>
<div class="line"><a name="l05905"></a><span class="lineno"> 5905</span>&#160;    <span class="comment">!/ Parameter list</span></div>
<div class="line"><a name="l05906"></a><span class="lineno"> 5906</span>&#160;    <span class="comment">!/</span></div>
<div class="line"><a name="l05907"></a><span class="lineno"> 5907</span>&#160;    <span class="keywordtype">implicit none</span></div>
<div class="line"><a name="l05908"></a><span class="lineno"> 5908</span>&#160;    <span class="keywordtype">character (len=*)</span> :: fnameList(:)</div>
<div class="line"><a name="l05909"></a><span class="lineno"> 5909</span>&#160;    <span class="keywordtype">character (len=*)</span> :: fname</div>
<div class="line"><a name="l05910"></a><span class="lineno"> 5910</span>&#160;    <span class="keywordtype">integer</span>           :: rc</div>
<div class="line"><a name="l05911"></a><span class="lineno"> 5911</span>&#160;    <span class="keywordtype">integer</span>           :: indx</div>
<div class="line"><a name="l05912"></a><span class="lineno"> 5912</span>&#160;    <span class="comment">!/</span></div>
<div class="line"><a name="l05913"></a><span class="lineno"> 5913</span>&#160;    <span class="comment">!/ ------------------------------------------------------------------- /</span></div>
<div class="line"><a name="l05914"></a><span class="lineno"> 5914</span>&#160;    <span class="comment">!/ Local parameters</span></div>
<div class="line"><a name="l05915"></a><span class="lineno"> 5915</span>&#160;    <span class="comment">!/</span></div>
<div class="line"><a name="l05916"></a><span class="lineno"> 5916</span>&#160;    <span class="keywordtype">integer</span>       :: i, check</div>
<div class="line"><a name="l05917"></a><span class="lineno"> 5917</span>&#160;    <span class="comment">!</span></div>
<div class="line"><a name="l05918"></a><span class="lineno"> 5918</span>&#160;    <span class="comment">! -------------------------------------------------------------------- /</span></div>
<div class="line"><a name="l05919"></a><span class="lineno"> 5919</span>&#160;    <span class="comment">! Find name in fnameList that matches fname</span></div>
<div class="line"><a name="l05920"></a><span class="lineno"> 5920</span>&#160;    <span class="comment">!</span></div>
<div class="line"><a name="l05921"></a><span class="lineno"> 5921</span>&#160;    <a class="code" href="ww3__systrk_8F90.html#a4eaa745ba73f3614e5bfbfb2b0fd3a50">check</a> = lbound(fnamelist,1) - 1</div>
<div class="line"><a name="l05922"></a><span class="lineno"> 5922</span>&#160;    indx = <a class="code" href="ww3__systrk_8F90.html#a4eaa745ba73f3614e5bfbfb2b0fd3a50">check</a></div>
<div class="line"><a name="l05923"></a><span class="lineno"> 5923</span>&#160;    <span class="keywordflow">do</span> i = lbound(fnamelist,1),ubound(fnamelist,1)</div>
<div class="line"><a name="l05924"></a><span class="lineno"> 5924</span>&#160;      <span class="keywordflow">if</span> ( trim(fnamelist(i)).eq.trim(fname) ) <span class="keywordflow">then</span></div>
<div class="line"><a name="l05925"></a><span class="lineno"> 5925</span>&#160;        indx = i</div>
<div class="line"><a name="l05926"></a><span class="lineno"> 5926</span>&#160;        <span class="keywordflow">exit</span></div>
<div class="line"><a name="l05927"></a><span class="lineno"> 5927</span>&#160;<span class="keywordflow">      endif</span></div>
<div class="line"><a name="l05928"></a><span class="lineno"> 5928</span>&#160;<span class="keywordflow">    enddo</span></div>
<div class="line"><a name="l05929"></a><span class="lineno"> 5929</span>&#160;    <span class="keywordflow">if</span> ( indx.eq.<a class="code" href="ww3__systrk_8F90.html#a4eaa745ba73f3614e5bfbfb2b0fd3a50">check</a> ) <span class="keywordflow">then</span></div>
<div class="line"><a name="l05930"></a><span class="lineno"> 5930</span>&#160;      <span class="keyword">call </span>esmf_logseterror(esmf_failure, rctoreturn=rc, &amp;</div>
<div class="line"><a name="l05931"></a><span class="lineno"> 5931</span>&#160;           msg=<span class="stringliteral">&#39;FieldIndex: input name (&#39;</span>//fname//<span class="stringliteral">&#39;) not in list&#39;</span>)</div>
<div class="line"><a name="l05932"></a><span class="lineno"> 5932</span>&#160;<span class="keywordflow">    endif</span></div>
<div class="line"><a name="l05933"></a><span class="lineno"> 5933</span>&#160;    <span class="comment">!/</span></div>
<div class="line"><a name="l05934"></a><span class="lineno"> 5934</span>&#160;    <span class="comment">!/ End of FieldIndex ------------------------------------------------- /</span></div>
<div class="line"><a name="l05935"></a><span class="lineno"> 5935</span>&#160;    <span class="comment">!/</span></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="w3adatmd_8F90_source.html#l00614">w3adatmd::aba</a>, <a class="el" href="w3adatmd_8F90_source.html#l00575">w3adatmd::cg</a>, <a class="el" href="w3adatmd_8F90_source.html#l00603">w3adatmd::charn</a>, <a class="el" href="ww3__systrk_8F90_source.html#l01299">check()</a>, <a class="el" href="w3gdatmd_8F90_source.html#l00625">w3gdatmd::clgtype</a>, <a class="el" href="w3gdatmd_8F90_source.html#l01234">w3gdatmd::dden</a>, <a class="el" href="w3gdatmd_8F90_source.html#l01183">w3gdatmd::dmin</a>, <a class="el" href="w3adatmd_8F90_source.html#l00584">w3adatmd::dw</a>, <a class="el" href="constants_8F90_source.html#l00062">constants::dwat</a>, <a class="el" href="w3gdatmd_8F90_source.html#l01234">w3gdatmd::ec2</a>, <a class="el" href="w3gdatmd_8F90_source.html#l01234">w3gdatmd::ecos</a>, <a class="el" href="w3gdatmd_8F90_source.html#l01234">w3gdatmd::es2</a>, <a class="el" href="w3gdatmd_8F90_source.html#l01234">w3gdatmd::esc</a>, <a class="el" href="w3gdatmd_8F90_source.html#l01234">w3gdatmd::esin</a>, <a class="el" href="CMakeLists_8txt_source.html#l00003">file()</a>, <a class="el" href="w3gdatmd_8F90_source.html#l01232">w3gdatmd::fte</a>, <a class="el" href="constants_8F90_source.html#l00061">constants::grav</a>, <a class="el" href="w3gdatmd_8F90_source.html#l01094">w3gdatmd::gtype</a>, <a class="el" href="w3odatmd_8F90_source.html#l00457">w3odatmd::iaproc</a>, <a class="el" href="yownodepool_8F90_source.html#l00116">yownodepool::iplg</a>, <a class="el" href="constants_8F90_source.html#l00101">constants::lpdlib</a>, <a class="el" href="w3gdatmd_8F90_source.html#l01163">w3gdatmd::mapsf</a>, <a class="el" href="w3gdatmd_8F90_source.html#l01163">w3gdatmd::mapsta</a>, <a class="el" href="w3odatmd_8F90_source.html#l00457">w3odatmd::naproc</a>, <a class="el" href="w3gdatmd_8F90_source.html#l01230">w3gdatmd::nk</a>, <a class="el" href="yownodepool_8F90_source.html#l00093">yownodepool::np</a>, <a class="el" href="w3gdatmd_8F90_source.html#l01097">w3gdatmd::nseal</a>, <a class="el" href="w3gdatmd_8F90_source.html#l01230">w3gdatmd::nth</a>, <a class="el" href="w3gdatmd_8F90_source.html#l01097">w3gdatmd::nx</a>, <a class="el" href="w3gdatmd_8F90_source.html#l01097">w3gdatmd::ny</a>, <a class="el" href="w3gdatmd_8F90_source.html#l00624">w3gdatmd::rlgtype</a>, <a class="el" href="w3gdatmd_8F90_source.html#l01234">w3gdatmd::sig</a>, <a class="el" href="w3gdatmd_8F90_source.html#l01234">w3gdatmd::sig2</a>, <a class="el" href="w3adatmd_8F90_source.html#l00607">w3adatmd::sxx</a>, <a class="el" href="w3adatmd_8F90_source.html#l00607">w3adatmd::sxy</a>, <a class="el" href="w3adatmd_8F90_source.html#l00607">w3adatmd::syy</a>, <a class="el" href="constants_8F90_source.html#l00072">constants::tpi</a>, <a class="el" href="w3adatmd_8F90_source.html#l00584">w3adatmd::u10</a>, <a class="el" href="w3adatmd_8F90_source.html#l00584">w3adatmd::u10d</a>, <a class="el" href="w3adatmd_8F90_source.html#l00614">w3adatmd::uba</a>, <a class="el" href="w3adatmd_8F90_source.html#l00614">w3adatmd::ubd</a>, <a class="el" href="w3gdatmd_8F90_source.html#l00626">w3gdatmd::ungtype</a>, <a class="el" href="w3wdatmd_8F90_source.html#l00183">w3wdatmd::ust</a>, <a class="el" href="w3wdatmd_8F90_source.html#l00183">w3wdatmd::va</a>, <a class="el" href="w3src3md_8F90_source.html#l00137">w3src3md::w3spr3()</a>, <a class="el" href="w3src4md_8F90_source.html#l00145">w3src4md::w3spr4()</a>, <a class="el" href="w3adatmd_8F90_source.html#l00575">w3adatmd::wn</a>, and <a class="el" href="w3adatmd_8F90_source.html#l00587">w3adatmd::wnmean</a>.</p>

</div>
</div>
<a id="a9aacdbe6b0276055261efea9e328c953"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a9aacdbe6b0276055261efea9e328c953">&#9670;&nbsp;</a></span>readfromfile()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">subroutine wmesmfmd::readfromfile </td>
          <td>(</td>
          <td class="paramtype">character(len=3), intent(inout)&#160;</td>
          <td class="paramname"><em>idfld</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">type(esmf_field), intent(inout)&#160;</td>
          <td class="paramname"><em>fldwx</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">type(esmf_field), intent(inout)&#160;</td>
          <td class="paramname"><em>fldwy</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">integer, dimension(2), intent(in)&#160;</td>
          <td class="paramname"><em>time0</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">integer, dimension(2), intent(in)&#160;</td>
          <td class="paramname"><em>timen</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">integer, intent(inout), optional&#160;</td>
          <td class="paramname"><em>rc</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Read input file to fill unmapped point for regional applications. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in,out]</td><td class="paramname">idfld</td><td>Field name </td></tr>
    <tr><td class="paramdir">[in,out]</td><td class="paramname">fldwx</td><td>2D eastward-component of field </td></tr>
    <tr><td class="paramdir">[in,out]</td><td class="paramname">fldwy</td><td>2D northward-component of field </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">time0</td><td>Time stamp for current time </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">timen</td><td>Time stamp for end time </td></tr>
    <tr><td class="paramdir">[in,out]</td><td class="paramname">rc</td><td>Return code</td></tr>
  </table>
  </dd>
</dl>
<dl class="section author"><dt>Author</dt><dd>U. Turuncoglu </dd></dl>
<dl class="section date"><dt>Date</dt><dd>18-May-2021 </dd></dl>

<p class="definition">Definition at line <a class="el" href="wmesmfmd_8F90_source.html#l07709">7709</a> of file <a class="el" href="wmesmfmd_8F90_source.html">wmesmfmd.F90</a>.</p>
<div class="fragment"><div class="line"><a name="l07709"></a><span class="lineno"> 7709</span>&#160;    <span class="comment">!/</span></div>
<div class="line"><a name="l07710"></a><span class="lineno"> 7710</span>&#160;    <span class="comment">!/                  +-----------------------------------+</span></div>
<div class="line"><a name="l07711"></a><span class="lineno"> 7711</span>&#160;    <span class="comment">!/                  | WAVEWATCH III           NOAA/NCEP |</span></div>
<div class="line"><a name="l07712"></a><span class="lineno"> 7712</span>&#160;    <span class="comment">!/                  |           U. Turuncoglu           |</span></div>
<div class="line"><a name="l07713"></a><span class="lineno"> 7713</span>&#160;    <span class="comment">!/                  |                        FORTRAN 90 |</span></div>
<div class="line"><a name="l07714"></a><span class="lineno"> 7714</span>&#160;    <span class="comment">!/                  | Last update :         18-May-2021 |</span></div>
<div class="line"><a name="l07715"></a><span class="lineno"> 7715</span>&#160;    <span class="comment">!/                  +-----------------------------------+</span></div>
<div class="line"><a name="l07716"></a><span class="lineno"> 7716</span>&#160;    <span class="comment">!/</span></div>
<div class="line"><a name="l07717"></a><span class="lineno"> 7717</span>&#160;    <span class="comment">!/    18-May-2021 : Origination.                        ( version 7.13 )</span></div>
<div class="line"><a name="l07718"></a><span class="lineno"> 7718</span>&#160;    <span class="comment">!/</span></div>
<div class="line"><a name="l07719"></a><span class="lineno"> 7719</span>&#160;    <span class="comment">!  1. Purpose :</span></div>
<div class="line"><a name="l07720"></a><span class="lineno"> 7720</span>&#160;    <span class="comment">!</span></div>
<div class="line"><a name="l07721"></a><span class="lineno"> 7721</span>&#160;    <span class="comment">!     Read input file to fill unmapped point for regional applications</span></div>
<div class="line"><a name="l07722"></a><span class="lineno"> 7722</span>&#160;    <span class="comment">!</span></div>
<div class="line"><a name="l07723"></a><span class="lineno"> 7723</span>&#160;    <span class="comment">!  2. Method :</span></div>
<div class="line"><a name="l07724"></a><span class="lineno"> 7724</span>&#160;    <span class="comment">!</span></div>
<div class="line"><a name="l07725"></a><span class="lineno"> 7725</span>&#160;    <span class="comment">!  3. Parameters :</span></div>
<div class="line"><a name="l07726"></a><span class="lineno"> 7726</span>&#160;    <span class="comment">!</span></div>
<div class="line"><a name="l07727"></a><span class="lineno"> 7727</span>&#160;    <span class="comment">!     Parameter list</span></div>
<div class="line"><a name="l07728"></a><span class="lineno"> 7728</span>&#160;    <span class="comment">!     ----------------------------------------------------------------</span></div>
<div class="line"><a name="l07729"></a><span class="lineno"> 7729</span>&#160;    <span class="comment">!       idfld     Str    I/O Field name</span></div>
<div class="line"><a name="l07730"></a><span class="lineno"> 7730</span>&#160;    <span class="comment">!       fldwx     Type   I/O 2D eastward-component of field</span></div>
<div class="line"><a name="l07731"></a><span class="lineno"> 7731</span>&#160;    <span class="comment">!       fldwy     Type   I/O 2D northward-component of field</span></div>
<div class="line"><a name="l07732"></a><span class="lineno"> 7732</span>&#160;    <span class="comment">!       time0     Int    I   Time stamp for current time</span></div>
<div class="line"><a name="l07733"></a><span class="lineno"> 7733</span>&#160;    <span class="comment">!       timen     Int    I   Time stamp for end time</span></div>
<div class="line"><a name="l07734"></a><span class="lineno"> 7734</span>&#160;    <span class="comment">!       rc        Int    I/O Return code</span></div>
<div class="line"><a name="l07735"></a><span class="lineno"> 7735</span>&#160;    <span class="comment">!     ----------------------------------------------------------------</span></div>
<div class="line"><a name="l07736"></a><span class="lineno"> 7736</span>&#160;    <span class="comment">!</span></div>
<div class="line"><a name="l07737"></a><span class="lineno"> 7737</span>&#160;    <span class="comment">!  4. Subroutines used :</span></div>
<div class="line"><a name="l07738"></a><span class="lineno"> 7738</span>&#160;    <span class="comment">!</span></div>
<div class="line"><a name="l07739"></a><span class="lineno"> 7739</span>&#160;    <span class="comment">!      Name      Type  Module   Description</span></div>
<div class="line"><a name="l07740"></a><span class="lineno"> 7740</span>&#160;    <span class="comment">!     ----------------------------------------------------------------</span></div>
<div class="line"><a name="l07741"></a><span class="lineno"> 7741</span>&#160;    <span class="comment">!      NONE</span></div>
<div class="line"><a name="l07742"></a><span class="lineno"> 7742</span>&#160;    <span class="comment">!     ----------------------------------------------------------------</span></div>
<div class="line"><a name="l07743"></a><span class="lineno"> 7743</span>&#160;    <span class="comment">!</span></div>
<div class="line"><a name="l07744"></a><span class="lineno"> 7744</span>&#160;    <span class="comment">!  5. Called by :</span></div>
<div class="line"><a name="l07745"></a><span class="lineno"> 7745</span>&#160;    <span class="comment">!</span></div>
<div class="line"><a name="l07746"></a><span class="lineno"> 7746</span>&#160;    <span class="comment">!  6. Error messages :</span></div>
<div class="line"><a name="l07747"></a><span class="lineno"> 7747</span>&#160;    <span class="comment">!</span></div>
<div class="line"><a name="l07748"></a><span class="lineno"> 7748</span>&#160;    <span class="comment">!  7. Remarks :</span></div>
<div class="line"><a name="l07749"></a><span class="lineno"> 7749</span>&#160;    <span class="comment">!</span></div>
<div class="line"><a name="l07750"></a><span class="lineno"> 7750</span>&#160;    <span class="comment">!  8. Structure :</span></div>
<div class="line"><a name="l07751"></a><span class="lineno"> 7751</span>&#160;    <span class="comment">!</span></div>
<div class="line"><a name="l07752"></a><span class="lineno"> 7752</span>&#160;    <span class="comment">!  9. Switches :</span></div>
<div class="line"><a name="l07753"></a><span class="lineno"> 7753</span>&#160;    <span class="comment">!</span></div>
<div class="line"><a name="l07754"></a><span class="lineno"> 7754</span>&#160;    <span class="comment">! 10. Source code :</span></div>
<div class="line"><a name="l07755"></a><span class="lineno"> 7755</span>&#160;    <span class="comment">!</span></div>
<div class="line"><a name="l07756"></a><span class="lineno"> 7756</span>&#160;    <span class="comment">!/ ------------------------------------------------------------------- /</span></div>
<div class="line"><a name="l07757"></a><span class="lineno"> 7757</span>&#160;    <span class="comment">!/</span></div>
<div class="line"><a name="l07758"></a><span class="lineno"> 7758</span>&#160;    <span class="keywordtype">USE </span><a class="code" href="namespacew3fldsmd.html">w3fldsmd</a>, <span class="keywordtype">ONLY</span>: <a class="code" href="namespacew3fldsmd.html#a98e84e100f8c808d04e0584cb1793d51">w3fldo</a>, <a class="code" href="namespacew3fldsmd.html#ad01f1b24a7947627c4e50e56830a2150">w3fldg</a></div>
<div class="line"><a name="l07759"></a><span class="lineno"> 7759</span>&#160;    <span class="keywordtype">USE </span><a class="code" href="namespacewmunitmd.html">wmunitmd</a>, <span class="keywordtype">ONLY</span>: <a class="code" href="namespacewmunitmd.html#a1e23e9e471aff383d3d3a991537d04ed">wmuget</a>, <a class="code" href="namespacewmunitmd.html#aafbea7426177ddda28e3875ca9244829">wmuset</a></div>
<div class="line"><a name="l07760"></a><span class="lineno"> 7760</span>&#160;    <span class="keywordtype">IMPLICIT NONE</span></div>
<div class="line"><a name="l07761"></a><span class="lineno"> 7761</span>&#160;    <span class="comment">!/ ------------------------------------------------------------------- /</span></div>
<div class="line"><a name="l07762"></a><span class="lineno"> 7762</span>&#160;    <span class="comment">!/ Parameter list</span></div>
<div class="line"><a name="l07763"></a><span class="lineno"> 7763</span>&#160;    <span class="comment">!/</span></div>
<div class="line"><a name="l07764"></a><span class="lineno"> 7764</span>&#160;    <span class="keywordtype">character(len=3)</span>, <span class="keywordtype">intent(inout)</span>  :: idfld</div>
<div class="line"><a name="l07765"></a><span class="lineno"> 7765</span>&#160;    <span class="keywordtype">type</span>(ESMF_Field), <span class="keywordtype">intent(inout)</span>  :: fldwx</div>
<div class="line"><a name="l07766"></a><span class="lineno"> 7766</span>&#160;    <span class="keywordtype">type</span>(ESMF_Field), <span class="keywordtype">intent(inout)</span>  :: fldwy</div>
<div class="line"><a name="l07767"></a><span class="lineno"> 7767</span>&#160;    <span class="keywordtype">integer</span>, <span class="keywordtype">intent(in)</span>              :: time0(2)</div>
<div class="line"><a name="l07768"></a><span class="lineno"> 7768</span>&#160;    <span class="keywordtype">integer</span>, <span class="keywordtype">intent(in)</span>              :: timen(2)</div>
<div class="line"><a name="l07769"></a><span class="lineno"> 7769</span>&#160;    <span class="keywordtype">integer</span>, <span class="keywordtype">intent(inout)</span>, <span class="keywordtype">optional</span> :: rc</div>
<div class="line"><a name="l07770"></a><span class="lineno"> 7770</span>&#160;    <span class="comment">!/</span></div>
<div class="line"><a name="l07771"></a><span class="lineno"> 7771</span>&#160;    <span class="comment">!/ ------------------------------------------------------------------- /</span></div>
<div class="line"><a name="l07772"></a><span class="lineno"> 7772</span>&#160;    <span class="comment">!/ Local parameters</span></div>
<div class="line"><a name="l07773"></a><span class="lineno"> 7773</span>&#160;    <span class="comment">!/</span></div>
<div class="line"><a name="l07774"></a><span class="lineno"> 7774</span>&#160;    <span class="keywordtype">integer</span> :: ierr, tw0l(2), twnl(2), lb(2), ub(2)</div>
<div class="line"><a name="l07775"></a><span class="lineno"> 7775</span>&#160;<span class="keywordtype">    real</span> :: wx0l(nx,ny), wy0l(nx,ny)</div>
<div class="line"><a name="l07776"></a><span class="lineno"> 7776</span>&#160;<span class="keywordtype">    real</span> :: wxnl(nx,ny), wynl(nx,ny)</div>
<div class="line"><a name="l07777"></a><span class="lineno"> 7777</span>&#160;<span class="keywordtype">    real</span> :: dt0l(nx,ny), dtnl(nx,ny)</div>
<div class="line"><a name="l07778"></a><span class="lineno"> 7778</span>&#160;<span class="keywordtype">    real</span>(ESMF_KIND_RX), <span class="keywordtype">pointer</span> :: dptr(:,:)</div>
<div class="line"><a name="l07779"></a><span class="lineno"> 7779</span>&#160;    <span class="keywordtype">integer</span> :: mdse = 6</div>
<div class="line"><a name="l07780"></a><span class="lineno"> 7780</span>&#160;    <span class="keywordtype">integer</span> :: mdst = 10</div>
<div class="line"><a name="l07781"></a><span class="lineno"> 7781</span>&#160;    <span class="keywordtype">integer</span>, <span class="keywordtype">save</span> :: mdsf</div>
<div class="line"><a name="l07782"></a><span class="lineno"> 7782</span>&#160;    <span class="keywordtype">character(256)</span> :: logmsg</div>
<div class="line"><a name="l07783"></a><span class="lineno"> 7783</span>&#160;    <span class="keywordtype">logical</span> :: flagsc = .false.</div>
<div class="line"><a name="l07784"></a><span class="lineno"> 7784</span>&#160;    <span class="keywordtype">integer</span>, <span class="keywordtype">parameter</span> :: lde = 0</div>
<div class="line"><a name="l07785"></a><span class="lineno"> 7785</span>&#160;    <span class="keywordtype">logical</span>, <span class="keywordtype">save</span> :: firstCall = .true.</div>
<div class="line"><a name="l07786"></a><span class="lineno"> 7786</span>&#160;    <span class="keywordtype">character(len=13)</span> :: tsstr</div>
<div class="line"><a name="l07787"></a><span class="lineno"> 7787</span>&#160;    <span class="keywordtype">character(len=3)</span> :: tsfld</div>
<div class="line"><a name="l07788"></a><span class="lineno"> 7788</span>&#160;    <span class="keywordtype">integer</span> :: nxt, nyt, gtypet, filler(3), tideflag</div>
<div class="line"><a name="l07789"></a><span class="lineno"> 7789</span>&#160;<span class="preprocessor">#if defined(TEST_WMESMFMD) || defined(TEST_WMESMFMD_READFROMFILE)</span></div>
<div class="line"><a name="l07790"></a><span class="lineno"> 7790</span>&#160;<span class="preprocessor"></span>    <span class="keywordtype">integer</span>, <span class="keywordtype">save</span> :: timeSlice = 1</div>
<div class="line"><a name="l07791"></a><span class="lineno"> 7791</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l07792"></a><span class="lineno"> 7792</span>&#160;<span class="preprocessor"></span>    <span class="comment">!</span></div>
<div class="line"><a name="l07793"></a><span class="lineno"> 7793</span>&#160;    <span class="comment">! -------------------------------------------------------------------- /</span></div>
<div class="line"><a name="l07794"></a><span class="lineno"> 7794</span>&#160;    <span class="comment">!</span></div>
<div class="line"><a name="l07795"></a><span class="lineno"> 7795</span>&#160;    rc = esmf_success</div>
<div class="line"><a name="l07796"></a><span class="lineno"> 7796</span>&#160; </div>
<div class="line"><a name="l07797"></a><span class="lineno"> 7797</span>&#160;    <span class="keywordflow">if</span> (firstcall) <span class="keywordflow">then</span></div>
<div class="line"><a name="l07798"></a><span class="lineno"> 7798</span>&#160;      <span class="comment">! assign unit number for input file</span></div>
<div class="line"><a name="l07799"></a><span class="lineno"> 7799</span>&#160;      <span class="keyword">call </span><a class="code" href="namespacewmunitmd.html#a1e23e9e471aff383d3d3a991537d04ed">wmuget</a>(mdse, mdst, mdsf, <span class="stringliteral">&#39;INP&#39;</span>)</div>
<div class="line"><a name="l07800"></a><span class="lineno"> 7800</span>&#160;      <span class="keyword">call </span><a class="code" href="namespacewmunitmd.html#aafbea7426177ddda28e3875ca9244829">wmuset</a>(mdse, mdst, mdsf, .true., desc=<span class="stringliteral">&#39;Input data file&#39;</span>)</div>
<div class="line"><a name="l07801"></a><span class="lineno"> 7801</span>&#160; </div>
<div class="line"><a name="l07802"></a><span class="lineno"> 7802</span>&#160;      <span class="comment">! open file</span></div>
<div class="line"><a name="l07803"></a><span class="lineno"> 7803</span>&#160;      <span class="keyword">call </span><a class="code" href="namespacew3fldsmd.html#a98e84e100f8c808d04e0584cb1793d51">w3fldo</a>(<span class="stringliteral">&#39;READ&#39;</span>, idfld, mdsf, mdst, mdse, nx, ny, gtype, ierr)</div>
<div class="line"><a name="l07804"></a><span class="lineno"> 7804</span>&#160;      <span class="keywordflow">if</span> (ierr.ne.0) <span class="keywordflow">then</span></div>
<div class="line"><a name="l07805"></a><span class="lineno"> 7805</span>&#160;        <span class="keyword">write</span>(logmsg,*) <span class="stringliteral">&quot;Error in opening &quot;</span>//idfld//<span class="stringliteral">&quot;, iostat = &quot;</span>, ierr</div>
<div class="line"><a name="l07806"></a><span class="lineno"> 7806</span>&#160;        <span class="keyword">call </span>esmf_logwrite(trim(logmsg), esmf_logmsg_error)</div>
<div class="line"><a name="l07807"></a><span class="lineno"> 7807</span>&#160;        rc = esmf_failure</div>
<div class="line"><a name="l07808"></a><span class="lineno"> 7808</span>&#160;        <span class="keywordflow">return</span></div>
<div class="line"><a name="l07809"></a><span class="lineno"> 7809</span>&#160;<span class="keywordflow">      endif</span></div>
<div class="line"><a name="l07810"></a><span class="lineno"> 7810</span>&#160; </div>
<div class="line"><a name="l07811"></a><span class="lineno"> 7811</span>&#160;      firstcall = .false.</div>
<div class="line"><a name="l07812"></a><span class="lineno"> 7812</span>&#160;<span class="keywordflow">    end if</span></div>
<div class="line"><a name="l07813"></a><span class="lineno"> 7813</span>&#160; </div>
<div class="line"><a name="l07814"></a><span class="lineno"> 7814</span>&#160;    <span class="comment">! init variables</span></div>
<div class="line"><a name="l07815"></a><span class="lineno"> 7815</span>&#160;    wx0l = 0.0</div>
<div class="line"><a name="l07816"></a><span class="lineno"> 7816</span>&#160;    wy0l = 0.0</div>
<div class="line"><a name="l07817"></a><span class="lineno"> 7817</span>&#160;    dt0l = 0.0</div>
<div class="line"><a name="l07818"></a><span class="lineno"> 7818</span>&#160;    wxnl = 0.0</div>
<div class="line"><a name="l07819"></a><span class="lineno"> 7819</span>&#160;    wynl = 0.0</div>
<div class="line"><a name="l07820"></a><span class="lineno"> 7820</span>&#160;    dtnl = 0.0</div>
<div class="line"><a name="l07821"></a><span class="lineno"> 7821</span>&#160; </div>
<div class="line"><a name="l07822"></a><span class="lineno"> 7822</span>&#160;    <span class="comment">! need to rewind to the begining of the file to access</span></div>
<div class="line"><a name="l07823"></a><span class="lineno"> 7823</span>&#160;    <span class="comment">! data of requested date correctly</span></div>
<div class="line"><a name="l07824"></a><span class="lineno"> 7824</span>&#160;    rewind(mdsf)</div>
<div class="line"><a name="l07825"></a><span class="lineno"> 7825</span>&#160; </div>
<div class="line"><a name="l07826"></a><span class="lineno"> 7826</span>&#160;    <span class="comment">! read header information</span></div>
<div class="line"><a name="l07827"></a><span class="lineno"> 7827</span>&#160;    <span class="comment">! this was inside of w3fldo call but since we are opening file</span></div>
<div class="line"><a name="l07828"></a><span class="lineno"> 7828</span>&#160;    <span class="comment">! once and rewinding, the header need to be read</span></div>
<div class="line"><a name="l07829"></a><span class="lineno"> 7829</span>&#160;    <span class="keyword">read</span>(mdsf, iostat=ierr) tsstr, tsfld, nxt, nyt, &amp;</div>
<div class="line"><a name="l07830"></a><span class="lineno"> 7830</span>&#160;         gtypet, filler(1:2), tideflag</div>
<div class="line"><a name="l07831"></a><span class="lineno"> 7831</span>&#160; </div>
<div class="line"><a name="l07832"></a><span class="lineno"> 7832</span>&#160;    <span class="comment">! read input</span></div>
<div class="line"><a name="l07833"></a><span class="lineno"> 7833</span>&#160;    <span class="keyword">call </span><a class="code" href="namespacew3fldsmd.html#ad01f1b24a7947627c4e50e56830a2150">w3fldg</a>(<span class="stringliteral">&#39;READ&#39;</span>, idfld, mdsf, mdst, mdse, nx, ny, &amp;</div>
<div class="line"><a name="l07834"></a><span class="lineno"> 7834</span>&#160;         nx, ny, time0, timen, tw0l, wx0l, wy0l, dt0l, twnl, &amp;</div>
<div class="line"><a name="l07835"></a><span class="lineno"> 7835</span>&#160;         wxnl, wynl, dtnl, ierr, <a class="code" href="namespacew3idatmd.html#ae00907da2d4618c147d88c942f1055fd">flagsc</a>)</div>
<div class="line"><a name="l07836"></a><span class="lineno"> 7836</span>&#160; </div>
<div class="line"><a name="l07837"></a><span class="lineno"> 7837</span>&#160;    <span class="comment">! fill fields with data belong to current time</span></div>
<div class="line"><a name="l07838"></a><span class="lineno"> 7838</span>&#160;    <span class="keywordflow">if</span> ( impgridislocal ) <span class="keywordflow">then</span></div>
<div class="line"><a name="l07839"></a><span class="lineno"> 7839</span>&#160;      <span class="keyword">call </span>esmf_fieldget(fldwx, localde=lde, farrayptr=dptr, &amp;</div>
<div class="line"><a name="l07840"></a><span class="lineno"> 7840</span>&#160;           exclusivelbound=lb, exclusiveubound=ub, rc=rc)</div>
<div class="line"><a name="l07841"></a><span class="lineno"> 7841</span>&#160;      <span class="keywordflow">if</span> (esmf_logfounderror(rc, passthru)) <span class="keywordflow">return</span></div>
<div class="line"><a name="l07842"></a><span class="lineno"> 7842</span>&#160;      dptr(lb(1):ub(1),lb(2):ub(2)) = wx0l(lb(1):ub(1),lb(2):ub(2))</div>
<div class="line"><a name="l07843"></a><span class="lineno"> 7843</span>&#160;      <span class="keywordflow">if</span> (<span class="keyword">associated</span>(dptr)) <span class="keyword">nullify</span>(dptr)</div>
<div class="line"><a name="l07844"></a><span class="lineno"> 7844</span>&#160;      <span class="keyword">call </span>esmf_fieldget(fldwy, localde=lde, farrayptr=dptr, &amp;</div>
<div class="line"><a name="l07845"></a><span class="lineno"> 7845</span>&#160;           exclusivelbound=lb, exclusiveubound=ub, rc=rc)</div>
<div class="line"><a name="l07846"></a><span class="lineno"> 7846</span>&#160;      <span class="keywordflow">if</span> (esmf_logfounderror(rc, passthru)) <span class="keywordflow">return</span></div>
<div class="line"><a name="l07847"></a><span class="lineno"> 7847</span>&#160;      dptr(lb(1):ub(1),lb(2):ub(2)) = wy0l(lb(1):ub(1),lb(2):ub(2))</div>
<div class="line"><a name="l07848"></a><span class="lineno"> 7848</span>&#160;      <span class="keywordflow">if</span> (<span class="keyword">associated</span>(dptr)) <span class="keyword">nullify</span>(dptr)</div>
<div class="line"><a name="l07849"></a><span class="lineno"> 7849</span>&#160;<span class="keywordflow">    end if</span></div>
<div class="line"><a name="l07850"></a><span class="lineno"> 7850</span>&#160; </div>
<div class="line"><a name="l07851"></a><span class="lineno"> 7851</span>&#160;<span class="preprocessor">#if defined(TEST_WMESMFMD) || defined(TEST_WMESMFMD_READFROMFILE)</span></div>
<div class="line"><a name="l07852"></a><span class="lineno"> 7852</span>&#160;<span class="preprocessor"></span>    <span class="keyword">write</span>(logmsg,*) <span class="stringliteral">&#39;time0 = &#39;</span>, time0(1), time0(2)</div>
<div class="line"><a name="l07853"></a><span class="lineno"> 7853</span>&#160;    <span class="keyword">call </span>esmf_logwrite(trim(logmsg), esmf_logmsg_info, rc=rc)</div>
<div class="line"><a name="l07854"></a><span class="lineno"> 7854</span>&#160;    <span class="keywordflow">if</span> (esmf_logfounderror(rc, passthru)) <span class="keywordflow">return</span></div>
<div class="line"><a name="l07855"></a><span class="lineno"> 7855</span>&#160;    <span class="keyword">write</span>(logmsg,*) <span class="stringliteral">&#39;timen = &#39;</span>, timen(1), timen(2)</div>
<div class="line"><a name="l07856"></a><span class="lineno"> 7856</span>&#160;    <span class="keyword">call </span>esmf_logwrite(trim(logmsg), esmf_logmsg_info, rc=rc)</div>
<div class="line"><a name="l07857"></a><span class="lineno"> 7857</span>&#160;    <span class="keywordflow">if</span> (esmf_logfounderror(rc, passthru)) <span class="keywordflow">return</span></div>
<div class="line"><a name="l07858"></a><span class="lineno"> 7858</span>&#160;    <span class="keyword">write</span>(logmsg,*) <span class="stringliteral">&#39;tw0 = &#39;</span>, tw0l(1), tw0l(2)</div>
<div class="line"><a name="l07859"></a><span class="lineno"> 7859</span>&#160;    <span class="keyword">call </span>esmf_logwrite(trim(logmsg), esmf_logmsg_info, rc=rc)</div>
<div class="line"><a name="l07860"></a><span class="lineno"> 7860</span>&#160;    <span class="keywordflow">if</span> (esmf_logfounderror(rc, passthru)) <span class="keywordflow">return</span></div>
<div class="line"><a name="l07861"></a><span class="lineno"> 7861</span>&#160;    <span class="keyword">write</span>(logmsg,*) <span class="stringliteral">&#39;twn = &#39;</span>, twnl(1), twnl(2)</div>
<div class="line"><a name="l07862"></a><span class="lineno"> 7862</span>&#160;    <span class="keyword">call </span>esmf_logwrite(trim(logmsg), esmf_logmsg_info, rc=rc)</div>
<div class="line"><a name="l07863"></a><span class="lineno"> 7863</span>&#160;    <span class="keywordflow">if</span> (esmf_logfounderror(rc, passthru)) <span class="keywordflow">return</span></div>
<div class="line"><a name="l07864"></a><span class="lineno"> 7864</span>&#160;    <span class="keyword">write</span>(logmsg,*) <span class="stringliteral">&#39;wx0 min, max = &#39;</span>, minval(wx0l), maxval(wx0l)</div>
<div class="line"><a name="l07865"></a><span class="lineno"> 7865</span>&#160;    <span class="keyword">call </span>esmf_logwrite(trim(logmsg), esmf_logmsg_info, rc=rc)</div>
<div class="line"><a name="l07866"></a><span class="lineno"> 7866</span>&#160;    <span class="keywordflow">if</span> (esmf_logfounderror(rc, passthru)) <span class="keywordflow">return</span></div>
<div class="line"><a name="l07867"></a><span class="lineno"> 7867</span>&#160;    <span class="keyword">write</span>(logmsg,*) <span class="stringliteral">&#39;wy0 min, max = &#39;</span>, minval(wy0l), maxval(wy0l)</div>
<div class="line"><a name="l07868"></a><span class="lineno"> 7868</span>&#160;    <span class="keyword">call </span>esmf_logwrite(trim(logmsg), esmf_logmsg_info, rc=rc)</div>
<div class="line"><a name="l07869"></a><span class="lineno"> 7869</span>&#160;    <span class="keywordflow">if</span> (esmf_logfounderror(rc, passthru)) <span class="keywordflow">return</span></div>
<div class="line"><a name="l07870"></a><span class="lineno"> 7870</span>&#160;    <span class="keyword">write</span>(logmsg,*) <span class="stringliteral">&#39;wxn min, max = &#39;</span>, minval(wxnl), maxval(wxnl)</div>
<div class="line"><a name="l07871"></a><span class="lineno"> 7871</span>&#160;    <span class="keyword">call </span>esmf_logwrite(trim(logmsg), esmf_logmsg_info, rc=rc)</div>
<div class="line"><a name="l07872"></a><span class="lineno"> 7872</span>&#160;    <span class="keywordflow">if</span> (esmf_logfounderror(rc, passthru)) <span class="keywordflow">return</span></div>
<div class="line"><a name="l07873"></a><span class="lineno"> 7873</span>&#160;    <span class="keyword">write</span>(logmsg,*) <span class="stringliteral">&#39;wyn min, max = &#39;</span>, minval(wynl), maxval(wynl)</div>
<div class="line"><a name="l07874"></a><span class="lineno"> 7874</span>&#160;    <span class="keyword">call </span>esmf_logwrite(trim(logmsg), esmf_logmsg_info, rc=rc)</div>
<div class="line"><a name="l07875"></a><span class="lineno"> 7875</span>&#160;    <span class="keywordflow">if</span> (esmf_logfounderror(rc, passthru)) <span class="keywordflow">return</span></div>
<div class="line"><a name="l07876"></a><span class="lineno"> 7876</span>&#160;    <span class="keyword">call </span>esmf_fieldwrite( fldwx, &amp;</div>
<div class="line"><a name="l07877"></a><span class="lineno"> 7877</span>&#160;         <span class="stringliteral">&quot;wmesmfmd_read_wx0.nc&quot;</span>, &amp;</div>
<div class="line"><a name="l07878"></a><span class="lineno"> 7878</span>&#160;         overwrite=.true., timeslice=timeslice, rc=rc )</div>
<div class="line"><a name="l07879"></a><span class="lineno"> 7879</span>&#160;    <span class="keywordflow">if</span> (esmf_logfounderror(rc, passthru)) <span class="keywordflow">return</span></div>
<div class="line"><a name="l07880"></a><span class="lineno"> 7880</span>&#160;    <span class="keyword">call </span>esmf_fieldwrite( fldwy, &amp;</div>
<div class="line"><a name="l07881"></a><span class="lineno"> 7881</span>&#160;         <span class="stringliteral">&quot;wmesmfmd_read_wy0.nc&quot;</span>, &amp;</div>
<div class="line"><a name="l07882"></a><span class="lineno"> 7882</span>&#160;         overwrite=.true., timeslice=timeslice, rc=rc )</div>
<div class="line"><a name="l07883"></a><span class="lineno"> 7883</span>&#160;    <span class="keywordflow">if</span> (esmf_logfounderror(rc, passthru)) <span class="keywordflow">return</span></div>
<div class="line"><a name="l07884"></a><span class="lineno"> 7884</span>&#160;    timeslice = timeslice + 1</div>
<div class="line"><a name="l07885"></a><span class="lineno"> 7885</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l07886"></a><span class="lineno"> 7886</span>&#160;<span class="preprocessor"></span>    <span class="comment">!/</span></div>
<div class="line"><a name="l07887"></a><span class="lineno"> 7887</span>&#160;    <span class="comment">!/ End of ReadFromFile ------------------------------------------- /</span></div>
<div class="line"><a name="l07888"></a><span class="lineno"> 7888</span>&#160;    <span class="comment">!/</span></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="w3gdatmd_8F90_source.html#l01094">w3gdatmd::gtype</a>, <a class="el" href="w3fldsmd_8F90_source.html#l00958">w3fldsmd::w3fldg()</a>, <a class="el" href="w3fldsmd_8F90_source.html#l00090">w3fldsmd::w3fldo()</a>, <a class="el" href="wmunitmd_8F90_source.html#l00667">wmunitmd::wmuget()</a>, and <a class="el" href="wmunitmd_8F90_source.html#l00497">wmunitmd::wmuset()</a>.</p>

</div>
</div>
<a id="afbf45ae6cb571a7f5a847b1fe12742a3"></a>
<h2 class="memtitle"><span class="permalink"><a href="#afbf45ae6cb571a7f5a847b1fe12742a3">&#9670;&nbsp;</a></span>setexport()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">subroutine wmesmfmd::setexport </td>
          <td>(</td>
          <td class="paramtype">type(esmf_gridcomp)&#160;</td>
          <td class="paramname"><em>gcomp</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">integer, intent(out)&#160;</td>
          <td class="paramname"><em>rc</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Set export fields from internal data structures. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir"></td><td class="paramname">gcomp</td><td>Gridded component </td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">rc</td><td>Return code</td></tr>
  </table>
  </dd>
</dl>
<dl class="section author"><dt>Author</dt><dd>T. J. Campbell </dd></dl>
<dl class="section date"><dt>Date</dt><dd>09-Aug-2017 </dd></dl>

<p class="definition">Definition at line <a class="el" href="wmesmfmd_8F90_source.html#l02821">2821</a> of file <a class="el" href="wmesmfmd_8F90_source.html">wmesmfmd.F90</a>.</p>
<div class="fragment"><div class="line"><a name="l02821"></a><span class="lineno"> 2821</span>&#160;    <span class="comment">!/</span></div>
<div class="line"><a name="l02822"></a><span class="lineno"> 2822</span>&#160;    <span class="comment">!/                  +-----------------------------------+</span></div>
<div class="line"><a name="l02823"></a><span class="lineno"> 2823</span>&#160;    <span class="comment">!/                  | WAVEWATCH III           NOAA/NCEP |</span></div>
<div class="line"><a name="l02824"></a><span class="lineno"> 2824</span>&#160;    <span class="comment">!/                  |        T. J. Campbell, NRL        |</span></div>
<div class="line"><a name="l02825"></a><span class="lineno"> 2825</span>&#160;    <span class="comment">!/                  |                        FORTRAN 90 |</span></div>
<div class="line"><a name="l02826"></a><span class="lineno"> 2826</span>&#160;    <span class="comment">!/                  | Last update :         09-Aug-2017 |</span></div>
<div class="line"><a name="l02827"></a><span class="lineno"> 2827</span>&#160;    <span class="comment">!/                  +-----------------------------------+</span></div>
<div class="line"><a name="l02828"></a><span class="lineno"> 2828</span>&#160;    <span class="comment">!/</span></div>
<div class="line"><a name="l02829"></a><span class="lineno"> 2829</span>&#160;    <span class="comment">!/    20-Jan-2017 : Origination.                        ( version 6.02 )</span></div>
<div class="line"><a name="l02830"></a><span class="lineno"> 2830</span>&#160;    <span class="comment">!/    09-Aug-2017 : Add ocean forcing export fields     ( version 6.03 )</span></div>
<div class="line"><a name="l02831"></a><span class="lineno"> 2831</span>&#160;    <span class="comment">!/</span></div>
<div class="line"><a name="l02832"></a><span class="lineno"> 2832</span>&#160;    <span class="comment">!  1. Purpose :</span></div>
<div class="line"><a name="l02833"></a><span class="lineno"> 2833</span>&#160;    <span class="comment">!</span></div>
<div class="line"><a name="l02834"></a><span class="lineno"> 2834</span>&#160;    <span class="comment">!     Set export fields from internal data structures</span></div>
<div class="line"><a name="l02835"></a><span class="lineno"> 2835</span>&#160;    <span class="comment">!</span></div>
<div class="line"><a name="l02836"></a><span class="lineno"> 2836</span>&#160;    <span class="comment">!  2. Method :</span></div>
<div class="line"><a name="l02837"></a><span class="lineno"> 2837</span>&#160;    <span class="comment">!</span></div>
<div class="line"><a name="l02838"></a><span class="lineno"> 2838</span>&#160;    <span class="comment">!  3. Parameters :</span></div>
<div class="line"><a name="l02839"></a><span class="lineno"> 2839</span>&#160;    <span class="comment">!</span></div>
<div class="line"><a name="l02840"></a><span class="lineno"> 2840</span>&#160;    <span class="comment">!     Parameter list</span></div>
<div class="line"><a name="l02841"></a><span class="lineno"> 2841</span>&#160;    <span class="comment">!     ----------------------------------------------------------------</span></div>
<div class="line"><a name="l02842"></a><span class="lineno"> 2842</span>&#160;    <span class="comment">!       gcomp     Type   I/O Gridded component</span></div>
<div class="line"><a name="l02843"></a><span class="lineno"> 2843</span>&#160;    <span class="comment">!       rc        Int.   O   Return code</span></div>
<div class="line"><a name="l02844"></a><span class="lineno"> 2844</span>&#160;    <span class="comment">!     ----------------------------------------------------------------</span></div>
<div class="line"><a name="l02845"></a><span class="lineno"> 2845</span>&#160;    <span class="comment">!</span></div>
<div class="line"><a name="l02846"></a><span class="lineno"> 2846</span>&#160;    <span class="comment">!  4. Subroutines used :</span></div>
<div class="line"><a name="l02847"></a><span class="lineno"> 2847</span>&#160;    <span class="comment">!</span></div>
<div class="line"><a name="l02848"></a><span class="lineno"> 2848</span>&#160;    <span class="comment">!      Name      Type  Module   Description</span></div>
<div class="line"><a name="l02849"></a><span class="lineno"> 2849</span>&#160;    <span class="comment">!     ----------------------------------------------------------------</span></div>
<div class="line"><a name="l02850"></a><span class="lineno"> 2850</span>&#160;    <span class="comment">!      NONE</span></div>
<div class="line"><a name="l02851"></a><span class="lineno"> 2851</span>&#160;    <span class="comment">!     ----------------------------------------------------------------</span></div>
<div class="line"><a name="l02852"></a><span class="lineno"> 2852</span>&#160;    <span class="comment">!</span></div>
<div class="line"><a name="l02853"></a><span class="lineno"> 2853</span>&#160;    <span class="comment">!  5. Called by :</span></div>
<div class="line"><a name="l02854"></a><span class="lineno"> 2854</span>&#160;    <span class="comment">!</span></div>
<div class="line"><a name="l02855"></a><span class="lineno"> 2855</span>&#160;    <span class="comment">!  6. Error messages :</span></div>
<div class="line"><a name="l02856"></a><span class="lineno"> 2856</span>&#160;    <span class="comment">!</span></div>
<div class="line"><a name="l02857"></a><span class="lineno"> 2857</span>&#160;    <span class="comment">!  7. Remarks :</span></div>
<div class="line"><a name="l02858"></a><span class="lineno"> 2858</span>&#160;    <span class="comment">!</span></div>
<div class="line"><a name="l02859"></a><span class="lineno"> 2859</span>&#160;    <span class="comment">!  8. Structure :</span></div>
<div class="line"><a name="l02860"></a><span class="lineno"> 2860</span>&#160;    <span class="comment">!</span></div>
<div class="line"><a name="l02861"></a><span class="lineno"> 2861</span>&#160;    <span class="comment">!  9. Switches :</span></div>
<div class="line"><a name="l02862"></a><span class="lineno"> 2862</span>&#160;    <span class="comment">!</span></div>
<div class="line"><a name="l02863"></a><span class="lineno"> 2863</span>&#160;    <span class="comment">! 10. Source code :</span></div>
<div class="line"><a name="l02864"></a><span class="lineno"> 2864</span>&#160;    <span class="comment">!</span></div>
<div class="line"><a name="l02865"></a><span class="lineno"> 2865</span>&#160;    <span class="comment">!/ ------------------------------------------------------------------- /</span></div>
<div class="line"><a name="l02866"></a><span class="lineno"> 2866</span>&#160;    <span class="comment">!/</span></div>
<div class="line"><a name="l02867"></a><span class="lineno"> 2867</span>&#160;    <span class="comment">!/ ------------------------------------------------------------------- /</span></div>
<div class="line"><a name="l02868"></a><span class="lineno"> 2868</span>&#160;    <span class="comment">!/ Parameter list</span></div>
<div class="line"><a name="l02869"></a><span class="lineno"> 2869</span>&#160;    <span class="comment">!/</span></div>
<div class="line"><a name="l02870"></a><span class="lineno"> 2870</span>&#160;    <span class="keywordtype">implicit none</span></div>
<div class="line"><a name="l02871"></a><span class="lineno"> 2871</span>&#160;    <span class="keywordtype">type</span>(ESMF_GridComp) :: gcomp</div>
<div class="line"><a name="l02872"></a><span class="lineno"> 2872</span>&#160;    <span class="keywordtype">integer</span>,<span class="keywordtype">intent(out)</span> :: rc</div>
<div class="line"><a name="l02873"></a><span class="lineno"> 2873</span>&#160;    <span class="comment">!/</span></div>
<div class="line"><a name="l02874"></a><span class="lineno"> 2874</span>&#160;    <span class="comment">!/ ------------------------------------------------------------------- /</span></div>
<div class="line"><a name="l02875"></a><span class="lineno"> 2875</span>&#160;    <span class="comment">!/ Local parameters</span></div>
<div class="line"><a name="l02876"></a><span class="lineno"> 2876</span>&#160;    <span class="comment">!/</span></div>
<div class="line"><a name="l02877"></a><span class="lineno"> 2877</span>&#160;    <span class="keywordtype">character(ESMF_MAXSTR)</span> :: cname</div>
<div class="line"><a name="l02878"></a><span class="lineno"> 2878</span>&#160;    <span class="keywordtype">integer</span>, <span class="keywordtype">parameter</span> :: iwt=8</div>
<div class="line"><a name="l02879"></a><span class="lineno"> 2879</span>&#160;<span class="keywordtype">    real</span>(8) :: wstime, wftime</div>
<div class="line"><a name="l02880"></a><span class="lineno"> 2880</span>&#160;    <span class="keywordtype">integer</span> :: i1, i2, i3, i4, i5, i6</div>
<div class="line"><a name="l02881"></a><span class="lineno"> 2881</span>&#160;    <span class="keywordtype">logical</span> :: flpart = .false., floutg = .false., floutg2 = .true.</div>
<div class="line"><a name="l02882"></a><span class="lineno"> 2882</span>&#160;<span class="preprocessor">#if defined(TEST_WMESMFMD) || defined(TEST_WMESMFMD_SETEXPORT)</span></div>
<div class="line"><a name="l02883"></a><span class="lineno"> 2883</span>&#160;<span class="preprocessor"></span>    <span class="keywordtype">type</span>(ESMF_State) :: dumpState</div>
<div class="line"><a name="l02884"></a><span class="lineno"> 2884</span>&#160;    <span class="keywordtype">integer</span>, <span class="keywordtype">save</span> :: timeSlice = 1</div>
<div class="line"><a name="l02885"></a><span class="lineno"> 2885</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l02886"></a><span class="lineno"> 2886</span>&#160;<span class="preprocessor"></span><span class="keywordtype">    real</span>(ESMF_KIND_R8), <span class="keywordtype">pointer</span> :: farrayptr(:,:)</div>
<div class="line"><a name="l02887"></a><span class="lineno"> 2887</span>&#160;    <span class="comment">!</span></div>
<div class="line"><a name="l02888"></a><span class="lineno"> 2888</span>&#160;    <span class="comment">! -------------------------------------------------------------------- /</span></div>
<div class="line"><a name="l02889"></a><span class="lineno"> 2889</span>&#160;    <span class="comment">! Prep</span></div>
<div class="line"><a name="l02890"></a><span class="lineno"> 2890</span>&#160;    <span class="comment">!</span></div>
<div class="line"><a name="l02891"></a><span class="lineno"> 2891</span>&#160;    rc = esmf_success</div>
<div class="line"><a name="l02892"></a><span class="lineno"> 2892</span>&#160;    <span class="keywordflow">if</span> ( noactiveexpfields ) <span class="keywordflow">return</span></div>
<div class="line"><a name="l02893"></a><span class="lineno"> 2893</span>&#160;    <span class="keyword">call </span>esmf_vmwtime(wstime)</div>
<div class="line"><a name="l02894"></a><span class="lineno"> 2894</span>&#160;    <span class="keyword">call </span>esmf_gridcompget(gcomp, name=cname, rc=rc)</div>
<div class="line"><a name="l02895"></a><span class="lineno"> 2895</span>&#160;    <span class="keywordflow">if</span> (esmf_logfounderror(rc, passthru)) <span class="keywordflow">return</span></div>
<div class="line"><a name="l02896"></a><span class="lineno"> 2896</span>&#160;    <span class="keywordflow">if</span> (verbosity.gt.0) <span class="keyword">call </span>esmf_logwrite(trim(cname)// &amp;</div>
<div class="line"><a name="l02897"></a><span class="lineno"> 2897</span>&#160;         <span class="stringliteral">&#39;: entered SetExport&#39;</span>, esmf_logmsg_info)</div>
<div class="line"><a name="l02898"></a><span class="lineno"> 2898</span>&#160;    <span class="comment">!</span></div>
<div class="line"><a name="l02899"></a><span class="lineno"> 2899</span>&#160;    <span class="comment">! -------------------------------------------------------------------- /</span></div>
<div class="line"><a name="l02900"></a><span class="lineno"> 2900</span>&#160;    <span class="comment">! Setup</span></div>
<div class="line"><a name="l02901"></a><span class="lineno"> 2901</span>&#160;    <span class="comment">!</span></div>
<div class="line"><a name="l02902"></a><span class="lineno"> 2902</span>&#160;    <span class="keyword">call </span>w3setg ( expgridid, mdse, mdst )</div>
<div class="line"><a name="l02903"></a><span class="lineno"> 2903</span>&#160;    <span class="keyword">call </span><a class="code" href="namespacew3wdatmd.html#ac0bd6dc2f0effae7dce2f111cde16802">w3setw</a> ( expgridid, mdse, mdst )</div>
<div class="line"><a name="l02904"></a><span class="lineno"> 2904</span>&#160;    <span class="keyword">call </span><a class="code" href="namespacew3adatmd.html#ab2c0f2e6e7524fb061d841ba7a7324a1">w3seta</a> ( expgridid, mdse, mdst )</div>
<div class="line"><a name="l02905"></a><span class="lineno"> 2905</span>&#160;    <span class="keyword">call </span><a class="code" href="namespacew3idatmd.html#a0d197238708114cc861c919bb7b0f04f">w3seti</a> ( expgridid, mdse, mdst )</div>
<div class="line"><a name="l02906"></a><span class="lineno"> 2906</span>&#160;    <span class="keyword">call </span>w3seto ( expgridid, mdse, mdst )</div>
<div class="line"><a name="l02907"></a><span class="lineno"> 2907</span>&#160;    <span class="keyword">call </span>wmsetm ( expgridid, mdse, mdst )</div>
<div class="line"><a name="l02908"></a><span class="lineno"> 2908</span>&#160;<span class="preprocessor">#ifdef USE_W3OUTG_FOR_EXPORT</span></div>
<div class="line"><a name="l02909"></a><span class="lineno"> 2909</span>&#160;<span class="preprocessor"></span>    <span class="keywordflow">if</span> ( natgridislocal ) <span class="keyword">call </span><a class="code" href="namespacew3iogomd.html#a29d80cc57aa6c280d775fbea9750990c">w3outg</a>( <a class="code" href="namespacew3wdatmd.html#a26efd8bf935279cb1bc2b2dfd68f39b1">va</a>, flpart, floutg, floutg2 )</div>
<div class="line"><a name="l02910"></a><span class="lineno"> 2910</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l02911"></a><span class="lineno"> 2911</span>&#160;<span class="preprocessor"></span>    <span class="comment">!</span></div>
<div class="line"><a name="l02912"></a><span class="lineno"> 2912</span>&#160;    <span class="comment">! -------------------------------------------------------------------- /</span></div>
<div class="line"><a name="l02913"></a><span class="lineno"> 2913</span>&#160;    <span class="comment">! Charnock</span></div>
<div class="line"><a name="l02914"></a><span class="lineno"> 2914</span>&#160;    <span class="comment">!</span></div>
<div class="line"><a name="l02915"></a><span class="lineno"> 2915</span>&#160;    i1 = fieldindex( expfieldname, <span class="stringliteral">&#39;charno&#39;</span>, rc )</div>
<div class="line"><a name="l02916"></a><span class="lineno"> 2916</span>&#160;    <span class="keywordflow">if</span> (esmf_logfounderror(rc, passthru)) <span class="keywordflow">return</span></div>
<div class="line"><a name="l02917"></a><span class="lineno"> 2917</span>&#160;    <span class="keywordflow">if</span> ( expfieldactive(i1) ) <span class="keywordflow">then</span></div>
<div class="line"><a name="l02918"></a><span class="lineno"> 2918</span>&#160;      <span class="keyword">call </span>calccharnk( expfield(i1), rc )</div>
<div class="line"><a name="l02919"></a><span class="lineno"> 2919</span>&#160;      <span class="keywordflow">if</span> (esmf_logfounderror(rc, passthru)) <span class="keywordflow">return</span></div>
<div class="line"><a name="l02920"></a><span class="lineno"> 2920</span>&#160;<span class="keywordflow">    endif</span></div>
<div class="line"><a name="l02921"></a><span class="lineno"> 2921</span>&#160;    <span class="comment">!</span></div>
<div class="line"><a name="l02922"></a><span class="lineno"> 2922</span>&#160;    <span class="comment">! -------------------------------------------------------------------- /</span></div>
<div class="line"><a name="l02923"></a><span class="lineno"> 2923</span>&#160;    <span class="comment">! Surface Roughness</span></div>
<div class="line"><a name="l02924"></a><span class="lineno"> 2924</span>&#160;    <span class="comment">!</span></div>
<div class="line"><a name="l02925"></a><span class="lineno"> 2925</span>&#160;    i1 = fieldindex( expfieldname, <span class="stringliteral">&#39;z0rlen&#39;</span>, rc )</div>
<div class="line"><a name="l02926"></a><span class="lineno"> 2926</span>&#160;    <span class="keywordflow">if</span> (esmf_logfounderror(rc, passthru)) <span class="keywordflow">return</span></div>
<div class="line"><a name="l02927"></a><span class="lineno"> 2927</span>&#160;    <span class="keywordflow">if</span> ( expfieldactive(i1) ) <span class="keywordflow">then</span></div>
<div class="line"><a name="l02928"></a><span class="lineno"> 2928</span>&#160;      <span class="keyword">call </span>calcroughl( expfield(i1), rc )</div>
<div class="line"><a name="l02929"></a><span class="lineno"> 2929</span>&#160;      <span class="keywordflow">if</span> (esmf_logfounderror(rc, passthru)) <span class="keywordflow">return</span></div>
<div class="line"><a name="l02930"></a><span class="lineno"> 2930</span>&#160;<span class="keywordflow">    endif</span></div>
<div class="line"><a name="l02931"></a><span class="lineno"> 2931</span>&#160;    <span class="comment">!</span></div>
<div class="line"><a name="l02932"></a><span class="lineno"> 2932</span>&#160;    <span class="comment">! -------------------------------------------------------------------- /</span></div>
<div class="line"><a name="l02933"></a><span class="lineno"> 2933</span>&#160;    <span class="comment">! Stokes Drift 3D</span></div>
<div class="line"><a name="l02934"></a><span class="lineno"> 2934</span>&#160;    <span class="comment">!</span></div>
<div class="line"><a name="l02935"></a><span class="lineno"> 2935</span>&#160;    i1 = fieldindex( expfieldname, <span class="stringliteral">&#39;uscurr&#39;</span>, rc )</div>
<div class="line"><a name="l02936"></a><span class="lineno"> 2936</span>&#160;    <span class="keywordflow">if</span> (esmf_logfounderror(rc, passthru)) <span class="keywordflow">return</span></div>
<div class="line"><a name="l02937"></a><span class="lineno"> 2937</span>&#160;    i2 = fieldindex( expfieldname, <span class="stringliteral">&#39;vscurr&#39;</span>, rc )</div>
<div class="line"><a name="l02938"></a><span class="lineno"> 2938</span>&#160;    <span class="keywordflow">if</span> (esmf_logfounderror(rc, passthru)) <span class="keywordflow">return</span></div>
<div class="line"><a name="l02939"></a><span class="lineno"> 2939</span>&#160;    <span class="keywordflow">if</span> ( expfieldactive(i1) .and. &amp;</div>
<div class="line"><a name="l02940"></a><span class="lineno"> 2940</span>&#160;         expfieldactive(i2) ) <span class="keywordflow">then</span></div>
<div class="line"><a name="l02941"></a><span class="lineno"> 2941</span>&#160;      <span class="keyword">call </span>calcstokes3d( <a class="code" href="namespacew3wdatmd.html#a26efd8bf935279cb1bc2b2dfd68f39b1">va</a>, expfield(i1), expfield(i2), rc )</div>
<div class="line"><a name="l02942"></a><span class="lineno"> 2942</span>&#160;      <span class="keywordflow">if</span> (esmf_logfounderror(rc, passthru)) <span class="keywordflow">return</span></div>
<div class="line"><a name="l02943"></a><span class="lineno"> 2943</span>&#160;<span class="keywordflow">    endif</span></div>
<div class="line"><a name="l02944"></a><span class="lineno"> 2944</span>&#160;    <span class="comment">!</span></div>
<div class="line"><a name="l02945"></a><span class="lineno"> 2945</span>&#160;    <span class="comment">! -------------------------------------------------------------------- /</span></div>
<div class="line"><a name="l02946"></a><span class="lineno"> 2946</span>&#160;    <span class="comment">! Partitioned Stokes Drift 3 2D fields</span></div>
<div class="line"><a name="l02947"></a><span class="lineno"> 2947</span>&#160;    <span class="comment">!</span></div>
<div class="line"><a name="l02948"></a><span class="lineno"> 2948</span>&#160;    i1 = fieldindex( expfieldname, <span class="stringliteral">&#39;x1pstk&#39;</span>, rc )</div>
<div class="line"><a name="l02949"></a><span class="lineno"> 2949</span>&#160;    <span class="keywordflow">if</span> (esmf_logfounderror(rc, passthru)) <span class="keywordflow">return</span></div>
<div class="line"><a name="l02950"></a><span class="lineno"> 2950</span>&#160;    i2 = fieldindex( expfieldname, <span class="stringliteral">&#39;y1pstk&#39;</span>, rc )</div>
<div class="line"><a name="l02951"></a><span class="lineno"> 2951</span>&#160;    <span class="keywordflow">if</span> (esmf_logfounderror(rc, passthru)) <span class="keywordflow">return</span></div>
<div class="line"><a name="l02952"></a><span class="lineno"> 2952</span>&#160;    i3 = fieldindex( expfieldname, <span class="stringliteral">&#39;x2pstk&#39;</span>, rc )</div>
<div class="line"><a name="l02953"></a><span class="lineno"> 2953</span>&#160;    <span class="keywordflow">if</span> (esmf_logfounderror(rc, passthru)) <span class="keywordflow">return</span></div>
<div class="line"><a name="l02954"></a><span class="lineno"> 2954</span>&#160;    i4 = fieldindex( expfieldname, <span class="stringliteral">&#39;y2pstk&#39;</span>, rc )</div>
<div class="line"><a name="l02955"></a><span class="lineno"> 2955</span>&#160;    <span class="keywordflow">if</span> (esmf_logfounderror(rc, passthru)) <span class="keywordflow">return</span></div>
<div class="line"><a name="l02956"></a><span class="lineno"> 2956</span>&#160;    i5 = fieldindex( expfieldname, <span class="stringliteral">&#39;x3pstk&#39;</span>, rc )</div>
<div class="line"><a name="l02957"></a><span class="lineno"> 2957</span>&#160;    <span class="keywordflow">if</span> (esmf_logfounderror(rc, passthru)) <span class="keywordflow">return</span></div>
<div class="line"><a name="l02958"></a><span class="lineno"> 2958</span>&#160;    i6 = fieldindex( expfieldname, <span class="stringliteral">&#39;y3pstk&#39;</span>, rc )</div>
<div class="line"><a name="l02959"></a><span class="lineno"> 2959</span>&#160;    <span class="keywordflow">if</span> (esmf_logfounderror(rc, passthru)) <span class="keywordflow">return</span></div>
<div class="line"><a name="l02960"></a><span class="lineno"> 2960</span>&#160;    <span class="keywordflow">if</span> ( expfieldactive(i1) .and. &amp;</div>
<div class="line"><a name="l02961"></a><span class="lineno"> 2961</span>&#160;         expfieldactive(i2) .and. &amp;</div>
<div class="line"><a name="l02962"></a><span class="lineno"> 2962</span>&#160;         expfieldactive(i3) .and. &amp;</div>
<div class="line"><a name="l02963"></a><span class="lineno"> 2963</span>&#160;         expfieldactive(i4) .and. &amp;</div>
<div class="line"><a name="l02964"></a><span class="lineno"> 2964</span>&#160;         expfieldactive(i5) .and. &amp;</div>
<div class="line"><a name="l02965"></a><span class="lineno"> 2965</span>&#160;         expfieldactive(i6)  ) <span class="keywordflow">then</span></div>
<div class="line"><a name="l02966"></a><span class="lineno"> 2966</span>&#160;      <span class="keyword">call </span>calcpstokes( <a class="code" href="namespacew3wdatmd.html#a26efd8bf935279cb1bc2b2dfd68f39b1">va</a>, expfield(i1), expfield(i2), expfield(i3), &amp;</div>
<div class="line"><a name="l02967"></a><span class="lineno"> 2967</span>&#160;           expfield(i4), expfield(i5), expfield(i6), rc )</div>
<div class="line"><a name="l02968"></a><span class="lineno"> 2968</span>&#160;      <span class="keywordflow">if</span> (esmf_logfounderror(rc, passthru)) <span class="keywordflow">return</span></div>
<div class="line"><a name="l02969"></a><span class="lineno"> 2969</span>&#160;<span class="keywordflow">    endif</span></div>
<div class="line"><a name="l02970"></a><span class="lineno"> 2970</span>&#160;    <span class="comment">!</span></div>
<div class="line"><a name="l02971"></a><span class="lineno"> 2971</span>&#160;    <span class="comment">! -------------------------------------------------------------------- /</span></div>
<div class="line"><a name="l02972"></a><span class="lineno"> 2972</span>&#160;    <span class="comment">! Bottom Currents</span></div>
<div class="line"><a name="l02973"></a><span class="lineno"> 2973</span>&#160;    <span class="comment">!</span></div>
<div class="line"><a name="l02974"></a><span class="lineno"> 2974</span>&#160;    i1 = fieldindex( expfieldname, <span class="stringliteral">&#39;wbcuru&#39;</span>, rc )</div>
<div class="line"><a name="l02975"></a><span class="lineno"> 2975</span>&#160;    <span class="keywordflow">if</span> (esmf_logfounderror(rc, passthru)) <span class="keywordflow">return</span></div>
<div class="line"><a name="l02976"></a><span class="lineno"> 2976</span>&#160;    i2 = fieldindex( expfieldname, <span class="stringliteral">&#39;wbcurv&#39;</span>, rc )</div>
<div class="line"><a name="l02977"></a><span class="lineno"> 2977</span>&#160;    <span class="keywordflow">if</span> (esmf_logfounderror(rc, passthru)) <span class="keywordflow">return</span></div>
<div class="line"><a name="l02978"></a><span class="lineno"> 2978</span>&#160;    i3 = fieldindex( expfieldname, <span class="stringliteral">&#39;wbcurp&#39;</span>, rc )</div>
<div class="line"><a name="l02979"></a><span class="lineno"> 2979</span>&#160;    <span class="keywordflow">if</span> (esmf_logfounderror(rc, passthru)) <span class="keywordflow">return</span></div>
<div class="line"><a name="l02980"></a><span class="lineno"> 2980</span>&#160;    <span class="keywordflow">if</span> ( expfieldactive(i1) .and. &amp;</div>
<div class="line"><a name="l02981"></a><span class="lineno"> 2981</span>&#160;         expfieldactive(i2) .and. &amp;</div>
<div class="line"><a name="l02982"></a><span class="lineno"> 2982</span>&#160;         expfieldactive(i3) ) <span class="keywordflow">then</span></div>
<div class="line"><a name="l02983"></a><span class="lineno"> 2983</span>&#160;      <span class="keyword">call </span>calcbotcur( <a class="code" href="namespacew3wdatmd.html#a26efd8bf935279cb1bc2b2dfd68f39b1">va</a>, expfield(i1), expfield(i2), expfield(i3), rc )</div>
<div class="line"><a name="l02984"></a><span class="lineno"> 2984</span>&#160;      <span class="keywordflow">if</span> (esmf_logfounderror(rc, passthru)) <span class="keywordflow">return</span></div>
<div class="line"><a name="l02985"></a><span class="lineno"> 2985</span>&#160;<span class="keywordflow">    endif</span></div>
<div class="line"><a name="l02986"></a><span class="lineno"> 2986</span>&#160;    <span class="comment">!</span></div>
<div class="line"><a name="l02987"></a><span class="lineno"> 2987</span>&#160;    <span class="comment">! -------------------------------------------------------------------- /</span></div>
<div class="line"><a name="l02988"></a><span class="lineno"> 2988</span>&#160;    <span class="comment">! Radiation stresses 2D</span></div>
<div class="line"><a name="l02989"></a><span class="lineno"> 2989</span>&#160;    <span class="comment">!</span></div>
<div class="line"><a name="l02990"></a><span class="lineno"> 2990</span>&#160;    i1 = fieldindex( expfieldname, <span class="stringliteral">&#39;wavsuu&#39;</span>, rc )</div>
<div class="line"><a name="l02991"></a><span class="lineno"> 2991</span>&#160;    <span class="keywordflow">if</span> (esmf_logfounderror(rc, passthru)) <span class="keywordflow">return</span></div>
<div class="line"><a name="l02992"></a><span class="lineno"> 2992</span>&#160;    i2 = fieldindex( expfieldname, <span class="stringliteral">&#39;wavsuv&#39;</span>, rc )</div>
<div class="line"><a name="l02993"></a><span class="lineno"> 2993</span>&#160;    <span class="keywordflow">if</span> (esmf_logfounderror(rc, passthru)) <span class="keywordflow">return</span></div>
<div class="line"><a name="l02994"></a><span class="lineno"> 2994</span>&#160;    i3 = fieldindex( expfieldname, <span class="stringliteral">&#39;wavsvv&#39;</span>, rc )</div>
<div class="line"><a name="l02995"></a><span class="lineno"> 2995</span>&#160;    <span class="keywordflow">if</span> (esmf_logfounderror(rc, passthru)) <span class="keywordflow">return</span></div>
<div class="line"><a name="l02996"></a><span class="lineno"> 2996</span>&#160;    <span class="keywordflow">if</span> ( expfieldactive(i1) .and. &amp;</div>
<div class="line"><a name="l02997"></a><span class="lineno"> 2997</span>&#160;         expfieldactive(i2) .and. &amp;</div>
<div class="line"><a name="l02998"></a><span class="lineno"> 2998</span>&#160;         expfieldactive(i3) ) <span class="keywordflow">then</span></div>
<div class="line"><a name="l02999"></a><span class="lineno"> 2999</span>&#160;      <span class="keyword">call </span>calcradstr2d( <a class="code" href="namespacew3wdatmd.html#a26efd8bf935279cb1bc2b2dfd68f39b1">va</a>, expfield(i1), expfield(i2), expfield(i3), rc )</div>
<div class="line"><a name="l03000"></a><span class="lineno"> 3000</span>&#160;      <span class="keywordflow">if</span> (esmf_logfounderror(rc, passthru)) <span class="keywordflow">return</span></div>
<div class="line"><a name="l03001"></a><span class="lineno"> 3001</span>&#160;<span class="keywordflow">    endif</span></div>
<div class="line"><a name="l03002"></a><span class="lineno"> 3002</span>&#160;    <span class="comment">!</span></div>
<div class="line"><a name="l03003"></a><span class="lineno"> 3003</span>&#160;    <span class="comment">! -------------------------------------------------------------------- /</span></div>
<div class="line"><a name="l03004"></a><span class="lineno"> 3004</span>&#160;    <span class="comment">! cpl_scalars - grid sizes</span></div>
<div class="line"><a name="l03005"></a><span class="lineno"> 3005</span>&#160;    <span class="comment">!</span></div>
<div class="line"><a name="l03006"></a><span class="lineno"> 3006</span>&#160;    <span class="keywordflow">if</span> (med_present) <span class="keywordflow">then</span></div>
<div class="line"><a name="l03007"></a><span class="lineno"> 3007</span>&#160;      i1 = fieldindex( expfieldname, trim(flds_scalar_name), rc=rc )</div>
<div class="line"><a name="l03008"></a><span class="lineno"> 3008</span>&#160;      <span class="keywordflow">if</span> (esmf_logfounderror(rc, passthru)) <span class="keywordflow">return</span></div>
<div class="line"><a name="l03009"></a><span class="lineno"> 3009</span>&#160;      <span class="keywordflow">if</span> ( expfieldactive(i1) ) <span class="keywordflow">then</span></div>
<div class="line"><a name="l03010"></a><span class="lineno"> 3010</span>&#160;        <span class="keyword">call </span>esmf_fieldget(expfield(i1), farrayptr=farrayptr, rc=rc)</div>
<div class="line"><a name="l03011"></a><span class="lineno"> 3011</span>&#160;        <span class="keywordflow">if</span> (esmf_logfounderror(rc, passthru)) <span class="keywordflow">return</span></div>
<div class="line"><a name="l03012"></a><span class="lineno"> 3012</span>&#160;        <span class="keywordflow">if</span> (flds_scalar_index_nx &gt; 0 .and. flds_scalar_index_nx &lt; flds_scalar_num) <span class="keywordflow">then</span></div>
<div class="line"><a name="l03013"></a><span class="lineno"> 3013</span>&#160;          farrayptr(flds_scalar_index_nx,1) = dble(nx)</div>
<div class="line"><a name="l03014"></a><span class="lineno"> 3014</span>&#160;<span class="keywordflow">        endif</span></div>
<div class="line"><a name="l03015"></a><span class="lineno"> 3015</span>&#160;        <span class="keywordflow">if</span> (flds_scalar_index_ny &gt; 0 .and. flds_scalar_index_ny &lt; flds_scalar_num) <span class="keywordflow">then</span></div>
<div class="line"><a name="l03016"></a><span class="lineno"> 3016</span>&#160;          farrayptr(flds_scalar_index_ny,1) = dble(ny)</div>
<div class="line"><a name="l03017"></a><span class="lineno"> 3017</span>&#160;<span class="keywordflow">        endif</span></div>
<div class="line"><a name="l03018"></a><span class="lineno"> 3018</span>&#160;<span class="keywordflow">      endif</span></div>
<div class="line"><a name="l03019"></a><span class="lineno"> 3019</span>&#160;<span class="keywordflow">    endif</span></div>
<div class="line"><a name="l03020"></a><span class="lineno"> 3020</span>&#160;    <span class="comment">!</span></div>
<div class="line"><a name="l03021"></a><span class="lineno"> 3021</span>&#160;    <span class="comment">! -------------------------------------------------------------------- /</span></div>
<div class="line"><a name="l03022"></a><span class="lineno"> 3022</span>&#160;    <span class="comment">! Post</span></div>
<div class="line"><a name="l03023"></a><span class="lineno"> 3023</span>&#160;    <span class="comment">!</span></div>
<div class="line"><a name="l03024"></a><span class="lineno"> 3024</span>&#160;<span class="preprocessor">#if defined(TEST_WMESMFMD) || defined(TEST_WMESMFMD_SETEXPORT)</span></div>
<div class="line"><a name="l03025"></a><span class="lineno"> 3025</span>&#160;<span class="preprocessor"></span>    <span class="keyword">call </span>nuopc_modelget(gcomp, exportstate=dumpstate, rc=rc)</div>
<div class="line"><a name="l03026"></a><span class="lineno"> 3026</span>&#160;    <span class="keywordflow">if</span> (esmf_logfounderror(rc, passthru)) <span class="keywordflow">return</span></div>
<div class="line"><a name="l03027"></a><span class="lineno"> 3027</span>&#160;    <span class="keyword">call </span>nuopc_write(dumpstate, overwrite=.true., &amp;</div>
<div class="line"><a name="l03028"></a><span class="lineno"> 3028</span>&#160;         filenameprefix=<span class="stringliteral">&quot;field_&quot;</span>//trim(cname)//<span class="stringliteral">&quot;_export_&quot;</span>, &amp;</div>
<div class="line"><a name="l03029"></a><span class="lineno"> 3029</span>&#160;         timeslice=timeslice, relaxedflag=.true., rc=rc)</div>
<div class="line"><a name="l03030"></a><span class="lineno"> 3030</span>&#160;    <span class="keywordflow">if</span> (esmf_logfounderror(rc, passthru)) <span class="keywordflow">return</span></div>
<div class="line"><a name="l03031"></a><span class="lineno"> 3031</span>&#160;    timeslice = timeslice + 1</div>
<div class="line"><a name="l03032"></a><span class="lineno"> 3032</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l03033"></a><span class="lineno"> 3033</span>&#160;<span class="preprocessor"></span>    rc = esmf_success</div>
<div class="line"><a name="l03034"></a><span class="lineno"> 3034</span>&#160;    <span class="keyword">call </span>esmf_vmwtime(wftime)</div>
<div class="line"><a name="l03035"></a><span class="lineno"> 3035</span>&#160;    wtime(iwt) = wtime(iwt) + wftime - wstime</div>
<div class="line"><a name="l03036"></a><span class="lineno"> 3036</span>&#160;    wtcnt(iwt) = wtcnt(iwt) + 1</div>
<div class="line"><a name="l03037"></a><span class="lineno"> 3037</span>&#160;    <span class="keywordflow">if</span> (verbosity.gt.0) <span class="keyword">call </span>esmf_logwrite(trim(cname)// &amp;</div>
<div class="line"><a name="l03038"></a><span class="lineno"> 3038</span>&#160;         <span class="stringliteral">&#39;: leaving SetExport&#39;</span>, esmf_logmsg_info)</div>
<div class="line"><a name="l03039"></a><span class="lineno"> 3039</span>&#160;    <span class="comment">!/</span></div>
<div class="line"><a name="l03040"></a><span class="lineno"> 3040</span>&#160;    <span class="comment">!/ End of SetExport -------------------------------------------------- /</span></div>
<div class="line"><a name="l03041"></a><span class="lineno"> 3041</span>&#160;    <span class="comment">!/</span></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="CMakeLists_8txt_source.html#l00003">file()</a>, <a class="el" href="constants_8F90_source.html#l00101">constants::lpdlib</a>, <a class="el" href="w3odatmd_8F90_source.html#l00457">w3odatmd::naproc</a>, <a class="el" href="wmmdatmd_8F90_source.html#l00321">wmmdatmd::nmproc</a>, <a class="el" href="w3gdatmd_8F90_source.html#l01109">w3gdatmd::ntri</a>, <a class="el" href="w3gdatmd_8F90_source.html#l01097">w3gdatmd::nx</a>, <a class="el" href="w3gdatmd_8F90_source.html#l01097">w3gdatmd::ny</a>, and <a class="el" href="w3gdatmd_8F90_source.html#l01111">w3gdatmd::trigp</a>.</p>

</div>
</div>
<a id="a7518f8f78d77552ecc8860b09fc117dc"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a7518f8f78d77552ecc8860b09fc117dc">&#9670;&nbsp;</a></span>setservices()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">subroutine, public wmesmfmd::setservices </td>
          <td>(</td>
          <td class="paramtype">type(esmf_gridcomp)&#160;</td>
          <td class="paramname"><em>gcomp</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">integer, intent(out)&#160;</td>
          <td class="paramname"><em>rc</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Wave model ESMF set services. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir"></td><td class="paramname">gcomp</td><td>Gridded component. </td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">rc</td><td>Return code.</td></tr>
  </table>
  </dd>
</dl>
<dl class="section author"><dt>Author</dt><dd>T. J. Campbell </dd></dl>
<dl class="section date"><dt>Date</dt><dd>20-Jan-2017 </dd></dl>

<p class="definition">Definition at line <a class="el" href="wmesmfmd_8F90_source.html#l00352">352</a> of file <a class="el" href="wmesmfmd_8F90_source.html">wmesmfmd.F90</a>.</p>
<div class="fragment"><div class="line"><a name="l00352"></a><span class="lineno">  352</span>&#160;    <span class="comment">!/</span></div>
<div class="line"><a name="l00353"></a><span class="lineno">  353</span>&#160;    <span class="comment">!/                  +-----------------------------------+</span></div>
<div class="line"><a name="l00354"></a><span class="lineno">  354</span>&#160;    <span class="comment">!/                  | WAVEWATCH III           NOAA/NCEP |</span></div>
<div class="line"><a name="l00355"></a><span class="lineno">  355</span>&#160;    <span class="comment">!/                  |        T. J. Campbell, NRL        |</span></div>
<div class="line"><a name="l00356"></a><span class="lineno">  356</span>&#160;    <span class="comment">!/                  |                        FORTRAN 90 |</span></div>
<div class="line"><a name="l00357"></a><span class="lineno">  357</span>&#160;    <span class="comment">!/                  | Last update :         20-Jan-2017 |</span></div>
<div class="line"><a name="l00358"></a><span class="lineno">  358</span>&#160;    <span class="comment">!/                  +-----------------------------------+</span></div>
<div class="line"><a name="l00359"></a><span class="lineno">  359</span>&#160;    <span class="comment">!/</span></div>
<div class="line"><a name="l00360"></a><span class="lineno">  360</span>&#160;    <span class="comment">!/    20-Jan-2017 : Origination.                        ( version 6.02 )</span></div>
<div class="line"><a name="l00361"></a><span class="lineno">  361</span>&#160;    <span class="comment">!/</span></div>
<div class="line"><a name="l00362"></a><span class="lineno">  362</span>&#160;    <span class="comment">!  1. Purpose :</span></div>
<div class="line"><a name="l00363"></a><span class="lineno">  363</span>&#160;    <span class="comment">!</span></div>
<div class="line"><a name="l00364"></a><span class="lineno">  364</span>&#160;    <span class="comment">!     Wave model ESMF set services.</span></div>
<div class="line"><a name="l00365"></a><span class="lineno">  365</span>&#160;    <span class="comment">!</span></div>
<div class="line"><a name="l00366"></a><span class="lineno">  366</span>&#160;    <span class="comment">!  2. Method :</span></div>
<div class="line"><a name="l00367"></a><span class="lineno">  367</span>&#160;    <span class="comment">!</span></div>
<div class="line"><a name="l00368"></a><span class="lineno">  368</span>&#160;    <span class="comment">!  3. Parameters :</span></div>
<div class="line"><a name="l00369"></a><span class="lineno">  369</span>&#160;    <span class="comment">!</span></div>
<div class="line"><a name="l00370"></a><span class="lineno">  370</span>&#160;    <span class="comment">!     Parameter list</span></div>
<div class="line"><a name="l00371"></a><span class="lineno">  371</span>&#160;    <span class="comment">!     ----------------------------------------------------------------</span></div>
<div class="line"><a name="l00372"></a><span class="lineno">  372</span>&#160;    <span class="comment">!       gcomp   Type   I/O Gridded component</span></div>
<div class="line"><a name="l00373"></a><span class="lineno">  373</span>&#160;    <span class="comment">!       rc      Int.   O   Return code</span></div>
<div class="line"><a name="l00374"></a><span class="lineno">  374</span>&#160;    <span class="comment">!     ----------------------------------------------------------------</span></div>
<div class="line"><a name="l00375"></a><span class="lineno">  375</span>&#160;    <span class="comment">!</span></div>
<div class="line"><a name="l00376"></a><span class="lineno">  376</span>&#160;    <span class="comment">!  4. Subroutines used :</span></div>
<div class="line"><a name="l00377"></a><span class="lineno">  377</span>&#160;    <span class="comment">!</span></div>
<div class="line"><a name="l00378"></a><span class="lineno">  378</span>&#160;    <span class="comment">!      Name            Type   Module    Description</span></div>
<div class="line"><a name="l00379"></a><span class="lineno">  379</span>&#160;    <span class="comment">!     ----------------------------------------------------------------</span></div>
<div class="line"><a name="l00380"></a><span class="lineno">  380</span>&#160;    <span class="comment">!      InitializeP0    Subr.  WMESMFMD  Wave model NUOPC/ESMF Initialize phase 0</span></div>
<div class="line"><a name="l00381"></a><span class="lineno">  381</span>&#160;    <span class="comment">!      InitializeP1    Subr.  WMESMFMD  Wave model NUOPC/ESMF Initialize phase 1</span></div>
<div class="line"><a name="l00382"></a><span class="lineno">  382</span>&#160;    <span class="comment">!      InitializeP3    Subr.  WMESMFMD  Wave model NUOPC/ESMF Initialize phase 3</span></div>
<div class="line"><a name="l00383"></a><span class="lineno">  383</span>&#160;    <span class="comment">!      Finalize        Subr.  WMESMFMD  Wave model NUOPC/ESMF Finalize</span></div>
<div class="line"><a name="l00384"></a><span class="lineno">  384</span>&#160;    <span class="comment">!      DataInitialize  Subr.  WMESMFMD  Wave model NUOPC/ESMF Data Initialize</span></div>
<div class="line"><a name="l00385"></a><span class="lineno">  385</span>&#160;    <span class="comment">!      ModelAdvance    Subr.  WMESMFMD  Wave model NUOPC/ESMF Model Advance</span></div>
<div class="line"><a name="l00386"></a><span class="lineno">  386</span>&#160;    <span class="comment">!     ----------------------------------------------------------------</span></div>
<div class="line"><a name="l00387"></a><span class="lineno">  387</span>&#160;    <span class="comment">!</span></div>
<div class="line"><a name="l00388"></a><span class="lineno">  388</span>&#160;    <span class="comment">!  5. Called by :</span></div>
<div class="line"><a name="l00389"></a><span class="lineno">  389</span>&#160;    <span class="comment">!</span></div>
<div class="line"><a name="l00390"></a><span class="lineno">  390</span>&#160;    <span class="comment">!  6. Error messages :</span></div>
<div class="line"><a name="l00391"></a><span class="lineno">  391</span>&#160;    <span class="comment">!</span></div>
<div class="line"><a name="l00392"></a><span class="lineno">  392</span>&#160;    <span class="comment">!  7. Remarks :</span></div>
<div class="line"><a name="l00393"></a><span class="lineno">  393</span>&#160;    <span class="comment">!</span></div>
<div class="line"><a name="l00394"></a><span class="lineno">  394</span>&#160;    <span class="comment">!  8. Structure :</span></div>
<div class="line"><a name="l00395"></a><span class="lineno">  395</span>&#160;    <span class="comment">!</span></div>
<div class="line"><a name="l00396"></a><span class="lineno">  396</span>&#160;    <span class="comment">!  9. Switches :</span></div>
<div class="line"><a name="l00397"></a><span class="lineno">  397</span>&#160;    <span class="comment">!</span></div>
<div class="line"><a name="l00398"></a><span class="lineno">  398</span>&#160;    <span class="comment">! 10. Source code :</span></div>
<div class="line"><a name="l00399"></a><span class="lineno">  399</span>&#160;    <span class="comment">!</span></div>
<div class="line"><a name="l00400"></a><span class="lineno">  400</span>&#160;    <span class="comment">!/ ------------------------------------------------------------------- /</span></div>
<div class="line"><a name="l00401"></a><span class="lineno">  401</span>&#160;    <span class="comment">!/</span></div>
<div class="line"><a name="l00402"></a><span class="lineno">  402</span>&#160;    <span class="comment">!/ ------------------------------------------------------------------- /</span></div>
<div class="line"><a name="l00403"></a><span class="lineno">  403</span>&#160;    <span class="comment">!/ Parameter list</span></div>
<div class="line"><a name="l00404"></a><span class="lineno">  404</span>&#160;    <span class="comment">!/</span></div>
<div class="line"><a name="l00405"></a><span class="lineno">  405</span>&#160;    <span class="keywordtype">implicit none</span></div>
<div class="line"><a name="l00406"></a><span class="lineno">  406</span>&#160;    <span class="keywordtype">type</span>(ESMF_GridComp) :: gcomp</div>
<div class="line"><a name="l00407"></a><span class="lineno">  407</span>&#160;    <span class="keywordtype">integer</span>,<span class="keywordtype">intent(out)</span> :: rc</div>
<div class="line"><a name="l00408"></a><span class="lineno">  408</span>&#160;    <span class="comment">!/</span></div>
<div class="line"><a name="l00409"></a><span class="lineno">  409</span>&#160;    <span class="comment">!/ ------------------------------------------------------------------- /</span></div>
<div class="line"><a name="l00410"></a><span class="lineno">  410</span>&#160;    <span class="comment">!/ Local parameters</span></div>
<div class="line"><a name="l00411"></a><span class="lineno">  411</span>&#160;    <span class="comment">!/</span></div>
<div class="line"><a name="l00412"></a><span class="lineno">  412</span>&#160;    <span class="comment">!NONE</span></div>
<div class="line"><a name="l00413"></a><span class="lineno">  413</span>&#160;    <span class="comment">!</span></div>
<div class="line"><a name="l00414"></a><span class="lineno">  414</span>&#160;    <span class="comment">! -------------------------------------------------------------------- /</span></div>
<div class="line"><a name="l00415"></a><span class="lineno">  415</span>&#160;    <span class="comment">! Prep</span></div>
<div class="line"><a name="l00416"></a><span class="lineno">  416</span>&#160;    <span class="comment">!</span></div>
<div class="line"><a name="l00417"></a><span class="lineno">  417</span>&#160;    rc = esmf_success</div>
<div class="line"><a name="l00418"></a><span class="lineno">  418</span>&#160; </div>
<div class="line"><a name="l00419"></a><span class="lineno">  419</span>&#160;    <span class="comment">! --- Initialize wallclock timers</span></div>
<div class="line"><a name="l00420"></a><span class="lineno">  420</span>&#160; </div>
<div class="line"><a name="l00421"></a><span class="lineno">  421</span>&#160;    wtnam( 1) = <span class="stringliteral">&#39;InitializeP0&#39;</span></div>
<div class="line"><a name="l00422"></a><span class="lineno">  422</span>&#160;    wtnam( 2) = <span class="stringliteral">&#39;InitializeP1&#39;</span></div>
<div class="line"><a name="l00423"></a><span class="lineno">  423</span>&#160;    wtnam( 3) = <span class="stringliteral">&#39;InitializeP3&#39;</span></div>
<div class="line"><a name="l00424"></a><span class="lineno">  424</span>&#160;    wtnam( 4) = <span class="stringliteral">&#39;DataInitialize&#39;</span></div>
<div class="line"><a name="l00425"></a><span class="lineno">  425</span>&#160;    wtnam( 5) = <span class="stringliteral">&#39;ModelAdvance&#39;</span></div>
<div class="line"><a name="l00426"></a><span class="lineno">  426</span>&#160;    wtnam( 6) = <span class="stringliteral">&#39;Finalize&#39;</span></div>
<div class="line"><a name="l00427"></a><span class="lineno">  427</span>&#160;    wtnam( 7) = <span class="stringliteral">&#39;GetImport&#39;</span></div>
<div class="line"><a name="l00428"></a><span class="lineno">  428</span>&#160;    wtnam( 8) = <span class="stringliteral">&#39;SetExport&#39;</span></div>
<div class="line"><a name="l00429"></a><span class="lineno">  429</span>&#160;    wtnam( 9) = <span class="stringliteral">&#39;FieldGather&#39;</span></div>
<div class="line"><a name="l00430"></a><span class="lineno">  430</span>&#160;    wtnam(10) = <span class="stringliteral">&#39;FieldFill&#39;</span></div>
<div class="line"><a name="l00431"></a><span class="lineno">  431</span>&#160;    wtcnt( :) = 0</div>
<div class="line"><a name="l00432"></a><span class="lineno">  432</span>&#160;    wtime( :) = 0d0</div>
<div class="line"><a name="l00433"></a><span class="lineno">  433</span>&#160;    <span class="comment">!</span></div>
<div class="line"><a name="l00434"></a><span class="lineno">  434</span>&#160;    <span class="comment">! -------------------------------------------------------------------- /</span></div>
<div class="line"><a name="l00435"></a><span class="lineno">  435</span>&#160;    <span class="comment">! 1.  NUOPC model component will register the generic methods</span></div>
<div class="line"><a name="l00436"></a><span class="lineno">  436</span>&#160;    <span class="comment">!</span></div>
<div class="line"><a name="l00437"></a><span class="lineno">  437</span>&#160;    <span class="keyword">call </span>nuopc_compderive(gcomp, parent_setservices, rc=rc)</div>
<div class="line"><a name="l00438"></a><span class="lineno">  438</span>&#160;    <span class="keywordflow">if</span> (esmf_logfounderror(rc, passthru)) <span class="keywordflow">return</span></div>
<div class="line"><a name="l00439"></a><span class="lineno">  439</span>&#160;    <span class="comment">!</span></div>
<div class="line"><a name="l00440"></a><span class="lineno">  440</span>&#160;    <span class="comment">! -------------------------------------------------------------------- /</span></div>
<div class="line"><a name="l00441"></a><span class="lineno">  441</span>&#160;    <span class="comment">! 2.  Set model entry points</span></div>
<div class="line"><a name="l00442"></a><span class="lineno">  442</span>&#160;    <span class="comment">!</span></div>
<div class="line"><a name="l00443"></a><span class="lineno">  443</span>&#160;    <span class="comment">! --- Initialize - phase 0 (requires use of ESMF method)</span></div>
<div class="line"><a name="l00444"></a><span class="lineno">  444</span>&#160; </div>
<div class="line"><a name="l00445"></a><span class="lineno">  445</span>&#160;    <span class="keyword">call </span>esmf_gridcompsetentrypoint(gcomp, esmf_method_initialize, &amp;</div>
<div class="line"><a name="l00446"></a><span class="lineno">  446</span>&#160;         userroutine=initializep0, phase=0, rc=rc)</div>
<div class="line"><a name="l00447"></a><span class="lineno">  447</span>&#160;    <span class="keywordflow">if</span> (esmf_logfounderror(rc, passthru)) <span class="keywordflow">return</span></div>
<div class="line"><a name="l00448"></a><span class="lineno">  448</span>&#160; </div>
<div class="line"><a name="l00449"></a><span class="lineno">  449</span>&#160;    <span class="comment">! --- Set entry points for initialize methods</span></div>
<div class="line"><a name="l00450"></a><span class="lineno">  450</span>&#160; </div>
<div class="line"><a name="l00451"></a><span class="lineno">  451</span>&#160;    <span class="comment">! &gt;= IPDv03 supports satisfying inter-model data dependencies and</span></div>
<div class="line"><a name="l00452"></a><span class="lineno">  452</span>&#160;    <span class="comment">! the transfer of ESMF Grid &amp; Mesh objects between Model and/or</span></div>
<div class="line"><a name="l00453"></a><span class="lineno">  453</span>&#160;    <span class="comment">! Mediator components during initialization</span></div>
<div class="line"><a name="l00454"></a><span class="lineno">  454</span>&#160;    <span class="comment">! IPDv03p1: advertise import &amp; export fields</span></div>
<div class="line"><a name="l00455"></a><span class="lineno">  455</span>&#160;    <span class="keyword">call </span>nuopc_compsetentrypoint(gcomp, esmf_method_initialize, &amp;</div>
<div class="line"><a name="l00456"></a><span class="lineno">  456</span>&#160;         phaselabellist=(/<span class="stringliteral">&quot;IPDv03p1&quot;</span>/), userroutine=initializep1, rc=rc)</div>
<div class="line"><a name="l00457"></a><span class="lineno">  457</span>&#160;    <span class="keywordflow">if</span> (esmf_logfounderror(rc, passthru)) <span class="keywordflow">return</span></div>
<div class="line"><a name="l00458"></a><span class="lineno">  458</span>&#160;    <span class="comment">! IPDv03p2: unspecified by NUOPC -- not required</span></div>
<div class="line"><a name="l00459"></a><span class="lineno">  459</span>&#160;    <span class="comment">! IPDv03p3: realize import &amp; export fields</span></div>
<div class="line"><a name="l00460"></a><span class="lineno">  460</span>&#160;    <span class="keyword">call </span>nuopc_compsetentrypoint(gcomp, esmf_method_initialize, &amp;</div>
<div class="line"><a name="l00461"></a><span class="lineno">  461</span>&#160;         phaselabellist=(/<span class="stringliteral">&quot;IPDv03p3&quot;</span>/), userroutine=initializep3, rc=rc)</div>
<div class="line"><a name="l00462"></a><span class="lineno">  462</span>&#160;    <span class="keywordflow">if</span> (esmf_logfounderror(rc, passthru)) <span class="keywordflow">return</span></div>
<div class="line"><a name="l00463"></a><span class="lineno">  463</span>&#160;    <span class="comment">! IPDv03p4: relevant for TransferActionGeomObject==&quot;accept&quot;</span></div>
<div class="line"><a name="l00464"></a><span class="lineno">  464</span>&#160;    <span class="comment">! IPDv03p5: relevant for TransferActionGeomObject==&quot;accept&quot;</span></div>
<div class="line"><a name="l00465"></a><span class="lineno">  465</span>&#160;    <span class="comment">! IPDv03p6: check compatibility of fields connected status</span></div>
<div class="line"><a name="l00466"></a><span class="lineno">  466</span>&#160;    <span class="comment">! IPDv03p7: handle field data initialization</span></div>
<div class="line"><a name="l00467"></a><span class="lineno">  467</span>&#160; </div>
<div class="line"><a name="l00468"></a><span class="lineno">  468</span>&#160;    <span class="comment">!</span></div>
<div class="line"><a name="l00469"></a><span class="lineno">  469</span>&#160;    <span class="comment">! -------------------------------------------------------------------- /</span></div>
<div class="line"><a name="l00470"></a><span class="lineno">  470</span>&#160;    <span class="comment">! 3.  Register specializing methods</span></div>
<div class="line"><a name="l00471"></a><span class="lineno">  471</span>&#160;    <span class="comment">!</span></div>
<div class="line"><a name="l00472"></a><span class="lineno">  472</span>&#160;    <span class="comment">! --- Model initialize export data method</span></div>
<div class="line"><a name="l00473"></a><span class="lineno">  473</span>&#160; </div>
<div class="line"><a name="l00474"></a><span class="lineno">  474</span>&#160;    <span class="keyword">call </span>nuopc_compspecialize(gcomp, speclabel=label_datainitialize, &amp;</div>
<div class="line"><a name="l00475"></a><span class="lineno">  475</span>&#160;         specroutine=datainitialize, rc=rc)</div>
<div class="line"><a name="l00476"></a><span class="lineno">  476</span>&#160;    <span class="keywordflow">if</span> (esmf_logfounderror(rc, passthru)) <span class="keywordflow">return</span></div>
<div class="line"><a name="l00477"></a><span class="lineno">  477</span>&#160; </div>
<div class="line"><a name="l00478"></a><span class="lineno">  478</span>&#160;    <span class="comment">! --- Model checkImport method (overriding default)</span></div>
<div class="line"><a name="l00479"></a><span class="lineno">  479</span>&#160; </div>
<div class="line"><a name="l00480"></a><span class="lineno">  480</span>&#160;    <span class="keyword">call </span>esmf_methodremove(gcomp, label_checkimport, rc=rc)</div>
<div class="line"><a name="l00481"></a><span class="lineno">  481</span>&#160;    <span class="keywordflow">if</span> (esmf_logfounderror(rc, passthru)) <span class="keywordflow">return</span></div>
<div class="line"><a name="l00482"></a><span class="lineno">  482</span>&#160;    <span class="keyword">call </span>nuopc_compspecialize(gcomp, speclabel=label_checkimport, &amp;</div>
<div class="line"><a name="l00483"></a><span class="lineno">  483</span>&#160;         specroutine=nuopc_noop, rc=rc)</div>
<div class="line"><a name="l00484"></a><span class="lineno">  484</span>&#160;    <span class="keywordflow">if</span> (esmf_logfounderror(rc, passthru)) <span class="keywordflow">return</span></div>
<div class="line"><a name="l00485"></a><span class="lineno">  485</span>&#160; </div>
<div class="line"><a name="l00486"></a><span class="lineno">  486</span>&#160;    <span class="comment">! --- Model advance method</span></div>
<div class="line"><a name="l00487"></a><span class="lineno">  487</span>&#160; </div>
<div class="line"><a name="l00488"></a><span class="lineno">  488</span>&#160;    <span class="keyword">call </span>nuopc_compspecialize(gcomp, speclabel=label_advance, &amp;</div>
<div class="line"><a name="l00489"></a><span class="lineno">  489</span>&#160;         specroutine=modeladvance, rc=rc)</div>
<div class="line"><a name="l00490"></a><span class="lineno">  490</span>&#160;    <span class="keywordflow">if</span> (esmf_logfounderror(rc, passthru)) <span class="keywordflow">return</span></div>
<div class="line"><a name="l00491"></a><span class="lineno">  491</span>&#160; </div>
<div class="line"><a name="l00492"></a><span class="lineno">  492</span>&#160;    <span class="comment">! --- Model finalize method</span></div>
<div class="line"><a name="l00493"></a><span class="lineno">  493</span>&#160; </div>
<div class="line"><a name="l00494"></a><span class="lineno">  494</span>&#160;    <span class="keyword">call </span>nuopc_compspecialize(gcomp, speclabel=label_finalize, &amp;</div>
<div class="line"><a name="l00495"></a><span class="lineno">  495</span>&#160;         specroutine=finalize, rc=rc)</div>
<div class="line"><a name="l00496"></a><span class="lineno">  496</span>&#160;    <span class="keywordflow">if</span> (esmf_logfounderror(rc, passthru)) <span class="keywordflow">return</span></div>
<div class="line"><a name="l00497"></a><span class="lineno">  497</span>&#160;    <span class="comment">!</span></div>
<div class="line"><a name="l00498"></a><span class="lineno">  498</span>&#160;    <span class="comment">! -------------------------------------------------------------------- /</span></div>
<div class="line"><a name="l00499"></a><span class="lineno">  499</span>&#160;    <span class="comment">! Post</span></div>
<div class="line"><a name="l00500"></a><span class="lineno">  500</span>&#160;    <span class="comment">!</span></div>
<div class="line"><a name="l00501"></a><span class="lineno">  501</span>&#160;    rc = esmf_success</div>
<div class="line"><a name="l00502"></a><span class="lineno">  502</span>&#160;    <span class="comment">!/</span></div>
<div class="line"><a name="l00503"></a><span class="lineno">  503</span>&#160;    <span class="comment">!/ End of SetServices ------------------------------------------------ /</span></div>
<div class="line"><a name="l00504"></a><span class="lineno">  504</span>&#160;    <span class="comment">!/</span></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="wmmdatmd_8F90_source.html#l00329">wmmdatmd::etime</a>, <a class="el" href="w3gdatmd_8F90_source.html#l01088">w3gdatmd::grids</a>, <a class="el" href="wmmdatmd_8F90_source.html#l00322">wmmdatmd::improc</a>, <a class="el" href="constants_8F90_source.html#l00109">constants::is_esmf_component</a>, <a class="el" href="wmmdatmd_8F90_source.html#l00321">wmmdatmd::nmproc</a>, <a class="el" href="wmmdatmd_8F90_source.html#l00324">wmmdatmd::nmpscr</a>, <a class="el" href="wmmdatmd_8F90_source.html#l00328">wmmdatmd::stime</a>, <a class="el" href="w3wdatmd_8F90_source.html#l00172">w3wdatmd::time</a>, <a class="el" href="w3adatmd_8F90_source.html#l00612">w3adatmd::us3d</a>, and <a class="el" href="w3iogomd_8F90_source.html#l01198">w3iogomd::w3outg()</a>.</p>

</div>
</div>
<a id="af66fcedda6573f5f88a3385e288b8864"></a>
<h2 class="memtitle"><span class="permalink"><a href="#af66fcedda6573f5f88a3385e288b8864">&#9670;&nbsp;</a></span>setupimpbmsk()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">subroutine wmesmfmd::setupimpbmsk </td>
          <td>(</td>
          <td class="paramtype">type(esmf_field)&#160;</td>
          <td class="paramname"><em>bmskField</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">type(esmf_field)&#160;</td>
          <td class="paramname"><em>impField</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real(esmf_kind_rx)&#160;</td>
          <td class="paramname"><em>missingVal</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">integer, optional&#160;</td>
          <td class="paramname"><em>rc</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Setup background blending mask field for an import field. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">bmskField</td><td>Blending mask field </td></tr>
    <tr><td class="paramname">impField</td><td>Import field </td></tr>
    <tr><td class="paramname">missingVal</td><td>Missing value </td></tr>
    <tr><td class="paramname">rc</td><td>Return code</td></tr>
  </table>
  </dd>
</dl>
<dl class="section author"><dt>Author</dt><dd>T. J. Campbell </dd></dl>
<dl class="section date"><dt>Date</dt><dd>09-Aug-2017 </dd></dl>

<p class="definition">Definition at line <a class="el" href="wmesmfmd_8F90_source.html#l05074">5074</a> of file <a class="el" href="wmesmfmd_8F90_source.html">wmesmfmd.F90</a>.</p>
<div class="fragment"><div class="line"><a name="l05074"></a><span class="lineno"> 5074</span>&#160;    <span class="comment">!/</span></div>
<div class="line"><a name="l05075"></a><span class="lineno"> 5075</span>&#160;    <span class="comment">!/                  +-----------------------------------+</span></div>
<div class="line"><a name="l05076"></a><span class="lineno"> 5076</span>&#160;    <span class="comment">!/                  | WAVEWATCH III           NOAA/NCEP |</span></div>
<div class="line"><a name="l05077"></a><span class="lineno"> 5077</span>&#160;    <span class="comment">!/                  |        T. J. Campbell, NRL        |</span></div>
<div class="line"><a name="l05078"></a><span class="lineno"> 5078</span>&#160;    <span class="comment">!/                  |                        FORTRAN 90 |</span></div>
<div class="line"><a name="l05079"></a><span class="lineno"> 5079</span>&#160;    <span class="comment">!/                  | Last update :         09-Aug-2017 |</span></div>
<div class="line"><a name="l05080"></a><span class="lineno"> 5080</span>&#160;    <span class="comment">!/                  +-----------------------------------+</span></div>
<div class="line"><a name="l05081"></a><span class="lineno"> 5081</span>&#160;    <span class="comment">!/</span></div>
<div class="line"><a name="l05082"></a><span class="lineno"> 5082</span>&#160;    <span class="comment">!/    09-Aug-2017 : Origination.                        ( version 6.03 )</span></div>
<div class="line"><a name="l05083"></a><span class="lineno"> 5083</span>&#160;    <span class="comment">!/</span></div>
<div class="line"><a name="l05084"></a><span class="lineno"> 5084</span>&#160;    <span class="comment">!  1. Purpose :</span></div>
<div class="line"><a name="l05085"></a><span class="lineno"> 5085</span>&#160;    <span class="comment">!</span></div>
<div class="line"><a name="l05086"></a><span class="lineno"> 5086</span>&#160;    <span class="comment">!     Setup background blending mask field for an import field</span></div>
<div class="line"><a name="l05087"></a><span class="lineno"> 5087</span>&#160;    <span class="comment">!</span></div>
<div class="line"><a name="l05088"></a><span class="lineno"> 5088</span>&#160;    <span class="comment">!  2. Method :</span></div>
<div class="line"><a name="l05089"></a><span class="lineno"> 5089</span>&#160;    <span class="comment">!</span></div>
<div class="line"><a name="l05090"></a><span class="lineno"> 5090</span>&#160;    <span class="comment">!  3. Parameters :</span></div>
<div class="line"><a name="l05091"></a><span class="lineno"> 5091</span>&#160;    <span class="comment">!</span></div>
<div class="line"><a name="l05092"></a><span class="lineno"> 5092</span>&#160;    <span class="comment">!     Parameter list</span></div>
<div class="line"><a name="l05093"></a><span class="lineno"> 5093</span>&#160;    <span class="comment">!     ----------------------------------------------------------------</span></div>
<div class="line"><a name="l05094"></a><span class="lineno"> 5094</span>&#160;    <span class="comment">!       bmskField  Type   I/O blending mask field</span></div>
<div class="line"><a name="l05095"></a><span class="lineno"> 5095</span>&#160;    <span class="comment">!       impField   Type   I   import field</span></div>
<div class="line"><a name="l05096"></a><span class="lineno"> 5096</span>&#160;    <span class="comment">!       missingVal Real   I   missing value</span></div>
<div class="line"><a name="l05097"></a><span class="lineno"> 5097</span>&#160;    <span class="comment">!       rc         Int    O   Return code</span></div>
<div class="line"><a name="l05098"></a><span class="lineno"> 5098</span>&#160;    <span class="comment">!     ----------------------------------------------------------------</span></div>
<div class="line"><a name="l05099"></a><span class="lineno"> 5099</span>&#160;    <span class="comment">!</span></div>
<div class="line"><a name="l05100"></a><span class="lineno"> 5100</span>&#160;    <span class="comment">!  4. Subroutines used :</span></div>
<div class="line"><a name="l05101"></a><span class="lineno"> 5101</span>&#160;    <span class="comment">!</span></div>
<div class="line"><a name="l05102"></a><span class="lineno"> 5102</span>&#160;    <span class="comment">!      Name      Type  Module   Description</span></div>
<div class="line"><a name="l05103"></a><span class="lineno"> 5103</span>&#160;    <span class="comment">!     ----------------------------------------------------------------</span></div>
<div class="line"><a name="l05104"></a><span class="lineno"> 5104</span>&#160;    <span class="comment">!      NONE</span></div>
<div class="line"><a name="l05105"></a><span class="lineno"> 5105</span>&#160;    <span class="comment">!     ----------------------------------------------------------------</span></div>
<div class="line"><a name="l05106"></a><span class="lineno"> 5106</span>&#160;    <span class="comment">!</span></div>
<div class="line"><a name="l05107"></a><span class="lineno"> 5107</span>&#160;    <span class="comment">!  5. Called by :</span></div>
<div class="line"><a name="l05108"></a><span class="lineno"> 5108</span>&#160;    <span class="comment">!</span></div>
<div class="line"><a name="l05109"></a><span class="lineno"> 5109</span>&#160;    <span class="comment">!  6. Error messages :</span></div>
<div class="line"><a name="l05110"></a><span class="lineno"> 5110</span>&#160;    <span class="comment">!</span></div>
<div class="line"><a name="l05111"></a><span class="lineno"> 5111</span>&#160;    <span class="comment">!  7. Remarks :</span></div>
<div class="line"><a name="l05112"></a><span class="lineno"> 5112</span>&#160;    <span class="comment">!</span></div>
<div class="line"><a name="l05113"></a><span class="lineno"> 5113</span>&#160;    <span class="comment">!  8. Structure :</span></div>
<div class="line"><a name="l05114"></a><span class="lineno"> 5114</span>&#160;    <span class="comment">!</span></div>
<div class="line"><a name="l05115"></a><span class="lineno"> 5115</span>&#160;    <span class="comment">!  9. Switches :</span></div>
<div class="line"><a name="l05116"></a><span class="lineno"> 5116</span>&#160;    <span class="comment">!</span></div>
<div class="line"><a name="l05117"></a><span class="lineno"> 5117</span>&#160;    <span class="comment">! 10. Source code :</span></div>
<div class="line"><a name="l05118"></a><span class="lineno"> 5118</span>&#160;    <span class="comment">!</span></div>
<div class="line"><a name="l05119"></a><span class="lineno"> 5119</span>&#160;    <span class="comment">!/ ------------------------------------------------------------------- /</span></div>
<div class="line"><a name="l05120"></a><span class="lineno"> 5120</span>&#160;    <span class="comment">!/</span></div>
<div class="line"><a name="l05121"></a><span class="lineno"> 5121</span>&#160;    <span class="comment">!/ ------------------------------------------------------------------- /</span></div>
<div class="line"><a name="l05122"></a><span class="lineno"> 5122</span>&#160;    <span class="comment">!/ Parameter list</span></div>
<div class="line"><a name="l05123"></a><span class="lineno"> 5123</span>&#160;    <span class="comment">!/</span></div>
<div class="line"><a name="l05124"></a><span class="lineno"> 5124</span>&#160;    <span class="keywordtype">implicit none</span></div>
<div class="line"><a name="l05125"></a><span class="lineno"> 5125</span>&#160;    <span class="keywordtype">type</span>(ESMF_Field)      :: bmskField</div>
<div class="line"><a name="l05126"></a><span class="lineno"> 5126</span>&#160;    <span class="keywordtype">type</span>(ESMF_Field)      :: impField</div>
<div class="line"><a name="l05127"></a><span class="lineno"> 5127</span>&#160;<span class="keywordtype">    real</span>(ESMF_KIND_RX)    :: missingVal</div>
<div class="line"><a name="l05128"></a><span class="lineno"> 5128</span>&#160;    <span class="keywordtype">integer</span>, <span class="keywordtype">optional</span>     :: rc</div>
<div class="line"><a name="l05129"></a><span class="lineno"> 5129</span>&#160;    <span class="comment">!/</span></div>
<div class="line"><a name="l05130"></a><span class="lineno"> 5130</span>&#160;    <span class="comment">!/ ------------------------------------------------------------------- /</span></div>
<div class="line"><a name="l05131"></a><span class="lineno"> 5131</span>&#160;    <span class="comment">!/ Local parameters</span></div>
<div class="line"><a name="l05132"></a><span class="lineno"> 5132</span>&#160;    <span class="comment">!/</span></div>
<div class="line"><a name="l05133"></a><span class="lineno"> 5133</span>&#160;<span class="keywordtype">    real</span>(ESMF_KIND_RX), <span class="keywordtype">parameter</span> :: zero = 0.0</div>
<div class="line"><a name="l05134"></a><span class="lineno"> 5134</span>&#160;<span class="keywordtype">    real</span>(ESMF_KIND_RX), <span class="keywordtype">parameter</span> :: half = 0.5</div>
<div class="line"><a name="l05135"></a><span class="lineno"> 5135</span>&#160;<span class="keywordtype">    real</span>(ESMF_KIND_RX), <span class="keywordtype">parameter</span> ::  one = 1.0</div>
<div class="line"><a name="l05136"></a><span class="lineno"> 5136</span>&#160;    <span class="keywordtype">integer</span>, <span class="keywordtype">parameter</span> :: nsig = imphalowidth-1</div>
<div class="line"><a name="l05137"></a><span class="lineno"> 5137</span>&#160;    <span class="keywordtype">integer</span>, <span class="keywordtype">parameter</span> :: niter = 10</div>
<div class="line"><a name="l05138"></a><span class="lineno"> 5138</span>&#160;    <span class="keywordtype">integer</span>, <span class="keywordtype">parameter</span> :: iter0 = 1-niter</div>
<div class="line"><a name="l05139"></a><span class="lineno"> 5139</span>&#160;    <span class="keywordtype">integer</span>, <span class="keywordtype">parameter</span> :: lde = 0</div>
<div class="line"><a name="l05140"></a><span class="lineno"> 5140</span>&#160;    <span class="keywordtype">integer</span> :: iter, i, j, ii, jj, k, l</div>
<div class="line"><a name="l05141"></a><span class="lineno"> 5141</span>&#160;    <span class="keywordtype">integer</span> :: elb(2), eub(2)</div>
<div class="line"><a name="l05142"></a><span class="lineno"> 5142</span>&#160;    <span class="keywordtype">integer</span> :: tlb(2), tub(2)</div>
<div class="line"><a name="l05143"></a><span class="lineno"> 5143</span>&#160;<span class="keywordtype">    real</span>(ESMF_KIND_RX), <span class="keywordtype">pointer</span> :: mptr(:,:), dptr(:,:)</div>
<div class="line"><a name="l05144"></a><span class="lineno"> 5144</span>&#160;    <span class="keywordtype">type</span>(ESMF_Field) :: cmskField</div>
<div class="line"><a name="l05145"></a><span class="lineno"> 5145</span>&#160;<span class="keywordtype">    real</span>(ESMF_KIND_RX), <span class="keywordtype">pointer</span> :: bmsk(:,:), cmsk(:,:)</div>
<div class="line"><a name="l05146"></a><span class="lineno"> 5146</span>&#160;<span class="keywordtype">    real</span>(ESMF_KIND_RX) :: bsum, wsum</div>
<div class="line"><a name="l05147"></a><span class="lineno"> 5147</span>&#160;<span class="keywordtype">    real</span>(ESMF_KIND_RX) :: wflt(-nsig:nsig,-nsig:nsig)</div>
<div class="line"><a name="l05148"></a><span class="lineno"> 5148</span>&#160;    <span class="keywordtype">character(ESMF_MAXSTR)</span> :: fnm</div>
<div class="line"><a name="l05149"></a><span class="lineno"> 5149</span>&#160;<span class="preprocessor">#if defined(TEST_WMESMFMD) || defined(TEST_WMESMFMD_SETUPIMPBMSK)</span></div>
<div class="line"><a name="l05150"></a><span class="lineno"> 5150</span>&#160;<span class="preprocessor"></span>    <span class="keywordtype">integer</span> :: timeSlice</div>
<div class="line"><a name="l05151"></a><span class="lineno"> 5151</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l05152"></a><span class="lineno"> 5152</span>&#160;<span class="preprocessor"></span>    <span class="comment">!</span></div>
<div class="line"><a name="l05153"></a><span class="lineno"> 5153</span>&#160;    <span class="comment">! -------------------------------------------------------------------- /</span></div>
<div class="line"><a name="l05154"></a><span class="lineno"> 5154</span>&#160;    <span class="comment">! Initialize filter</span></div>
<div class="line"><a name="l05155"></a><span class="lineno"> 5155</span>&#160;    <span class="comment">!</span></div>
<div class="line"><a name="l05156"></a><span class="lineno"> 5156</span>&#160;    <span class="keywordflow">if</span> (<span class="keyword">present</span>(rc)) rc = esmf_success</div>
<div class="line"><a name="l05157"></a><span class="lineno"> 5157</span>&#160; </div>
<div class="line"><a name="l05158"></a><span class="lineno"> 5158</span>&#160;    <span class="keywordflow">do</span> l = -nsig,nsig</div>
<div class="line"><a name="l05159"></a><span class="lineno"> 5159</span>&#160;      <span class="keywordflow">do</span> k = -nsig,nsig</div>
<div class="line"><a name="l05160"></a><span class="lineno"> 5160</span>&#160;        wflt(k,l) = exp( -<a class="code" href="namespacescrip__constants.html#a99a1a0f01091bf19bea3be8dfdd6147f">half</a>*( real(k,esmf_kind_rx)**2 &amp;</div>
<div class="line"><a name="l05161"></a><span class="lineno"> 5161</span>&#160;             + real(l,esmf_kind_rx)**2 ) )</div>
<div class="line"><a name="l05162"></a><span class="lineno"> 5162</span>&#160;<span class="keywordflow">      enddo</span></div>
<div class="line"><a name="l05163"></a><span class="lineno"> 5163</span>&#160;<span class="keywordflow">    enddo</span></div>
<div class="line"><a name="l05164"></a><span class="lineno"> 5164</span>&#160;    <span class="comment">!</span></div>
<div class="line"><a name="l05165"></a><span class="lineno"> 5165</span>&#160;    <span class="comment">! -------------------------------------------------------------------- /</span></div>
<div class="line"><a name="l05166"></a><span class="lineno"> 5166</span>&#160;    <span class="comment">! Set up fields and pointers</span></div>
<div class="line"><a name="l05167"></a><span class="lineno"> 5167</span>&#160;    <span class="comment">!</span></div>
<div class="line"><a name="l05168"></a><span class="lineno"> 5168</span>&#160;    <span class="keyword">call </span>esmf_fieldget( impfield, name=fnm, rc=rc )</div>
<div class="line"><a name="l05169"></a><span class="lineno"> 5169</span>&#160;    <span class="keywordflow">if</span> (esmf_logfounderror(rc, passthru)) <span class="keywordflow">return</span></div>
<div class="line"><a name="l05170"></a><span class="lineno"> 5170</span>&#160; </div>
<div class="line"><a name="l05171"></a><span class="lineno"> 5171</span>&#160;    cmskfield = esmf_fieldcreate( impgrid, imparrayspec2d, &amp;</div>
<div class="line"><a name="l05172"></a><span class="lineno"> 5172</span>&#160;         totallwidth=imphalolwidth, totaluwidth=imphalouwidth, &amp;</div>
<div class="line"><a name="l05173"></a><span class="lineno"> 5173</span>&#160;         staggerloc=impstaggerloc, indexflag=impindexflag, rc=rc )</div>
<div class="line"><a name="l05174"></a><span class="lineno"> 5174</span>&#160;    <span class="keywordflow">if</span> (esmf_logfounderror(rc, passthru)) <span class="keywordflow">return</span></div>
<div class="line"><a name="l05175"></a><span class="lineno"> 5175</span>&#160; </div>
<div class="line"><a name="l05176"></a><span class="lineno"> 5176</span>&#160;    <span class="keywordflow">if</span> ( impgridislocal ) <span class="keywordflow">then</span></div>
<div class="line"><a name="l05177"></a><span class="lineno"> 5177</span>&#160;      <span class="keyword">call </span>esmf_fieldget( impmask, localde=lde, farrayptr=mptr, &amp;</div>
<div class="line"><a name="l05178"></a><span class="lineno"> 5178</span>&#160;           exclusivelbound=elb, exclusiveubound=eub, &amp;</div>
<div class="line"><a name="l05179"></a><span class="lineno"> 5179</span>&#160;           totallbound=tlb, totalubound=tub, rc=rc )</div>
<div class="line"><a name="l05180"></a><span class="lineno"> 5180</span>&#160;      <span class="keywordflow">if</span> (esmf_logfounderror(rc, passthru)) <span class="keywordflow">return</span></div>
<div class="line"><a name="l05181"></a><span class="lineno"> 5181</span>&#160;      <span class="keyword">call </span>esmf_fieldget( impfield,  localde=lde, farrayptr=dptr, rc=rc )</div>
<div class="line"><a name="l05182"></a><span class="lineno"> 5182</span>&#160;      <span class="keywordflow">if</span> (esmf_logfounderror(rc, passthru)) <span class="keywordflow">return</span></div>
<div class="line"><a name="l05183"></a><span class="lineno"> 5183</span>&#160;      <span class="keyword">call </span>esmf_fieldget( bmskfield, localde=lde, farrayptr=bmsk, rc=rc )</div>
<div class="line"><a name="l05184"></a><span class="lineno"> 5184</span>&#160;      <span class="keywordflow">if</span> (esmf_logfounderror(rc, passthru)) <span class="keywordflow">return</span></div>
<div class="line"><a name="l05185"></a><span class="lineno"> 5185</span>&#160;      <span class="keyword">call </span>esmf_fieldget( cmskfield, localde=lde, farrayptr=cmsk, rc=rc )</div>
<div class="line"><a name="l05186"></a><span class="lineno"> 5186</span>&#160;      <span class="keywordflow">if</span> (esmf_logfounderror(rc, passthru)) <span class="keywordflow">return</span></div>
<div class="line"><a name="l05187"></a><span class="lineno"> 5187</span>&#160;<span class="keywordflow">    endif</span></div>
<div class="line"><a name="l05188"></a><span class="lineno"> 5188</span>&#160;    <span class="comment">!</span></div>
<div class="line"><a name="l05189"></a><span class="lineno"> 5189</span>&#160;    <span class="comment">! -------------------------------------------------------------------- /</span></div>
<div class="line"><a name="l05190"></a><span class="lineno"> 5190</span>&#160;    <span class="comment">! Create blending mask</span></div>
<div class="line"><a name="l05191"></a><span class="lineno"> 5191</span>&#160;    <span class="comment">!</span></div>
<div class="line"><a name="l05192"></a><span class="lineno"> 5192</span>&#160;    <span class="keywordflow">if</span> ( impgridislocal ) <span class="keywordflow">then</span></div>
<div class="line"><a name="l05193"></a><span class="lineno"> 5193</span>&#160;      <span class="keywordflow">do</span> j = elb(2),eub(2)</div>
<div class="line"><a name="l05194"></a><span class="lineno"> 5194</span>&#160;        <span class="keywordflow">do</span> i = elb(1),eub(1)</div>
<div class="line"><a name="l05195"></a><span class="lineno"> 5195</span>&#160;          <span class="keywordflow">if</span> ( nint(dptr(i,j)).eq.nint(missingval) ) <span class="keywordflow">then</span></div>
<div class="line"><a name="l05196"></a><span class="lineno"> 5196</span>&#160;            bmsk(i,j) = <a class="code" href="namespacescrip__constants.html#a8f7ef7b037191fbbeb9b568788a77405">zero</a></div>
<div class="line"><a name="l05197"></a><span class="lineno"> 5197</span>&#160;          <span class="keywordflow">else</span></div>
<div class="line"><a name="l05198"></a><span class="lineno"> 5198</span>&#160;            bmsk(i,j) = <a class="code" href="namespacescrip__constants.html#a766bef5f354460e4fdd00aefd1b85bc3">one</a></div>
<div class="line"><a name="l05199"></a><span class="lineno"> 5199</span>&#160;<span class="keywordflow">          endif</span></div>
<div class="line"><a name="l05200"></a><span class="lineno"> 5200</span>&#160;          cmsk(i,j) = bmsk(i,j)</div>
<div class="line"><a name="l05201"></a><span class="lineno"> 5201</span>&#160;<span class="keywordflow">        enddo</span></div>
<div class="line"><a name="l05202"></a><span class="lineno"> 5202</span>&#160;<span class="keywordflow">      enddo</span></div>
<div class="line"><a name="l05203"></a><span class="lineno"> 5203</span>&#160;<span class="keywordflow">    endif</span></div>
<div class="line"><a name="l05204"></a><span class="lineno"> 5204</span>&#160;<span class="preprocessor">#if defined(TEST_WMESMFMD) || defined(TEST_WMESMFMD_SETUPIMPBMSK)</span></div>
<div class="line"><a name="l05205"></a><span class="lineno"> 5205</span>&#160;<span class="preprocessor"></span>    timeslice = 1</div>
<div class="line"><a name="l05206"></a><span class="lineno"> 5206</span>&#160;    <span class="keyword">call </span>esmf_fieldwrite( bmskfield, &amp;</div>
<div class="line"><a name="l05207"></a><span class="lineno"> 5207</span>&#160;         <span class="stringliteral">&quot;wmesmfmd_setupimpbmsk_&quot;</span>//trim(fnm)//<span class="stringliteral">&quot;.nc&quot;</span>, &amp;</div>
<div class="line"><a name="l05208"></a><span class="lineno"> 5208</span>&#160;         overwrite=.true., timeslice=timeslice, rc=rc )</div>
<div class="line"><a name="l05209"></a><span class="lineno"> 5209</span>&#160;    <span class="keywordflow">if</span> (esmf_logfounderror(rc, passthru)) <span class="keywordflow">return</span></div>
<div class="line"><a name="l05210"></a><span class="lineno"> 5210</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l05211"></a><span class="lineno"> 5211</span>&#160;<span class="preprocessor"></span> </div>
<div class="line"><a name="l05212"></a><span class="lineno"> 5212</span>&#160;    iter_loop: <span class="keywordflow">do</span> <a class="code" href="namespacew3adatmd.html#a795c1e1aacb2a4f255bb3b646998e466">iter</a> = iter0,niter</div>
<div class="line"><a name="l05213"></a><span class="lineno"> 5213</span>&#160; </div>
<div class="line"><a name="l05214"></a><span class="lineno"> 5214</span>&#160;      <span class="keyword">call </span>esmf_fieldhalo( bmskfield, imphalorh, rc=rc )</div>
<div class="line"><a name="l05215"></a><span class="lineno"> 5215</span>&#160;      <span class="keywordflow">if</span> (esmf_logfounderror(rc, passthru)) <span class="keywordflow">return</span></div>
<div class="line"><a name="l05216"></a><span class="lineno"> 5216</span>&#160; </div>
<div class="line"><a name="l05217"></a><span class="lineno"> 5217</span>&#160;      <span class="keywordflow">if</span> ( impgridislocal ) <span class="keywordflow">then</span></div>
<div class="line"><a name="l05218"></a><span class="lineno"> 5218</span>&#160; </div>
<div class="line"><a name="l05219"></a><span class="lineno"> 5219</span>&#160;        j_loop: <span class="keywordflow">do</span> j = elb(2),eub(2)</div>
<div class="line"><a name="l05220"></a><span class="lineno"> 5220</span>&#160;          i_loop: <span class="keywordflow">do</span> i = elb(1),eub(1)</div>
<div class="line"><a name="l05221"></a><span class="lineno"> 5221</span>&#160;            <span class="keywordflow">if</span> ( nint(mptr(i,j)).eq.maskvalueland ) cycle i_loop</div>
<div class="line"><a name="l05222"></a><span class="lineno"> 5222</span>&#160;            <span class="keywordflow">if</span> ( nint(dptr(i,j)).eq.nint(missingval) ) cycle i_loop</div>
<div class="line"><a name="l05223"></a><span class="lineno"> 5223</span>&#160; </div>
<div class="line"><a name="l05224"></a><span class="lineno"> 5224</span>&#160;            <span class="keywordflow">if</span> (<a class="code" href="namespacew3adatmd.html#a795c1e1aacb2a4f255bb3b646998e466">iter</a>.le.0) <span class="keywordflow">then</span></div>
<div class="line"><a name="l05225"></a><span class="lineno"> 5225</span>&#160; </div>
<div class="line"><a name="l05226"></a><span class="lineno"> 5226</span>&#160;              <span class="comment">! initialize blending zone to zero</span></div>
<div class="line"><a name="l05227"></a><span class="lineno"> 5227</span>&#160;              l_loop0: <span class="keywordflow">do</span> l = -1,1</div>
<div class="line"><a name="l05228"></a><span class="lineno"> 5228</span>&#160;                jj = j + l</div>
<div class="line"><a name="l05229"></a><span class="lineno"> 5229</span>&#160;                <span class="keywordflow">if</span> ( jj.lt.tlb(2).or.jj.gt.tub(2) ) cycle l_loop0</div>
<div class="line"><a name="l05230"></a><span class="lineno"> 5230</span>&#160;                k_loop0: <span class="keywordflow">do</span> k = -1,1</div>
<div class="line"><a name="l05231"></a><span class="lineno"> 5231</span>&#160;                  ii = i + k</div>
<div class="line"><a name="l05232"></a><span class="lineno"> 5232</span>&#160;                  <span class="keywordflow">if</span> ( ii.lt.tlb(1).or.ii.gt.tub(1) ) cycle k_loop0</div>
<div class="line"><a name="l05233"></a><span class="lineno"> 5233</span>&#160;                  <span class="keywordflow">if</span> ( nint(mptr(ii,jj)).eq.maskvalueland ) cycle k_loop0</div>
<div class="line"><a name="l05234"></a><span class="lineno"> 5234</span>&#160;                  <span class="keywordflow">if</span> ( bmsk(ii,jj).eq.<a class="code" href="namespacescrip__constants.html#a8f7ef7b037191fbbeb9b568788a77405">zero</a> ) cmsk(i,j) = <a class="code" href="namespacescrip__constants.html#a8f7ef7b037191fbbeb9b568788a77405">zero</a></div>
<div class="line"><a name="l05235"></a><span class="lineno"> 5235</span>&#160;<span class="keywordflow">                enddo</span> k_loop0</div>
<div class="line"><a name="l05236"></a><span class="lineno"> 5236</span>&#160;<span class="keywordflow">              enddo</span> l_loop0</div>
<div class="line"><a name="l05237"></a><span class="lineno"> 5237</span>&#160; </div>
<div class="line"><a name="l05238"></a><span class="lineno"> 5238</span>&#160;            <span class="keywordflow">else</span></div>
<div class="line"><a name="l05239"></a><span class="lineno"> 5239</span>&#160; </div>
<div class="line"><a name="l05240"></a><span class="lineno"> 5240</span>&#160;              <span class="comment">! iterate filter over blending zone</span></div>
<div class="line"><a name="l05241"></a><span class="lineno"> 5241</span>&#160;              bsum = <a class="code" href="namespacescrip__constants.html#a8f7ef7b037191fbbeb9b568788a77405">zero</a></div>
<div class="line"><a name="l05242"></a><span class="lineno"> 5242</span>&#160;              wsum = <a class="code" href="namespacescrip__constants.html#a8f7ef7b037191fbbeb9b568788a77405">zero</a></div>
<div class="line"><a name="l05243"></a><span class="lineno"> 5243</span>&#160;              l_loop: <span class="keywordflow">do</span> l = -nsig,nsig</div>
<div class="line"><a name="l05244"></a><span class="lineno"> 5244</span>&#160;                jj = j + l</div>
<div class="line"><a name="l05245"></a><span class="lineno"> 5245</span>&#160;                <span class="keywordflow">if</span> ( jj.lt.tlb(2).or.jj.gt.tub(2) ) cycle l_loop</div>
<div class="line"><a name="l05246"></a><span class="lineno"> 5246</span>&#160;                k_loop: <span class="keywordflow">do</span> k = -nsig,nsig</div>
<div class="line"><a name="l05247"></a><span class="lineno"> 5247</span>&#160;                  ii = i + k</div>
<div class="line"><a name="l05248"></a><span class="lineno"> 5248</span>&#160;                  <span class="keywordflow">if</span> ( ii.lt.tlb(1).or.ii.gt.tub(1) ) cycle k_loop</div>
<div class="line"><a name="l05249"></a><span class="lineno"> 5249</span>&#160;                  <span class="keywordflow">if</span> ( nint(mptr(ii,jj)).eq.maskvalueland ) cycle k_loop</div>
<div class="line"><a name="l05250"></a><span class="lineno"> 5250</span>&#160;                  bsum = bsum + wflt(k,l)*bmsk(ii,jj)</div>
<div class="line"><a name="l05251"></a><span class="lineno"> 5251</span>&#160;                  wsum = wsum + wflt(k,l)</div>
<div class="line"><a name="l05252"></a><span class="lineno"> 5252</span>&#160;<span class="keywordflow">                enddo</span> k_loop</div>
<div class="line"><a name="l05253"></a><span class="lineno"> 5253</span>&#160;<span class="keywordflow">              enddo</span> l_loop</div>
<div class="line"><a name="l05254"></a><span class="lineno"> 5254</span>&#160;              <span class="keywordflow">if</span> ( wsum.gt.<a class="code" href="namespacescrip__constants.html#a8f7ef7b037191fbbeb9b568788a77405">zero</a> ) cmsk(i,j) = bsum/wsum</div>
<div class="line"><a name="l05255"></a><span class="lineno"> 5255</span>&#160; </div>
<div class="line"><a name="l05256"></a><span class="lineno"> 5256</span>&#160;<span class="keywordflow">            endif</span></div>
<div class="line"><a name="l05257"></a><span class="lineno"> 5257</span>&#160; </div>
<div class="line"><a name="l05258"></a><span class="lineno"> 5258</span>&#160;<span class="keywordflow">          enddo</span> i_loop</div>
<div class="line"><a name="l05259"></a><span class="lineno"> 5259</span>&#160;<span class="keywordflow">        enddo</span> j_loop</div>
<div class="line"><a name="l05260"></a><span class="lineno"> 5260</span>&#160; </div>
<div class="line"><a name="l05261"></a><span class="lineno"> 5261</span>&#160;        <span class="keywordflow">do</span> j = elb(2),eub(2)</div>
<div class="line"><a name="l05262"></a><span class="lineno"> 5262</span>&#160;          <span class="keywordflow">do</span> i = elb(1),eub(1)</div>
<div class="line"><a name="l05263"></a><span class="lineno"> 5263</span>&#160;            <span class="keywordflow">if</span> ( nint(mptr(i,j)).eq.maskvalueland ) cycle</div>
<div class="line"><a name="l05264"></a><span class="lineno"> 5264</span>&#160;            bmsk(i,j) = cmsk(i,j)</div>
<div class="line"><a name="l05265"></a><span class="lineno"> 5265</span>&#160;<span class="keywordflow">          enddo</span></div>
<div class="line"><a name="l05266"></a><span class="lineno"> 5266</span>&#160;<span class="keywordflow">        enddo</span></div>
<div class="line"><a name="l05267"></a><span class="lineno"> 5267</span>&#160; </div>
<div class="line"><a name="l05268"></a><span class="lineno"> 5268</span>&#160;<span class="keywordflow">      endif</span></div>
<div class="line"><a name="l05269"></a><span class="lineno"> 5269</span>&#160;<span class="preprocessor">#if defined(TEST_WMESMFMD) || defined(TEST_WMESMFMD_SETUPIMPBMSK)</span></div>
<div class="line"><a name="l05270"></a><span class="lineno"> 5270</span>&#160;<span class="preprocessor"></span>      timeslice = timeslice + 1</div>
<div class="line"><a name="l05271"></a><span class="lineno"> 5271</span>&#160;      <span class="keyword">call </span>esmf_fieldwrite( bmskfield, &amp;</div>
<div class="line"><a name="l05272"></a><span class="lineno"> 5272</span>&#160;           <span class="stringliteral">&quot;wmesmfmd_setupimpbmsk_&quot;</span>//trim(fnm)//<span class="stringliteral">&quot;.nc&quot;</span>, &amp;</div>
<div class="line"><a name="l05273"></a><span class="lineno"> 5273</span>&#160;           overwrite=.true., timeslice=timeslice, rc=rc )</div>
<div class="line"><a name="l05274"></a><span class="lineno"> 5274</span>&#160;      <span class="keywordflow">if</span> (esmf_logfounderror(rc, passthru)) <span class="keywordflow">return</span></div>
<div class="line"><a name="l05275"></a><span class="lineno"> 5275</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l05276"></a><span class="lineno"> 5276</span>&#160;<span class="preprocessor"></span> </div>
<div class="line"><a name="l05277"></a><span class="lineno"> 5277</span>&#160;<span class="keywordflow">    enddo</span> iter_loop</div>
<div class="line"><a name="l05278"></a><span class="lineno"> 5278</span>&#160;    <span class="comment">!</span></div>
<div class="line"><a name="l05279"></a><span class="lineno"> 5279</span>&#160;    <span class="comment">! -------------------------------------------------------------------- /</span></div>
<div class="line"><a name="l05280"></a><span class="lineno"> 5280</span>&#160;    <span class="comment">! Clean up</span></div>
<div class="line"><a name="l05281"></a><span class="lineno"> 5281</span>&#160;    <span class="comment">!</span></div>
<div class="line"><a name="l05282"></a><span class="lineno"> 5282</span>&#160;    <span class="keyword">call </span>esmf_fielddestroy( cmskfield, rc=rc )</div>
<div class="line"><a name="l05283"></a><span class="lineno"> 5283</span>&#160;    <span class="keywordflow">if</span> (esmf_logfounderror(rc, passthru)) <span class="keywordflow">return</span></div>
<div class="line"><a name="l05284"></a><span class="lineno"> 5284</span>&#160;    <span class="comment">!/</span></div>
<div class="line"><a name="l05285"></a><span class="lineno"> 5285</span>&#160;    <span class="comment">!/ End of SetupImpBmsk ----------------------------------------------- /</span></div>
<div class="line"><a name="l05286"></a><span class="lineno"> 5286</span>&#160;    <span class="comment">!/</span></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="w3gdatmd_8F90_source.html#l00625">w3gdatmd::clgtype</a>, <a class="el" href="w3gdatmd_8F90_source.html#l01094">w3gdatmd::gtype</a>, <a class="el" href="yownodepool_8F90_source.html#l00116">yownodepool::iplg</a>, <a class="el" href="constants_8F90_source.html#l00101">constants::lpdlib</a>, <a class="el" href="yownodepool_8F90_source.html#l00093">yownodepool::np</a>, <a class="el" href="yowrankModule_8F90_source.html#l00068">yowrankmodule::rank</a>, <a class="el" href="w3gdatmd_8F90_source.html#l00624">w3gdatmd::rlgtype</a>, and <a class="el" href="w3gdatmd_8F90_source.html#l00626">w3gdatmd::ungtype</a>.</p>

</div>
</div>
</div><!-- contents -->
</div><!-- doc-content -->
<div class="ttc" id="anamespacescrip__constants_html_a99a1a0f01091bf19bea3be8dfdd6147f"><div class="ttname"><a href="namespacescrip__constants.html#a99a1a0f01091bf19bea3be8dfdd6147f">scrip_constants::half</a></div><div class="ttdeci">real(kind=scrip_r8), parameter half</div><div class="ttdef"><b>Definition:</b> <a href="scrip__constants_8f_source.html#l00050">scrip_constants.f:50</a></div></div>
<div class="ttc" id="anamespaceyowelementpool_html_a0bd51f375cd41b9805d1185ed8e0d1e4"><div class="ttname"><a href="namespaceyowelementpool.html#a0bd51f375cd41b9805d1185ed8e0d1e4">yowelementpool::ielg</a></div><div class="ttdeci">integer, dimension(:), allocatable, target, public ielg</div><div class="ttdoc">global element array.</div><div class="ttdef"><b>Definition:</b> <a href="yowelementpool_8F90_source.html#l00065">yowelementpool.F90:65</a></div></div>
<div class="ttc" id="anamespaceyowelementpool_html"><div class="ttname"><a href="namespaceyowelementpool.html">yowelementpool</a></div><div class="ttdef"><b>Definition:</b> <a href="yowelementpool_8F90_source.html#l00038">yowelementpool.F90:38</a></div></div>
<div class="ttc" id="anamespaceyowrankmodule_html_aed43dc1f570b5625e119a367999116e2"><div class="ttname"><a href="namespaceyowrankmodule.html#aed43dc1f570b5625e119a367999116e2">yowrankmodule::rank</a></div><div class="ttdeci">type(t_rank), dimension(:), allocatable, public rank</div><div class="ttdoc">Provides access to some information of all threads e.g.</div><div class="ttdef"><b>Definition:</b> <a href="yowrankModule_8F90_source.html#l00068">yowrankModule.F90:68</a></div></div>
<div class="ttc" id="anamespacew3adatmd_html_a699e1ebfc57530e36053a26ad9530c0f"><div class="ttname"><a href="namespacew3adatmd.html#a699e1ebfc57530e36053a26ad9530c0f">w3adatmd::us3d</a></div><div class="ttdeci">real, dimension(:,:), pointer us3d</div><div class="ttdef"><b>Definition:</b> <a href="w3adatmd_8F90_source.html#l00612">w3adatmd.F90:612</a></div></div>
<div class="ttc" id="anamespacew3adatmd_html_adaccc46c70348e68ea06c9e0977522e6"><div class="ttname"><a href="namespacew3adatmd.html#adaccc46c70348e68ea06c9e0977522e6">w3adatmd::cg</a></div><div class="ttdeci">real, dimension(:,:), pointer cg</div><div class="ttdef"><b>Definition:</b> <a href="w3adatmd_8F90_source.html#l00575">w3adatmd.F90:575</a></div></div>
<div class="ttc" id="anamespacew3adatmd_html_afa9c18e382373af88df0f16b91a82065"><div class="ttname"><a href="namespacew3adatmd.html#afa9c18e382373af88df0f16b91a82065">w3adatmd::dw</a></div><div class="ttdeci">real, dimension(:), pointer dw</div><div class="ttdef"><b>Definition:</b> <a href="w3adatmd_8F90_source.html#l00584">w3adatmd.F90:584</a></div></div>
<div class="ttc" id="anamespacew3adatmd_html_a982588d9c5fbf625de3abe149df867ad"><div class="ttname"><a href="namespacew3adatmd.html#a982588d9c5fbf625de3abe149df867ad">w3adatmd::ipass</a></div><div class="ttdeci">integer, pointer ipass</div><div class="ttdef"><b>Definition:</b> <a href="w3adatmd_8F90_source.html#l00686">w3adatmd.F90:686</a></div></div>
<div class="ttc" id="anamespacew3odatmd_html_a36a4047055987bb52cab303f0207f676"><div class="ttname"><a href="namespacew3odatmd.html#a36a4047055987bb52cab303f0207f676">w3odatmd::iaproc</a></div><div class="ttdeci">integer, pointer iaproc</div><div class="ttdef"><b>Definition:</b> <a href="w3odatmd_8F90_source.html#l00457">w3odatmd.F90:457</a></div></div>
<div class="ttc" id="anamespaceyownodepool_html_aeb9586089a351e66fced1e5fa617e2ec"><div class="ttname"><a href="namespaceyownodepool.html#aeb9586089a351e66fced1e5fa617e2ec">yownodepool::iplg</a></div><div class="ttdeci">integer, dimension(:), allocatable, public iplg</div><div class="ttdoc">Node local to global mapping.</div><div class="ttdef"><b>Definition:</b> <a href="yownodepool_8F90_source.html#l00116">yownodepool.F90:116</a></div></div>
<div class="ttc" id="anamespaceyownodepool_html_ab77f5a6052a07d32d3f2debc49086fdc"><div class="ttname"><a href="namespaceyownodepool.html#ab77f5a6052a07d32d3f2debc49086fdc">yownodepool::npa</a></div><div class="ttdeci">integer, public npa</div><div class="ttdoc">number of ghost + resident nodes this partition holds</div><div class="ttdef"><b>Definition:</b> <a href="yownodepool_8F90_source.html#l00099">yownodepool.F90:99</a></div></div>
<div class="ttc" id="anamespacewmunitmd_html_aafbea7426177ddda28e3875ca9244829"><div class="ttname"><a href="namespacewmunitmd.html#aafbea7426177ddda28e3875ca9244829">wmunitmd::wmuset</a></div><div class="ttdeci">subroutine wmuset(NDSE, NDST, NDS, FLAG, TYPE, NAME, DESC)</div><div class="ttdoc">Directly set information for a unit number in the data structure.</div><div class="ttdef"><b>Definition:</b> <a href="wmunitmd_8F90_source.html#l00497">wmunitmd.F90:497</a></div></div>
<div class="ttc" id="anamespacewmunitmd_html_a1e23e9e471aff383d3d3a991537d04ed"><div class="ttname"><a href="namespacewmunitmd.html#a1e23e9e471aff383d3d3a991537d04ed">wmunitmd::wmuget</a></div><div class="ttdeci">subroutine wmuget(NDSE, NDST, NDS, TYPE, NR)</div><div class="ttdoc">Find a free unit number for a given file type.</div><div class="ttdef"><b>Definition:</b> <a href="wmunitmd_8F90_source.html#l00667">wmunitmd.F90:667</a></div></div>
<div class="ttc" id="anamespacescrip__constants_html_a766bef5f354460e4fdd00aefd1b85bc3"><div class="ttname"><a href="namespacescrip__constants.html#a766bef5f354460e4fdd00aefd1b85bc3">scrip_constants::one</a></div><div class="ttdeci">real(kind=scrip_r8), parameter one</div><div class="ttdef"><b>Definition:</b> <a href="scrip__constants_8f_source.html#l00050">scrip_constants.f:50</a></div></div>
<div class="ttc" id="anamespacew3wdatmd_html_a26efd8bf935279cb1bc2b2dfd68f39b1"><div class="ttname"><a href="namespacew3wdatmd.html#a26efd8bf935279cb1bc2b2dfd68f39b1">w3wdatmd::va</a></div><div class="ttdeci">real, dimension(:,:), pointer va</div><div class="ttdef"><b>Definition:</b> <a href="w3wdatmd_8F90_source.html#l00183">w3wdatmd.F90:183</a></div></div>
<div class="ttc" id="anamespaceyowelementpool_html_a7a6d4803690fc091c26d02151a507c25"><div class="ttname"><a href="namespaceyowelementpool.html#a7a6d4803690fc091c26d02151a507c25">yowelementpool::ne</a></div><div class="ttdeci">integer, public ne</div><div class="ttdoc">number of local elements</div><div class="ttdef"><b>Definition:</b> <a href="yowelementpool_8F90_source.html#l00048">yowelementpool.F90:48</a></div></div>
<div class="ttc" id="anamespacew3adatmd_html_ab2c0f2e6e7524fb061d841ba7a7324a1"><div class="ttname"><a href="namespacew3adatmd.html#ab2c0f2e6e7524fb061d841ba7a7324a1">w3adatmd::w3seta</a></div><div class="ttdeci">subroutine w3seta(IMOD, NDSE, NDST)</div><div class="ttdoc">Select one of the WAVEWATCH III grids / models.</div><div class="ttdef"><b>Definition:</b> <a href="w3adatmd_8F90_source.html#l02645">w3adatmd.F90:2645</a></div></div>
<div class="ttc" id="anamespacescrip__constants_html_a8f7ef7b037191fbbeb9b568788a77405"><div class="ttname"><a href="namespacescrip__constants.html#a8f7ef7b037191fbbeb9b568788a77405">scrip_constants::zero</a></div><div class="ttdeci">real(kind=scrip_r8), parameter zero</div><div class="ttdef"><b>Definition:</b> <a href="scrip__constants_8f_source.html#l00050">scrip_constants.f:50</a></div></div>
<div class="ttc" id="anamespaceyownodepool_html"><div class="ttname"><a href="namespaceyownodepool.html">yownodepool</a></div><div class="ttdoc">Has data that belong to nodes.</div><div class="ttdef"><b>Definition:</b> <a href="yownodepool_8F90_source.html#l00039">yownodepool.F90:39</a></div></div>
<div class="ttc" id="anamespaceconstants_html_ad8b244917fc2f2b94d397086522af7a1"><div class="ttname"><a href="namespaceconstants.html#ad8b244917fc2f2b94d397086522af7a1">constants::lpdlib</a></div><div class="ttdeci">logical lpdlib</div><div class="ttdoc">LPDLIB Logical for using the PDLIB library.</div><div class="ttdef"><b>Definition:</b> <a href="constants_8F90_source.html#l00101">constants.F90:101</a></div></div>
<div class="ttc" id="anamespacew3wdatmd_html_ac0bd6dc2f0effae7dce2f111cde16802"><div class="ttname"><a href="namespacew3wdatmd.html#ac0bd6dc2f0effae7dce2f111cde16802">w3wdatmd::w3setw</a></div><div class="ttdeci">subroutine w3setw(IMOD, NDSE, NDST)</div><div class="ttdoc">Select one of the WAVEWATCH III grids / models.</div><div class="ttdef"><b>Definition:</b> <a href="w3wdatmd_8F90_source.html#l00660">w3wdatmd.F90:660</a></div></div>
<div class="ttc" id="anamespacew3idatmd_html_ae00907da2d4618c147d88c942f1055fd"><div class="ttname"><a href="namespacew3idatmd.html#ae00907da2d4618c147d88c942f1055fd">w3idatmd::flagsc</a></div><div class="ttdeci">logical, dimension(:), pointer flagsc</div><div class="ttdef"><b>Definition:</b> <a href="w3idatmd_8F90_source.html#l00260">w3idatmd.F90:260</a></div></div>
<div class="ttc" id="anamespacescrip__constants_html_a02fdf10dccdc4cfbb4218e5f8df5d6fb"><div class="ttname"><a href="namespacescrip__constants.html#a02fdf10dccdc4cfbb4218e5f8df5d6fb">scrip_constants::two</a></div><div class="ttdeci">real(kind=scrip_r8), parameter two</div><div class="ttdef"><b>Definition:</b> <a href="scrip__constants_8f_source.html#l00050">scrip_constants.f:50</a></div></div>
<div class="ttc" id="anamespacew3odatmd_html_a5fb3206737f511149173f90ece6bb54f"><div class="ttname"><a href="namespacew3odatmd.html#a5fb3206737f511149173f90ece6bb54f">w3odatmd::naproc</a></div><div class="ttdeci">integer, pointer naproc</div><div class="ttdef"><b>Definition:</b> <a href="w3odatmd_8F90_source.html#l00457">w3odatmd.F90:457</a></div></div>
<div class="ttc" id="anamespacew3idatmd_html_a0d197238708114cc861c919bb7b0f04f"><div class="ttname"><a href="namespacew3idatmd.html#a0d197238708114cc861c919bb7b0f04f">w3idatmd::w3seti</a></div><div class="ttdeci">subroutine w3seti(IMOD, NDSE, NDST)</div><div class="ttdoc">Select one of the WAVEWATCH III grids / models.</div><div class="ttdef"><b>Definition:</b> <a href="w3idatmd_8F90_source.html#l00819">w3idatmd.F90:819</a></div></div>
<div class="ttc" id="anamespacew3adatmd_html_a2087a76dd0ef641047dfa5788f9833fd"><div class="ttname"><a href="namespacew3adatmd.html#a2087a76dd0ef641047dfa5788f9833fd">w3adatmd::wn</a></div><div class="ttdeci">real, dimension(:,:), pointer wn</div><div class="ttdef"><b>Definition:</b> <a href="w3adatmd_8F90_source.html#l00575">w3adatmd.F90:575</a></div></div>
<div class="ttc" id="anamespaceyowelementpool_html_a814bfeb4a7ea372cb338c9885dd82a7c"><div class="ttname"><a href="namespaceyowelementpool.html#a814bfeb4a7ea372cb338c9885dd82a7c">yowelementpool::ine</a></div><div class="ttdeci">integer, dimension(:,:), allocatable, target, public ine</div><div class="ttdoc">number of elements of the augmented domain</div><div class="ttdef"><b>Definition:</b> <a href="yowelementpool_8F90_source.html#l00056">yowelementpool.F90:56</a></div></div>
<div class="ttc" id="anamespaceyownodepool_html_a37e8a2849d4567665802bff23fa43a4d"><div class="ttname"><a href="namespaceyownodepool.html#a37e8a2849d4567665802bff23fa43a4d">yownodepool::nodes_global</a></div><div class="ttdeci">type(t_node), dimension(:), allocatable, target, public nodes_global</div><div class="ttdoc">all nodes with their data.</div><div class="ttdef"><b>Definition:</b> <a href="yownodepool_8F90_source.html#l00103">yownodepool.F90:103</a></div></div>
<div class="ttc" id="anamespacew3adatmd_html_a795c1e1aacb2a4f255bb3b646998e466"><div class="ttname"><a href="namespacew3adatmd.html#a795c1e1aacb2a4f255bb3b646998e466">w3adatmd::iter</a></div><div class="ttdeci">integer, dimension(:,:), pointer iter</div><div class="ttdef"><b>Definition:</b> <a href="w3adatmd_8F90_source.html#l00654">w3adatmd.F90:654</a></div></div>
<div class="ttc" id="anamespacew3fldsmd_html_ad01f1b24a7947627c4e50e56830a2150"><div class="ttname"><a href="namespacew3fldsmd.html#ad01f1b24a7947627c4e50e56830a2150">w3fldsmd::w3fldg</a></div><div class="ttdeci">subroutine w3fldg(INXOUT, IDFLD, NDS, NDST, NDSE, MX, MY, NX, NY, T0, TN, TF0, FX0, FY0, FA0, TFN, FXN, FYN, FAN, IERR, FLAGSC ifdef W3_OASIS</div><div class="ttdef"><b>Definition:</b> <a href="w3fldsmd_8F90_source.html#l00958">w3fldsmd.F90:958</a></div></div>
<div class="ttc" id="anamespacew3fldsmd_html_a98e84e100f8c808d04e0584cb1793d51"><div class="ttname"><a href="namespacew3fldsmd.html#a98e84e100f8c808d04e0584cb1793d51">w3fldsmd::w3fldo</a></div><div class="ttdeci">subroutine w3fldo(INXOUT, IDFLD, NDS, NDST, NDSE, NX, NY, GTYPE, IERR, FEXT, FPRE, FHDR, TIDEFLAGIN)</div><div class="ttdef"><b>Definition:</b> <a href="w3fldsmd_8F90_source.html#l00090">w3fldsmd.F90:90</a></div></div>
<div class="ttc" id="anamespacew3iogomd_html_a29d80cc57aa6c280d775fbea9750990c"><div class="ttname"><a href="namespacew3iogomd.html#a29d80cc57aa6c280d775fbea9750990c">w3iogomd::w3outg</a></div><div class="ttdeci">subroutine w3outg(A, FLPART, FLOUTG, FLOUTG2)</div><div class="ttdoc">Fill necessary arrays with gridded data for output.</div><div class="ttdef"><b>Definition:</b> <a href="w3iogomd_8F90_source.html#l01198">w3iogomd.F90:1198</a></div></div>
<div class="ttc" id="aww3__systrk_8F90_html_a4eaa745ba73f3614e5bfbfb2b0fd3a50"><div class="ttname"><a href="ww3__systrk_8F90.html#a4eaa745ba73f3614e5bfbfb2b0fd3a50">check</a></div><div class="ttdeci">subroutine check(status)</div><div class="ttdoc">N/A.</div><div class="ttdef"><b>Definition:</b> <a href="ww3__systrk_8F90_source.html#l01299">ww3_systrk.F90:1299</a></div></div>
<div class="ttc" id="anamespacewmunitmd_html"><div class="ttname"><a href="namespacewmunitmd.html">wmunitmd</a></div><div class="ttdoc">Dynamic assignement of unit numbers for the multi-grid wave model.</div><div class="ttdef"><b>Definition:</b> <a href="wmunitmd_8F90_source.html#l00018">wmunitmd.F90:18</a></div></div>
<div class="ttc" id="anamespacew3fldsmd_html"><div class="ttname"><a href="namespacew3fldsmd.html">w3fldsmd</a></div><div class="ttdef"><b>Definition:</b> <a href="w3fldsmd_8F90_source.html#l00003">w3fldsmd.F90:3</a></div></div>
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="namespacewmesmfmd.html">wmesmfmd</a></li>
    <li class="footer">Generated by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.17 </li>
  </ul>
</div>
</body>
</html>
