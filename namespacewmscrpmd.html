<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.17"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>WAVEWATCH III: wmscrpmd Module Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
  $(document).ready(function() { init_search(); });
/* @license-end */
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">WAVEWATCH III
   &#160;<span id="projectnumber">beta 0.0.1</span>
   </div>
  </td>
   <td>        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
</td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.17 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('namespacewmscrpmd.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="summary">
<a href="#func-members">Functions/Subroutines</a>  </div>
  <div class="headertitle">
<div class="title">wmscrpmd Module Reference</div>  </div>
</div><!--header-->
<div class="contents">

<p>Routines to determine and process grid dependencies in the multi-grid wave model.  
<a href="namespacewmscrpmd.html#details">More...</a></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions/Subroutines</h2></td></tr>
<tr class="memitem:aead9c900863f602a8ff52427419a7709"><td class="memItemLeft" align="right" valign="top">subroutine&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacewmscrpmd.html#aead9c900863f602a8ff52427419a7709">scrip_wrapper</a> (ID_SRC, ID_DST, MAPSTA_SRC, MAPST2_SRC, FLAGLL, GRIDSHIFT, L_MASTER, L_READ, L_TEST)</td></tr>
<tr class="memdesc:aead9c900863f602a8ff52427419a7709"><td class="mdescLeft">&#160;</td><td class="mdescRight">Compute grid information required by SCRIP.  <a href="namespacewmscrpmd.html#aead9c900863f602a8ff52427419a7709">More...</a><br /></td></tr>
<tr class="separator:aead9c900863f602a8ff52427419a7709"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a209b96841918917341cee8884ed16b38"><td class="memItemLeft" align="right" valign="top">subroutine&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacewmscrpmd.html#a209b96841918917341cee8884ed16b38">get_scrip_info_unstructured</a> (ID_GRD, GRID_CENTER_LON, GRID_CENTER_LAT, GRID_CORNER_LON, GRID_CORNER_LAT, GRID_MASK, GRID_DIMS, GRID_SIZE, GRID_CORNERS, GRID_RANK)</td></tr>
<tr class="memdesc:a209b96841918917341cee8884ed16b38"><td class="mdescLeft">&#160;</td><td class="mdescRight">Compute grid arrays for scrip for a specific unstructured grid.  <a href="namespacewmscrpmd.html#a209b96841918917341cee8884ed16b38">More...</a><br /></td></tr>
<tr class="separator:a209b96841918917341cee8884ed16b38"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:afc26be2e4edc36071a5fd6ab661e29b2"><td class="memItemLeft" align="right" valign="top">subroutine&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacewmscrpmd.html#afc26be2e4edc36071a5fd6ab661e29b2">get_scrip_info_structured</a> (ID_GRD, GRID_CENTER_LON, GRID_CENTER_LAT, GRID_CORNER_LON, GRID_CORNER_LAT, GRID_MASK, GRID_DIMS, GRID_SIZE, GRID_CORNERS, GRID_RANK)</td></tr>
<tr class="memdesc:afc26be2e4edc36071a5fd6ab661e29b2"><td class="mdescLeft">&#160;</td><td class="mdescRight">Compute grid arrays needed for scrip for a specific structured grid.  <a href="namespacewmscrpmd.html#afc26be2e4edc36071a5fd6ab661e29b2">More...</a><br /></td></tr>
<tr class="separator:afc26be2e4edc36071a5fd6ab661e29b2"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a1120b9c547b5baa010d3c8fad18490b9"><td class="memItemLeft" align="right" valign="top">subroutine&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacewmscrpmd.html#a1120b9c547b5baa010d3c8fad18490b9">get_scrip_info</a> (ID_GRD, GRID_CENTER_LON, GRID_CENTER_LAT, GRID_CORNER_LON, GRID_CORNER_LAT, GRID_MASK, GRID_DIMS, GRID_SIZE, GRID_CORNERS, GRID_RANK)</td></tr>
<tr class="memdesc:a1120b9c547b5baa010d3c8fad18490b9"><td class="mdescLeft">&#160;</td><td class="mdescRight">Compute grid for scrip for a specific structured grid.  <a href="namespacewmscrpmd.html#a1120b9c547b5baa010d3c8fad18490b9">More...</a><br /></td></tr>
<tr class="separator:a1120b9c547b5baa010d3c8fad18490b9"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aef31042879618e8470d8c73c942a1bdb"><td class="memItemLeft" align="right" valign="top">subroutine&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacewmscrpmd.html#aef31042879618e8470d8c73c942a1bdb">scrip_info_renormalization</a> (GRID_CENTER_LON, GRID_CENTER_LAT, GRID_CORNER_LON, GRID_CORNER_LAT, GRID_MASK, GRID_DIMS, GRID_SIZE, GRID_CORNERS, GRID_RANK, CONV_DX, CONV_DY, OFFSET, GRIDSHIFT)</td></tr>
<tr class="memdesc:aef31042879618e8470d8c73c942a1bdb"><td class="mdescLeft">&#160;</td><td class="mdescRight">Rescale according to whether the grid is spherical or not.  <a href="namespacewmscrpmd.html#aef31042879618e8470d8c73c942a1bdb">More...</a><br /></td></tr>
<tr class="separator:aef31042879618e8470d8c73c942a1bdb"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a4a23dd15cca3e4b295529c8318932be3"><td class="memItemLeft" align="right" valign="top">subroutine&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacewmscrpmd.html#a4a23dd15cca3e4b295529c8318932be3">triang_indexes</a> (I, INEXT, IPREV)</td></tr>
<tr class="memdesc:a4a23dd15cca3e4b295529c8318932be3"><td class="mdescLeft">&#160;</td><td class="mdescRight">Desc not available.  <a href="namespacewmscrpmd.html#a4a23dd15cca3e4b295529c8318932be3">More...</a><br /></td></tr>
<tr class="separator:a4a23dd15cca3e4b295529c8318932be3"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ad4af6c395fa4aceb01ca07579be7c212"><td class="memItemLeft" align="right" valign="top">subroutine&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacewmscrpmd.html#ad4af6c395fa4aceb01ca07579be7c212">get_unstructured_vertex_degree</a> (MNP, MNE, TRIGP, TRIGINCD)</td></tr>
<tr class="memdesc:ad4af6c395fa4aceb01ca07579be7c212"><td class="mdescLeft">&#160;</td><td class="mdescRight">This function returns the list of incidences.  <a href="namespacewmscrpmd.html#ad4af6c395fa4aceb01ca07579be7c212">More...</a><br /></td></tr>
<tr class="separator:ad4af6c395fa4aceb01ca07579be7c212"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ae482aa7ebda10bf20602dda562720664"><td class="memItemLeft" align="right" valign="top">subroutine&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacewmscrpmd.html#ae482aa7ebda10bf20602dda562720664">get_boundary</a> (MNP, MNE, TRIGP, IOBP, NEIGHBOR_PREV, NEIGHBOR_NEXT)</td></tr>
<tr class="memdesc:ae482aa7ebda10bf20602dda562720664"><td class="mdescLeft">&#160;</td><td class="mdescRight">Returns neighbor of a boundary node.  <a href="namespacewmscrpmd.html#ae482aa7ebda10bf20602dda562720664">More...</a><br /></td></tr>
<tr class="separator:ae482aa7ebda10bf20602dda562720664"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aa06afec642efbc99c6ea3999c9b51bf0"><td class="memItemLeft" align="right" valign="top">subroutine&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacewmscrpmd.html#aa06afec642efbc99c6ea3999c9b51bf0">fix_periodcity</a> (PT)</td></tr>
<tr class="memdesc:aa06afec642efbc99c6ea3999c9b51bf0"><td class="mdescLeft">&#160;</td><td class="mdescRight">Adjust element longitude coordinates for elements straddling the dateline with distance of ~360 degrees.  <a href="namespacewmscrpmd.html#aa06afec642efbc99c6ea3999c9b51bf0">More...</a><br /></td></tr>
<tr class="separator:aa06afec642efbc99c6ea3999c9b51bf0"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>Routines to determine and process grid dependencies in the multi-grid wave model. </p>
<dl class="section author"><dt>Author</dt><dd>E. Rogers </dd>
<dd>
M. Dutour </dd>
<dd>
A. Roland </dd>
<dd>
F. Ardhuin </dd></dl>
<dl class="section date"><dt>Date</dt><dd>10-Dec-2014 </dd></dl>
</div><h2 class="groupheader">Function/Subroutine Documentation</h2>
<a id="aa06afec642efbc99c6ea3999c9b51bf0"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aa06afec642efbc99c6ea3999c9b51bf0">&#9670;&nbsp;</a></span>fix_periodcity()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">subroutine wmscrpmd::fix_periodcity </td>
          <td>(</td>
          <td class="paramtype">real*8, dimension(3,2), intent(inout)&#160;</td>
          <td class="paramname"><em>PT</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Adjust element longitude coordinates for elements straddling the dateline with distance of ~360 degrees. </p>
<p>Detect if element has nodes on both sides of dateline and adjust coordinates so that all nodes have the same sign.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in,out]</td><td class="paramname">PT</td><td></td></tr>
  </table>
  </dd>
</dl>
<dl class="section author"><dt>Author</dt><dd>Steven Brus </dd>
<dd>
Ali Abdolali </dd></dl>
<dl class="section date"><dt>Date</dt><dd>21-May-2020 </dd></dl>

<p class="definition">Definition at line <a class="el" href="wmscrpmd_8F90_source.html#l01711">1711</a> of file <a class="el" href="wmscrpmd_8F90_source.html">wmscrpmd.F90</a>.</p>
<div class="fragment"><div class="line"><a name="l01711"></a><span class="lineno"> 1711</span>&#160; </div>
<div class="line"><a name="l01712"></a><span class="lineno"> 1712</span>&#160;    <span class="comment">!/</span></div>
<div class="line"><a name="l01713"></a><span class="lineno"> 1713</span>&#160;    <span class="comment">!/                  +-----------------------------------+</span></div>
<div class="line"><a name="l01714"></a><span class="lineno"> 1714</span>&#160;    <span class="comment">!/                  | WAVEWATCH III           NOAA/NCEP |</span></div>
<div class="line"><a name="l01715"></a><span class="lineno"> 1715</span>&#160;    <span class="comment">!/                  | Steven Brus                       |</span></div>
<div class="line"><a name="l01716"></a><span class="lineno"> 1716</span>&#160;    <span class="comment">!/                  | Ali Abdolali                      |</span></div>
<div class="line"><a name="l01717"></a><span class="lineno"> 1717</span>&#160;    <span class="comment">!/                  |                        FORTRAN 90 |</span></div>
<div class="line"><a name="l01718"></a><span class="lineno"> 1718</span>&#160;    <span class="comment">!/                  | Last update :         21-May-2020 |</span></div>
<div class="line"><a name="l01719"></a><span class="lineno"> 1719</span>&#160;    <span class="comment">!/                  +-----------------------------------+</span></div>
<div class="line"><a name="l01720"></a><span class="lineno"> 1720</span>&#160;    <span class="comment">!/</span></div>
<div class="line"><a name="l01721"></a><span class="lineno"> 1721</span>&#160;    <span class="comment">!/    21-May-2020 : Origination.                        ( version 6.07 )</span></div>
<div class="line"><a name="l01722"></a><span class="lineno"> 1722</span>&#160;    <span class="comment">!/</span></div>
<div class="line"><a name="l01723"></a><span class="lineno"> 1723</span>&#160;    <span class="comment">!/</span></div>
<div class="line"><a name="l01724"></a><span class="lineno"> 1724</span>&#160;    <span class="comment">!  1. Purpose :</span></div>
<div class="line"><a name="l01725"></a><span class="lineno"> 1725</span>&#160;    <span class="comment">!</span></div>
<div class="line"><a name="l01726"></a><span class="lineno"> 1726</span>&#160;    <span class="comment">!     Adjust element longitude coordinates for elements straddling the</span></div>
<div class="line"><a name="l01727"></a><span class="lineno"> 1727</span>&#160;    <span class="comment">!     dateline with distance of ~360 degrees</span></div>
<div class="line"><a name="l01728"></a><span class="lineno"> 1728</span>&#160;    <span class="comment">!</span></div>
<div class="line"><a name="l01729"></a><span class="lineno"> 1729</span>&#160;    <span class="comment">!  2. Method :</span></div>
<div class="line"><a name="l01730"></a><span class="lineno"> 1730</span>&#160;    <span class="comment">!</span></div>
<div class="line"><a name="l01731"></a><span class="lineno"> 1731</span>&#160;    <span class="comment">!     Detect if element has nodes on both sides of dateline and adjust</span></div>
<div class="line"><a name="l01732"></a><span class="lineno"> 1732</span>&#160;    <span class="comment">!     coordinates so that all nodes have the same sign</span></div>
<div class="line"><a name="l01733"></a><span class="lineno"> 1733</span>&#160;    <span class="comment">!</span></div>
<div class="line"><a name="l01734"></a><span class="lineno"> 1734</span>&#160;    <span class="comment">!  3. Parameters :</span></div>
<div class="line"><a name="l01735"></a><span class="lineno"> 1735</span>&#160;    <span class="comment">!</span></div>
<div class="line"><a name="l01736"></a><span class="lineno"> 1736</span>&#160;    <span class="comment">!     Parameter list</span></div>
<div class="line"><a name="l01737"></a><span class="lineno"> 1737</span>&#160;    <span class="comment">!     ----------------------------------------------------------------</span></div>
<div class="line"><a name="l01738"></a><span class="lineno"> 1738</span>&#160;    <span class="keywordtype">IMPLICIT NONE</span></div>
<div class="line"><a name="l01739"></a><span class="lineno"> 1739</span>&#160;    real*8, <span class="keywordtype">INTENT(INOUT)</span> :: pt(3,2)</div>
<div class="line"><a name="l01740"></a><span class="lineno"> 1740</span>&#160;    <span class="comment">!     ----------------------------------------------------------------</span></div>
<div class="line"><a name="l01741"></a><span class="lineno"> 1741</span>&#160;    <span class="comment">!</span></div>
<div class="line"><a name="l01742"></a><span class="lineno"> 1742</span>&#160;    <span class="comment">!     Local variables.</span></div>
<div class="line"><a name="l01743"></a><span class="lineno"> 1743</span>&#160;    <span class="comment">!     ----------------------------------------------------------------</span></div>
<div class="line"><a name="l01744"></a><span class="lineno"> 1744</span>&#160;    <span class="keywordtype">INTEGER</span> :: I</div>
<div class="line"><a name="l01745"></a><span class="lineno"> 1745</span>&#160;    <span class="keywordtype">INTEGER</span> :: R1GT180, R2GT180, R3GT180</div>
<div class="line"><a name="l01746"></a><span class="lineno"> 1746</span>&#160;    <span class="comment">!     ----------------------------------------------------------------</span></div>
<div class="line"><a name="l01747"></a><span class="lineno"> 1747</span>&#160;    <span class="comment">!</span></div>
<div class="line"><a name="l01748"></a><span class="lineno"> 1748</span>&#160;    <span class="comment">!  4. Subroutines used :</span></div>
<div class="line"><a name="l01749"></a><span class="lineno"> 1749</span>&#160;    <span class="comment">!</span></div>
<div class="line"><a name="l01750"></a><span class="lineno"> 1750</span>&#160; </div>
<div class="line"><a name="l01751"></a><span class="lineno"> 1751</span>&#160;    <span class="comment">!  5. Called by :</span></div>
<div class="line"><a name="l01752"></a><span class="lineno"> 1752</span>&#160;    <span class="comment">!</span></div>
<div class="line"><a name="l01753"></a><span class="lineno"> 1753</span>&#160;    <span class="comment">!      Name         Type  Module   Description</span></div>
<div class="line"><a name="l01754"></a><span class="lineno"> 1754</span>&#160;    <span class="comment">!     ----------------------------------------------------------------</span></div>
<div class="line"><a name="l01755"></a><span class="lineno"> 1755</span>&#160;    <span class="comment">!      GET_SCRIP_INFO_UNSTRUCTURED Subr. WMSCRPMD  Element center calculation</span></div>
<div class="line"><a name="l01756"></a><span class="lineno"> 1756</span>&#160;    <span class="comment">!      GET_SCRIP_INFO              Subr. WMSCRPMD  Check signs</span></div>
<div class="line"><a name="l01757"></a><span class="lineno"> 1757</span>&#160;    <span class="comment">!     ----------------------------------------------------------------</span></div>
<div class="line"><a name="l01758"></a><span class="lineno"> 1758</span>&#160;    <span class="comment">!</span></div>
<div class="line"><a name="l01759"></a><span class="lineno"> 1759</span>&#160;    <span class="comment">!  6. Error messages :</span></div>
<div class="line"><a name="l01760"></a><span class="lineno"> 1760</span>&#160;    <span class="comment">!</span></div>
<div class="line"><a name="l01761"></a><span class="lineno"> 1761</span>&#160;    <span class="comment">!       None.</span></div>
<div class="line"><a name="l01762"></a><span class="lineno"> 1762</span>&#160;    <span class="comment">!</span></div>
<div class="line"><a name="l01763"></a><span class="lineno"> 1763</span>&#160;    <span class="comment">!  7. Remarks :</span></div>
<div class="line"><a name="l01764"></a><span class="lineno"> 1764</span>&#160;    <span class="comment">!</span></div>
<div class="line"><a name="l01765"></a><span class="lineno"> 1765</span>&#160;    <span class="comment">!  8. Structure :</span></div>
<div class="line"><a name="l01766"></a><span class="lineno"> 1766</span>&#160;    <span class="comment">!</span></div>
<div class="line"><a name="l01767"></a><span class="lineno"> 1767</span>&#160;    <span class="comment">!  9. Switches :</span></div>
<div class="line"><a name="l01768"></a><span class="lineno"> 1768</span>&#160;    <span class="comment">!</span></div>
<div class="line"><a name="l01769"></a><span class="lineno"> 1769</span>&#160;    <span class="comment">! 10. Source code :</span></div>
<div class="line"><a name="l01770"></a><span class="lineno"> 1770</span>&#160;    <span class="comment">!/ ------------------------------------------------------------------- /</span></div>
<div class="line"><a name="l01771"></a><span class="lineno"> 1771</span>&#160; </div>
<div class="line"><a name="l01772"></a><span class="lineno"> 1772</span>&#160;    r1gt180 = merge(1, 0, abs(pt(3,1)-pt(2,1)).GT.180)</div>
<div class="line"><a name="l01773"></a><span class="lineno"> 1773</span>&#160;    r2gt180 = merge(1, 0, abs(pt(1,1)-pt(3,1)).GT.180)</div>
<div class="line"><a name="l01774"></a><span class="lineno"> 1774</span>&#160;    r3gt180 = merge(1, 0, abs(pt(2,1)-pt(1,1)).GT.180)</div>
<div class="line"><a name="l01775"></a><span class="lineno"> 1775</span>&#160;    <span class="comment">! if R1GT180+R2GT180+R3GT180 .eq. 0 the element does not cross the</span></div>
<div class="line"><a name="l01776"></a><span class="lineno"> 1776</span>&#160;    <span class="comment">! dateline</span></div>
<div class="line"><a name="l01777"></a><span class="lineno"> 1777</span>&#160;    <span class="comment">! if R1GT180+R2GT180+R3GT180 .eq. 1 the element contains the pole</span></div>
<div class="line"><a name="l01778"></a><span class="lineno"> 1778</span>&#160;    <span class="comment">! if R1GT180+R2GT180+R3GT180 .eq. 2 the element crosses the dateline</span></div>
<div class="line"><a name="l01779"></a><span class="lineno"> 1779</span>&#160; </div>
<div class="line"><a name="l01780"></a><span class="lineno"> 1780</span>&#160;    <span class="keywordflow">IF</span> ( r1gt180 + r2gt180 == 2 ) <span class="keywordflow">THEN</span></div>
<div class="line"><a name="l01781"></a><span class="lineno"> 1781</span>&#160;      pt(3,1)=pt(3,1)-sign(360.0d0,(pt(3,1)-pt(2,1)))</div>
<div class="line"><a name="l01782"></a><span class="lineno"> 1782</span>&#160;    <span class="keywordflow">ELSE</span> <span class="keywordflow">IF</span> ( r2gt180 + r3gt180 == 2 ) <span class="keywordflow">THEN</span></div>
<div class="line"><a name="l01783"></a><span class="lineno"> 1783</span>&#160;      pt(1,1)=pt(1,1)-sign(360.0d0,(pt(1,1)-pt(2,1)))</div>
<div class="line"><a name="l01784"></a><span class="lineno"> 1784</span>&#160;    <span class="keywordflow">ELSE</span> <span class="keywordflow">IF</span> ( r1gt180 + r3gt180 == 2 ) <span class="keywordflow">THEN</span></div>
<div class="line"><a name="l01785"></a><span class="lineno"> 1785</span>&#160;      pt(2,1)=pt(2,1)-sign(360.0d0,(pt(2,1)-pt(3,1)))</div>
<div class="line"><a name="l01786"></a><span class="lineno"> 1786</span>&#160;<span class="keywordflow">    ENDIF</span></div>
<div class="line"><a name="l01787"></a><span class="lineno"> 1787</span>&#160; </div>
<div class="line"><a name="l01788"></a><span class="lineno"> 1788</span>&#160;    <span class="keywordflow">RETURN</span></div>
</div><!-- fragment -->
<p class="reference">Referenced by <a class="el" href="wmscrpmd_8F90_source.html#l01165">get_scrip_info()</a>, and <a class="el" href="wmscrpmd_8F90_source.html#l00551">get_scrip_info_unstructured()</a>.</p>

</div>
</div>
<a id="ae482aa7ebda10bf20602dda562720664"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ae482aa7ebda10bf20602dda562720664">&#9670;&nbsp;</a></span>get_boundary()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">subroutine wmscrpmd::get_boundary </td>
          <td>(</td>
          <td class="paramtype">integer, intent(in)&#160;</td>
          <td class="paramname"><em>MNP</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">integer, intent(in)&#160;</td>
          <td class="paramname"><em>MNE</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">integer, dimension(3,mne), intent(in)&#160;</td>
          <td class="paramname"><em>TRIGP</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">integer, dimension(mnp), intent(inout)&#160;</td>
          <td class="paramname"><em>IOBP</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">integer, dimension(mnp), intent(inout)&#160;</td>
          <td class="paramname"><em>NEIGHBOR_PREV</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">integer, dimension(mnp), intent(inout)&#160;</td>
          <td class="paramname"><em>NEIGHBOR_NEXT</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Returns neighbor of a boundary node. </p>
<p>If a node belong to a boundary, the function returns the neighbor of this point on one side. If the point is interior then the value 0 is set.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">MNP</td><td>Number of nodes. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">MNE</td><td>Number of triangles. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">TRIGP</td><td>List of nodes. </td></tr>
    <tr><td class="paramdir">[in,out]</td><td class="paramname">IOBP</td><td></td></tr>
    <tr><td class="paramdir">[in,out]</td><td class="paramname">NEIGHBOR_PREV</td><td></td></tr>
    <tr><td class="paramdir">[in,out]</td><td class="paramname">NEIGHBOR_NEXT</td><td></td></tr>
  </table>
  </dd>
</dl>
<dl class="section author"><dt>Author</dt><dd>M. Dutour </dd>
<dd>
A. Roland </dd></dl>
<dl class="section date"><dt>Date</dt><dd>10-Dec-2014 </dd></dl>

<p class="definition">Definition at line <a class="el" href="wmscrpmd_8F90_source.html#l01502">1502</a> of file <a class="el" href="wmscrpmd_8F90_source.html">wmscrpmd.F90</a>.</p>
<div class="fragment"><div class="line"><a name="l01502"></a><span class="lineno"> 1502</span>&#160;    <span class="comment">!/                  +-----------------------------------+</span></div>
<div class="line"><a name="l01503"></a><span class="lineno"> 1503</span>&#160;    <span class="comment">!/                  | WAVEWATCH III                     |</span></div>
<div class="line"><a name="l01504"></a><span class="lineno"> 1504</span>&#160;    <span class="comment">!/                  | M. Dutour, A. Roland              |</span></div>
<div class="line"><a name="l01505"></a><span class="lineno"> 1505</span>&#160;    <span class="comment">!/                  |                        FORTRAN 90 |</span></div>
<div class="line"><a name="l01506"></a><span class="lineno"> 1506</span>&#160;    <span class="comment">!/                  | Last update :         10-Dec-2014 !</span></div>
<div class="line"><a name="l01507"></a><span class="lineno"> 1507</span>&#160;    <span class="comment">!/                  +-----------------------------------+</span></div>
<div class="line"><a name="l01508"></a><span class="lineno"> 1508</span>&#160;    <span class="comment">!/</span></div>
<div class="line"><a name="l01509"></a><span class="lineno"> 1509</span>&#160;    <span class="comment">!  Written:</span></div>
<div class="line"><a name="l01510"></a><span class="lineno"> 1510</span>&#160;    <span class="comment">!</span></div>
<div class="line"><a name="l01511"></a><span class="lineno"> 1511</span>&#160;    <span class="comment">!    20-Feb-2012</span></div>
<div class="line"><a name="l01512"></a><span class="lineno"> 1512</span>&#160;    <span class="comment">!/    10-Dec-2014 : Add checks for allocate status      ( version 5.04 )</span></div>
<div class="line"><a name="l01513"></a><span class="lineno"> 1513</span>&#160;    <span class="comment">!</span></div>
<div class="line"><a name="l01514"></a><span class="lineno"> 1514</span>&#160;    <span class="comment">!  Author:</span></div>
<div class="line"><a name="l01515"></a><span class="lineno"> 1515</span>&#160;    <span class="comment">!</span></div>
<div class="line"><a name="l01516"></a><span class="lineno"> 1516</span>&#160;    <span class="comment">!    Mathieu Dutour Sikiric, IRB &amp; Aron Roland, Z&amp;P</span></div>
<div class="line"><a name="l01517"></a><span class="lineno"> 1517</span>&#160;    <span class="comment">!</span></div>
<div class="line"><a name="l01518"></a><span class="lineno"> 1518</span>&#160;    <span class="comment">!  Parameters:</span></div>
<div class="line"><a name="l01519"></a><span class="lineno"> 1519</span>&#160;    <span class="comment">!   Input:</span></div>
<div class="line"><a name="l01520"></a><span class="lineno"> 1520</span>&#160;    <span class="comment">!    MNP: number of nodes</span></div>
<div class="line"><a name="l01521"></a><span class="lineno"> 1521</span>&#160;    <span class="comment">!    TRIGP: list of nodes</span></div>
<div class="line"><a name="l01522"></a><span class="lineno"> 1522</span>&#160;    <span class="comment">!    MNE: number of triangles</span></div>
<div class="line"><a name="l01523"></a><span class="lineno"> 1523</span>&#160;    <span class="comment">!   Output:</span></div>
<div class="line"><a name="l01524"></a><span class="lineno"> 1524</span>&#160;    <span class="comment">!    NEIGHBOR</span></div>
<div class="line"><a name="l01525"></a><span class="lineno"> 1525</span>&#160;    <span class="comment">!</span></div>
<div class="line"><a name="l01526"></a><span class="lineno"> 1526</span>&#160;    <span class="comment">!  Description:</span></div>
<div class="line"><a name="l01527"></a><span class="lineno"> 1527</span>&#160;    <span class="comment">!    if a node belong to a boundary, the function</span></div>
<div class="line"><a name="l01528"></a><span class="lineno"> 1528</span>&#160;    <span class="comment">!    returns the neighbor of this point on one side.</span></div>
<div class="line"><a name="l01529"></a><span class="lineno"> 1529</span>&#160;    <span class="comment">!    if the point is interior then the value 0 is set.</span></div>
<div class="line"><a name="l01530"></a><span class="lineno"> 1530</span>&#160;    <span class="comment">!</span></div>
<div class="line"><a name="l01531"></a><span class="lineno"> 1531</span>&#160;    <span class="keywordtype">USE </span><a class="code" href="namespacew3servmd.html">w3servmd</a>, <span class="keywordtype">ONLY</span>: extcde</div>
<div class="line"><a name="l01532"></a><span class="lineno"> 1532</span>&#160;    <span class="keywordtype">IMPLICIT NONE</span></div>
<div class="line"><a name="l01533"></a><span class="lineno"> 1533</span>&#160; </div>
<div class="line"><a name="l01534"></a><span class="lineno"> 1534</span>&#160;    <span class="keywordtype">INTEGER</span>, <span class="keywordtype">INTENT(IN)</span>             :: MNP, MNE, TRIGP(3,MNE)</div>
<div class="line"><a name="l01535"></a><span class="lineno"> 1535</span>&#160;    <span class="keywordtype">INTEGER</span>, <span class="keywordtype">INTENT(INOUT)</span>          :: IOBP(MNP)</div>
<div class="line"><a name="l01536"></a><span class="lineno"> 1536</span>&#160;    <span class="keywordtype">INTEGER</span>, <span class="keywordtype">INTENT(INOUT)</span>          :: NEIGHBOR_PREV(MNP)</div>
<div class="line"><a name="l01537"></a><span class="lineno"> 1537</span>&#160;    <span class="keywordtype">INTEGER</span>, <span class="keywordtype">INTENT(INOUT)</span>          :: NEIGHBOR_NEXT(MNP)</div>
<div class="line"><a name="l01538"></a><span class="lineno"> 1538</span>&#160; </div>
<div class="line"><a name="l01539"></a><span class="lineno"> 1539</span>&#160;    <span class="keywordtype">INTEGER</span>, <span class="keywordtype">POINTER</span> :: STATUS(:)</div>
<div class="line"><a name="l01540"></a><span class="lineno"> 1540</span>&#160;    <span class="keywordtype">INTEGER</span>, <span class="keywordtype">POINTER</span> :: COLLECTED(:)</div>
<div class="line"><a name="l01541"></a><span class="lineno"> 1541</span>&#160;    <span class="keywordtype">INTEGER</span>, <span class="keywordtype">POINTER</span> :: NEXTVERT(:)</div>
<div class="line"><a name="l01542"></a><span class="lineno"> 1542</span>&#160;    <span class="keywordtype">INTEGER</span>, <span class="keywordtype">POINTER</span> :: PREVVERT(:)</div>
<div class="line"><a name="l01543"></a><span class="lineno"> 1543</span>&#160; </div>
<div class="line"><a name="l01544"></a><span class="lineno"> 1544</span>&#160;    <span class="keywordtype">INTEGER</span> :: IE, I, IP, IP2, IP3</div>
<div class="line"><a name="l01545"></a><span class="lineno"> 1545</span>&#160;    <span class="keywordtype">INTEGER</span> :: ISFINISHED, INEXT, IPREV</div>
<div class="line"><a name="l01546"></a><span class="lineno"> 1546</span>&#160;    <span class="keywordtype">INTEGER</span> :: IPNEXT, IPPREV, ZNEXT, ZPREV</div>
<div class="line"><a name="l01547"></a><span class="lineno"> 1547</span>&#160; </div>
<div class="line"><a name="l01548"></a><span class="lineno"> 1548</span>&#160;    <span class="keyword">ALLOCATE</span>(<a class="code" href="namespacescrip__timers.html#a13e5d8b1f71ebc95443c31da01c7d687">status</a>(mnp), stat=istat)</div>
<div class="line"><a name="l01549"></a><span class="lineno"> 1549</span>&#160;    check_alloc_status( istat )</div>
<div class="line"><a name="l01550"></a><span class="lineno"> 1550</span>&#160;    <span class="keyword">ALLOCATE</span>(collected(mnp), stat=istat)</div>
<div class="line"><a name="l01551"></a><span class="lineno"> 1551</span>&#160;    check_alloc_status( istat )</div>
<div class="line"><a name="l01552"></a><span class="lineno"> 1552</span>&#160;    <span class="keyword">ALLOCATE</span>(prevvert(mnp), stat=istat)</div>
<div class="line"><a name="l01553"></a><span class="lineno"> 1553</span>&#160;    check_alloc_status( istat )</div>
<div class="line"><a name="l01554"></a><span class="lineno"> 1554</span>&#160;    <span class="keyword">ALLOCATE</span>(nextvert(mnp), stat=istat)</div>
<div class="line"><a name="l01555"></a><span class="lineno"> 1555</span>&#160;    check_alloc_status( istat )</div>
<div class="line"><a name="l01556"></a><span class="lineno"> 1556</span>&#160;    iobp = 0</div>
<div class="line"><a name="l01557"></a><span class="lineno"> 1557</span>&#160;    neighbor_next = 0</div>
<div class="line"><a name="l01558"></a><span class="lineno"> 1558</span>&#160;    neighbor_prev = 0</div>
<div class="line"><a name="l01559"></a><span class="lineno"> 1559</span>&#160; </div>
<div class="line"><a name="l01560"></a><span class="lineno"> 1560</span>&#160;    <span class="comment">!  Now computing the next items</span></div>
<div class="line"><a name="l01561"></a><span class="lineno"> 1561</span>&#160;    <a class="code" href="namespacescrip__timers.html#a13e5d8b1f71ebc95443c31da01c7d687">status</a> = 0</div>
<div class="line"><a name="l01562"></a><span class="lineno"> 1562</span>&#160;    nextvert = 0</div>
<div class="line"><a name="l01563"></a><span class="lineno"> 1563</span>&#160;    prevvert = 0</div>
<div class="line"><a name="l01564"></a><span class="lineno"> 1564</span>&#160;    <span class="keywordflow">DO</span> ie=1,mne</div>
<div class="line"><a name="l01565"></a><span class="lineno"> 1565</span>&#160;      <span class="keywordflow">DO</span> i=1,3</div>
<div class="line"><a name="l01566"></a><span class="lineno"> 1566</span>&#160;        <span class="keyword">CALL </span><a class="code" href="namespacew3triamd.html#a03614b889485266f84a023e4c4de6843">triang_indexes</a>(i, inext, iprev)</div>
<div class="line"><a name="l01567"></a><span class="lineno"> 1567</span>&#160;        ip=trigp(i,ie)</div>
<div class="line"><a name="l01568"></a><span class="lineno"> 1568</span>&#160;        ipnext=trigp(inext,ie)</div>
<div class="line"><a name="l01569"></a><span class="lineno"> 1569</span>&#160;        ipprev=trigp(iprev,ie)</div>
<div class="line"><a name="l01570"></a><span class="lineno"> 1570</span>&#160;        <span class="keywordflow">IF</span> (<a class="code" href="namespacescrip__timers.html#a13e5d8b1f71ebc95443c31da01c7d687">status</a>(ip).EQ.0) <span class="keywordflow">THEN</span></div>
<div class="line"><a name="l01571"></a><span class="lineno"> 1571</span>&#160;          <a class="code" href="namespacescrip__timers.html#a13e5d8b1f71ebc95443c31da01c7d687">status</a>(ip)=1</div>
<div class="line"><a name="l01572"></a><span class="lineno"> 1572</span>&#160;          prevvert(ip)=ipprev</div>
<div class="line"><a name="l01573"></a><span class="lineno"> 1573</span>&#160;          nextvert(ip)=ipnext</div>
<div class="line"><a name="l01574"></a><span class="lineno"> 1574</span>&#160;<span class="keywordflow">        END IF</span></div>
<div class="line"><a name="l01575"></a><span class="lineno"> 1575</span>&#160;<span class="keywordflow">      END DO</span></div>
<div class="line"><a name="l01576"></a><span class="lineno"> 1576</span>&#160;<span class="keywordflow">    END DO</span></div>
<div class="line"><a name="l01577"></a><span class="lineno"> 1577</span>&#160;    <a class="code" href="namespacescrip__timers.html#a13e5d8b1f71ebc95443c31da01c7d687">status</a>(:)=0</div>
<div class="line"><a name="l01578"></a><span class="lineno"> 1578</span>&#160;    <span class="keywordflow">DO</span></div>
<div class="line"><a name="l01579"></a><span class="lineno"> 1579</span>&#160;      collected(:)=0</div>
<div class="line"><a name="l01580"></a><span class="lineno"> 1580</span>&#160;      <span class="keywordflow">DO</span> ie=1,mne</div>
<div class="line"><a name="l01581"></a><span class="lineno"> 1581</span>&#160;        <span class="keywordflow">DO</span> i=1,3</div>
<div class="line"><a name="l01582"></a><span class="lineno"> 1582</span>&#160;          <span class="keyword">CALL </span><a class="code" href="namespacew3triamd.html#a03614b889485266f84a023e4c4de6843">triang_indexes</a>(i, inext, iprev)</div>
<div class="line"><a name="l01583"></a><span class="lineno"> 1583</span>&#160;          ip=trigp(i,ie)</div>
<div class="line"><a name="l01584"></a><span class="lineno"> 1584</span>&#160;          ipnext=trigp(inext,ie)</div>
<div class="line"><a name="l01585"></a><span class="lineno"> 1585</span>&#160;          ipprev=trigp(iprev,ie)</div>
<div class="line"><a name="l01586"></a><span class="lineno"> 1586</span>&#160;          <span class="keywordflow">IF</span> (<a class="code" href="namespacescrip__timers.html#a13e5d8b1f71ebc95443c31da01c7d687">status</a>(ip).EQ.0) <span class="keywordflow">THEN</span></div>
<div class="line"><a name="l01587"></a><span class="lineno"> 1587</span>&#160;            znext=nextvert(ip)</div>
<div class="line"><a name="l01588"></a><span class="lineno"> 1588</span>&#160;            <span class="keywordflow">IF</span> (znext.EQ.ipprev) <span class="keywordflow">THEN</span></div>
<div class="line"><a name="l01589"></a><span class="lineno"> 1589</span>&#160;              collected(ip)=1</div>
<div class="line"><a name="l01590"></a><span class="lineno"> 1590</span>&#160;              nextvert(ip)=ipnext</div>
<div class="line"><a name="l01591"></a><span class="lineno"> 1591</span>&#160;              <span class="keywordflow">IF</span> (nextvert(ip).EQ.prevvert(ip)) <span class="keywordflow">THEN</span></div>
<div class="line"><a name="l01592"></a><span class="lineno"> 1592</span>&#160;                <a class="code" href="namespacescrip__timers.html#a13e5d8b1f71ebc95443c31da01c7d687">status</a>(ip)=1</div>
<div class="line"><a name="l01593"></a><span class="lineno"> 1593</span>&#160;<span class="keywordflow">              END IF</span></div>
<div class="line"><a name="l01594"></a><span class="lineno"> 1594</span>&#160;<span class="keywordflow">            END IF</span></div>
<div class="line"><a name="l01595"></a><span class="lineno"> 1595</span>&#160;<span class="keywordflow">          END IF</span></div>
<div class="line"><a name="l01596"></a><span class="lineno"> 1596</span>&#160;<span class="keywordflow">        END DO</span></div>
<div class="line"><a name="l01597"></a><span class="lineno"> 1597</span>&#160;<span class="keywordflow">      END DO</span></div>
<div class="line"><a name="l01598"></a><span class="lineno"> 1598</span>&#160; </div>
<div class="line"><a name="l01599"></a><span class="lineno"> 1599</span>&#160;      isfinished=1</div>
<div class="line"><a name="l01600"></a><span class="lineno"> 1600</span>&#160;      <span class="keywordflow">DO</span> ip=1,mnp</div>
<div class="line"><a name="l01601"></a><span class="lineno"> 1601</span>&#160;        <span class="keywordflow">IF</span> ((collected(ip).EQ.0).AND.(<a class="code" href="namespacescrip__timers.html#a13e5d8b1f71ebc95443c31da01c7d687">status</a>(ip).EQ.0)) <span class="keywordflow">THEN</span></div>
<div class="line"><a name="l01602"></a><span class="lineno"> 1602</span>&#160;          <a class="code" href="namespacescrip__timers.html#a13e5d8b1f71ebc95443c31da01c7d687">status</a>(ip)=-1</div>
<div class="line"><a name="l01603"></a><span class="lineno"> 1603</span>&#160;          neighbor_next(ip)=nextvert(ip)</div>
<div class="line"><a name="l01604"></a><span class="lineno"> 1604</span>&#160;<span class="keywordflow">        END IF</span></div>
<div class="line"><a name="l01605"></a><span class="lineno"> 1605</span>&#160;        <span class="keywordflow">IF</span> (<a class="code" href="namespacescrip__timers.html#a13e5d8b1f71ebc95443c31da01c7d687">status</a>(ip).EQ.0) <span class="keywordflow">THEN</span></div>
<div class="line"><a name="l01606"></a><span class="lineno"> 1606</span>&#160;          isfinished=0</div>
<div class="line"><a name="l01607"></a><span class="lineno"> 1607</span>&#160;<span class="keywordflow">        END IF</span></div>
<div class="line"><a name="l01608"></a><span class="lineno"> 1608</span>&#160;<span class="keywordflow">      END DO</span></div>
<div class="line"><a name="l01609"></a><span class="lineno"> 1609</span>&#160;      <span class="keywordflow">IF</span> (isfinished.EQ.1) <span class="keywordflow">THEN</span></div>
<div class="line"><a name="l01610"></a><span class="lineno"> 1610</span>&#160;        <span class="keywordflow">EXIT</span></div>
<div class="line"><a name="l01611"></a><span class="lineno"> 1611</span>&#160;<span class="keywordflow">      END IF</span></div>
<div class="line"><a name="l01612"></a><span class="lineno"> 1612</span>&#160;<span class="keywordflow">    END DO</span></div>
<div class="line"><a name="l01613"></a><span class="lineno"> 1613</span>&#160; </div>
<div class="line"><a name="l01614"></a><span class="lineno"> 1614</span>&#160;    <span class="comment">!  Now computing the prev items</span></div>
<div class="line"><a name="l01615"></a><span class="lineno"> 1615</span>&#160;    <a class="code" href="namespacescrip__timers.html#a13e5d8b1f71ebc95443c31da01c7d687">status</a> = 0</div>
<div class="line"><a name="l01616"></a><span class="lineno"> 1616</span>&#160;    nextvert = 0</div>
<div class="line"><a name="l01617"></a><span class="lineno"> 1617</span>&#160;    prevvert = 0</div>
<div class="line"><a name="l01618"></a><span class="lineno"> 1618</span>&#160;    <span class="keywordflow">DO</span> ie=1,mne</div>
<div class="line"><a name="l01619"></a><span class="lineno"> 1619</span>&#160;      <span class="keywordflow">DO</span> i=1,3</div>
<div class="line"><a name="l01620"></a><span class="lineno"> 1620</span>&#160;        <span class="keyword">CALL </span><a class="code" href="namespacew3triamd.html#a03614b889485266f84a023e4c4de6843">triang_indexes</a>(i, inext, iprev)</div>
<div class="line"><a name="l01621"></a><span class="lineno"> 1621</span>&#160;        ip=trigp(i,ie)</div>
<div class="line"><a name="l01622"></a><span class="lineno"> 1622</span>&#160;        ipnext=trigp(inext,ie)</div>
<div class="line"><a name="l01623"></a><span class="lineno"> 1623</span>&#160;        ipprev=trigp(iprev,ie)</div>
<div class="line"><a name="l01624"></a><span class="lineno"> 1624</span>&#160;        <span class="keywordflow">IF</span> (<a class="code" href="namespacescrip__timers.html#a13e5d8b1f71ebc95443c31da01c7d687">status</a>(ip).EQ.0) <span class="keywordflow">THEN</span></div>
<div class="line"><a name="l01625"></a><span class="lineno"> 1625</span>&#160;          <a class="code" href="namespacescrip__timers.html#a13e5d8b1f71ebc95443c31da01c7d687">status</a>(ip)=1</div>
<div class="line"><a name="l01626"></a><span class="lineno"> 1626</span>&#160;          prevvert(ip)=ipprev</div>
<div class="line"><a name="l01627"></a><span class="lineno"> 1627</span>&#160;          nextvert(ip)=ipnext</div>
<div class="line"><a name="l01628"></a><span class="lineno"> 1628</span>&#160;<span class="keywordflow">        END IF</span></div>
<div class="line"><a name="l01629"></a><span class="lineno"> 1629</span>&#160;<span class="keywordflow">      END DO</span></div>
<div class="line"><a name="l01630"></a><span class="lineno"> 1630</span>&#160;<span class="keywordflow">    END DO</span></div>
<div class="line"><a name="l01631"></a><span class="lineno"> 1631</span>&#160;    <a class="code" href="namespacescrip__timers.html#a13e5d8b1f71ebc95443c31da01c7d687">status</a>(:)=0</div>
<div class="line"><a name="l01632"></a><span class="lineno"> 1632</span>&#160;    <span class="keywordflow">DO</span></div>
<div class="line"><a name="l01633"></a><span class="lineno"> 1633</span>&#160;      collected(:)=0</div>
<div class="line"><a name="l01634"></a><span class="lineno"> 1634</span>&#160;      <span class="keywordflow">DO</span> ie=1,mne</div>
<div class="line"><a name="l01635"></a><span class="lineno"> 1635</span>&#160;        <span class="keywordflow">DO</span> i=1,3</div>
<div class="line"><a name="l01636"></a><span class="lineno"> 1636</span>&#160;          <span class="keyword">CALL </span><a class="code" href="namespacew3triamd.html#a03614b889485266f84a023e4c4de6843">triang_indexes</a>(i, inext, iprev)</div>
<div class="line"><a name="l01637"></a><span class="lineno"> 1637</span>&#160;          ip=trigp(i,ie)</div>
<div class="line"><a name="l01638"></a><span class="lineno"> 1638</span>&#160;          ipnext=trigp(inext,ie)</div>
<div class="line"><a name="l01639"></a><span class="lineno"> 1639</span>&#160;          ipprev=trigp(iprev,ie)</div>
<div class="line"><a name="l01640"></a><span class="lineno"> 1640</span>&#160;          <span class="keywordflow">IF</span> (<a class="code" href="namespacescrip__timers.html#a13e5d8b1f71ebc95443c31da01c7d687">status</a>(ip).EQ.0) <span class="keywordflow">THEN</span></div>
<div class="line"><a name="l01641"></a><span class="lineno"> 1641</span>&#160;            zprev=prevvert(ip)</div>
<div class="line"><a name="l01642"></a><span class="lineno"> 1642</span>&#160;            <span class="keywordflow">IF</span> (zprev.EQ.ipnext) <span class="keywordflow">THEN</span></div>
<div class="line"><a name="l01643"></a><span class="lineno"> 1643</span>&#160;              collected(ip)=1</div>
<div class="line"><a name="l01644"></a><span class="lineno"> 1644</span>&#160;              prevvert(ip)=ipprev</div>
<div class="line"><a name="l01645"></a><span class="lineno"> 1645</span>&#160;              <span class="keywordflow">IF</span> (prevvert(ip).EQ.nextvert(ip)) <span class="keywordflow">THEN</span></div>
<div class="line"><a name="l01646"></a><span class="lineno"> 1646</span>&#160;                <a class="code" href="namespacescrip__timers.html#a13e5d8b1f71ebc95443c31da01c7d687">status</a>(ip)=1</div>
<div class="line"><a name="l01647"></a><span class="lineno"> 1647</span>&#160;<span class="keywordflow">              END IF</span></div>
<div class="line"><a name="l01648"></a><span class="lineno"> 1648</span>&#160;<span class="keywordflow">            END IF</span></div>
<div class="line"><a name="l01649"></a><span class="lineno"> 1649</span>&#160;<span class="keywordflow">          END IF</span></div>
<div class="line"><a name="l01650"></a><span class="lineno"> 1650</span>&#160;<span class="keywordflow">        END DO</span></div>
<div class="line"><a name="l01651"></a><span class="lineno"> 1651</span>&#160;<span class="keywordflow">      END DO</span></div>
<div class="line"><a name="l01652"></a><span class="lineno"> 1652</span>&#160; </div>
<div class="line"><a name="l01653"></a><span class="lineno"> 1653</span>&#160;      isfinished=1</div>
<div class="line"><a name="l01654"></a><span class="lineno"> 1654</span>&#160;      <span class="keywordflow">DO</span> ip=1,mnp</div>
<div class="line"><a name="l01655"></a><span class="lineno"> 1655</span>&#160;        <span class="keywordflow">IF</span> ((collected(ip).EQ.0).AND.(<a class="code" href="namespacescrip__timers.html#a13e5d8b1f71ebc95443c31da01c7d687">status</a>(ip).EQ.0)) <span class="keywordflow">THEN</span></div>
<div class="line"><a name="l01656"></a><span class="lineno"> 1656</span>&#160;          <a class="code" href="namespacescrip__timers.html#a13e5d8b1f71ebc95443c31da01c7d687">status</a>(ip)=-1</div>
<div class="line"><a name="l01657"></a><span class="lineno"> 1657</span>&#160;          neighbor_prev(ip)=prevvert(ip)     <span class="comment">! new code</span></div>
<div class="line"><a name="l01658"></a><span class="lineno"> 1658</span>&#160;<span class="keywordflow">        END IF</span></div>
<div class="line"><a name="l01659"></a><span class="lineno"> 1659</span>&#160;        <span class="keywordflow">IF</span> (<a class="code" href="namespacescrip__timers.html#a13e5d8b1f71ebc95443c31da01c7d687">status</a>(ip).EQ.0) <span class="keywordflow">THEN</span></div>
<div class="line"><a name="l01660"></a><span class="lineno"> 1660</span>&#160;          isfinished=0</div>
<div class="line"><a name="l01661"></a><span class="lineno"> 1661</span>&#160;<span class="keywordflow">        END IF</span></div>
<div class="line"><a name="l01662"></a><span class="lineno"> 1662</span>&#160;<span class="keywordflow">      END DO</span></div>
<div class="line"><a name="l01663"></a><span class="lineno"> 1663</span>&#160;      <span class="keywordflow">IF</span> (isfinished.EQ.1) <span class="keywordflow">THEN</span></div>
<div class="line"><a name="l01664"></a><span class="lineno"> 1664</span>&#160;        <span class="keywordflow">EXIT</span></div>
<div class="line"><a name="l01665"></a><span class="lineno"> 1665</span>&#160;<span class="keywordflow">      END IF</span></div>
<div class="line"><a name="l01666"></a><span class="lineno"> 1666</span>&#160;<span class="keywordflow">    END DO</span></div>
<div class="line"><a name="l01667"></a><span class="lineno"> 1667</span>&#160;    <span class="comment">!  Now making checks</span></div>
<div class="line"><a name="l01668"></a><span class="lineno"> 1668</span>&#160;    <span class="keywordflow">DO</span> ip=1,mnp</div>
<div class="line"><a name="l01669"></a><span class="lineno"> 1669</span>&#160;      ip2=neighbor_next(ip)</div>
<div class="line"><a name="l01670"></a><span class="lineno"> 1670</span>&#160;      <span class="keywordflow">IF</span> (ip2.GT.0) <span class="keywordflow">THEN</span></div>
<div class="line"><a name="l01671"></a><span class="lineno"> 1671</span>&#160;        ip3=neighbor_prev(ip2)</div>
<div class="line"><a name="l01672"></a><span class="lineno"> 1672</span>&#160;        <span class="keywordflow">IF</span> (abs(ip3 - ip).GT.0) <span class="keywordflow">THEN</span></div>
<div class="line"><a name="l01673"></a><span class="lineno"> 1673</span>&#160;          <span class="keyword">WRITE</span>(*,*) <span class="stringliteral">&#39;IP=&#39;</span>, ip, <span class="stringliteral">&#39; IP2=&#39;</span>, ip2, <span class="stringliteral">&#39; IP3=&#39;</span>, ip3</div>
<div class="line"><a name="l01674"></a><span class="lineno"> 1674</span>&#160;          <span class="keyword">WRITE</span>(*,*) <span class="stringliteral">&#39;We have a dramatic inconsistency&#39;</span></div>
<div class="line"><a name="l01675"></a><span class="lineno"> 1675</span>&#160;          stop <span class="stringliteral">&#39;wmscrpmd, case 3&#39;</span></div>
<div class="line"><a name="l01676"></a><span class="lineno"> 1676</span>&#160;<span class="keywordflow">        END IF</span></div>
<div class="line"><a name="l01677"></a><span class="lineno"> 1677</span>&#160;<span class="keywordflow">      END IF</span></div>
<div class="line"><a name="l01678"></a><span class="lineno"> 1678</span>&#160;<span class="keywordflow">    END DO</span></div>
<div class="line"><a name="l01679"></a><span class="lineno"> 1679</span>&#160;    <span class="comment">!   Now assigning the boundary IOBP array</span></div>
<div class="line"><a name="l01680"></a><span class="lineno"> 1680</span>&#160;    <span class="keywordflow">DO</span> ip=1,mnp</div>
<div class="line"><a name="l01681"></a><span class="lineno"> 1681</span>&#160;      <span class="keywordflow">IF</span> (<a class="code" href="namespacescrip__timers.html#a13e5d8b1f71ebc95443c31da01c7d687">status</a>(ip).EQ.-1 .AND. iobp(ip) .EQ. 0) <span class="keywordflow">THEN</span></div>
<div class="line"><a name="l01682"></a><span class="lineno"> 1682</span>&#160;        iobp(ip)=1</div>
<div class="line"><a name="l01683"></a><span class="lineno"> 1683</span>&#160;<span class="keywordflow">      END IF</span></div>
<div class="line"><a name="l01684"></a><span class="lineno"> 1684</span>&#160;<span class="keywordflow">    END DO</span></div>
<div class="line"><a name="l01685"></a><span class="lineno"> 1685</span>&#160; </div>
<div class="line"><a name="l01686"></a><span class="lineno"> 1686</span>&#160;    <span class="keyword">DEALLOCATE</span>(<a class="code" href="namespacescrip__timers.html#a13e5d8b1f71ebc95443c31da01c7d687">status</a>, stat=istat)</div>
<div class="line"><a name="l01687"></a><span class="lineno"> 1687</span>&#160;    check_dealloc_status( istat )</div>
<div class="line"><a name="l01688"></a><span class="lineno"> 1688</span>&#160;    <span class="keyword">DEALLOCATE</span>(collected, stat=istat)</div>
<div class="line"><a name="l01689"></a><span class="lineno"> 1689</span>&#160;    check_dealloc_status( istat )</div>
<div class="line"><a name="l01690"></a><span class="lineno"> 1690</span>&#160;    <span class="keyword">DEALLOCATE</span>(nextvert, stat=istat)</div>
<div class="line"><a name="l01691"></a><span class="lineno"> 1691</span>&#160;    check_dealloc_status( istat )</div>
<div class="line"><a name="l01692"></a><span class="lineno"> 1692</span>&#160;    <span class="keyword">DEALLOCATE</span>(prevvert, stat=istat)</div>
<div class="line"><a name="l01693"></a><span class="lineno"> 1693</span>&#160;    check_dealloc_status( istat )</div>
<div class="line"><a name="l01694"></a><span class="lineno"> 1694</span>&#160; </div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="w3servmd_8F90_source.html#l00736">w3servmd::extcde()</a>, and <a class="el" href="wmscrpmd_8F90_source.html#l01413">triang_indexes()</a>.</p>

<p class="reference">Referenced by <a class="el" href="wmscrpmd_8F90_source.html#l00551">get_scrip_info_unstructured()</a>.</p>

</div>
</div>
<a id="a1120b9c547b5baa010d3c8fad18490b9"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a1120b9c547b5baa010d3c8fad18490b9">&#9670;&nbsp;</a></span>get_scrip_info()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">subroutine wmscrpmd::get_scrip_info </td>
          <td>(</td>
          <td class="paramtype">integer, intent(in)&#160;</td>
          <td class="paramname"><em>ID_GRD</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real*8, dimension(:), intent(out), allocatable&#160;</td>
          <td class="paramname"><em>GRID_CENTER_LON</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real*8, dimension(:), intent(out), allocatable&#160;</td>
          <td class="paramname"><em>GRID_CENTER_LAT</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real*8, dimension(:,:), intent(out), allocatable&#160;</td>
          <td class="paramname"><em>GRID_CORNER_LON</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real*8, dimension(:,:), intent(out), allocatable&#160;</td>
          <td class="paramname"><em>GRID_CORNER_LAT</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">logical, dimension(:), intent(out), allocatable&#160;</td>
          <td class="paramname"><em>GRID_MASK</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">integer, dimension(:), intent(out), allocatable&#160;</td>
          <td class="paramname"><em>GRID_DIMS</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">integer, intent(out)&#160;</td>
          <td class="paramname"><em>GRID_SIZE</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">integer, intent(out)&#160;</td>
          <td class="paramname"><em>GRID_CORNERS</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">integer, intent(out)&#160;</td>
          <td class="paramname"><em>GRID_RANK</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Compute grid for scrip for a specific structured grid. </p>
<p>This is adapted from Erick Rogers code by making it cleaner.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">ID_GRD</td><td></td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">GRID_CENTER_LON</td><td></td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">GRID_CENTER_LAT</td><td></td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">GRID_CORNER_LON</td><td></td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">GRID_CORNER_LAT</td><td></td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">GRID_MASK</td><td></td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">GRID_DIMS</td><td></td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">GRID_SIZE</td><td></td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">GRID_CORNERS</td><td></td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">GRID_RANK</td><td></td></tr>
  </table>
  </dd>
</dl>
<dl class="section author"><dt>Author</dt><dd>M. Dutour </dd>
<dd>
A. Roland </dd></dl>
<dl class="section date"><dt>Date</dt><dd>20-Feb-2012 </dd></dl>

<p class="definition">Definition at line <a class="el" href="wmscrpmd_8F90_source.html#l01165">1165</a> of file <a class="el" href="wmscrpmd_8F90_source.html">wmscrpmd.F90</a>.</p>
<div class="fragment"><div class="line"><a name="l01165"></a><span class="lineno"> 1165</span>&#160;    <span class="comment">!  1. Original author :</span></div>
<div class="line"><a name="l01166"></a><span class="lineno"> 1166</span>&#160;    <span class="comment">!</span></div>
<div class="line"><a name="l01167"></a><span class="lineno"> 1167</span>&#160;    <span class="comment">!     Mathieu Dutour Sikiric, IRB &amp; Aron Roland, Z&amp;P</span></div>
<div class="line"><a name="l01168"></a><span class="lineno"> 1168</span>&#160;    <span class="comment">!</span></div>
<div class="line"><a name="l01169"></a><span class="lineno"> 1169</span>&#160;    <span class="comment">!  2. Last update :</span></div>
<div class="line"><a name="l01170"></a><span class="lineno"> 1170</span>&#160;    <span class="comment">!</span></div>
<div class="line"><a name="l01171"></a><span class="lineno"> 1171</span>&#160;    <span class="comment">!     See revisions.</span></div>
<div class="line"><a name="l01172"></a><span class="lineno"> 1172</span>&#160;    <span class="comment">!</span></div>
<div class="line"><a name="l01173"></a><span class="lineno"> 1173</span>&#160;    <span class="comment">!  3. Revisions :</span></div>
<div class="line"><a name="l01174"></a><span class="lineno"> 1174</span>&#160;    <span class="comment">!</span></div>
<div class="line"><a name="l01175"></a><span class="lineno"> 1175</span>&#160;    <span class="comment">!     20-Feb-2012 : Origination, this is adapted from Erick Rogers</span></div>
<div class="line"><a name="l01176"></a><span class="lineno"> 1176</span>&#160;    <span class="comment">!                   code by splitting the code into sections.</span></div>
<div class="line"><a name="l01177"></a><span class="lineno"> 1177</span>&#160;    <span class="comment">!</span></div>
<div class="line"><a name="l01178"></a><span class="lineno"> 1178</span>&#160;    <span class="comment">!  4. Copyright :</span></div>
<div class="line"><a name="l01179"></a><span class="lineno"> 1179</span>&#160;    <span class="comment">!</span></div>
<div class="line"><a name="l01180"></a><span class="lineno"> 1180</span>&#160;    <span class="comment">!  5. Purpose :</span></div>
<div class="line"><a name="l01181"></a><span class="lineno"> 1181</span>&#160;    <span class="comment">!</span></div>
<div class="line"><a name="l01182"></a><span class="lineno"> 1182</span>&#160;    <span class="comment">!     Compute grid for scrip for a specific structured grid.</span></div>
<div class="line"><a name="l01183"></a><span class="lineno"> 1183</span>&#160;    <span class="comment">!     This is adapted from Erick Rogers code by making it cleaner.</span></div>
<div class="line"><a name="l01184"></a><span class="lineno"> 1184</span>&#160;    <span class="comment">!</span></div>
<div class="line"><a name="l01185"></a><span class="lineno"> 1185</span>&#160;    <span class="comment">!  6. Method :</span></div>
<div class="line"><a name="l01186"></a><span class="lineno"> 1186</span>&#160;    <span class="comment">!</span></div>
<div class="line"><a name="l01187"></a><span class="lineno"> 1187</span>&#160;    <span class="comment">!  7. Parameters, Variables and types :</span></div>
<div class="line"><a name="l01188"></a><span class="lineno"> 1188</span>&#160;    <span class="comment">!</span></div>
<div class="line"><a name="l01189"></a><span class="lineno"> 1189</span>&#160;    <span class="comment">!  8. Called by :</span></div>
<div class="line"><a name="l01190"></a><span class="lineno"> 1190</span>&#160;    <span class="comment">!</span></div>
<div class="line"><a name="l01191"></a><span class="lineno"> 1191</span>&#160;    <span class="comment">!     Subroutine scrip_wrapper</span></div>
<div class="line"><a name="l01192"></a><span class="lineno"> 1192</span>&#160;    <span class="comment">!</span></div>
<div class="line"><a name="l01193"></a><span class="lineno"> 1193</span>&#160;    <span class="comment">!  9. Subroutines and functions used :</span></div>
<div class="line"><a name="l01194"></a><span class="lineno"> 1194</span>&#160;    <span class="comment">!</span></div>
<div class="line"><a name="l01195"></a><span class="lineno"> 1195</span>&#160;    <span class="comment">! 10. Error messages:</span></div>
<div class="line"><a name="l01196"></a><span class="lineno"> 1196</span>&#160;    <span class="comment">!</span></div>
<div class="line"><a name="l01197"></a><span class="lineno"> 1197</span>&#160;    <span class="comment">! 11. Remarks :</span></div>
<div class="line"><a name="l01198"></a><span class="lineno"> 1198</span>&#160;    <span class="comment">!</span></div>
<div class="line"><a name="l01199"></a><span class="lineno"> 1199</span>&#160;    <span class="comment">! 12. Structure :</span></div>
<div class="line"><a name="l01200"></a><span class="lineno"> 1200</span>&#160;    <span class="comment">!</span></div>
<div class="line"><a name="l01201"></a><span class="lineno"> 1201</span>&#160;    <span class="comment">! 13. Switches :</span></div>
<div class="line"><a name="l01202"></a><span class="lineno"> 1202</span>&#160;    <span class="comment">!</span></div>
<div class="line"><a name="l01203"></a><span class="lineno"> 1203</span>&#160;    <span class="comment">! 14. Source code :</span></div>
<div class="line"><a name="l01204"></a><span class="lineno"> 1204</span>&#160;    <span class="keywordtype">USE </span><a class="code" href="namespacew3servmd.html">w3servmd</a>, <span class="keywordtype">ONLY</span>: extcde</div>
<div class="line"><a name="l01205"></a><span class="lineno"> 1205</span>&#160;    <span class="keywordtype">USE </span><a class="code" href="namespacew3gdatmd.html">w3gdatmd</a>, <span class="keywordtype">ONLY</span> : <a class="code" href="namespacew3gdatmd.html#a4e0be685c06d5b77285bb227dd2b8ac9">grids</a>, <a class="code" href="namespacew3gdatmd.html#ab1451f01c0706fb65b2c7e1fa1ad1ba6">ungtype</a></div>
<div class="line"><a name="l01206"></a><span class="lineno"> 1206</span>&#160;    <span class="keywordtype">IMPLICIT NONE</span></div>
<div class="line"><a name="l01207"></a><span class="lineno"> 1207</span>&#160;    <span class="keywordtype">INTEGER</span>, <span class="keywordtype">INTENT(IN)</span>      :: ID_GRD</div>
<div class="line"><a name="l01208"></a><span class="lineno"> 1208</span>&#160;    real*8, <span class="keywordtype">INTENT(OUT)</span>, <span class="keywordtype">ALLOCATABLE</span> :: grid_center_lon(:)</div>
<div class="line"><a name="l01209"></a><span class="lineno"> 1209</span>&#160;    real*8, <span class="keywordtype">INTENT(OUT)</span>, <span class="keywordtype">ALLOCATABLE</span> :: grid_center_lat(:)</div>
<div class="line"><a name="l01210"></a><span class="lineno"> 1210</span>&#160;    <span class="keywordtype">LOGICAL</span>, <span class="keywordtype">INTENT(OUT)</span>, <span class="keywordtype">ALLOCATABLE</span> :: GRID_MASK(:)</div>
<div class="line"><a name="l01211"></a><span class="lineno"> 1211</span>&#160;    real*8, <span class="keywordtype">INTENT(OUT)</span>, <span class="keywordtype">ALLOCATABLE</span> :: grid_corner_lon(:,:)</div>
<div class="line"><a name="l01212"></a><span class="lineno"> 1212</span>&#160;    real*8, <span class="keywordtype">INTENT(OUT)</span>, <span class="keywordtype">ALLOCATABLE</span> :: grid_corner_lat(:,:)</div>
<div class="line"><a name="l01213"></a><span class="lineno"> 1213</span>&#160;    <span class="keywordtype">INTEGER</span>, <span class="keywordtype">INTENT(OUT)</span>, <span class="keywordtype">ALLOCATABLE</span> :: GRID_DIMS(:)</div>
<div class="line"><a name="l01214"></a><span class="lineno"> 1214</span>&#160;    <span class="keywordtype">INTEGER</span>, <span class="keywordtype">INTENT(OUT)</span> :: GRID_SIZE, GRID_CORNERS, GRID_RANK</div>
<div class="line"><a name="l01215"></a><span class="lineno"> 1215</span>&#160;    real*8 :: dlon1, dlat1, dlon2, dlat2, thedet</div>
<div class="line"><a name="l01216"></a><span class="lineno"> 1216</span>&#160;    <span class="keywordtype">INTEGER</span> :: I, J</div>
<div class="line"><a name="l01217"></a><span class="lineno"> 1217</span>&#160;    <span class="keywordtype">INTEGER</span> :: IC, JC, IP, CHECKSIGNS, NBPLUS, NBMINUS, NBZERO</div>
<div class="line"><a name="l01218"></a><span class="lineno"> 1218</span>&#160;    <span class="keywordtype">INTEGER</span> :: PRINTDATA, PRINTMINMAX</div>
<div class="line"><a name="l01219"></a><span class="lineno"> 1219</span>&#160;    real*8 :: minlon, minlat, maxlon, maxlat</div>
<div class="line"><a name="l01220"></a><span class="lineno"> 1220</span>&#160;    real*8 :: minloncorner, maxloncorner, minlatcorner, maxlatcorner</div>
<div class="line"><a name="l01221"></a><span class="lineno"> 1221</span>&#160;    real*8 :: pt(3,2)</div>
<div class="line"><a name="l01222"></a><span class="lineno"> 1222</span>&#160;    <span class="keywordflow">IF</span> (<a class="code" href="namespacew3gdatmd.html#a4e0be685c06d5b77285bb227dd2b8ac9">grids</a>(id_grd)%GTYPE .EQ. <a class="code" href="namespacew3gdatmd.html#ab1451f01c0706fb65b2c7e1fa1ad1ba6">ungtype</a>) <span class="keywordflow">THEN</span></div>
<div class="line"><a name="l01223"></a><span class="lineno"> 1223</span>&#160;      <span class="keyword">CALL </span><a class="code" href="namespacewmscrpmd.html#a209b96841918917341cee8884ed16b38">get_scrip_info_unstructured</a> (id_grd,                       &amp;</div>
<div class="line"><a name="l01224"></a><span class="lineno"> 1224</span>&#160;           &amp;   grid_center_lon, grid_center_lat,                              &amp;</div>
<div class="line"><a name="l01225"></a><span class="lineno"> 1225</span>&#160;           &amp;   grid_corner_lon, grid_corner_lat, grid_mask,                   &amp;</div>
<div class="line"><a name="l01226"></a><span class="lineno"> 1226</span>&#160;           &amp;   grid_dims, grid_size, grid_corners, grid_rank)</div>
<div class="line"><a name="l01227"></a><span class="lineno"> 1227</span>&#160;    <span class="keywordflow">ELSE</span></div>
<div class="line"><a name="l01228"></a><span class="lineno"> 1228</span>&#160;      <span class="keyword">CALL </span><a class="code" href="namespacewmscrpmd.html#afc26be2e4edc36071a5fd6ab661e29b2">get_scrip_info_structured</a> (id_grd,                         &amp;</div>
<div class="line"><a name="l01229"></a><span class="lineno"> 1229</span>&#160;           &amp;   grid_center_lon, grid_center_lat,                              &amp;</div>
<div class="line"><a name="l01230"></a><span class="lineno"> 1230</span>&#160;           &amp;   grid_corner_lon, grid_corner_lat, grid_mask,                   &amp;</div>
<div class="line"><a name="l01231"></a><span class="lineno"> 1231</span>&#160;           &amp;   grid_dims, grid_size, grid_corners, grid_rank)</div>
<div class="line"><a name="l01232"></a><span class="lineno"> 1232</span>&#160;<span class="keywordflow">    END IF</span></div>
<div class="line"><a name="l01233"></a><span class="lineno"> 1233</span>&#160;    checksigns=1</div>
<div class="line"><a name="l01234"></a><span class="lineno"> 1234</span>&#160;    <span class="keywordflow">IF</span> (checksigns.EQ.1) <span class="keywordflow">THEN</span></div>
<div class="line"><a name="l01235"></a><span class="lineno"> 1235</span>&#160;      nbplus=0</div>
<div class="line"><a name="l01236"></a><span class="lineno"> 1236</span>&#160;      nbminus=0</div>
<div class="line"><a name="l01237"></a><span class="lineno"> 1237</span>&#160;      nbzero=0</div>
<div class="line"><a name="l01238"></a><span class="lineno"> 1238</span>&#160;      <span class="keywordflow">DO</span> ip=1,grid_size</div>
<div class="line"><a name="l01239"></a><span class="lineno"> 1239</span>&#160;        <span class="keywordflow">DO</span> ic=1,grid_corners</div>
<div class="line"><a name="l01240"></a><span class="lineno"> 1240</span>&#160;          <span class="keywordflow">IF</span> (ic.EQ.grid_corners) <span class="keywordflow">THEN</span></div>
<div class="line"><a name="l01241"></a><span class="lineno"> 1241</span>&#160;            jc=1</div>
<div class="line"><a name="l01242"></a><span class="lineno"> 1242</span>&#160;          <span class="keywordflow">ELSE</span></div>
<div class="line"><a name="l01243"></a><span class="lineno"> 1243</span>&#160;            jc=ic+1</div>
<div class="line"><a name="l01244"></a><span class="lineno"> 1244</span>&#160;<span class="keywordflow">          END IF</span></div>
<div class="line"><a name="l01245"></a><span class="lineno"> 1245</span>&#160; </div>
<div class="line"><a name="l01246"></a><span class="lineno"> 1246</span>&#160;          pt(1,1) = grid_center_lon(ip)</div>
<div class="line"><a name="l01247"></a><span class="lineno"> 1247</span>&#160;          pt(1,2) = grid_center_lat(ip)</div>
<div class="line"><a name="l01248"></a><span class="lineno"> 1248</span>&#160;          pt(2,1) = grid_corner_lon(ic,ip)</div>
<div class="line"><a name="l01249"></a><span class="lineno"> 1249</span>&#160;          pt(2,2) = grid_corner_lat(ic,ip)</div>
<div class="line"><a name="l01250"></a><span class="lineno"> 1250</span>&#160;          pt(3,1) = grid_corner_lon(jc,ip)</div>
<div class="line"><a name="l01251"></a><span class="lineno"> 1251</span>&#160;          pt(3,2) = grid_corner_lat(jc,ip)</div>
<div class="line"><a name="l01252"></a><span class="lineno"> 1252</span>&#160; </div>
<div class="line"><a name="l01253"></a><span class="lineno"> 1253</span>&#160;          <span class="keyword">CALL </span><a class="code" href="namespacew3triamd.html#a864329ce5e5bb1ba165095fb128241f0">fix_periodcity</a>(pt)</div>
<div class="line"><a name="l01254"></a><span class="lineno"> 1254</span>&#160; </div>
<div class="line"><a name="l01255"></a><span class="lineno"> 1255</span>&#160;          dlon1=pt(2,1)-pt(1,1)</div>
<div class="line"><a name="l01256"></a><span class="lineno"> 1256</span>&#160;          dlon2=pt(3,1)-pt(1,1)</div>
<div class="line"><a name="l01257"></a><span class="lineno"> 1257</span>&#160;          dlat1=pt(2,2)-pt(1,2)</div>
<div class="line"><a name="l01258"></a><span class="lineno"> 1258</span>&#160;          dlat2=pt(3,2)-pt(1,2)</div>
<div class="line"><a name="l01259"></a><span class="lineno"> 1259</span>&#160; </div>
<div class="line"><a name="l01260"></a><span class="lineno"> 1260</span>&#160;          thedet=dlon1*dlat2 - dlon2*dlat1</div>
<div class="line"><a name="l01261"></a><span class="lineno"> 1261</span>&#160;          <span class="keywordflow">IF</span> (thedet.GT.1d-8) <span class="keywordflow">THEN</span></div>
<div class="line"><a name="l01262"></a><span class="lineno"> 1262</span>&#160;            nbplus=nbplus+1</div>
<div class="line"><a name="l01263"></a><span class="lineno"> 1263</span>&#160;          <span class="keywordflow">ELSE</span> <span class="keywordflow">IF</span> (thedet.LT.-1d-8) <span class="keywordflow">THEN</span></div>
<div class="line"><a name="l01264"></a><span class="lineno"> 1264</span>&#160;            nbminus=nbminus+1</div>
<div class="line"><a name="l01265"></a><span class="lineno"> 1265</span>&#160;          <span class="keywordflow">ELSE</span></div>
<div class="line"><a name="l01266"></a><span class="lineno"> 1266</span>&#160;            nbzero=nbzero+1</div>
<div class="line"><a name="l01267"></a><span class="lineno"> 1267</span>&#160;<span class="keywordflow">          END IF</span></div>
<div class="line"><a name="l01268"></a><span class="lineno"> 1268</span>&#160;<span class="keywordflow">        END DO</span></div>
<div class="line"><a name="l01269"></a><span class="lineno"> 1269</span>&#160;<span class="keywordflow">      END DO</span></div>
<div class="line"><a name="l01270"></a><span class="lineno"> 1270</span>&#160; </div>
<div class="line"><a name="l01271"></a><span class="lineno"> 1271</span>&#160;      <span class="keyword">WRITE</span>(*,*) <span class="stringliteral">&#39;SI nbPlus=&#39;</span>, nbplus, <span class="stringliteral">&#39; nbMinus=&#39;</span>, nbminus, <span class="stringliteral">&#39; nbZero=&#39;</span>, nbzero</div>
<div class="line"><a name="l01272"></a><span class="lineno"> 1272</span>&#160; </div>
<div class="line"><a name="l01273"></a><span class="lineno"> 1273</span>&#160;<span class="keywordflow">    END IF</span></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="w3servmd_8F90_source.html#l00736">w3servmd::extcde()</a>, <a class="el" href="wmscrpmd_8F90_source.html#l01711">fix_periodcity()</a>, <a class="el" href="wmscrpmd_8F90_source.html#l00974">get_scrip_info_structured()</a>, <a class="el" href="wmscrpmd_8F90_source.html#l00551">get_scrip_info_unstructured()</a>, <a class="el" href="w3gdatmd_8F90_source.html#l01088">w3gdatmd::grids</a>, and <a class="el" href="w3gdatmd_8F90_source.html#l00626">w3gdatmd::ungtype</a>.</p>

<p class="reference">Referenced by <a class="el" href="wmscrpmd_8F90_source.html#l00115">scrip_wrapper()</a>.</p>

</div>
</div>
<a id="afc26be2e4edc36071a5fd6ab661e29b2"></a>
<h2 class="memtitle"><span class="permalink"><a href="#afc26be2e4edc36071a5fd6ab661e29b2">&#9670;&nbsp;</a></span>get_scrip_info_structured()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">subroutine wmscrpmd::get_scrip_info_structured </td>
          <td>(</td>
          <td class="paramtype">integer, intent(in)&#160;</td>
          <td class="paramname"><em>ID_GRD</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real*8, dimension(:), intent(out), allocatable&#160;</td>
          <td class="paramname"><em>GRID_CENTER_LON</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real*8, dimension(:), intent(out), allocatable&#160;</td>
          <td class="paramname"><em>GRID_CENTER_LAT</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real*8, dimension(:,:), intent(out), allocatable&#160;</td>
          <td class="paramname"><em>GRID_CORNER_LON</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real*8, dimension(:,:), intent(out), allocatable&#160;</td>
          <td class="paramname"><em>GRID_CORNER_LAT</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">logical, dimension(:), intent(out), allocatable&#160;</td>
          <td class="paramname"><em>GRID_MASK</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">integer, dimension(:), intent(out), allocatable&#160;</td>
          <td class="paramname"><em>GRID_DIMS</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">integer, intent(out)&#160;</td>
          <td class="paramname"><em>GRID_SIZE</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">integer, intent(out)&#160;</td>
          <td class="paramname"><em>GRID_CORNERS</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">integer, intent(out)&#160;</td>
          <td class="paramname"><em>GRID_RANK</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Compute grid arrays needed for scrip for a specific structured grid. </p>
<p>This is adapted from Erick Rogers original code by splitting the original scrip_wrapper function.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">ID_GRD</td><td></td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">GRID_CENTER_LON</td><td></td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">GRID_CENTER_LAT</td><td></td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">GRID_CORNER_LON</td><td></td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">GRID_CORNER_LAT</td><td></td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">GRID_MASK</td><td></td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">GRID_DIMS</td><td></td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">GRID_SIZE</td><td></td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">GRID_CORNERS</td><td></td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">GRID_RANK</td><td></td></tr>
  </table>
  </dd>
</dl>
<dl class="section author"><dt>Author</dt><dd>M. Dutour </dd>
<dd>
A. Roland </dd></dl>
<dl class="section date"><dt>Date</dt><dd>10-Dec-2014 </dd></dl>

<p class="definition">Definition at line <a class="el" href="wmscrpmd_8F90_source.html#l00974">974</a> of file <a class="el" href="wmscrpmd_8F90_source.html">wmscrpmd.F90</a>.</p>
<div class="fragment"><div class="line"><a name="l00974"></a><span class="lineno">  974</span>&#160;    <span class="comment">!/                  +-----------------------------------+</span></div>
<div class="line"><a name="l00975"></a><span class="lineno">  975</span>&#160;    <span class="comment">!/                  | WAVEWATCH III                     |</span></div>
<div class="line"><a name="l00976"></a><span class="lineno">  976</span>&#160;    <span class="comment">!/                  | M. Dutour, A. Roland              |</span></div>
<div class="line"><a name="l00977"></a><span class="lineno">  977</span>&#160;    <span class="comment">!/                  |                        FORTRAN 90 |</span></div>
<div class="line"><a name="l00978"></a><span class="lineno">  978</span>&#160;    <span class="comment">!/                  | Last update :         10-Dec-2014 !</span></div>
<div class="line"><a name="l00979"></a><span class="lineno">  979</span>&#160;    <span class="comment">!/                  +-----------------------------------+</span></div>
<div class="line"><a name="l00980"></a><span class="lineno">  980</span>&#160;    <span class="comment">!/</span></div>
<div class="line"><a name="l00981"></a><span class="lineno">  981</span>&#160;    <span class="comment">!  1. Original author :</span></div>
<div class="line"><a name="l00982"></a><span class="lineno">  982</span>&#160;    <span class="comment">!</span></div>
<div class="line"><a name="l00983"></a><span class="lineno">  983</span>&#160;    <span class="comment">!     Mathieu Dutour Sikiric, IRB &amp; Aron Roland, Z&amp;P</span></div>
<div class="line"><a name="l00984"></a><span class="lineno">  984</span>&#160;    <span class="comment">!</span></div>
<div class="line"><a name="l00985"></a><span class="lineno">  985</span>&#160;    <span class="comment">!  2. Last update :</span></div>
<div class="line"><a name="l00986"></a><span class="lineno">  986</span>&#160;    <span class="comment">!</span></div>
<div class="line"><a name="l00987"></a><span class="lineno">  987</span>&#160;    <span class="comment">!     See revisions.</span></div>
<div class="line"><a name="l00988"></a><span class="lineno">  988</span>&#160;    <span class="comment">!</span></div>
<div class="line"><a name="l00989"></a><span class="lineno">  989</span>&#160;    <span class="comment">!  3. Revisions :</span></div>
<div class="line"><a name="l00990"></a><span class="lineno">  990</span>&#160;    <span class="comment">!</span></div>
<div class="line"><a name="l00991"></a><span class="lineno">  991</span>&#160;    <span class="comment">!     20-Feb-2012 : Origination, this is adapted from Erick Rogers</span></div>
<div class="line"><a name="l00992"></a><span class="lineno">  992</span>&#160;    <span class="comment">!                   code by splitting the code into sections.</span></div>
<div class="line"><a name="l00993"></a><span class="lineno">  993</span>&#160;    <span class="comment">!/    10-Dec-2014 : Add checks for allocate status      ( version 5.04 )</span></div>
<div class="line"><a name="l00994"></a><span class="lineno">  994</span>&#160;    <span class="comment">!</span></div>
<div class="line"><a name="l00995"></a><span class="lineno">  995</span>&#160;    <span class="comment">!  4. Copyright :</span></div>
<div class="line"><a name="l00996"></a><span class="lineno">  996</span>&#160;    <span class="comment">!</span></div>
<div class="line"><a name="l00997"></a><span class="lineno">  997</span>&#160;    <span class="comment">!  5. Purpose :</span></div>
<div class="line"><a name="l00998"></a><span class="lineno">  998</span>&#160;    <span class="comment">!</span></div>
<div class="line"><a name="l00999"></a><span class="lineno">  999</span>&#160;    <span class="comment">!     Compute grid arrays needed for scrip for a specific structured grid.</span></div>
<div class="line"><a name="l01000"></a><span class="lineno"> 1000</span>&#160;    <span class="comment">!     This is adapted from Erick Rogers original code by splitting</span></div>
<div class="line"><a name="l01001"></a><span class="lineno"> 1001</span>&#160;    <span class="comment">!     the original scrip_wrapper function</span></div>
<div class="line"><a name="l01002"></a><span class="lineno"> 1002</span>&#160;    <span class="comment">!</span></div>
<div class="line"><a name="l01003"></a><span class="lineno"> 1003</span>&#160;    <span class="comment">!  6. Method :</span></div>
<div class="line"><a name="l01004"></a><span class="lineno"> 1004</span>&#160;    <span class="comment">!</span></div>
<div class="line"><a name="l01005"></a><span class="lineno"> 1005</span>&#160;    <span class="comment">!  7. Parameters, Variables and types :</span></div>
<div class="line"><a name="l01006"></a><span class="lineno"> 1006</span>&#160;    <span class="comment">!</span></div>
<div class="line"><a name="l01007"></a><span class="lineno"> 1007</span>&#160;    <span class="comment">!  8. Called by :</span></div>
<div class="line"><a name="l01008"></a><span class="lineno"> 1008</span>&#160;    <span class="comment">!</span></div>
<div class="line"><a name="l01009"></a><span class="lineno"> 1009</span>&#160;    <span class="comment">!     Subroutine get_scrip_info</span></div>
<div class="line"><a name="l01010"></a><span class="lineno"> 1010</span>&#160;    <span class="comment">!</span></div>
<div class="line"><a name="l01011"></a><span class="lineno"> 1011</span>&#160;    <span class="comment">!  9. Subroutines and functions used :</span></div>
<div class="line"><a name="l01012"></a><span class="lineno"> 1012</span>&#160;    <span class="comment">!</span></div>
<div class="line"><a name="l01013"></a><span class="lineno"> 1013</span>&#160;    <span class="comment">! 10. Error messages:</span></div>
<div class="line"><a name="l01014"></a><span class="lineno"> 1014</span>&#160;    <span class="comment">!</span></div>
<div class="line"><a name="l01015"></a><span class="lineno"> 1015</span>&#160;    <span class="comment">! 11. Remarks :</span></div>
<div class="line"><a name="l01016"></a><span class="lineno"> 1016</span>&#160;    <span class="comment">!</span></div>
<div class="line"><a name="l01017"></a><span class="lineno"> 1017</span>&#160;    <span class="comment">! 12. Structure :</span></div>
<div class="line"><a name="l01018"></a><span class="lineno"> 1018</span>&#160;    <span class="comment">!</span></div>
<div class="line"><a name="l01019"></a><span class="lineno"> 1019</span>&#160;    <span class="comment">! 13. Switches :</span></div>
<div class="line"><a name="l01020"></a><span class="lineno"> 1020</span>&#160;    <span class="comment">!</span></div>
<div class="line"><a name="l01021"></a><span class="lineno"> 1021</span>&#160;    <span class="comment">! 14. Source code :</span></div>
<div class="line"><a name="l01022"></a><span class="lineno"> 1022</span>&#160;    <span class="keywordtype">USE </span><a class="code" href="namespacew3servmd.html">w3servmd</a>, <span class="keywordtype">ONLY</span>: extcde</div>
<div class="line"><a name="l01023"></a><span class="lineno"> 1023</span>&#160;    <span class="keywordtype">USE </span><a class="code" href="namespacew3gdatmd.html">w3gdatmd</a>, <span class="keywordtype">ONLY</span> : <a class="code" href="namespacew3gdatmd.html#a4e0be685c06d5b77285bb227dd2b8ac9">grids</a></div>
<div class="line"><a name="l01024"></a><span class="lineno"> 1024</span>&#160;    <span class="keywordtype">USE </span><a class="code" href="namespacescrip__constants.html">scrip_constants</a>, <span class="keywordtype">ONLY</span> : <a class="code" href="namespacescrip__constants.html#a99a1a0f01091bf19bea3be8dfdd6147f">half</a></div>
<div class="line"><a name="l01025"></a><span class="lineno"> 1025</span>&#160;    <span class="keywordtype">IMPLICIT NONE</span></div>
<div class="line"><a name="l01026"></a><span class="lineno"> 1026</span>&#160;    <span class="keywordtype">INTEGER</span>, <span class="keywordtype">INTENT(IN)</span>      :: ID_GRD</div>
<div class="line"><a name="l01027"></a><span class="lineno"> 1027</span>&#160;    real*8, <span class="keywordtype">INTENT(OUT)</span>, <span class="keywordtype">ALLOCATABLE</span> :: grid_center_lon(:)</div>
<div class="line"><a name="l01028"></a><span class="lineno"> 1028</span>&#160;    real*8, <span class="keywordtype">INTENT(OUT)</span>, <span class="keywordtype">ALLOCATABLE</span> :: grid_center_lat(:)</div>
<div class="line"><a name="l01029"></a><span class="lineno"> 1029</span>&#160;    <span class="keywordtype">LOGICAL</span>, <span class="keywordtype">INTENT(OUT)</span>, <span class="keywordtype">ALLOCATABLE</span> :: GRID_MASK(:)</div>
<div class="line"><a name="l01030"></a><span class="lineno"> 1030</span>&#160;    real*8, <span class="keywordtype">INTENT(OUT)</span>, <span class="keywordtype">ALLOCATABLE</span> :: grid_corner_lon(:,:)</div>
<div class="line"><a name="l01031"></a><span class="lineno"> 1031</span>&#160;    real*8, <span class="keywordtype">INTENT(OUT)</span>, <span class="keywordtype">ALLOCATABLE</span> :: grid_corner_lat(:,:)</div>
<div class="line"><a name="l01032"></a><span class="lineno"> 1032</span>&#160;    <span class="keywordtype">INTEGER</span>, <span class="keywordtype">INTENT(OUT)</span>, <span class="keywordtype">ALLOCATABLE</span> :: GRID_DIMS(:)</div>
<div class="line"><a name="l01033"></a><span class="lineno"> 1033</span>&#160;    <span class="keywordtype">INTEGER</span>, <span class="keywordtype">INTENT(OUT)</span> :: GRID_SIZE, GRID_CORNERS, GRID_RANK</div>
<div class="line"><a name="l01034"></a><span class="lineno"> 1034</span>&#160;    <span class="comment">!</span></div>
<div class="line"><a name="l01035"></a><span class="lineno"> 1035</span>&#160;    real*8, <span class="keywordtype">ALLOCATABLE</span>    :: xin_grd(:,:), yin_grd(:,:)</div>
<div class="line"><a name="l01036"></a><span class="lineno"> 1036</span>&#160;    real*8, <span class="keywordtype">ALLOCATABLE</span>    :: dxdp_grd(:,:), dxdq_grd(:,:)</div>
<div class="line"><a name="l01037"></a><span class="lineno"> 1037</span>&#160;    real*8, <span class="keywordtype">ALLOCATABLE</span>    :: dydp_grd(:,:), dydq_grd(:,:)</div>
<div class="line"><a name="l01038"></a><span class="lineno"> 1038</span>&#160;    <span class="keywordtype">INTEGER</span> :: N1, N2, NI, NJ</div>
<div class="line"><a name="l01039"></a><span class="lineno"> 1039</span>&#160;    <span class="keywordtype">INTEGER</span> :: IREC, J, I</div>
<div class="line"><a name="l01040"></a><span class="lineno"> 1040</span>&#160;    grid_rank=2</div>
<div class="line"><a name="l01041"></a><span class="lineno"> 1041</span>&#160;    n1=<span class="keyword">SIZE</span>(<a class="code" href="namespacew3gdatmd.html#a4e0be685c06d5b77285bb227dd2b8ac9">grids</a>(id_grd)%XGRD,1)</div>
<div class="line"><a name="l01042"></a><span class="lineno"> 1042</span>&#160;    n2=<span class="keyword">SIZE</span>(<a class="code" href="namespacew3gdatmd.html#a4e0be685c06d5b77285bb227dd2b8ac9">grids</a>(id_grd)%XGRD,2)</div>
<div class="line"><a name="l01043"></a><span class="lineno"> 1043</span>&#160;    <span class="keyword">ALLOCATE</span>(xin_grd(n1,n2), stat=istat)</div>
<div class="line"><a name="l01044"></a><span class="lineno"> 1044</span>&#160;    check_alloc_status( istat )</div>
<div class="line"><a name="l01045"></a><span class="lineno"> 1045</span>&#160;    <span class="keyword">ALLOCATE</span>(yin_grd(n1,n2), stat=istat)</div>
<div class="line"><a name="l01046"></a><span class="lineno"> 1046</span>&#160;    check_alloc_status( istat )</div>
<div class="line"><a name="l01047"></a><span class="lineno"> 1047</span>&#160;    <span class="keyword">ALLOCATE</span>(dxdp_grd(n1,n2), stat=istat)</div>
<div class="line"><a name="l01048"></a><span class="lineno"> 1048</span>&#160;    check_alloc_status( istat )</div>
<div class="line"><a name="l01049"></a><span class="lineno"> 1049</span>&#160;    <span class="keyword">ALLOCATE</span>(dxdq_grd(n1,n2), stat=istat)</div>
<div class="line"><a name="l01050"></a><span class="lineno"> 1050</span>&#160;    check_alloc_status( istat )</div>
<div class="line"><a name="l01051"></a><span class="lineno"> 1051</span>&#160;    <span class="keyword">ALLOCATE</span>(dydp_grd(n1,n2), stat=istat)</div>
<div class="line"><a name="l01052"></a><span class="lineno"> 1052</span>&#160;    check_alloc_status( istat )</div>
<div class="line"><a name="l01053"></a><span class="lineno"> 1053</span>&#160;    <span class="keyword">ALLOCATE</span>(dydq_grd(n1,n2), stat=istat)</div>
<div class="line"><a name="l01054"></a><span class="lineno"> 1054</span>&#160;    check_alloc_status( istat )</div>
<div class="line"><a name="l01055"></a><span class="lineno"> 1055</span>&#160; </div>
<div class="line"><a name="l01056"></a><span class="lineno"> 1056</span>&#160;    xin_grd=dble(<a class="code" href="namespacew3gdatmd.html#a4e0be685c06d5b77285bb227dd2b8ac9">grids</a>(id_grd)%XGRD)</div>
<div class="line"><a name="l01057"></a><span class="lineno"> 1057</span>&#160;    yin_grd=dble(<a class="code" href="namespacew3gdatmd.html#a4e0be685c06d5b77285bb227dd2b8ac9">grids</a>(id_grd)%YGRD)</div>
<div class="line"><a name="l01058"></a><span class="lineno"> 1058</span>&#160;    dxdp_grd=dble(<a class="code" href="namespacew3gdatmd.html#a4e0be685c06d5b77285bb227dd2b8ac9">grids</a>(id_grd)%DXDP)</div>
<div class="line"><a name="l01059"></a><span class="lineno"> 1059</span>&#160;    dxdq_grd=dble(<a class="code" href="namespacew3gdatmd.html#a4e0be685c06d5b77285bb227dd2b8ac9">grids</a>(id_grd)%DXDQ)</div>
<div class="line"><a name="l01060"></a><span class="lineno"> 1060</span>&#160;    dydp_grd=dble(<a class="code" href="namespacew3gdatmd.html#a4e0be685c06d5b77285bb227dd2b8ac9">grids</a>(id_grd)%DYDP)</div>
<div class="line"><a name="l01061"></a><span class="lineno"> 1061</span>&#160;    dydq_grd=dble(<a class="code" href="namespacew3gdatmd.html#a4e0be685c06d5b77285bb227dd2b8ac9">grids</a>(id_grd)%DYDQ)</div>
<div class="line"><a name="l01062"></a><span class="lineno"> 1062</span>&#160; </div>
<div class="line"><a name="l01063"></a><span class="lineno"> 1063</span>&#160;    <span class="keyword">ALLOCATE</span>(grid_dims(grid_rank), stat=istat)</div>
<div class="line"><a name="l01064"></a><span class="lineno"> 1064</span>&#160;    check_alloc_status( istat )</div>
<div class="line"><a name="l01065"></a><span class="lineno"> 1065</span>&#160;    grid_dims(1)=n2</div>
<div class="line"><a name="l01066"></a><span class="lineno"> 1066</span>&#160;    ni=n2</div>
<div class="line"><a name="l01067"></a><span class="lineno"> 1067</span>&#160;    grid_dims(2)=n1</div>
<div class="line"><a name="l01068"></a><span class="lineno"> 1068</span>&#160;    nj=n1</div>
<div class="line"><a name="l01069"></a><span class="lineno"> 1069</span>&#160; </div>
<div class="line"><a name="l01070"></a><span class="lineno"> 1070</span>&#160;    grid_size=ni*nj <span class="comment">! hardwired: logically rectangular grid</span></div>
<div class="line"><a name="l01071"></a><span class="lineno"> 1071</span>&#160;    grid_corners=4  <span class="comment">! hardwired: each cell has 4 corners</span></div>
<div class="line"><a name="l01072"></a><span class="lineno"> 1072</span>&#160; </div>
<div class="line"><a name="l01073"></a><span class="lineno"> 1073</span>&#160;    <span class="comment">!.....notes: unfortunately, scrip only works for spherical coordinates.</span></div>
<div class="line"><a name="l01074"></a><span class="lineno"> 1074</span>&#160;    <span class="comment">!         thus, if we want to have a multi-grid case in meters, we have to</span></div>
<div class="line"><a name="l01075"></a><span class="lineno"> 1075</span>&#160;    <span class="comment">!         fake it. fortunately, it should be pretty rare to have a multi-grid</span></div>
<div class="line"><a name="l01076"></a><span class="lineno"> 1076</span>&#160;    <span class="comment">!         case in meters.</span></div>
<div class="line"><a name="l01077"></a><span class="lineno"> 1077</span>&#160; </div>
<div class="line"><a name="l01078"></a><span class="lineno"> 1078</span>&#160;    <span class="keyword">ALLOCATE</span>(grid_center_lon(ni*nj), stat=istat)</div>
<div class="line"><a name="l01079"></a><span class="lineno"> 1079</span>&#160;    check_alloc_status( istat )</div>
<div class="line"><a name="l01080"></a><span class="lineno"> 1080</span>&#160;    <span class="keyword">ALLOCATE</span>(grid_center_lat(ni*nj), stat=istat)</div>
<div class="line"><a name="l01081"></a><span class="lineno"> 1081</span>&#160;    check_alloc_status( istat )</div>
<div class="line"><a name="l01082"></a><span class="lineno"> 1082</span>&#160;    <span class="keyword">ALLOCATE</span>(grid_corner_lon(4,ni*nj), stat=istat)</div>
<div class="line"><a name="l01083"></a><span class="lineno"> 1083</span>&#160;    check_alloc_status( istat )</div>
<div class="line"><a name="l01084"></a><span class="lineno"> 1084</span>&#160;    <span class="keyword">ALLOCATE</span>(grid_corner_lat(4,ni*nj), stat=istat)</div>
<div class="line"><a name="l01085"></a><span class="lineno"> 1085</span>&#160;    check_alloc_status( istat )</div>
<div class="line"><a name="l01086"></a><span class="lineno"> 1086</span>&#160;    <span class="keyword">ALLOCATE</span>(grid_mask(ni*nj), stat=istat)</div>
<div class="line"><a name="l01087"></a><span class="lineno"> 1087</span>&#160;    check_alloc_status( istat )</div>
<div class="line"><a name="l01088"></a><span class="lineno"> 1088</span>&#160; </div>
<div class="line"><a name="l01089"></a><span class="lineno"> 1089</span>&#160;    <span class="comment">!.....notes: this &quot;gridshift&quot; variable is included because SCRIP sometimes</span></div>
<div class="line"><a name="l01090"></a><span class="lineno"> 1090</span>&#160;    <span class="comment">!            has trouble when grids cell locations are identical between</span></div>
<div class="line"><a name="l01091"></a><span class="lineno"> 1091</span>&#160;    <span class="comment">!            the two grids. Thus we apply this to one of the two grids.</span></div>
<div class="line"><a name="l01092"></a><span class="lineno"> 1092</span>&#160; </div>
<div class="line"><a name="l01093"></a><span class="lineno"> 1093</span>&#160;    <span class="comment">!.....notes: The following block of code could be converted to a subroutine.</span></div>
<div class="line"><a name="l01094"></a><span class="lineno"> 1094</span>&#160;    <span class="comment">!            Since it is called twice, this would save a little space.</span></div>
<div class="line"><a name="l01095"></a><span class="lineno"> 1095</span>&#160;    irec=0</div>
<div class="line"><a name="l01096"></a><span class="lineno"> 1096</span>&#160;    <span class="keywordflow">DO</span> j=1,nj</div>
<div class="line"><a name="l01097"></a><span class="lineno"> 1097</span>&#160;      <span class="keywordflow">DO</span> i=1,ni</div>
<div class="line"><a name="l01098"></a><span class="lineno"> 1098</span>&#160;        irec=irec+1</div>
<div class="line"><a name="l01099"></a><span class="lineno"> 1099</span>&#160;        grid_center_lon(irec)=xin_grd(j,i)</div>
<div class="line"><a name="l01100"></a><span class="lineno"> 1100</span>&#160;        grid_center_lat(irec)=yin_grd(j,i)</div>
<div class="line"><a name="l01101"></a><span class="lineno"> 1101</span>&#160;        grid_mask(irec)=.true.</div>
<div class="line"><a name="l01102"></a><span class="lineno"> 1102</span>&#160; </div>
<div class="line"><a name="l01103"></a><span class="lineno"> 1103</span>&#160;        <span class="comment">!..notes: normally, we&#39;d apply the mask like this:</span></div>
<div class="line"><a name="l01104"></a><span class="lineno"> 1104</span>&#160;        <span class="comment">!           if(abs(mapsta_src(j,i)).eq.1)then</span></div>
<div class="line"><a name="l01105"></a><span class="lineno"> 1105</span>&#160;        <span class="comment">!              grid1_mask(irec)=.true.</span></div>
<div class="line"><a name="l01106"></a><span class="lineno"> 1106</span>&#160;        <span class="comment">!           else</span></div>
<div class="line"><a name="l01107"></a><span class="lineno"> 1107</span>&#160;        <span class="comment">!              grid1_mask(irec)=.false.</span></div>
<div class="line"><a name="l01108"></a><span class="lineno"> 1108</span>&#160;        <span class="comment">!           endif</span></div>
<div class="line"><a name="l01109"></a><span class="lineno"> 1109</span>&#160;        <span class="comment">!..but unfortunately, WMGHGH needs information about the overlaying high-res</span></div>
<div class="line"><a name="l01110"></a><span class="lineno"> 1110</span>&#160;        <span class="comment">!           cells, even those that are masked, for calculating</span></div>
<div class="line"><a name="l01111"></a><span class="lineno"> 1111</span>&#160;        <span class="comment">!           NRL, NR0, NR1, NR2.</span></div>
<div class="line"><a name="l01112"></a><span class="lineno"> 1112</span>&#160; </div>
<div class="line"><a name="l01113"></a><span class="lineno"> 1113</span>&#160;        <span class="comment">!...........corner 1 : halfway to i-1,j-1</span></div>
<div class="line"><a name="l01114"></a><span class="lineno"> 1114</span>&#160;        grid_corner_lon(1,irec)=grid_center_lon(irec)-              &amp;</div>
<div class="line"><a name="l01115"></a><span class="lineno"> 1115</span>&#160;             &amp;        <a class="code" href="namespacescrip__constants.html#a99a1a0f01091bf19bea3be8dfdd6147f">half</a>*dxdp_grd(j,i)-<a class="code" href="namespacescrip__constants.html#a99a1a0f01091bf19bea3be8dfdd6147f">half</a>*dxdq_grd(j,i)</div>
<div class="line"><a name="l01116"></a><span class="lineno"> 1116</span>&#160;        grid_corner_lat(1,irec)=grid_center_lat(irec)-              &amp;</div>
<div class="line"><a name="l01117"></a><span class="lineno"> 1117</span>&#160;             &amp;        <a class="code" href="namespacescrip__constants.html#a99a1a0f01091bf19bea3be8dfdd6147f">half</a>*dydp_grd(j,i)-<a class="code" href="namespacescrip__constants.html#a99a1a0f01091bf19bea3be8dfdd6147f">half</a>*dydq_grd(j,i)</div>
<div class="line"><a name="l01118"></a><span class="lineno"> 1118</span>&#160; </div>
<div class="line"><a name="l01119"></a><span class="lineno"> 1119</span>&#160;        <span class="comment">!...........corner 2: halfway to i+1,j-1</span></div>
<div class="line"><a name="l01120"></a><span class="lineno"> 1120</span>&#160;        grid_corner_lon(2,irec)=grid_center_lon(irec)+              &amp;</div>
<div class="line"><a name="l01121"></a><span class="lineno"> 1121</span>&#160;             &amp;        <a class="code" href="namespacescrip__constants.html#a99a1a0f01091bf19bea3be8dfdd6147f">half</a>*dxdp_grd(j,i)-<a class="code" href="namespacescrip__constants.html#a99a1a0f01091bf19bea3be8dfdd6147f">half</a>*dxdq_grd(j,i)</div>
<div class="line"><a name="l01122"></a><span class="lineno"> 1122</span>&#160;        grid_corner_lat(2,irec)=grid_center_lat(irec)+              &amp;</div>
<div class="line"><a name="l01123"></a><span class="lineno"> 1123</span>&#160;             &amp;        <a class="code" href="namespacescrip__constants.html#a99a1a0f01091bf19bea3be8dfdd6147f">half</a>*dydp_grd(j,i)-<a class="code" href="namespacescrip__constants.html#a99a1a0f01091bf19bea3be8dfdd6147f">half</a>*dydq_grd(j,i)</div>
<div class="line"><a name="l01124"></a><span class="lineno"> 1124</span>&#160; </div>
<div class="line"><a name="l01125"></a><span class="lineno"> 1125</span>&#160;        <span class="comment">!...........corner 3: halfway to i+1,j+1</span></div>
<div class="line"><a name="l01126"></a><span class="lineno"> 1126</span>&#160;        grid_corner_lon(3,irec)=grid_center_lon(irec)+              &amp;</div>
<div class="line"><a name="l01127"></a><span class="lineno"> 1127</span>&#160;             &amp;        <a class="code" href="namespacescrip__constants.html#a99a1a0f01091bf19bea3be8dfdd6147f">half</a>*dxdp_grd(j,i)+<a class="code" href="namespacescrip__constants.html#a99a1a0f01091bf19bea3be8dfdd6147f">half</a>*dxdq_grd(j,i)</div>
<div class="line"><a name="l01128"></a><span class="lineno"> 1128</span>&#160;        grid_corner_lat(3,irec)=grid_center_lat(irec)+              &amp;</div>
<div class="line"><a name="l01129"></a><span class="lineno"> 1129</span>&#160;             &amp;        <a class="code" href="namespacescrip__constants.html#a99a1a0f01091bf19bea3be8dfdd6147f">half</a>*dydp_grd(j,i)+<a class="code" href="namespacescrip__constants.html#a99a1a0f01091bf19bea3be8dfdd6147f">half</a>*dydq_grd(j,i)</div>
<div class="line"><a name="l01130"></a><span class="lineno"> 1130</span>&#160; </div>
<div class="line"><a name="l01131"></a><span class="lineno"> 1131</span>&#160;        <span class="comment">!...........corner 4: halfway to i-1,j+1</span></div>
<div class="line"><a name="l01132"></a><span class="lineno"> 1132</span>&#160;        grid_corner_lon(4,irec)=grid_center_lon(irec)-              &amp;</div>
<div class="line"><a name="l01133"></a><span class="lineno"> 1133</span>&#160;             &amp;        <a class="code" href="namespacescrip__constants.html#a99a1a0f01091bf19bea3be8dfdd6147f">half</a>*dxdp_grd(j,i)+<a class="code" href="namespacescrip__constants.html#a99a1a0f01091bf19bea3be8dfdd6147f">half</a>*dxdq_grd(j,i)</div>
<div class="line"><a name="l01134"></a><span class="lineno"> 1134</span>&#160;        grid_corner_lat(4,irec)=grid_center_lat(irec)-              &amp;</div>
<div class="line"><a name="l01135"></a><span class="lineno"> 1135</span>&#160;             &amp;        <a class="code" href="namespacescrip__constants.html#a99a1a0f01091bf19bea3be8dfdd6147f">half</a>*dydp_grd(j,i)+<a class="code" href="namespacescrip__constants.html#a99a1a0f01091bf19bea3be8dfdd6147f">half</a>*dydq_grd(j,i)</div>
<div class="line"><a name="l01136"></a><span class="lineno"> 1136</span>&#160;<span class="keywordflow">      END DO</span></div>
<div class="line"><a name="l01137"></a><span class="lineno"> 1137</span>&#160;<span class="keywordflow">    END DO</span></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="w3servmd_8F90_source.html#l00736">w3servmd::extcde()</a>, <a class="el" href="w3gdatmd_8F90_source.html#l01088">w3gdatmd::grids</a>, and <a class="el" href="scrip__constants_8f_source.html#l00050">scrip_constants::half</a>.</p>

<p class="reference">Referenced by <a class="el" href="wmscrpmd_8F90_source.html#l01165">get_scrip_info()</a>.</p>

</div>
</div>
<a id="a209b96841918917341cee8884ed16b38"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a209b96841918917341cee8884ed16b38">&#9670;&nbsp;</a></span>get_scrip_info_unstructured()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">subroutine wmscrpmd::get_scrip_info_unstructured </td>
          <td>(</td>
          <td class="paramtype">integer, intent(in)&#160;</td>
          <td class="paramname"><em>ID_GRD</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real*8, dimension(:), intent(out), allocatable&#160;</td>
          <td class="paramname"><em>GRID_CENTER_LON</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real*8, dimension(:), intent(out), allocatable&#160;</td>
          <td class="paramname"><em>GRID_CENTER_LAT</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real*8, dimension(:,:), intent(out), allocatable&#160;</td>
          <td class="paramname"><em>GRID_CORNER_LON</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real*8, dimension(:,:), intent(out), allocatable&#160;</td>
          <td class="paramname"><em>GRID_CORNER_LAT</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">logical, dimension(:), intent(out), allocatable&#160;</td>
          <td class="paramname"><em>GRID_MASK</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">integer, dimension(:), intent(out), allocatable&#160;</td>
          <td class="paramname"><em>GRID_DIMS</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">integer, intent(out)&#160;</td>
          <td class="paramname"><em>GRID_SIZE</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">integer, intent(out)&#160;</td>
          <td class="paramname"><em>GRID_CORNERS</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">integer, intent(out)&#160;</td>
          <td class="paramname"><em>GRID_RANK</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Compute grid arrays for scrip for a specific unstructured grid. </p>
<p>For interior vertices, we select for every triangle the barycenter of the triangle. So to every node contained in N triangles we associate a domain with N corners. Every one of those corners is contained in 3 different domains.</p>
<p>For nodes that are on the boundary, we have to proceed differently. For every such node, we have NEIGHBOR_PREV and NEIGHBOR_NEXT which are the neighbor on each side of the boundary. We put a corner on the middle of the edge. We also put a corner on the node itself.</p>
<p>Note that instead of taking barycenters, we could have taken Voronoi vertices, but this carries danger since Voronoi vertices can be outside of the triangle. And it leaves open how to treat the boundary.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">ID_GRD</td><td></td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">GRID_CENTER_LON</td><td></td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">GRID_CENTER_LAT</td><td></td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">GRID_CORNER_LON</td><td></td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">GRID_CORNER_LAT</td><td></td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">GRID_MASK</td><td></td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">GRID_DIMS</td><td></td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">GRID_SIZE</td><td></td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">GRID_CORNERS</td><td></td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">GRID_RANK</td><td></td></tr>
  </table>
  </dd>
</dl>
<dl class="section author"><dt>Author</dt><dd>M. Dutour </dd>
<dd>
A. Roland </dd></dl>
<dl class="section date"><dt>Date</dt><dd>10-Dec-2014 </dd></dl>

<p class="definition">Definition at line <a class="el" href="wmscrpmd_8F90_source.html#l00551">551</a> of file <a class="el" href="wmscrpmd_8F90_source.html">wmscrpmd.F90</a>.</p>
<div class="fragment"><div class="line"><a name="l00551"></a><span class="lineno">  551</span>&#160;    <span class="comment">!/                  +-----------------------------------+</span></div>
<div class="line"><a name="l00552"></a><span class="lineno">  552</span>&#160;    <span class="comment">!/                  | WAVEWATCH III                     |</span></div>
<div class="line"><a name="l00553"></a><span class="lineno">  553</span>&#160;    <span class="comment">!/                  | M. Dutour, A. Roland              |</span></div>
<div class="line"><a name="l00554"></a><span class="lineno">  554</span>&#160;    <span class="comment">!/                  |                        FORTRAN 90 |</span></div>
<div class="line"><a name="l00555"></a><span class="lineno">  555</span>&#160;    <span class="comment">!/                  | Last update :         10-Dec-2014 !</span></div>
<div class="line"><a name="l00556"></a><span class="lineno">  556</span>&#160;    <span class="comment">!/                  +-----------------------------------+</span></div>
<div class="line"><a name="l00557"></a><span class="lineno">  557</span>&#160;    <span class="comment">!/</span></div>
<div class="line"><a name="l00558"></a><span class="lineno">  558</span>&#160;    <span class="comment">!  1. Original author :</span></div>
<div class="line"><a name="l00559"></a><span class="lineno">  559</span>&#160;    <span class="comment">!</span></div>
<div class="line"><a name="l00560"></a><span class="lineno">  560</span>&#160;    <span class="comment">!     Mathieu Dutour Sikiric, IRB &amp; Aron Roland, Z&amp;P</span></div>
<div class="line"><a name="l00561"></a><span class="lineno">  561</span>&#160;    <span class="comment">!</span></div>
<div class="line"><a name="l00562"></a><span class="lineno">  562</span>&#160;    <span class="comment">!  2. Last update :</span></div>
<div class="line"><a name="l00563"></a><span class="lineno">  563</span>&#160;    <span class="comment">!</span></div>
<div class="line"><a name="l00564"></a><span class="lineno">  564</span>&#160;    <span class="comment">!     See revisions.</span></div>
<div class="line"><a name="l00565"></a><span class="lineno">  565</span>&#160;    <span class="comment">!</span></div>
<div class="line"><a name="l00566"></a><span class="lineno">  566</span>&#160;    <span class="comment">!  3. Revisions :</span></div>
<div class="line"><a name="l00567"></a><span class="lineno">  567</span>&#160;    <span class="comment">!</span></div>
<div class="line"><a name="l00568"></a><span class="lineno">  568</span>&#160;    <span class="comment">!     20-Feb-2012 : Origination</span></div>
<div class="line"><a name="l00569"></a><span class="lineno">  569</span>&#160;    <span class="comment">!/    10-Dec-2014 : Add checks for allocate status      ( version 5.04 )</span></div>
<div class="line"><a name="l00570"></a><span class="lineno">  570</span>&#160;    <span class="comment">!</span></div>
<div class="line"><a name="l00571"></a><span class="lineno">  571</span>&#160;    <span class="comment">!  4. Copyright :</span></div>
<div class="line"><a name="l00572"></a><span class="lineno">  572</span>&#160;    <span class="comment">!</span></div>
<div class="line"><a name="l00573"></a><span class="lineno">  573</span>&#160;    <span class="comment">!  5. Purpose :</span></div>
<div class="line"><a name="l00574"></a><span class="lineno">  574</span>&#160;    <span class="comment">!</span></div>
<div class="line"><a name="l00575"></a><span class="lineno">  575</span>&#160;    <span class="comment">!     Compute grid arrays for scrip for a specific unstructured grid</span></div>
<div class="line"><a name="l00576"></a><span class="lineno">  576</span>&#160;    <span class="comment">!     For interior vertices, we select for every triangle the barycenter</span></div>
<div class="line"><a name="l00577"></a><span class="lineno">  577</span>&#160;    <span class="comment">!     of the triangle. So to every node contained in N triangles we associate</span></div>
<div class="line"><a name="l00578"></a><span class="lineno">  578</span>&#160;    <span class="comment">!     a domain with N corners. Every one of those corners is contained</span></div>
<div class="line"><a name="l00579"></a><span class="lineno">  579</span>&#160;    <span class="comment">!     in 3 different domains.</span></div>
<div class="line"><a name="l00580"></a><span class="lineno">  580</span>&#160;    <span class="comment">!     For nodes that are on the boundary, we have to proceed differently.</span></div>
<div class="line"><a name="l00581"></a><span class="lineno">  581</span>&#160;    <span class="comment">!     For every such node, we have NEIGHBOR_PREV and NEIGHBOR_NEXT which</span></div>
<div class="line"><a name="l00582"></a><span class="lineno">  582</span>&#160;    <span class="comment">!     are the neighbor on each side of the boundary.</span></div>
<div class="line"><a name="l00583"></a><span class="lineno">  583</span>&#160;    <span class="comment">!     We put a corner on the middle of the edge. We also put a corner</span></div>
<div class="line"><a name="l00584"></a><span class="lineno">  584</span>&#160;    <span class="comment">!     on the node itself.</span></div>
<div class="line"><a name="l00585"></a><span class="lineno">  585</span>&#160;    <span class="comment">!     Note that instead of taking barycenters, we could have taken</span></div>
<div class="line"><a name="l00586"></a><span class="lineno">  586</span>&#160;    <span class="comment">!     Voronoi vertices, but this carries danger since Voronoi vertices</span></div>
<div class="line"><a name="l00587"></a><span class="lineno">  587</span>&#160;    <span class="comment">!     can be outside of the triangle. And it leaves open how to treat</span></div>
<div class="line"><a name="l00588"></a><span class="lineno">  588</span>&#160;    <span class="comment">!     the boundary.</span></div>
<div class="line"><a name="l00589"></a><span class="lineno">  589</span>&#160;    <span class="comment">!</span></div>
<div class="line"><a name="l00590"></a><span class="lineno">  590</span>&#160;    <span class="comment">!  6. Method :</span></div>
<div class="line"><a name="l00591"></a><span class="lineno">  591</span>&#160;    <span class="comment">!</span></div>
<div class="line"><a name="l00592"></a><span class="lineno">  592</span>&#160;    <span class="comment">!  7. Parameters, Variables and types :</span></div>
<div class="line"><a name="l00593"></a><span class="lineno">  593</span>&#160;    <span class="comment">!</span></div>
<div class="line"><a name="l00594"></a><span class="lineno">  594</span>&#160;    <span class="comment">!  8. Called by :</span></div>
<div class="line"><a name="l00595"></a><span class="lineno">  595</span>&#160;    <span class="comment">!</span></div>
<div class="line"><a name="l00596"></a><span class="lineno">  596</span>&#160;    <span class="comment">!     Subroutine get_scrip_info</span></div>
<div class="line"><a name="l00597"></a><span class="lineno">  597</span>&#160;    <span class="comment">!</span></div>
<div class="line"><a name="l00598"></a><span class="lineno">  598</span>&#160;    <span class="comment">!  9. Subroutines and functions used :</span></div>
<div class="line"><a name="l00599"></a><span class="lineno">  599</span>&#160;    <span class="comment">!</span></div>
<div class="line"><a name="l00600"></a><span class="lineno">  600</span>&#160;    <span class="comment">! 10. Error messages:</span></div>
<div class="line"><a name="l00601"></a><span class="lineno">  601</span>&#160;    <span class="comment">!</span></div>
<div class="line"><a name="l00602"></a><span class="lineno">  602</span>&#160;    <span class="comment">! 11. Remarks :</span></div>
<div class="line"><a name="l00603"></a><span class="lineno">  603</span>&#160;    <span class="comment">!</span></div>
<div class="line"><a name="l00604"></a><span class="lineno">  604</span>&#160;    <span class="comment">! 12. Structure :</span></div>
<div class="line"><a name="l00605"></a><span class="lineno">  605</span>&#160;    <span class="comment">!</span></div>
<div class="line"><a name="l00606"></a><span class="lineno">  606</span>&#160;    <span class="comment">! 13. Switches :</span></div>
<div class="line"><a name="l00607"></a><span class="lineno">  607</span>&#160;    <span class="comment">!</span></div>
<div class="line"><a name="l00608"></a><span class="lineno">  608</span>&#160;    <span class="comment">! 14. Source code :</span></div>
<div class="line"><a name="l00609"></a><span class="lineno">  609</span>&#160;    <span class="keywordtype">USE </span><a class="code" href="namespacew3servmd.html">w3servmd</a>, <span class="keywordtype">ONLY</span>: extcde</div>
<div class="line"><a name="l00610"></a><span class="lineno">  610</span>&#160;    <span class="keywordtype">USE </span><a class="code" href="namespacew3gdatmd.html">w3gdatmd</a>, <span class="keywordtype">ONLY</span> : <a class="code" href="namespacew3gdatmd.html#a4e0be685c06d5b77285bb227dd2b8ac9">grids</a></div>
<div class="line"><a name="l00611"></a><span class="lineno">  611</span>&#160;    <span class="keywordtype">IMPLICIT NONE</span></div>
<div class="line"><a name="l00612"></a><span class="lineno">  612</span>&#160;    <span class="keywordtype">INTEGER</span>, <span class="keywordtype">INTENT(IN)</span>      :: ID_GRD</div>
<div class="line"><a name="l00613"></a><span class="lineno">  613</span>&#160;    real*8, <span class="keywordtype">INTENT(OUT)</span>, <span class="keywordtype">ALLOCATABLE</span> :: grid_center_lon(:)</div>
<div class="line"><a name="l00614"></a><span class="lineno">  614</span>&#160;    real*8, <span class="keywordtype">INTENT(OUT)</span>, <span class="keywordtype">ALLOCATABLE</span> :: grid_center_lat(:)</div>
<div class="line"><a name="l00615"></a><span class="lineno">  615</span>&#160;    <span class="keywordtype">LOGICAL</span>, <span class="keywordtype">INTENT(OUT)</span>, <span class="keywordtype">ALLOCATABLE</span> :: GRID_MASK(:)</div>
<div class="line"><a name="l00616"></a><span class="lineno">  616</span>&#160;    real*8, <span class="keywordtype">INTENT(OUT)</span>, <span class="keywordtype">ALLOCATABLE</span> :: grid_corner_lon(:,:)</div>
<div class="line"><a name="l00617"></a><span class="lineno">  617</span>&#160;    real*8, <span class="keywordtype">INTENT(OUT)</span>, <span class="keywordtype">ALLOCATABLE</span> :: grid_corner_lat(:,:)</div>
<div class="line"><a name="l00618"></a><span class="lineno">  618</span>&#160;    <span class="keywordtype">INTEGER</span>, <span class="keywordtype">INTENT(OUT)</span>, <span class="keywordtype">ALLOCATABLE</span> :: GRID_DIMS(:)</div>
<div class="line"><a name="l00619"></a><span class="lineno">  619</span>&#160;    <span class="keywordtype">INTEGER</span>, <span class="keywordtype">INTENT(OUT)</span> :: GRID_SIZE, GRID_CORNERS, GRID_RANK</div>
<div class="line"><a name="l00620"></a><span class="lineno">  620</span>&#160; </div>
<div class="line"><a name="l00621"></a><span class="lineno">  621</span>&#160;    <span class="keywordtype">INTEGER</span> DIRAPPROACH, DUALAPPROACH, THEAPPROACH</div>
<div class="line"><a name="l00622"></a><span class="lineno">  622</span>&#160;    <span class="keywordtype">INTEGER</span> MNE, MNP, IE, IP, I</div>
<div class="line"><a name="l00623"></a><span class="lineno">  623</span>&#160;    <span class="keywordtype">INTEGER</span> NBPLUS, NBMINUS</div>
<div class="line"><a name="l00624"></a><span class="lineno">  624</span>&#160;    <span class="keywordtype">INTEGER</span> I1, I2, I3</div>
<div class="line"><a name="l00625"></a><span class="lineno">  625</span>&#160;    real*8 :: elon1, elon2, elon3, elon, elonc</div>
<div class="line"><a name="l00626"></a><span class="lineno">  626</span>&#160;    real*8 :: elat1, elat2, elat3, elat, elatc</div>
<div class="line"><a name="l00627"></a><span class="lineno">  627</span>&#160;<span class="keywordtype">    REAL</span> *8 :: DELTALON12, DELTALON13, DELTALAT12, DELTALAT13</div>
<div class="line"><a name="l00628"></a><span class="lineno">  628</span>&#160;<span class="keywordtype">    REAL</span> *8 :: THEDET</div>
<div class="line"><a name="l00629"></a><span class="lineno">  629</span>&#160;    real*8 :: pt(3,2)</div>
<div class="line"><a name="l00630"></a><span class="lineno">  630</span>&#160;    <span class="keywordtype">INTEGER</span>, <span class="keywordtype">POINTER</span> :: IOBP(:), TRIGINCD(:)</div>
<div class="line"><a name="l00631"></a><span class="lineno">  631</span>&#160;    <span class="keywordtype">INTEGER</span>, <span class="keywordtype">POINTER</span> :: NEIGHBOR_PREV(:), NEIGHBOR_NEXT(:)</div>
<div class="line"><a name="l00632"></a><span class="lineno">  632</span>&#160;    <span class="keywordtype">INTEGER</span>, <span class="keywordtype">POINTER</span> :: NBASSIGNEDCORNER(:), LISTNBCORNER(:)</div>
<div class="line"><a name="l00633"></a><span class="lineno">  633</span>&#160;    <span class="keywordtype">INTEGER</span>, <span class="keywordtype">POINTER</span> :: STATUS(:), NEXTVERT(:), PREVVERT(:), FINALVERT(:)</div>
<div class="line"><a name="l00634"></a><span class="lineno">  634</span>&#160;    <span class="keywordtype">INTEGER</span> :: MAXCORNER, NBCORNER</div>
<div class="line"><a name="l00635"></a><span class="lineno">  635</span>&#160;    <span class="keywordtype">INTEGER</span> :: IDX, IPNEXT, IPPREV, NB, INEXT, IPREV</div>
<div class="line"><a name="l00636"></a><span class="lineno">  636</span>&#160;    real*8, <span class="keywordtype">POINTER</span> :: lon_cent_trig(:), lat_cent_trig(:)</div>
<div class="line"><a name="l00637"></a><span class="lineno">  637</span>&#160;    real*8 :: elonip, elonnext, elonprev, elonn, elonp</div>
<div class="line"><a name="l00638"></a><span class="lineno">  638</span>&#160;    real*8 :: elatip, elatnext, elatprev, elatn, elatp</div>
<div class="line"><a name="l00639"></a><span class="lineno">  639</span>&#160;    <span class="keywordtype">INTEGER</span> :: ISFINISHED, ZPREV</div>
<div class="line"><a name="l00640"></a><span class="lineno">  640</span>&#160;    <span class="keywordtype">INTEGER</span> :: DODEBUG</div>
<div class="line"><a name="l00641"></a><span class="lineno">  641</span>&#160;    grid_rank=2</div>
<div class="line"><a name="l00642"></a><span class="lineno">  642</span>&#160;    dirapproach=1</div>
<div class="line"><a name="l00643"></a><span class="lineno">  643</span>&#160;    dualapproach=2</div>
<div class="line"><a name="l00644"></a><span class="lineno">  644</span>&#160;    theapproach=dualapproach</div>
<div class="line"><a name="l00645"></a><span class="lineno">  645</span>&#160;    mne=<a class="code" href="namespacew3gdatmd.html#a4e0be685c06d5b77285bb227dd2b8ac9">grids</a>(id_grd)%NTRI</div>
<div class="line"><a name="l00646"></a><span class="lineno">  646</span>&#160;    mnp=<a class="code" href="namespacew3gdatmd.html#a4e0be685c06d5b77285bb227dd2b8ac9">grids</a>(id_grd)%NX</div>
<div class="line"><a name="l00647"></a><span class="lineno">  647</span>&#160;    <span class="keywordflow">IF</span> (theapproach .EQ. dirapproach) <span class="keywordflow">THEN</span></div>
<div class="line"><a name="l00648"></a><span class="lineno">  648</span>&#160;      <span class="keyword">ALLOCATE</span>(grid_center_lon(mne), stat=istat)</div>
<div class="line"><a name="l00649"></a><span class="lineno">  649</span>&#160;      check_alloc_status( istat )</div>
<div class="line"><a name="l00650"></a><span class="lineno">  650</span>&#160;      <span class="keyword">ALLOCATE</span>(grid_center_lat(mne), stat=istat)</div>
<div class="line"><a name="l00651"></a><span class="lineno">  651</span>&#160;      check_alloc_status( istat )</div>
<div class="line"><a name="l00652"></a><span class="lineno">  652</span>&#160;      <span class="keyword">ALLOCATE</span>(grid_corner_lon(3,mne), stat=istat)</div>
<div class="line"><a name="l00653"></a><span class="lineno">  653</span>&#160;      check_alloc_status( istat )</div>
<div class="line"><a name="l00654"></a><span class="lineno">  654</span>&#160;      <span class="keyword">ALLOCATE</span>(grid_corner_lat(3,mne), stat=istat)</div>
<div class="line"><a name="l00655"></a><span class="lineno">  655</span>&#160;      check_alloc_status( istat )</div>
<div class="line"><a name="l00656"></a><span class="lineno">  656</span>&#160;      <span class="keyword">ALLOCATE</span>(grid_mask(mne), stat=istat)</div>
<div class="line"><a name="l00657"></a><span class="lineno">  657</span>&#160;      check_alloc_status( istat )</div>
<div class="line"><a name="l00658"></a><span class="lineno">  658</span>&#160;      <span class="keywordflow">DO</span> ie=1,mne</div>
<div class="line"><a name="l00659"></a><span class="lineno">  659</span>&#160;        i1=<a class="code" href="namespacew3gdatmd.html#a4e0be685c06d5b77285bb227dd2b8ac9">grids</a>(id_grd)%TRIGP(1,ie)</div>
<div class="line"><a name="l00660"></a><span class="lineno">  660</span>&#160;        i2=<a class="code" href="namespacew3gdatmd.html#a4e0be685c06d5b77285bb227dd2b8ac9">grids</a>(id_grd)%TRIGP(2,ie)</div>
<div class="line"><a name="l00661"></a><span class="lineno">  661</span>&#160;        i3=<a class="code" href="namespacew3gdatmd.html#a4e0be685c06d5b77285bb227dd2b8ac9">grids</a>(id_grd)%TRIGP(3,ie)</div>
<div class="line"><a name="l00662"></a><span class="lineno">  662</span>&#160;        elon1=<a class="code" href="namespacew3gdatmd.html#a4e0be685c06d5b77285bb227dd2b8ac9">grids</a>(id_grd)%XGRD(1,i1)</div>
<div class="line"><a name="l00663"></a><span class="lineno">  663</span>&#160;        elon2=<a class="code" href="namespacew3gdatmd.html#a4e0be685c06d5b77285bb227dd2b8ac9">grids</a>(id_grd)%XGRD(1,i2)</div>
<div class="line"><a name="l00664"></a><span class="lineno">  664</span>&#160;        elon3=<a class="code" href="namespacew3gdatmd.html#a4e0be685c06d5b77285bb227dd2b8ac9">grids</a>(id_grd)%XGRD(1,i3)</div>
<div class="line"><a name="l00665"></a><span class="lineno">  665</span>&#160;        elat1=<a class="code" href="namespacew3gdatmd.html#a4e0be685c06d5b77285bb227dd2b8ac9">grids</a>(id_grd)%YGRD(1,i1)</div>
<div class="line"><a name="l00666"></a><span class="lineno">  666</span>&#160;        elat2=<a class="code" href="namespacew3gdatmd.html#a4e0be685c06d5b77285bb227dd2b8ac9">grids</a>(id_grd)%YGRD(1,i2)</div>
<div class="line"><a name="l00667"></a><span class="lineno">  667</span>&#160;        elat3=<a class="code" href="namespacew3gdatmd.html#a4e0be685c06d5b77285bb227dd2b8ac9">grids</a>(id_grd)%YGRD(1,i3)</div>
<div class="line"><a name="l00668"></a><span class="lineno">  668</span>&#160;        elon=(elon1 + elon2 + elon3)/3</div>
<div class="line"><a name="l00669"></a><span class="lineno">  669</span>&#160;        elat=(elat1 + elat2 + elat3)/3</div>
<div class="line"><a name="l00670"></a><span class="lineno">  670</span>&#160;        grid_center_lon(ie)=elon</div>
<div class="line"><a name="l00671"></a><span class="lineno">  671</span>&#160;        grid_center_lat(ie)=elat</div>
<div class="line"><a name="l00672"></a><span class="lineno">  672</span>&#160;        grid_corner_lon(1,ie)=elon1</div>
<div class="line"><a name="l00673"></a><span class="lineno">  673</span>&#160;        grid_corner_lon(2,ie)=elon2</div>
<div class="line"><a name="l00674"></a><span class="lineno">  674</span>&#160;        grid_corner_lon(3,ie)=elon3</div>
<div class="line"><a name="l00675"></a><span class="lineno">  675</span>&#160;        grid_corner_lat(1,ie)=elat1</div>
<div class="line"><a name="l00676"></a><span class="lineno">  676</span>&#160;        grid_corner_lat(2,ie)=elat2</div>
<div class="line"><a name="l00677"></a><span class="lineno">  677</span>&#160;        grid_corner_lat(3,ie)=elat3</div>
<div class="line"><a name="l00678"></a><span class="lineno">  678</span>&#160;        grid_mask(ie)=.true.</div>
<div class="line"><a name="l00679"></a><span class="lineno">  679</span>&#160;<span class="keywordflow">      END DO</span></div>
<div class="line"><a name="l00680"></a><span class="lineno">  680</span>&#160;      grid_corners=3</div>
<div class="line"><a name="l00681"></a><span class="lineno">  681</span>&#160;<span class="keywordflow">    END IF</span></div>
<div class="line"><a name="l00682"></a><span class="lineno">  682</span>&#160;    <span class="keywordflow">IF</span> (theapproach .EQ. dualapproach) <span class="keywordflow">THEN</span></div>
<div class="line"><a name="l00683"></a><span class="lineno">  683</span>&#160;      <span class="keyword">ALLOCATE</span>(trigincd(mnp), stat=istat)</div>
<div class="line"><a name="l00684"></a><span class="lineno">  684</span>&#160;      check_alloc_status( istat )</div>
<div class="line"><a name="l00685"></a><span class="lineno">  685</span>&#160;      <span class="keyword">ALLOCATE</span>(iobp(mnp), stat=istat)</div>
<div class="line"><a name="l00686"></a><span class="lineno">  686</span>&#160;      check_alloc_status( istat )</div>
<div class="line"><a name="l00687"></a><span class="lineno">  687</span>&#160;      <span class="keyword">ALLOCATE</span>(neighbor_next(mnp), stat=istat)</div>
<div class="line"><a name="l00688"></a><span class="lineno">  688</span>&#160;      check_alloc_status( istat )</div>
<div class="line"><a name="l00689"></a><span class="lineno">  689</span>&#160;      <span class="keyword">ALLOCATE</span>(neighbor_prev(mnp), stat=istat)</div>
<div class="line"><a name="l00690"></a><span class="lineno">  690</span>&#160;      check_alloc_status( istat )</div>
<div class="line"><a name="l00691"></a><span class="lineno">  691</span>&#160;      <span class="keyword">ALLOCATE</span>(nbassignedcorner(mnp), stat=istat)</div>
<div class="line"><a name="l00692"></a><span class="lineno">  692</span>&#160;      check_alloc_status( istat )</div>
<div class="line"><a name="l00693"></a><span class="lineno">  693</span>&#160;      <span class="keyword">ALLOCATE</span>(listnbcorner(mnp), stat=istat)</div>
<div class="line"><a name="l00694"></a><span class="lineno">  694</span>&#160;      check_alloc_status( istat )</div>
<div class="line"><a name="l00695"></a><span class="lineno">  695</span>&#160; </div>
<div class="line"><a name="l00696"></a><span class="lineno">  696</span>&#160;      <span class="keyword">ALLOCATE</span>(<a class="code" href="namespacescrip__timers.html#a13e5d8b1f71ebc95443c31da01c7d687">status</a>(mnp), stat=istat)</div>
<div class="line"><a name="l00697"></a><span class="lineno">  697</span>&#160;      check_alloc_status( istat )</div>
<div class="line"><a name="l00698"></a><span class="lineno">  698</span>&#160;      <span class="keyword">ALLOCATE</span>(nextvert(mnp), stat=istat)</div>
<div class="line"><a name="l00699"></a><span class="lineno">  699</span>&#160;      check_alloc_status( istat )</div>
<div class="line"><a name="l00700"></a><span class="lineno">  700</span>&#160;      <span class="keyword">ALLOCATE</span>(prevvert(mnp), stat=istat)</div>
<div class="line"><a name="l00701"></a><span class="lineno">  701</span>&#160;      check_alloc_status( istat )</div>
<div class="line"><a name="l00702"></a><span class="lineno">  702</span>&#160;      <span class="keyword">ALLOCATE</span>(finalvert(mnp), stat=istat)</div>
<div class="line"><a name="l00703"></a><span class="lineno">  703</span>&#160;      check_alloc_status( istat )</div>
<div class="line"><a name="l00704"></a><span class="lineno">  704</span>&#160;      <span class="keyword">ALLOCATE</span>(lon_cent_trig(mne), stat=istat)</div>
<div class="line"><a name="l00705"></a><span class="lineno">  705</span>&#160;      check_alloc_status( istat )</div>
<div class="line"><a name="l00706"></a><span class="lineno">  706</span>&#160;      <span class="keyword">ALLOCATE</span>(lat_cent_trig(mne), stat=istat)</div>
<div class="line"><a name="l00707"></a><span class="lineno">  707</span>&#160;      check_alloc_status( istat )</div>
<div class="line"><a name="l00708"></a><span class="lineno">  708</span>&#160; </div>
<div class="line"><a name="l00709"></a><span class="lineno">  709</span>&#160;      <span class="keyword">CALL </span><a class="code" href="namespacewmscrpmd.html#ad4af6c395fa4aceb01ca07579be7c212">get_unstructured_vertex_degree</a> (mnp, mne,             &amp;</div>
<div class="line"><a name="l00710"></a><span class="lineno">  710</span>&#160;           <a class="code" href="namespacew3gdatmd.html#a4e0be685c06d5b77285bb227dd2b8ac9">grids</a>(id_grd)%TRIGP, trigincd)</div>
<div class="line"><a name="l00711"></a><span class="lineno">  711</span>&#160;      <span class="keyword">CALL </span><a class="code" href="namespacew3triamd.html#a196c111258770cf6c369c05994e6f92d">get_boundary</a>(mnp, mne, <a class="code" href="namespacew3gdatmd.html#a4e0be685c06d5b77285bb227dd2b8ac9">grids</a>(id_grd)%TRIGP, iobp,     &amp;</div>
<div class="line"><a name="l00712"></a><span class="lineno">  712</span>&#160;           neighbor_prev, neighbor_next)</div>
<div class="line"><a name="l00713"></a><span class="lineno">  713</span>&#160; </div>
<div class="line"><a name="l00714"></a><span class="lineno">  714</span>&#160;      <span class="comment">! Find max number of corners</span></div>
<div class="line"><a name="l00715"></a><span class="lineno">  715</span>&#160;      maxcorner=0</div>
<div class="line"><a name="l00716"></a><span class="lineno">  716</span>&#160;      <span class="keywordflow">DO</span> ip=1,mnp</div>
<div class="line"><a name="l00717"></a><span class="lineno">  717</span>&#160;        <span class="keywordflow">IF</span> (neighbor_next(ip) .EQ. 0) <span class="keywordflow">THEN</span></div>
<div class="line"><a name="l00718"></a><span class="lineno">  718</span>&#160;          nbcorner=trigincd(ip)</div>
<div class="line"><a name="l00719"></a><span class="lineno">  719</span>&#160;        <span class="keywordflow">ELSE</span></div>
<div class="line"><a name="l00720"></a><span class="lineno">  720</span>&#160;          nbcorner=trigincd(ip) + 3</div>
<div class="line"><a name="l00721"></a><span class="lineno">  721</span>&#160;<span class="keywordflow">        END IF</span></div>
<div class="line"><a name="l00722"></a><span class="lineno">  722</span>&#160;        listnbcorner(ip)=nbcorner</div>
<div class="line"><a name="l00723"></a><span class="lineno">  723</span>&#160;        <span class="keywordflow">IF</span> (nbcorner .GT. maxcorner) <span class="keywordflow">THEN</span></div>
<div class="line"><a name="l00724"></a><span class="lineno">  724</span>&#160;          maxcorner=nbcorner</div>
<div class="line"><a name="l00725"></a><span class="lineno">  725</span>&#160;<span class="keywordflow">        END IF</span></div>
<div class="line"><a name="l00726"></a><span class="lineno">  726</span>&#160;<span class="keywordflow">      END DO</span></div>
<div class="line"><a name="l00727"></a><span class="lineno">  727</span>&#160;      grid_corners=maxcorner</div>
<div class="line"><a name="l00728"></a><span class="lineno">  728</span>&#160; </div>
<div class="line"><a name="l00729"></a><span class="lineno">  729</span>&#160;      <span class="keyword">ALLOCATE</span>(grid_center_lon(mnp), stat=istat)</div>
<div class="line"><a name="l00730"></a><span class="lineno">  730</span>&#160;      check_alloc_status( istat )</div>
<div class="line"><a name="l00731"></a><span class="lineno">  731</span>&#160;      <span class="keyword">ALLOCATE</span>(grid_center_lat(mnp), stat=istat)</div>
<div class="line"><a name="l00732"></a><span class="lineno">  732</span>&#160;      check_alloc_status( istat )</div>
<div class="line"><a name="l00733"></a><span class="lineno">  733</span>&#160;      <span class="keyword">ALLOCATE</span>(grid_corner_lon(maxcorner,mnp), stat=istat)</div>
<div class="line"><a name="l00734"></a><span class="lineno">  734</span>&#160;      check_alloc_status( istat )</div>
<div class="line"><a name="l00735"></a><span class="lineno">  735</span>&#160;      <span class="keyword">ALLOCATE</span>(grid_corner_lat(maxcorner,mnp), stat=istat)</div>
<div class="line"><a name="l00736"></a><span class="lineno">  736</span>&#160;      check_alloc_status( istat )</div>
<div class="line"><a name="l00737"></a><span class="lineno">  737</span>&#160;      <span class="keyword">ALLOCATE</span>(grid_mask(mnp), stat=istat)</div>
<div class="line"><a name="l00738"></a><span class="lineno">  738</span>&#160;      check_alloc_status( istat )</div>
<div class="line"><a name="l00739"></a><span class="lineno">  739</span>&#160; </div>
<div class="line"><a name="l00740"></a><span class="lineno">  740</span>&#160;      <span class="comment">! Add first three corners for boundaries</span></div>
<div class="line"><a name="l00741"></a><span class="lineno">  741</span>&#160;      nbassignedcorner(:)=0</div>
<div class="line"><a name="l00742"></a><span class="lineno">  742</span>&#160;      <span class="keywordflow">DO</span> ip=1,mnp</div>
<div class="line"><a name="l00743"></a><span class="lineno">  743</span>&#160;        grid_mask(ip)=.true.</div>
<div class="line"><a name="l00744"></a><span class="lineno">  744</span>&#160;        <span class="keywordflow">IF</span> (neighbor_next(ip) .GT. 0) <span class="keywordflow">THEN</span></div>
<div class="line"><a name="l00745"></a><span class="lineno">  745</span>&#160;          ipnext=neighbor_next(ip)</div>
<div class="line"><a name="l00746"></a><span class="lineno">  746</span>&#160;          ipprev=neighbor_prev(ip)</div>
<div class="line"><a name="l00747"></a><span class="lineno">  747</span>&#160;          elonip=dble(<a class="code" href="namespacew3gdatmd.html#a4e0be685c06d5b77285bb227dd2b8ac9">grids</a>(id_grd)%XGRD(1,ip))</div>
<div class="line"><a name="l00748"></a><span class="lineno">  748</span>&#160;          elatip=dble(<a class="code" href="namespacew3gdatmd.html#a4e0be685c06d5b77285bb227dd2b8ac9">grids</a>(id_grd)%YGRD(1,ip))</div>
<div class="line"><a name="l00749"></a><span class="lineno">  749</span>&#160;          elonnext=dble(<a class="code" href="namespacew3gdatmd.html#a4e0be685c06d5b77285bb227dd2b8ac9">grids</a>(id_grd)%XGRD(1,ipnext))</div>
<div class="line"><a name="l00750"></a><span class="lineno">  750</span>&#160;          elatnext=dble(<a class="code" href="namespacew3gdatmd.html#a4e0be685c06d5b77285bb227dd2b8ac9">grids</a>(id_grd)%YGRD(1,ipnext))</div>
<div class="line"><a name="l00751"></a><span class="lineno">  751</span>&#160;          elonprev=dble(<a class="code" href="namespacew3gdatmd.html#a4e0be685c06d5b77285bb227dd2b8ac9">grids</a>(id_grd)%XGRD(1,ipprev))</div>
<div class="line"><a name="l00752"></a><span class="lineno">  752</span>&#160;          elatprev=dble(<a class="code" href="namespacew3gdatmd.html#a4e0be685c06d5b77285bb227dd2b8ac9">grids</a>(id_grd)%YGRD(1,ipprev))</div>
<div class="line"><a name="l00753"></a><span class="lineno">  753</span>&#160; </div>
<div class="line"><a name="l00754"></a><span class="lineno">  754</span>&#160;          <span class="comment">! Periodicity fix for corner node</span></div>
<div class="line"><a name="l00755"></a><span class="lineno">  755</span>&#160;          <span class="keywordflow">IF</span> ( abs(elonip - elonnext) .GT. 180.0 ) <span class="keywordflow">THEN</span></div>
<div class="line"><a name="l00756"></a><span class="lineno">  756</span>&#160;            elonnext = elonnext -sign(360.0d0,(elonip - elonnext))</div>
<div class="line"><a name="l00757"></a><span class="lineno">  757</span>&#160;<span class="keywordflow">          ENDIF</span></div>
<div class="line"><a name="l00758"></a><span class="lineno">  758</span>&#160;          <span class="keywordflow">IF</span> ( abs(elonip - elonprev) .GT. 180.0 ) <span class="keywordflow">THEN</span></div>
<div class="line"><a name="l00759"></a><span class="lineno">  759</span>&#160;            elonprev = elonprev -sign(360.0d0,(elonip - elonprev))</div>
<div class="line"><a name="l00760"></a><span class="lineno">  760</span>&#160;<span class="keywordflow">          ENDIF</span></div>
<div class="line"><a name="l00761"></a><span class="lineno">  761</span>&#160; </div>
<div class="line"><a name="l00762"></a><span class="lineno">  762</span>&#160;          elonn=(elonip+elonnext)/2.0</div>
<div class="line"><a name="l00763"></a><span class="lineno">  763</span>&#160;          elatn=(elatip+elatnext)/2.0</div>
<div class="line"><a name="l00764"></a><span class="lineno">  764</span>&#160;          elonp=(elonip+elonprev)/2.0</div>
<div class="line"><a name="l00765"></a><span class="lineno">  765</span>&#160;          elatp=(elatip+elatprev)/2.0</div>
<div class="line"><a name="l00766"></a><span class="lineno">  766</span>&#160; </div>
<div class="line"><a name="l00767"></a><span class="lineno">  767</span>&#160; </div>
<div class="line"><a name="l00768"></a><span class="lineno">  768</span>&#160;          grid_corner_lon(1,ip)=elonn</div>
<div class="line"><a name="l00769"></a><span class="lineno">  769</span>&#160;          grid_corner_lat(1,ip)=elatn</div>
<div class="line"><a name="l00770"></a><span class="lineno">  770</span>&#160;          grid_corner_lon(2,ip)=elonip</div>
<div class="line"><a name="l00771"></a><span class="lineno">  771</span>&#160;          grid_corner_lat(2,ip)=elatip</div>
<div class="line"><a name="l00772"></a><span class="lineno">  772</span>&#160;          grid_corner_lon(3,ip)=elonp</div>
<div class="line"><a name="l00773"></a><span class="lineno">  773</span>&#160;          grid_corner_lat(3,ip)=elatp</div>
<div class="line"><a name="l00774"></a><span class="lineno">  774</span>&#160;          nbassignedcorner(ip)=3</div>
<div class="line"><a name="l00775"></a><span class="lineno">  775</span>&#160;<span class="keywordflow">        END IF</span></div>
<div class="line"><a name="l00776"></a><span class="lineno">  776</span>&#160;<span class="keywordflow">      END DO</span></div>
<div class="line"><a name="l00777"></a><span class="lineno">  777</span>&#160; </div>
<div class="line"><a name="l00778"></a><span class="lineno">  778</span>&#160;      <span class="comment">! Compute centers</span></div>
<div class="line"><a name="l00779"></a><span class="lineno">  779</span>&#160;      <span class="keywordflow">DO</span> ip=1,mnp</div>
<div class="line"><a name="l00780"></a><span class="lineno">  780</span>&#160;        grid_center_lon(ip)=dble(<a class="code" href="namespacew3gdatmd.html#a4e0be685c06d5b77285bb227dd2b8ac9">grids</a>(id_grd)%XGRD(1,ip))</div>
<div class="line"><a name="l00781"></a><span class="lineno">  781</span>&#160;        grid_center_lat(ip)=dble(<a class="code" href="namespacew3gdatmd.html#a4e0be685c06d5b77285bb227dd2b8ac9">grids</a>(id_grd)%YGRD(1,ip))</div>
<div class="line"><a name="l00782"></a><span class="lineno">  782</span>&#160;<span class="keywordflow">      END DO</span></div>
<div class="line"><a name="l00783"></a><span class="lineno">  783</span>&#160; </div>
<div class="line"><a name="l00784"></a><span class="lineno">  784</span>&#160;      <span class="comment">! Check triangle node orientation</span></div>
<div class="line"><a name="l00785"></a><span class="lineno">  785</span>&#160;      <span class="comment">! Compute triangle centers</span></div>
<div class="line"><a name="l00786"></a><span class="lineno">  786</span>&#160;      nbplus=0</div>
<div class="line"><a name="l00787"></a><span class="lineno">  787</span>&#160;      nbminus=0</div>
<div class="line"><a name="l00788"></a><span class="lineno">  788</span>&#160;      <span class="keywordflow">DO</span> ie=1,mne</div>
<div class="line"><a name="l00789"></a><span class="lineno">  789</span>&#160;        i1=<a class="code" href="namespacew3gdatmd.html#a4e0be685c06d5b77285bb227dd2b8ac9">grids</a>(id_grd)%TRIGP(1,ie)</div>
<div class="line"><a name="l00790"></a><span class="lineno">  790</span>&#160;        i2=<a class="code" href="namespacew3gdatmd.html#a4e0be685c06d5b77285bb227dd2b8ac9">grids</a>(id_grd)%TRIGP(2,ie)</div>
<div class="line"><a name="l00791"></a><span class="lineno">  791</span>&#160;        i3=<a class="code" href="namespacew3gdatmd.html#a4e0be685c06d5b77285bb227dd2b8ac9">grids</a>(id_grd)%TRIGP(3,ie)</div>
<div class="line"><a name="l00792"></a><span class="lineno">  792</span>&#160;        pt(1,1)=dble(<a class="code" href="namespacew3gdatmd.html#a4e0be685c06d5b77285bb227dd2b8ac9">grids</a>(id_grd)%XGRD(1,i1))</div>
<div class="line"><a name="l00793"></a><span class="lineno">  793</span>&#160;        pt(2,1)=dble(<a class="code" href="namespacew3gdatmd.html#a4e0be685c06d5b77285bb227dd2b8ac9">grids</a>(id_grd)%XGRD(1,i2))</div>
<div class="line"><a name="l00794"></a><span class="lineno">  794</span>&#160;        pt(3,1)=dble(<a class="code" href="namespacew3gdatmd.html#a4e0be685c06d5b77285bb227dd2b8ac9">grids</a>(id_grd)%XGRD(1,i3))</div>
<div class="line"><a name="l00795"></a><span class="lineno">  795</span>&#160;        pt(1,2)=dble(<a class="code" href="namespacew3gdatmd.html#a4e0be685c06d5b77285bb227dd2b8ac9">grids</a>(id_grd)%YGRD(1,i1))</div>
<div class="line"><a name="l00796"></a><span class="lineno">  796</span>&#160;        pt(2,2)=dble(<a class="code" href="namespacew3gdatmd.html#a4e0be685c06d5b77285bb227dd2b8ac9">grids</a>(id_grd)%YGRD(1,i2))</div>
<div class="line"><a name="l00797"></a><span class="lineno">  797</span>&#160;        pt(3,2)=dble(<a class="code" href="namespacew3gdatmd.html#a4e0be685c06d5b77285bb227dd2b8ac9">grids</a>(id_grd)%YGRD(1,i3))</div>
<div class="line"><a name="l00798"></a><span class="lineno">  798</span>&#160; </div>
<div class="line"><a name="l00799"></a><span class="lineno">  799</span>&#160;        <span class="keyword">CALL </span><a class="code" href="namespacew3triamd.html#a864329ce5e5bb1ba165095fb128241f0">fix_periodcity</a>(pt)</div>
<div class="line"><a name="l00800"></a><span class="lineno">  800</span>&#160; </div>
<div class="line"><a name="l00801"></a><span class="lineno">  801</span>&#160;        elon1 = pt(1,1)</div>
<div class="line"><a name="l00802"></a><span class="lineno">  802</span>&#160;        elon2 = pt(2,1)</div>
<div class="line"><a name="l00803"></a><span class="lineno">  803</span>&#160;        elon3 = pt(3,1)</div>
<div class="line"><a name="l00804"></a><span class="lineno">  804</span>&#160;        elat1 = pt(1,2)</div>
<div class="line"><a name="l00805"></a><span class="lineno">  805</span>&#160;        elat2 = pt(2,2)</div>
<div class="line"><a name="l00806"></a><span class="lineno">  806</span>&#160;        elat3 = pt(3,2)</div>
<div class="line"><a name="l00807"></a><span class="lineno">  807</span>&#160; </div>
<div class="line"><a name="l00808"></a><span class="lineno">  808</span>&#160;        deltalon12=elon2 - elon1</div>
<div class="line"><a name="l00809"></a><span class="lineno">  809</span>&#160;        deltalon13=elon3 - elon1</div>
<div class="line"><a name="l00810"></a><span class="lineno">  810</span>&#160;        deltalat12=elat2 - elat1</div>
<div class="line"><a name="l00811"></a><span class="lineno">  811</span>&#160;        deltalat13=elat3 - elat1</div>
<div class="line"><a name="l00812"></a><span class="lineno">  812</span>&#160;        thedet=deltalon12*deltalat13 - deltalon13*deltalat12</div>
<div class="line"><a name="l00813"></a><span class="lineno">  813</span>&#160;        <span class="keywordflow">IF</span> (thedet.GT.0) <span class="keywordflow">THEN</span></div>
<div class="line"><a name="l00814"></a><span class="lineno">  814</span>&#160;          nbplus=nbplus+1</div>
<div class="line"><a name="l00815"></a><span class="lineno">  815</span>&#160;<span class="keywordflow">        END IF</span></div>
<div class="line"><a name="l00816"></a><span class="lineno">  816</span>&#160;        <span class="keywordflow">IF</span> (thedet.LT.0) <span class="keywordflow">THEN</span></div>
<div class="line"><a name="l00817"></a><span class="lineno">  817</span>&#160;          nbminus=nbminus+1</div>
<div class="line"><a name="l00818"></a><span class="lineno">  818</span>&#160;<span class="keywordflow">        END IF</span></div>
<div class="line"><a name="l00819"></a><span class="lineno">  819</span>&#160;        elon=(elon1 + elon2 + elon3)/3.0</div>
<div class="line"><a name="l00820"></a><span class="lineno">  820</span>&#160;        elat=(elat1 + elat2 + elat3)/3.0</div>
<div class="line"><a name="l00821"></a><span class="lineno">  821</span>&#160; </div>
<div class="line"><a name="l00822"></a><span class="lineno">  822</span>&#160; </div>
<div class="line"><a name="l00823"></a><span class="lineno">  823</span>&#160;        lon_cent_trig(ie)=elon</div>
<div class="line"><a name="l00824"></a><span class="lineno">  824</span>&#160;        lat_cent_trig(ie)=elat</div>
<div class="line"><a name="l00825"></a><span class="lineno">  825</span>&#160; </div>
<div class="line"><a name="l00826"></a><span class="lineno">  826</span>&#160;<span class="keywordflow">      END DO</span></div>
<div class="line"><a name="l00827"></a><span class="lineno">  827</span>&#160;      dodebug=0</div>
<div class="line"><a name="l00828"></a><span class="lineno">  828</span>&#160;      <span class="keywordflow">IF</span> (dodebug.EQ.1) <span class="keywordflow">THEN</span></div>
<div class="line"><a name="l00829"></a><span class="lineno">  829</span>&#160;        print *, <span class="stringliteral">&#39;nbplus=&#39;</span>, nbplus, <span class="stringliteral">&#39; nbminus=&#39;</span>, nbminus</div>
<div class="line"><a name="l00830"></a><span class="lineno">  830</span>&#160;<span class="keywordflow">      END IF</span></div>
<div class="line"><a name="l00831"></a><span class="lineno">  831</span>&#160; </div>
<div class="line"><a name="l00832"></a><span class="lineno">  832</span>&#160;      <a class="code" href="namespacescrip__timers.html#a13e5d8b1f71ebc95443c31da01c7d687">status</a>(:) = 0</div>
<div class="line"><a name="l00833"></a><span class="lineno">  833</span>&#160;      nextvert(:) = 0</div>
<div class="line"><a name="l00834"></a><span class="lineno">  834</span>&#160;      prevvert(:) = 0</div>
<div class="line"><a name="l00835"></a><span class="lineno">  835</span>&#160;      <span class="keywordflow">DO</span> ie=1,mne</div>
<div class="line"><a name="l00836"></a><span class="lineno">  836</span>&#160;        <span class="keywordflow">DO</span> i=1,3</div>
<div class="line"><a name="l00837"></a><span class="lineno">  837</span>&#160;          <span class="keyword">CALL </span><a class="code" href="namespacew3triamd.html#a03614b889485266f84a023e4c4de6843">triang_indexes</a>(i, inext, iprev)</div>
<div class="line"><a name="l00838"></a><span class="lineno">  838</span>&#160;          ip=<a class="code" href="namespacew3gdatmd.html#a4e0be685c06d5b77285bb227dd2b8ac9">grids</a>(id_grd)%TRIGP(i,ie)</div>
<div class="line"><a name="l00839"></a><span class="lineno">  839</span>&#160;          ipnext=<a class="code" href="namespacew3gdatmd.html#a4e0be685c06d5b77285bb227dd2b8ac9">grids</a>(id_grd)%TRIGP(inext,ie)</div>
<div class="line"><a name="l00840"></a><span class="lineno">  840</span>&#160;          ipprev=<a class="code" href="namespacew3gdatmd.html#a4e0be685c06d5b77285bb227dd2b8ac9">grids</a>(id_grd)%TRIGP(iprev,ie)</div>
<div class="line"><a name="l00841"></a><span class="lineno">  841</span>&#160;          <span class="keywordflow">IF</span> (<a class="code" href="namespacescrip__timers.html#a13e5d8b1f71ebc95443c31da01c7d687">status</a>(ip).EQ.0) <span class="keywordflow">THEN</span></div>
<div class="line"><a name="l00842"></a><span class="lineno">  842</span>&#160;            <span class="keywordflow">IF</span> (neighbor_next(ip).EQ.0) <span class="keywordflow">THEN</span></div>
<div class="line"><a name="l00843"></a><span class="lineno">  843</span>&#160;              <a class="code" href="namespacescrip__timers.html#a13e5d8b1f71ebc95443c31da01c7d687">status</a>(ip)=1</div>
<div class="line"><a name="l00844"></a><span class="lineno">  844</span>&#160;              finalvert(ip)=ipprev</div>
<div class="line"><a name="l00845"></a><span class="lineno">  845</span>&#160;              prevvert(ip)=ipprev</div>
<div class="line"><a name="l00846"></a><span class="lineno">  846</span>&#160;              nextvert(ip)=ipnext</div>
<div class="line"><a name="l00847"></a><span class="lineno">  847</span>&#160;            <span class="keywordflow">ELSE</span></div>
<div class="line"><a name="l00848"></a><span class="lineno">  848</span>&#160;              <span class="keywordflow">IF</span> (neighbor_prev(ip).EQ.ipprev) <span class="keywordflow">THEN</span></div>
<div class="line"><a name="l00849"></a><span class="lineno">  849</span>&#160;                <a class="code" href="namespacescrip__timers.html#a13e5d8b1f71ebc95443c31da01c7d687">status</a>(ip)=1</div>
<div class="line"><a name="l00850"></a><span class="lineno">  850</span>&#160;                prevvert(ip)=ipprev</div>
<div class="line"><a name="l00851"></a><span class="lineno">  851</span>&#160;                nextvert(ip)=ipnext</div>
<div class="line"><a name="l00852"></a><span class="lineno">  852</span>&#160;                finalvert(ip)=neighbor_next(ip)</div>
<div class="line"><a name="l00853"></a><span class="lineno">  853</span>&#160;<span class="keywordflow">              END IF</span></div>
<div class="line"><a name="l00854"></a><span class="lineno">  854</span>&#160;<span class="keywordflow">            END IF</span></div>
<div class="line"><a name="l00855"></a><span class="lineno">  855</span>&#160;<span class="keywordflow">          END IF</span></div>
<div class="line"><a name="l00856"></a><span class="lineno">  856</span>&#160;<span class="keywordflow">        END DO</span></div>
<div class="line"><a name="l00857"></a><span class="lineno">  857</span>&#160;<span class="keywordflow">      END DO</span></div>
<div class="line"><a name="l00858"></a><span class="lineno">  858</span>&#160;      <a class="code" href="namespacescrip__timers.html#a13e5d8b1f71ebc95443c31da01c7d687">status</a>(:)=0</div>
<div class="line"><a name="l00859"></a><span class="lineno">  859</span>&#160;      <span class="keywordflow">DO</span></div>
<div class="line"><a name="l00860"></a><span class="lineno">  860</span>&#160;        isfinished=1</div>
<div class="line"><a name="l00861"></a><span class="lineno">  861</span>&#160;        <span class="keywordflow">DO</span> ie=1,mne</div>
<div class="line"><a name="l00862"></a><span class="lineno">  862</span>&#160;          elon=lon_cent_trig(ie)</div>
<div class="line"><a name="l00863"></a><span class="lineno">  863</span>&#160;          elat=lat_cent_trig(ie)</div>
<div class="line"><a name="l00864"></a><span class="lineno">  864</span>&#160;          <span class="keywordflow">DO</span> i=1,3</div>
<div class="line"><a name="l00865"></a><span class="lineno">  865</span>&#160;            <span class="keyword">CALL </span><a class="code" href="namespacew3triamd.html#a03614b889485266f84a023e4c4de6843">triang_indexes</a>(i, inext, iprev)</div>
<div class="line"><a name="l00866"></a><span class="lineno">  866</span>&#160;            ip=<a class="code" href="namespacew3gdatmd.html#a4e0be685c06d5b77285bb227dd2b8ac9">grids</a>(id_grd)%TRIGP(i,ie)</div>
<div class="line"><a name="l00867"></a><span class="lineno">  867</span>&#160;            ipnext=<a class="code" href="namespacew3gdatmd.html#a4e0be685c06d5b77285bb227dd2b8ac9">grids</a>(id_grd)%TRIGP(inext,ie)</div>
<div class="line"><a name="l00868"></a><span class="lineno">  868</span>&#160;            ipprev=<a class="code" href="namespacew3gdatmd.html#a4e0be685c06d5b77285bb227dd2b8ac9">grids</a>(id_grd)%TRIGP(iprev,ie)</div>
<div class="line"><a name="l00869"></a><span class="lineno">  869</span>&#160;            <span class="keywordflow">IF</span> (<a class="code" href="namespacescrip__timers.html#a13e5d8b1f71ebc95443c31da01c7d687">status</a>(ip).EQ.0) <span class="keywordflow">THEN</span></div>
<div class="line"><a name="l00870"></a><span class="lineno">  870</span>&#160;              isfinished=0</div>
<div class="line"><a name="l00871"></a><span class="lineno">  871</span>&#160;              zprev=prevvert(ip)</div>
<div class="line"><a name="l00872"></a><span class="lineno">  872</span>&#160;              <span class="keywordflow">IF</span> (zprev.EQ.ipprev) <span class="keywordflow">THEN</span></div>
<div class="line"><a name="l00873"></a><span class="lineno">  873</span>&#160;                idx=nbassignedcorner(ip)</div>
<div class="line"><a name="l00874"></a><span class="lineno">  874</span>&#160;                idx=idx+1</div>
<div class="line"><a name="l00875"></a><span class="lineno">  875</span>&#160;                grid_corner_lon(idx,ip)=elon</div>
<div class="line"><a name="l00876"></a><span class="lineno">  876</span>&#160;                grid_corner_lat(idx,ip)=elat</div>
<div class="line"><a name="l00877"></a><span class="lineno">  877</span>&#160;                nbassignedcorner(ip)=idx</div>
<div class="line"><a name="l00878"></a><span class="lineno">  878</span>&#160;                prevvert(ip)=ipnext</div>
<div class="line"><a name="l00879"></a><span class="lineno">  879</span>&#160;                <span class="keywordflow">IF</span> (ipnext.EQ.finalvert(ip)) <span class="keywordflow">THEN</span></div>
<div class="line"><a name="l00880"></a><span class="lineno">  880</span>&#160;                  <a class="code" href="namespacescrip__timers.html#a13e5d8b1f71ebc95443c31da01c7d687">status</a>(ip)=1</div>
<div class="line"><a name="l00881"></a><span class="lineno">  881</span>&#160;<span class="keywordflow">                END IF</span></div>
<div class="line"><a name="l00882"></a><span class="lineno">  882</span>&#160;<span class="keywordflow">              END IF</span></div>
<div class="line"><a name="l00883"></a><span class="lineno">  883</span>&#160;<span class="keywordflow">            END IF</span></div>
<div class="line"><a name="l00884"></a><span class="lineno">  884</span>&#160;<span class="keywordflow">          END DO</span></div>
<div class="line"><a name="l00885"></a><span class="lineno">  885</span>&#160;<span class="keywordflow">        END DO</span></div>
<div class="line"><a name="l00886"></a><span class="lineno">  886</span>&#160;        <span class="keywordflow">IF</span> (isfinished.EQ.1) <span class="keywordflow">THEN</span></div>
<div class="line"><a name="l00887"></a><span class="lineno">  887</span>&#160;          <span class="keywordflow">EXIT</span></div>
<div class="line"><a name="l00888"></a><span class="lineno">  888</span>&#160;<span class="keywordflow">        END IF</span></div>
<div class="line"><a name="l00889"></a><span class="lineno">  889</span>&#160;<span class="keywordflow">      END DO</span></div>
<div class="line"><a name="l00890"></a><span class="lineno">  890</span>&#160;      <span class="keywordflow">DO</span> ip=1,mnp</div>
<div class="line"><a name="l00891"></a><span class="lineno">  891</span>&#160;        <span class="keywordflow">IF</span> (nbassignedcorner(ip).NE.listnbcorner(ip)) <span class="keywordflow">THEN</span></div>
<div class="line"><a name="l00892"></a><span class="lineno">  892</span>&#160;          <span class="keyword">WRITE</span>(*,*) <span class="stringliteral">&#39;Incoherent number at IP=&#39;</span>, ip</div>
<div class="line"><a name="l00893"></a><span class="lineno">  893</span>&#160;          <span class="keyword">WRITE</span>(*,*) <span class="stringliteral">&#39;  NbAssignedCorner(IP)=&#39;</span>, nbassignedcorner(ip)</div>
<div class="line"><a name="l00894"></a><span class="lineno">  894</span>&#160;          <span class="keyword">WRITE</span>(*,*) <span class="stringliteral">&#39;  ListNbCorner(IP)=&#39;</span>, listnbcorner(ip)</div>
<div class="line"><a name="l00895"></a><span class="lineno">  895</span>&#160;          <span class="keyword">WRITE</span>(*,*) <span class="stringliteral">&#39;  N_N=&#39;</span>, neighbor_next(ip), <span class="stringliteral">&#39;N_P=&#39;</span>, neighbor_prev(ip)</div>
<div class="line"><a name="l00896"></a><span class="lineno">  896</span>&#160;          <span class="keyword">WRITE</span>(*,*) <span class="stringliteral">&#39;  TrigIncd=&#39;</span>, trigincd(ip)</div>
<div class="line"><a name="l00897"></a><span class="lineno">  897</span>&#160;          stop <span class="stringliteral">&#39;wmscrpmd, case 2&#39;</span></div>
<div class="line"><a name="l00898"></a><span class="lineno">  898</span>&#160;<span class="keywordflow">        END IF</span></div>
<div class="line"><a name="l00899"></a><span class="lineno">  899</span>&#160;<span class="keywordflow">      END DO</span></div>
<div class="line"><a name="l00900"></a><span class="lineno">  900</span>&#160; </div>
<div class="line"><a name="l00901"></a><span class="lineno">  901</span>&#160;      <span class="comment">! if the number of corner is below threshold, we have to</span></div>
<div class="line"><a name="l00902"></a><span class="lineno">  902</span>&#160;      <span class="comment">! add some more.</span></div>
<div class="line"><a name="l00903"></a><span class="lineno">  903</span>&#160;      <span class="keywordflow">DO</span> ip=1,mnp</div>
<div class="line"><a name="l00904"></a><span class="lineno">  904</span>&#160;        nb=nbassignedcorner(ip)</div>
<div class="line"><a name="l00905"></a><span class="lineno">  905</span>&#160;        <span class="keywordflow">IF</span> (nb .LT. maxcorner) <span class="keywordflow">THEN</span></div>
<div class="line"><a name="l00906"></a><span class="lineno">  906</span>&#160;          elon=grid_corner_lon(nb,ip)</div>
<div class="line"><a name="l00907"></a><span class="lineno">  907</span>&#160;          elat=grid_corner_lat(nb,ip)</div>
<div class="line"><a name="l00908"></a><span class="lineno">  908</span>&#160;          <span class="keywordflow">DO</span> idx=nb+1,maxcorner</div>
<div class="line"><a name="l00909"></a><span class="lineno">  909</span>&#160;            grid_corner_lon(idx,ip)=elon</div>
<div class="line"><a name="l00910"></a><span class="lineno">  910</span>&#160;            grid_corner_lat(idx,ip)=elat</div>
<div class="line"><a name="l00911"></a><span class="lineno">  911</span>&#160;<span class="keywordflow">          END DO</span></div>
<div class="line"><a name="l00912"></a><span class="lineno">  912</span>&#160;<span class="keywordflow">        END IF</span></div>
<div class="line"><a name="l00913"></a><span class="lineno">  913</span>&#160;<span class="keywordflow">      END DO</span></div>
<div class="line"><a name="l00914"></a><span class="lineno">  914</span>&#160;      <span class="keyword">DEALLOCATE</span>(nbassignedcorner, stat=istat)</div>
<div class="line"><a name="l00915"></a><span class="lineno">  915</span>&#160;      check_dealloc_status( istat )</div>
<div class="line"><a name="l00916"></a><span class="lineno">  916</span>&#160;      <span class="keyword">DEALLOCATE</span>(listnbcorner, stat=istat)</div>
<div class="line"><a name="l00917"></a><span class="lineno">  917</span>&#160;      check_dealloc_status( istat )</div>
<div class="line"><a name="l00918"></a><span class="lineno">  918</span>&#160;      <span class="keyword">DEALLOCATE</span>(trigincd, stat=istat)</div>
<div class="line"><a name="l00919"></a><span class="lineno">  919</span>&#160;      check_dealloc_status( istat )</div>
<div class="line"><a name="l00920"></a><span class="lineno">  920</span>&#160;      <span class="keyword">DEALLOCATE</span>(iobp, stat=istat)</div>
<div class="line"><a name="l00921"></a><span class="lineno">  921</span>&#160;      check_dealloc_status( istat )</div>
<div class="line"><a name="l00922"></a><span class="lineno">  922</span>&#160;      <span class="keyword">DEALLOCATE</span>(neighbor_prev, stat=istat)</div>
<div class="line"><a name="l00923"></a><span class="lineno">  923</span>&#160;      check_dealloc_status( istat )</div>
<div class="line"><a name="l00924"></a><span class="lineno">  924</span>&#160;      <span class="keyword">DEALLOCATE</span>(neighbor_next, stat=istat)</div>
<div class="line"><a name="l00925"></a><span class="lineno">  925</span>&#160;      check_dealloc_status( istat )</div>
<div class="line"><a name="l00926"></a><span class="lineno">  926</span>&#160;      <span class="keyword">DEALLOCATE</span>(<a class="code" href="namespacescrip__timers.html#a13e5d8b1f71ebc95443c31da01c7d687">status</a>, stat=istat)</div>
<div class="line"><a name="l00927"></a><span class="lineno">  927</span>&#160;      check_dealloc_status( istat )</div>
<div class="line"><a name="l00928"></a><span class="lineno">  928</span>&#160;      <span class="keyword">DEALLOCATE</span>(nextvert, stat=istat)</div>
<div class="line"><a name="l00929"></a><span class="lineno">  929</span>&#160;      check_dealloc_status( istat )</div>
<div class="line"><a name="l00930"></a><span class="lineno">  930</span>&#160;      <span class="keyword">DEALLOCATE</span>(prevvert, stat=istat)</div>
<div class="line"><a name="l00931"></a><span class="lineno">  931</span>&#160;      check_dealloc_status( istat )</div>
<div class="line"><a name="l00932"></a><span class="lineno">  932</span>&#160;      <span class="keyword">DEALLOCATE</span>(finalvert, stat=istat)</div>
<div class="line"><a name="l00933"></a><span class="lineno">  933</span>&#160;      check_dealloc_status( istat )</div>
<div class="line"><a name="l00934"></a><span class="lineno">  934</span>&#160;      <span class="keyword">DEALLOCATE</span>(lon_cent_trig, stat=istat)</div>
<div class="line"><a name="l00935"></a><span class="lineno">  935</span>&#160;      check_dealloc_status( istat )</div>
<div class="line"><a name="l00936"></a><span class="lineno">  936</span>&#160;      <span class="keyword">DEALLOCATE</span>(lat_cent_trig, stat=istat)</div>
<div class="line"><a name="l00937"></a><span class="lineno">  937</span>&#160;      check_dealloc_status( istat )</div>
<div class="line"><a name="l00938"></a><span class="lineno">  938</span>&#160; </div>
<div class="line"><a name="l00939"></a><span class="lineno">  939</span>&#160;      <span class="keyword">ALLOCATE</span>(grid_dims(2), stat=istat)</div>
<div class="line"><a name="l00940"></a><span class="lineno">  940</span>&#160;      check_alloc_status( istat )</div>
<div class="line"><a name="l00941"></a><span class="lineno">  941</span>&#160;      grid_dims(1)=mnp</div>
<div class="line"><a name="l00942"></a><span class="lineno">  942</span>&#160;      grid_dims(2)=1</div>
<div class="line"><a name="l00943"></a><span class="lineno">  943</span>&#160;      grid_size=mnp</div>
<div class="line"><a name="l00944"></a><span class="lineno">  944</span>&#160;<span class="keywordflow">    END IF</span></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="w3servmd_8F90_source.html#l00736">w3servmd::extcde()</a>, <a class="el" href="wmscrpmd_8F90_source.html#l01711">fix_periodcity()</a>, <a class="el" href="wmscrpmd_8F90_source.html#l01502">get_boundary()</a>, <a class="el" href="wmscrpmd_8F90_source.html#l01448">get_unstructured_vertex_degree()</a>, <a class="el" href="w3gdatmd_8F90_source.html#l01088">w3gdatmd::grids</a>, and <a class="el" href="wmscrpmd_8F90_source.html#l01413">triang_indexes()</a>.</p>

<p class="reference">Referenced by <a class="el" href="wmscrpmd_8F90_source.html#l01165">get_scrip_info()</a>.</p>

</div>
</div>
<a id="ad4af6c395fa4aceb01ca07579be7c212"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ad4af6c395fa4aceb01ca07579be7c212">&#9670;&nbsp;</a></span>get_unstructured_vertex_degree()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">subroutine wmscrpmd::get_unstructured_vertex_degree </td>
          <td>(</td>
          <td class="paramtype">integer, intent(in)&#160;</td>
          <td class="paramname"><em>MNP</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">integer, intent(in)&#160;</td>
          <td class="paramname"><em>MNE</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">integer, dimension(:,:), intent(in)&#160;</td>
          <td class="paramname"><em>TRIGP</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">integer, dimension(:), intent(out)&#160;</td>
          <td class="paramname"><em>TRIGINCD</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>This function returns the list of incidences. </p>
<p>Output: TrigIncd - number of triangles contained by vertices.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">MNP</td><td>Number of nodes </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">MNE</td><td>List of nodes </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">TRIGP</td><td>Number of triangles </td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">TRIGINCD</td><td>Number of triangles contained by vertices.</td></tr>
  </table>
  </dd>
</dl>
<dl class="section author"><dt>Author</dt><dd>M. Dutour </dd>
<dd>
A. Roland </dd></dl>
<dl class="section date"><dt>Date</dt><dd>20-Feb-2012 </dd></dl>

<p class="definition">Definition at line <a class="el" href="wmscrpmd_8F90_source.html#l01448">1448</a> of file <a class="el" href="wmscrpmd_8F90_source.html">wmscrpmd.F90</a>.</p>
<div class="fragment"><div class="line"><a name="l01448"></a><span class="lineno"> 1448</span>&#160;    <span class="comment">!  Written:</span></div>
<div class="line"><a name="l01449"></a><span class="lineno"> 1449</span>&#160;    <span class="comment">!</span></div>
<div class="line"><a name="l01450"></a><span class="lineno"> 1450</span>&#160;    <span class="comment">!    20-Feb-2012</span></div>
<div class="line"><a name="l01451"></a><span class="lineno"> 1451</span>&#160;    <span class="comment">!</span></div>
<div class="line"><a name="l01452"></a><span class="lineno"> 1452</span>&#160;    <span class="comment">!  Author:</span></div>
<div class="line"><a name="l01453"></a><span class="lineno"> 1453</span>&#160;    <span class="comment">!</span></div>
<div class="line"><a name="l01454"></a><span class="lineno"> 1454</span>&#160;    <span class="comment">!    Mathieu Dutour Sikiric, IRB &amp; Aron Roland, Z&amp;P</span></div>
<div class="line"><a name="l01455"></a><span class="lineno"> 1455</span>&#160;    <span class="comment">!</span></div>
<div class="line"><a name="l01456"></a><span class="lineno"> 1456</span>&#160;    <span class="comment">!  Parameters:</span></div>
<div class="line"><a name="l01457"></a><span class="lineno"> 1457</span>&#160;    <span class="comment">!   Input:</span></div>
<div class="line"><a name="l01458"></a><span class="lineno"> 1458</span>&#160;    <span class="comment">!    MNP: number of nodes</span></div>
<div class="line"><a name="l01459"></a><span class="lineno"> 1459</span>&#160;    <span class="comment">!    INE: list of nodes</span></div>
<div class="line"><a name="l01460"></a><span class="lineno"> 1460</span>&#160;    <span class="comment">!    MNE: number of triangles</span></div>
<div class="line"><a name="l01461"></a><span class="lineno"> 1461</span>&#160;    <span class="comment">!   Output:</span></div>
<div class="line"><a name="l01462"></a><span class="lineno"> 1462</span>&#160;    <span class="comment">!    TrigIncd (number of triangles contained by vertices</span></div>
<div class="line"><a name="l01463"></a><span class="lineno"> 1463</span>&#160;    <span class="comment">!</span></div>
<div class="line"><a name="l01464"></a><span class="lineno"> 1464</span>&#160;    <span class="comment">!  Description:</span></div>
<div class="line"><a name="l01465"></a><span class="lineno"> 1465</span>&#160;    <span class="comment">!    this function returns the list of incidences</span></div>
<div class="line"><a name="l01466"></a><span class="lineno"> 1466</span>&#160;    <span class="comment">!</span></div>
<div class="line"><a name="l01467"></a><span class="lineno"> 1467</span>&#160;    <span class="keywordtype">IMPLICIT NONE</span></div>
<div class="line"><a name="l01468"></a><span class="lineno"> 1468</span>&#160;    <span class="keywordtype">INTEGER</span>, <span class="keywordtype">INTENT(IN)</span> :: MNP, MNE</div>
<div class="line"><a name="l01469"></a><span class="lineno"> 1469</span>&#160;    <span class="keywordtype">INTEGER</span>, <span class="keywordtype">INTENT(IN)</span> :: TRIGP(:,:)</div>
<div class="line"><a name="l01470"></a><span class="lineno"> 1470</span>&#160;    <span class="keywordtype">INTEGER</span>, <span class="keywordtype">INTENT(OUT)</span> :: TRIGINCD(:)</div>
<div class="line"><a name="l01471"></a><span class="lineno"> 1471</span>&#160;    <span class="keywordtype">INTEGER</span> :: IP, IE, I</div>
<div class="line"><a name="l01472"></a><span class="lineno"> 1472</span>&#160;    trigincd=0</div>
<div class="line"><a name="l01473"></a><span class="lineno"> 1473</span>&#160;    <span class="keywordflow">DO</span> ie=1,mne</div>
<div class="line"><a name="l01474"></a><span class="lineno"> 1474</span>&#160;      <span class="keywordflow">DO</span> i=1,3</div>
<div class="line"><a name="l01475"></a><span class="lineno"> 1475</span>&#160;        ip=trigp(i,ie)</div>
<div class="line"><a name="l01476"></a><span class="lineno"> 1476</span>&#160;        trigincd(ip)=trigincd(ip) + 1</div>
<div class="line"><a name="l01477"></a><span class="lineno"> 1477</span>&#160;<span class="keywordflow">      END DO</span></div>
<div class="line"><a name="l01478"></a><span class="lineno"> 1478</span>&#160;<span class="keywordflow">    END DO</span></div>
</div><!-- fragment -->
<p class="reference">Referenced by <a class="el" href="wmscrpmd_8F90_source.html#l00551">get_scrip_info_unstructured()</a>.</p>

</div>
</div>
<a id="aef31042879618e8470d8c73c942a1bdb"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aef31042879618e8470d8c73c942a1bdb">&#9670;&nbsp;</a></span>scrip_info_renormalization()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">subroutine wmscrpmd::scrip_info_renormalization </td>
          <td>(</td>
          <td class="paramtype">real*8, dimension(:), intent(inout)&#160;</td>
          <td class="paramname"><em>GRID_CENTER_LON</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real*8, dimension(:), intent(inout)&#160;</td>
          <td class="paramname"><em>GRID_CENTER_LAT</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real*8, dimension(:,:), intent(inout)&#160;</td>
          <td class="paramname"><em>GRID_CORNER_LON</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real*8, dimension(:,:), intent(inout)&#160;</td>
          <td class="paramname"><em>GRID_CORNER_LAT</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">logical, dimension(:), intent(in)&#160;</td>
          <td class="paramname"><em>GRID_MASK</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">integer, dimension(:), intent(in)&#160;</td>
          <td class="paramname"><em>GRID_DIMS</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">integer, intent(in)&#160;</td>
          <td class="paramname"><em>GRID_SIZE</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">integer, intent(in)&#160;</td>
          <td class="paramname"><em>GRID_CORNERS</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">integer, intent(in)&#160;</td>
          <td class="paramname"><em>GRID_RANK</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real*8&#160;</td>
          <td class="paramname"><em>CONV_DX</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real*8&#160;</td>
          <td class="paramname"><em>CONV_DY</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real*8&#160;</td>
          <td class="paramname"><em>OFFSET</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real*8&#160;</td>
          <td class="paramname"><em>GRIDSHIFT</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Rescale according to whether the grid is spherical or not. </p>
<p>This is adapted from Erick Rogers scrip_wrapper.</p>
<p>Purpose is to rescale according to whether the grid is spherical or not and to adjust by some small shift to keep SCRIP happy in situations where nodes of different grids overlay.</p>
<p>We apply various transformations to the longitude latitude following here the transformations that were done only in finite difference meshes.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in,out]</td><td class="paramname">GRID_CENTER_LON</td><td></td></tr>
    <tr><td class="paramdir">[in,out]</td><td class="paramname">GRID_CENTER_LAT</td><td></td></tr>
    <tr><td class="paramdir">[in,out]</td><td class="paramname">GRID_CORNER_LON</td><td></td></tr>
    <tr><td class="paramdir">[in,out]</td><td class="paramname">GRID_CORNER_LAT</td><td></td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">GRID_MASK</td><td></td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">GRID_DIMS</td><td></td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">GRID_SIZE</td><td></td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">GRID_CORNERS</td><td></td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">GRID_RANK</td><td></td></tr>
    <tr><td class="paramdir"></td><td class="paramname">CONV_DX</td><td></td></tr>
    <tr><td class="paramdir"></td><td class="paramname">CONV_DY</td><td></td></tr>
    <tr><td class="paramdir"></td><td class="paramname">OFFSET</td><td></td></tr>
    <tr><td class="paramdir"></td><td class="paramname">GRIDSHIFT</td><td></td></tr>
  </table>
  </dd>
</dl>
<dl class="section author"><dt>Author</dt><dd>M. Dutour </dd>
<dd>
A. Roland </dd></dl>
<dl class="section date"><dt>Date</dt><dd>20-Feb-2012 </dd></dl>

<p class="definition">Definition at line <a class="el" href="wmscrpmd_8F90_source.html#l01313">1313</a> of file <a class="el" href="wmscrpmd_8F90_source.html">wmscrpmd.F90</a>.</p>
<div class="fragment"><div class="line"><a name="l01313"></a><span class="lineno"> 1313</span>&#160;    <span class="comment">!  1. Original author :</span></div>
<div class="line"><a name="l01314"></a><span class="lineno"> 1314</span>&#160;    <span class="comment">!</span></div>
<div class="line"><a name="l01315"></a><span class="lineno"> 1315</span>&#160;    <span class="comment">!     Mathieu Dutour Sikiric, IRB &amp; Aron Roland, Z&amp;P</span></div>
<div class="line"><a name="l01316"></a><span class="lineno"> 1316</span>&#160;    <span class="comment">!     Adapted from Erick Rogers scrip_wrapper</span></div>
<div class="line"><a name="l01317"></a><span class="lineno"> 1317</span>&#160;    <span class="comment">!</span></div>
<div class="line"><a name="l01318"></a><span class="lineno"> 1318</span>&#160;    <span class="comment">!  2. Last update :</span></div>
<div class="line"><a name="l01319"></a><span class="lineno"> 1319</span>&#160;    <span class="comment">!</span></div>
<div class="line"><a name="l01320"></a><span class="lineno"> 1320</span>&#160;    <span class="comment">!     See revisions.</span></div>
<div class="line"><a name="l01321"></a><span class="lineno"> 1321</span>&#160;    <span class="comment">!</span></div>
<div class="line"><a name="l01322"></a><span class="lineno"> 1322</span>&#160;    <span class="comment">!  3. Revisions :</span></div>
<div class="line"><a name="l01323"></a><span class="lineno"> 1323</span>&#160;    <span class="comment">!</span></div>
<div class="line"><a name="l01324"></a><span class="lineno"> 1324</span>&#160;    <span class="comment">!     20-Feb-2012 : Origination</span></div>
<div class="line"><a name="l01325"></a><span class="lineno"> 1325</span>&#160;    <span class="comment">!</span></div>
<div class="line"><a name="l01326"></a><span class="lineno"> 1326</span>&#160;    <span class="comment">!  4. Copyright :</span></div>
<div class="line"><a name="l01327"></a><span class="lineno"> 1327</span>&#160;    <span class="comment">!</span></div>
<div class="line"><a name="l01328"></a><span class="lineno"> 1328</span>&#160;    <span class="comment">!  5. Purpose :</span></div>
<div class="line"><a name="l01329"></a><span class="lineno"> 1329</span>&#160;    <span class="comment">!</span></div>
<div class="line"><a name="l01330"></a><span class="lineno"> 1330</span>&#160;    <span class="comment">!     This is adapted from Erick Rogers scrip_wrapper</span></div>
<div class="line"><a name="l01331"></a><span class="lineno"> 1331</span>&#160;    <span class="comment">!     Purpose is to rescale according to whether the grid is spherical</span></div>
<div class="line"><a name="l01332"></a><span class="lineno"> 1332</span>&#160;    <span class="comment">!     or not and to adjust by some small shift to keep SCRIP happy</span></div>
<div class="line"><a name="l01333"></a><span class="lineno"> 1333</span>&#160;    <span class="comment">!     in situations where nodes of different grids overlay</span></div>
<div class="line"><a name="l01334"></a><span class="lineno"> 1334</span>&#160;    <span class="comment">!</span></div>
<div class="line"><a name="l01335"></a><span class="lineno"> 1335</span>&#160;    <span class="comment">!  6. Method :</span></div>
<div class="line"><a name="l01336"></a><span class="lineno"> 1336</span>&#160;    <span class="comment">!</span></div>
<div class="line"><a name="l01337"></a><span class="lineno"> 1337</span>&#160;    <span class="comment">!    We apply various transformations to the longitude latitude</span></div>
<div class="line"><a name="l01338"></a><span class="lineno"> 1338</span>&#160;    <span class="comment">!    following here the transformations that were done only in</span></div>
<div class="line"><a name="l01339"></a><span class="lineno"> 1339</span>&#160;    <span class="comment">!    finite difference meshes.</span></div>
<div class="line"><a name="l01340"></a><span class="lineno"> 1340</span>&#160;    <span class="comment">!</span></div>
<div class="line"><a name="l01341"></a><span class="lineno"> 1341</span>&#160;    <span class="comment">!  7. Parameters, Variables and types :</span></div>
<div class="line"><a name="l01342"></a><span class="lineno"> 1342</span>&#160;    <span class="comment">!</span></div>
<div class="line"><a name="l01343"></a><span class="lineno"> 1343</span>&#160;    <span class="comment">!  8. Called by :</span></div>
<div class="line"><a name="l01344"></a><span class="lineno"> 1344</span>&#160;    <span class="comment">!</span></div>
<div class="line"><a name="l01345"></a><span class="lineno"> 1345</span>&#160;    <span class="comment">!     Subroutine WMGHGH</span></div>
<div class="line"><a name="l01346"></a><span class="lineno"> 1346</span>&#160;    <span class="comment">!</span></div>
<div class="line"><a name="l01347"></a><span class="lineno"> 1347</span>&#160;    <span class="comment">!  9. Subroutines and functions used :</span></div>
<div class="line"><a name="l01348"></a><span class="lineno"> 1348</span>&#160;    <span class="comment">!</span></div>
<div class="line"><a name="l01349"></a><span class="lineno"> 1349</span>&#160;    <span class="comment">! 10. Error messages:</span></div>
<div class="line"><a name="l01350"></a><span class="lineno"> 1350</span>&#160;    <span class="comment">!</span></div>
<div class="line"><a name="l01351"></a><span class="lineno"> 1351</span>&#160;    <span class="comment">! 11. Remarks :</span></div>
<div class="line"><a name="l01352"></a><span class="lineno"> 1352</span>&#160;    <span class="comment">!</span></div>
<div class="line"><a name="l01353"></a><span class="lineno"> 1353</span>&#160;    <span class="comment">! 12. Structure :</span></div>
<div class="line"><a name="l01354"></a><span class="lineno"> 1354</span>&#160;    <span class="comment">!</span></div>
<div class="line"><a name="l01355"></a><span class="lineno"> 1355</span>&#160;    <span class="comment">! 13. Switches :</span></div>
<div class="line"><a name="l01356"></a><span class="lineno"> 1356</span>&#160;    <span class="comment">!</span></div>
<div class="line"><a name="l01357"></a><span class="lineno"> 1357</span>&#160;    <span class="comment">! 14. Source code :</span></div>
<div class="line"><a name="l01358"></a><span class="lineno"> 1358</span>&#160;    <span class="keywordtype">IMPLICIT NONE</span></div>
<div class="line"><a name="l01359"></a><span class="lineno"> 1359</span>&#160;    real*8, <span class="keywordtype">INTENT(INOUT)</span> :: grid_center_lon(:)</div>
<div class="line"><a name="l01360"></a><span class="lineno"> 1360</span>&#160;    real*8, <span class="keywordtype">INTENT(INOUT)</span> :: grid_center_lat(:)</div>
<div class="line"><a name="l01361"></a><span class="lineno"> 1361</span>&#160;    <span class="keywordtype">LOGICAL</span>, <span class="keywordtype">INTENT(IN)</span> :: GRID_MASK(:)</div>
<div class="line"><a name="l01362"></a><span class="lineno"> 1362</span>&#160;    real*8, <span class="keywordtype">INTENT(INOUT)</span> :: grid_corner_lon(:,:)</div>
<div class="line"><a name="l01363"></a><span class="lineno"> 1363</span>&#160;    real*8, <span class="keywordtype">INTENT(INOUT)</span> :: grid_corner_lat(:,:)</div>
<div class="line"><a name="l01364"></a><span class="lineno"> 1364</span>&#160;    <span class="keywordtype">INTEGER</span>, <span class="keywordtype">INTENT(IN)</span> :: GRID_DIMS(:)</div>
<div class="line"><a name="l01365"></a><span class="lineno"> 1365</span>&#160;    <span class="keywordtype">INTEGER</span>, <span class="keywordtype">INTENT(IN)</span> :: GRID_SIZE, GRID_CORNERS, GRID_RANK</div>
<div class="line"><a name="l01366"></a><span class="lineno"> 1366</span>&#160;    real*8 :: conv_dx, conv_dy, offset, gridshift</div>
<div class="line"><a name="l01367"></a><span class="lineno"> 1367</span>&#160;    real*8 <a class="code" href="namespacescrip__grids.html#a0ed0b6d39c8ec373a2e8ca8a2ea11df6">deg2rad</a></div>
<div class="line"><a name="l01368"></a><span class="lineno"> 1368</span>&#160;    <span class="comment">!</span></div>
<div class="line"><a name="l01369"></a><span class="lineno"> 1369</span>&#160;    <span class="keywordtype">INTEGER</span> :: I, J, IP</div>
<div class="line"><a name="l01370"></a><span class="lineno"> 1370</span>&#160;    real*8 :: minlon, minlat, maxlon, maxlat, hlon, hlat</div>
<div class="line"><a name="l01371"></a><span class="lineno"> 1371</span>&#160;    real*8 :: minloncorner, maxloncorner, minlatcorner, maxlatcorner</div>
<div class="line"><a name="l01372"></a><span class="lineno"> 1372</span>&#160; </div>
<div class="line"><a name="l01373"></a><span class="lineno"> 1373</span>&#160;    <span class="keywordflow">DO</span> i=1,grid_size</div>
<div class="line"><a name="l01374"></a><span class="lineno"> 1374</span>&#160;      grid_center_lon(i)=(grid_center_lon(i)+offset)/conv_dx +        &amp;</div>
<div class="line"><a name="l01375"></a><span class="lineno"> 1375</span>&#160;           &amp;       gridshift</div>
<div class="line"><a name="l01376"></a><span class="lineno"> 1376</span>&#160;      grid_center_lat(i)=grid_center_lat(i)/conv_dy +                 &amp;</div>
<div class="line"><a name="l01377"></a><span class="lineno"> 1377</span>&#160;           &amp;       gridshift</div>
<div class="line"><a name="l01378"></a><span class="lineno"> 1378</span>&#160;      <span class="keywordflow">IF</span>(grid_center_lon(i)&gt;360.0) <span class="keywordflow">THEN</span></div>
<div class="line"><a name="l01379"></a><span class="lineno"> 1379</span>&#160;        grid_center_lon(i)=grid_center_lon(i)-360.0</div>
<div class="line"><a name="l01380"></a><span class="lineno"> 1380</span>&#160;<span class="keywordflow">      END IF</span></div>
<div class="line"><a name="l01381"></a><span class="lineno"> 1381</span>&#160;      <span class="keywordflow">IF</span>(grid_center_lon(i)&lt;000.0) <span class="keywordflow">THEN</span></div>
<div class="line"><a name="l01382"></a><span class="lineno"> 1382</span>&#160;        grid_center_lon(i)=grid_center_lon(i)+360.0</div>
<div class="line"><a name="l01383"></a><span class="lineno"> 1383</span>&#160;<span class="keywordflow">      END IF</span></div>
<div class="line"><a name="l01384"></a><span class="lineno"> 1384</span>&#160;      <span class="keywordflow">DO</span> j=1,grid_corners</div>
<div class="line"><a name="l01385"></a><span class="lineno"> 1385</span>&#160;        grid_corner_lon(j, i)=(grid_corner_lon(j, i)+offset)/conv_dx+ &amp;</div>
<div class="line"><a name="l01386"></a><span class="lineno"> 1386</span>&#160;             &amp;       gridshift</div>
<div class="line"><a name="l01387"></a><span class="lineno"> 1387</span>&#160;        grid_corner_lat(j, i)=grid_corner_lat(j, i)/conv_dy +         &amp;</div>
<div class="line"><a name="l01388"></a><span class="lineno"> 1388</span>&#160;             &amp;       gridshift</div>
<div class="line"><a name="l01389"></a><span class="lineno"> 1389</span>&#160;        <span class="keywordflow">IF</span>(grid_corner_lon(j,i)&gt;360.0) <span class="keywordflow">THEN</span></div>
<div class="line"><a name="l01390"></a><span class="lineno"> 1390</span>&#160;          grid_corner_lon(j,i)=grid_corner_lon(j,i)-360.0</div>
<div class="line"><a name="l01391"></a><span class="lineno"> 1391</span>&#160;<span class="keywordflow">        END IF</span></div>
<div class="line"><a name="l01392"></a><span class="lineno"> 1392</span>&#160;        <span class="keywordflow">IF</span>(grid_corner_lon(j,i)&lt;000.0) <span class="keywordflow">THEN</span></div>
<div class="line"><a name="l01393"></a><span class="lineno"> 1393</span>&#160;          grid_corner_lon(j,i)=grid_corner_lon(j,i)+360.0</div>
<div class="line"><a name="l01394"></a><span class="lineno"> 1394</span>&#160;<span class="keywordflow">        END IF</span></div>
<div class="line"><a name="l01395"></a><span class="lineno"> 1395</span>&#160;<span class="keywordflow">      END DO</span></div>
<div class="line"><a name="l01396"></a><span class="lineno"> 1396</span>&#160;<span class="keywordflow">    END DO</span></div>
<div class="line"><a name="l01397"></a><span class="lineno"> 1397</span>&#160; </div>
</div><!-- fragment -->
<p class="reference">Referenced by <a class="el" href="wmscrpmd_8F90_source.html#l00115">scrip_wrapper()</a>.</p>

</div>
</div>
<a id="aead9c900863f602a8ff52427419a7709"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aead9c900863f602a8ff52427419a7709">&#9670;&nbsp;</a></span>scrip_wrapper()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">subroutine wmscrpmd::scrip_wrapper </td>
          <td>(</td>
          <td class="paramtype">integer(scrip_i4), intent(in)&#160;</td>
          <td class="paramname"><em>ID_SRC</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">integer(scrip_i4), intent(in)&#160;</td>
          <td class="paramname"><em>ID_DST</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">integer(scrip_i4), dimension(:,:), intent(in)&#160;</td>
          <td class="paramname"><em>MAPSTA_SRC</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">integer(scrip_i4), dimension(:,:), intent(in)&#160;</td>
          <td class="paramname"><em>MAPST2_SRC</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">logical(scrip_logical), intent(in)&#160;</td>
          <td class="paramname"><em>FLAGLL</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real (scrip_r8), intent(in)&#160;</td>
          <td class="paramname"><em>GRIDSHIFT</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">logical(scrip_logical), intent(in)&#160;</td>
          <td class="paramname"><em>L_MASTER</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">logical(scrip_logical), intent(in)&#160;</td>
          <td class="paramname"><em>L_READ</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">logical(scrip_logical), intent(in)&#160;</td>
          <td class="paramname"><em>L_TEST</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Compute grid information required by SCRIP. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">ID_SRC</td><td></td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">ID_DST</td><td></td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">MAPSTA_SRC</td><td></td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">MAPST2_SRC</td><td></td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">FLAGLL</td><td></td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">GRIDSHIFT</td><td></td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">L_MASTER</td><td></td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">L_READ</td><td></td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">L_TEST</td><td></td></tr>
  </table>
  </dd>
</dl>
<dl class="section author"><dt>Author</dt><dd>E. Rogers </dd>
<dd>
M. Dutour </dd>
<dd>
A. Roland </dd></dl>
<dl class="section date"><dt>Date</dt><dd>10-Dec-2014 </dd></dl>

<p class="definition">Definition at line <a class="el" href="wmscrpmd_8F90_source.html#l00115">115</a> of file <a class="el" href="wmscrpmd_8F90_source.html">wmscrpmd.F90</a>.</p>
<div class="fragment"><div class="line"><a name="l00115"></a><span class="lineno">  115</span>&#160;    <span class="comment">!/                  +-----------------------------------+</span></div>
<div class="line"><a name="l00116"></a><span class="lineno">  116</span>&#160;    <span class="comment">!/                  | WAVEWATCH III                     |</span></div>
<div class="line"><a name="l00117"></a><span class="lineno">  117</span>&#160;    <span class="comment">!/                  | E. Rogers, M. Dutour, A. Roland   |</span></div>
<div class="line"><a name="l00118"></a><span class="lineno">  118</span>&#160;    <span class="comment">!/                  |                        FORTRAN 90 |</span></div>
<div class="line"><a name="l00119"></a><span class="lineno">  119</span>&#160;    <span class="comment">!/                  | Last update :         10-Dec-2014 !</span></div>
<div class="line"><a name="l00120"></a><span class="lineno">  120</span>&#160;    <span class="comment">!/                  +-----------------------------------+</span></div>
<div class="line"><a name="l00121"></a><span class="lineno">  121</span>&#160;    <span class="comment">!/</span></div>
<div class="line"><a name="l00122"></a><span class="lineno">  122</span>&#160;    <span class="comment">!  1. Original author :</span></div>
<div class="line"><a name="l00123"></a><span class="lineno">  123</span>&#160;    <span class="comment">!</span></div>
<div class="line"><a name="l00124"></a><span class="lineno">  124</span>&#160;    <span class="comment">!     Erick Rogers, NRL</span></div>
<div class="line"><a name="l00125"></a><span class="lineno">  125</span>&#160;    <span class="comment">!</span></div>
<div class="line"><a name="l00126"></a><span class="lineno">  126</span>&#160;    <span class="comment">!  2. Last update :</span></div>
<div class="line"><a name="l00127"></a><span class="lineno">  127</span>&#160;    <span class="comment">!</span></div>
<div class="line"><a name="l00128"></a><span class="lineno">  128</span>&#160;    <span class="comment">!     See revisions.</span></div>
<div class="line"><a name="l00129"></a><span class="lineno">  129</span>&#160;    <span class="comment">!</span></div>
<div class="line"><a name="l00130"></a><span class="lineno">  130</span>&#160;    <span class="comment">!  3. Revisions :</span></div>
<div class="line"><a name="l00131"></a><span class="lineno">  131</span>&#160;    <span class="comment">!</span></div>
<div class="line"><a name="l00132"></a><span class="lineno">  132</span>&#160;    <span class="comment">!     29-Apr-2011 : Origination                         ( version 4.01 )</span></div>
<div class="line"><a name="l00133"></a><span class="lineno">  133</span>&#160;    <span class="comment">!     20-Feb-2012 : Mathieu Dutour Sikiric, Aron Roland Z&amp;P</span></div>
<div class="line"><a name="l00134"></a><span class="lineno">  134</span>&#160;    <span class="comment">!                   Modification is to split the code into several</span></div>
<div class="line"><a name="l00135"></a><span class="lineno">  135</span>&#160;    <span class="comment">!                   subroutines</span></div>
<div class="line"><a name="l00136"></a><span class="lineno">  136</span>&#160;    <span class="comment">!                   ---get_scrip_info_structured (the structured case)</span></div>
<div class="line"><a name="l00137"></a><span class="lineno">  137</span>&#160;    <span class="comment">!                   ---get_scrip_info (chooses according to FD/FE)</span></div>
<div class="line"><a name="l00138"></a><span class="lineno">  138</span>&#160;    <span class="comment">!                   ---scrip_info_renormalization (conv_x and all that)</span></div>
<div class="line"><a name="l00139"></a><span class="lineno">  139</span>&#160;    <span class="comment">!     11-Apr-2013   Kevin Lind</span></div>
<div class="line"><a name="l00140"></a><span class="lineno">  140</span>&#160;    <span class="comment">!                   Added code for reading/writing SCRIP remap files</span></div>
<div class="line"><a name="l00141"></a><span class="lineno">  141</span>&#160;    <span class="comment">!/    10-Dec-2014 : Add checks for allocate status      ( version 5.04 )</span></div>
<div class="line"><a name="l00142"></a><span class="lineno">  142</span>&#160;    <span class="comment">!</span></div>
<div class="line"><a name="l00143"></a><span class="lineno">  143</span>&#160;    <span class="comment">!  4. Copyright :</span></div>
<div class="line"><a name="l00144"></a><span class="lineno">  144</span>&#160;    <span class="comment">!</span></div>
<div class="line"><a name="l00145"></a><span class="lineno">  145</span>&#160;    <span class="comment">!  5. Purpose :</span></div>
<div class="line"><a name="l00146"></a><span class="lineno">  146</span>&#160;    <span class="comment">!</span></div>
<div class="line"><a name="l00147"></a><span class="lineno">  147</span>&#160;    <span class="comment">!     Compute grid information required by SCRIP</span></div>
<div class="line"><a name="l00148"></a><span class="lineno">  148</span>&#160;    <span class="comment">!</span></div>
<div class="line"><a name="l00149"></a><span class="lineno">  149</span>&#160;    <span class="comment">!  6. Method :</span></div>
<div class="line"><a name="l00150"></a><span class="lineno">  150</span>&#160;    <span class="comment">!</span></div>
<div class="line"><a name="l00151"></a><span class="lineno">  151</span>&#160;    <span class="comment">!  7. Parameters, Variables and types :</span></div>
<div class="line"><a name="l00152"></a><span class="lineno">  152</span>&#160;    <span class="comment">!</span></div>
<div class="line"><a name="l00153"></a><span class="lineno">  153</span>&#160;    <span class="comment">!  8. Called by :</span></div>
<div class="line"><a name="l00154"></a><span class="lineno">  154</span>&#160;    <span class="comment">!</span></div>
<div class="line"><a name="l00155"></a><span class="lineno">  155</span>&#160;    <span class="comment">!     Subroutine WMGHGH</span></div>
<div class="line"><a name="l00156"></a><span class="lineno">  156</span>&#160;    <span class="comment">!</span></div>
<div class="line"><a name="l00157"></a><span class="lineno">  157</span>&#160;    <span class="comment">!  9. Subroutines and functions used :</span></div>
<div class="line"><a name="l00158"></a><span class="lineno">  158</span>&#160;    <span class="comment">!</span></div>
<div class="line"><a name="l00159"></a><span class="lineno">  159</span>&#160;    <span class="comment">!     Subroutine SCRIP</span></div>
<div class="line"><a name="l00160"></a><span class="lineno">  160</span>&#160;    <span class="comment">!</span></div>
<div class="line"><a name="l00161"></a><span class="lineno">  161</span>&#160;    <span class="comment">! 10. Error messages:</span></div>
<div class="line"><a name="l00162"></a><span class="lineno">  162</span>&#160;    <span class="comment">!</span></div>
<div class="line"><a name="l00163"></a><span class="lineno">  163</span>&#160;    <span class="comment">! 11. Remarks :</span></div>
<div class="line"><a name="l00164"></a><span class="lineno">  164</span>&#160;    <span class="comment">!</span></div>
<div class="line"><a name="l00165"></a><span class="lineno">  165</span>&#160;    <span class="comment">! 12. Structure :</span></div>
<div class="line"><a name="l00166"></a><span class="lineno">  166</span>&#160;    <span class="comment">!</span></div>
<div class="line"><a name="l00167"></a><span class="lineno">  167</span>&#160;    <span class="comment">! 13. Switches :</span></div>
<div class="line"><a name="l00168"></a><span class="lineno">  168</span>&#160;    <span class="comment">!</span></div>
<div class="line"><a name="l00169"></a><span class="lineno">  169</span>&#160;    <span class="comment">! 14. Source code :</span></div>
<div class="line"><a name="l00170"></a><span class="lineno">  170</span>&#160; </div>
<div class="line"><a name="l00171"></a><span class="lineno">  171</span>&#160;    <span class="keywordtype">USE </span><a class="code" href="namespacescrip__grids.html">scrip_grids</a></div>
<div class="line"><a name="l00172"></a><span class="lineno">  172</span>&#160;    <span class="keywordtype">USE </span><a class="code" href="namespacescrip__remap__vars.html">scrip_remap_vars</a></div>
<div class="line"><a name="l00173"></a><span class="lineno">  173</span>&#160;    <span class="keywordtype">USE </span><a class="code" href="namespacescrip__constants.html">scrip_constants</a></div>
<div class="line"><a name="l00174"></a><span class="lineno">  174</span>&#160;    <span class="keywordtype">USE </span><a class="code" href="namespacescrip__kindsmod.html">scrip_kindsmod</a></div>
<div class="line"><a name="l00175"></a><span class="lineno">  175</span>&#160;    <span class="keywordtype">USE </span><a class="code" href="namespacescrip__interface.html">scrip_interface</a></div>
<div class="line"><a name="l00176"></a><span class="lineno">  176</span>&#160;    <span class="keywordtype">USE </span><a class="code" href="namespacew3servmd.html">w3servmd</a>, <span class="keywordtype">ONLY</span>: extcde</div>
<div class="line"><a name="l00177"></a><span class="lineno">  177</span>&#160;    <span class="comment">!      USE W3GDATMD, ONLY : GRIDS</span></div>
<div class="line"><a name="l00178"></a><span class="lineno">  178</span>&#160; </div>
<div class="line"><a name="l00179"></a><span class="lineno">  179</span>&#160;    <span class="keywordtype">IMPLICIT NONE</span></div>
<div class="line"><a name="l00180"></a><span class="lineno">  180</span>&#160;    <span class="keywordtype">INTEGER(SCRIP_I4)</span>, <span class="keywordtype">INTENT(IN)</span>      :: ID_SRC, ID_DST</div>
<div class="line"><a name="l00181"></a><span class="lineno">  181</span>&#160;    <span class="keywordtype">INTEGER(SCRIP_I4)</span>, <span class="keywordtype">INTENT(IN)</span>      :: MAPSTA_SRC(:,:)</div>
<div class="line"><a name="l00182"></a><span class="lineno">  182</span>&#160;    <span class="keywordtype">INTEGER(SCRIP_I4)</span>, <span class="keywordtype">INTENT(IN)</span>      :: MAPST2_SRC(:,:)</div>
<div class="line"><a name="l00183"></a><span class="lineno">  183</span>&#160;    <span class="keywordtype">LOGICAL(SCRIP_LOGICAL)</span>, <span class="keywordtype">INTENT(IN)</span> :: FLAGLL</div>
<div class="line"><a name="l00184"></a><span class="lineno">  184</span>&#160;<span class="keywordtype">    REAL</span>   (SCRIP_R8), <span class="keywordtype">INTENT(IN)</span>      :: GRIDSHIFT</div>
<div class="line"><a name="l00185"></a><span class="lineno">  185</span>&#160;    <span class="keywordtype">LOGICAL(SCRIP_LOGICAL)</span>, <span class="keywordtype">INTENT(IN)</span> :: L_MASTER  <span class="comment">! Am I the master processor (do I/O)?</span></div>
<div class="line"><a name="l00186"></a><span class="lineno">  186</span>&#160;    <span class="keywordtype">LOGICAL(SCRIP_LOGICAL)</span>, <span class="keywordtype">INTENT(IN)</span> :: L_READ    <span class="comment">! Do I read the remap file?</span></div>
<div class="line"><a name="l00187"></a><span class="lineno">  187</span>&#160;    <span class="keywordtype">LOGICAL(SCRIP_LOGICAL)</span>, <span class="keywordtype">INTENT(IN)</span> :: L_TEST    <span class="comment">! Whether to include test output</span></div>
<div class="line"><a name="l00188"></a><span class="lineno">  188</span>&#160;    <span class="comment">! in subroutines</span></div>
<div class="line"><a name="l00189"></a><span class="lineno">  189</span>&#160;    <span class="comment">!/ ------------------------------------------------------------------- /</span></div>
<div class="line"><a name="l00190"></a><span class="lineno">  190</span>&#160;    <span class="comment">!/ local variables</span></div>
<div class="line"><a name="l00191"></a><span class="lineno">  191</span>&#160;    <span class="comment">!/</span></div>
<div class="line"><a name="l00192"></a><span class="lineno">  192</span>&#160;    <span class="keywordtype">INTEGER(SCRIP_I4)</span>                 :: IREC,I,J,NI,NJ,IDUM,NK,K, &amp;</div>
<div class="line"><a name="l00193"></a><span class="lineno">  193</span>&#160;         ILINK,IW,ICORNER,NGOODPNTS, &amp;</div>
<div class="line"><a name="l00194"></a><span class="lineno">  194</span>&#160;         NBADPNTS</div>
<div class="line"><a name="l00195"></a><span class="lineno">  195</span>&#160;    <span class="keywordtype">INTEGER(SCRIP_I4)</span>                 :: ISRC,JSRC,KSRC,IPNT,KDST, &amp;</div>
<div class="line"><a name="l00196"></a><span class="lineno">  196</span>&#160;         NI_SRC</div>
<div class="line"><a name="l00197"></a><span class="lineno">  197</span>&#160;<span class="keywordtype">    REAL</span>   (SCRIP_R8)                 :: LAT_CONVERSION,OFFSET</div>
<div class="line"><a name="l00198"></a><span class="lineno">  198</span>&#160;<span class="keywordtype">    REAL</span>   (SCRIP_R8)                 :: CONV_DX,CONV_DY,WEIGHT</div>
<div class="line"><a name="l00199"></a><span class="lineno">  199</span>&#160;<span class="keywordtype">    REAL</span>   (SCRIP_R8)                 :: WTSUM</div>
<div class="line"><a name="l00200"></a><span class="lineno">  200</span>&#160;<span class="preprocessor">#ifdef W3_T38</span></div>
<div class="line"><a name="l00201"></a><span class="lineno">  201</span>&#160;<span class="preprocessor"></span>    <span class="keywordtype">CHARACTER (LEN=10)</span>      :: CDATE_TIME(3)</div>
<div class="line"><a name="l00202"></a><span class="lineno">  202</span>&#160;    <span class="keywordtype">INTEGER</span>                 :: DATE_TIME(8)</div>
<div class="line"><a name="l00203"></a><span class="lineno">  203</span>&#160;    <span class="keywordtype">INTEGER</span>                 :: ELAPSED_TIME, BEG_TIME, &amp;</div>
<div class="line"><a name="l00204"></a><span class="lineno">  204</span>&#160;         END_TIME</div>
<div class="line"><a name="l00205"></a><span class="lineno">  205</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00206"></a><span class="lineno">  206</span>&#160;<span class="preprocessor"></span> </div>
<div class="line"><a name="l00207"></a><span class="lineno">  207</span>&#160;    <span class="comment">! test output for input variables</span></div>
<div class="line"><a name="l00208"></a><span class="lineno">  208</span>&#160; </div>
<div class="line"><a name="l00209"></a><span class="lineno">  209</span>&#160;<span class="preprocessor">#ifdef W3_T38</span></div>
<div class="line"><a name="l00210"></a><span class="lineno">  210</span>&#160;<span class="preprocessor"></span>    <span class="keywordflow">if</span>(l_master)<span class="keyword">write</span>(*,*)<span class="stringliteral">&#39;flagll = &#39;</span>,flagll</div>
<div class="line"><a name="l00211"></a><span class="lineno">  211</span>&#160;    <span class="keywordflow">if</span>(l_master)<span class="keyword">write</span>(*,*)<span class="stringliteral">&#39;gridshift = &#39;</span>,gridshift</div>
<div class="line"><a name="l00212"></a><span class="lineno">  212</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00213"></a><span class="lineno">  213</span>&#160;<span class="preprocessor"></span> </div>
<div class="line"><a name="l00214"></a><span class="lineno">  214</span>&#160;    <span class="comment">!</span></div>
<div class="line"><a name="l00215"></a><span class="lineno">  215</span>&#160;    <span class="comment">! START: universal settings</span></div>
<div class="line"><a name="l00216"></a><span class="lineno">  216</span>&#160;    <span class="comment">!</span></div>
<div class="line"><a name="l00217"></a><span class="lineno">  217</span>&#160; </div>
<div class="line"><a name="l00218"></a><span class="lineno">  218</span>&#160;    <span class="comment">!     Set variables for converting to degrees</span></div>
<div class="line"><a name="l00219"></a><span class="lineno">  219</span>&#160;    <span class="comment">!     notes: SCRIP only operates on spherical coordinates, so for the case</span></div>
<div class="line"><a name="l00220"></a><span class="lineno">  220</span>&#160;    <span class="comment">!         where the problem is specified by the user as in a</span></div>
<div class="line"><a name="l00221"></a><span class="lineno">  221</span>&#160;    <span class="comment">!         meters/cartesian coordinate system, it is necessary to make</span></div>
<div class="line"><a name="l00222"></a><span class="lineno">  222</span>&#160;    <span class="comment">!         a temporary conversion to a &quot;fake&quot; spherical coordinate grid,</span></div>
<div class="line"><a name="l00223"></a><span class="lineno">  223</span>&#160;    <span class="comment">!         to keep SCRIP happy. The good news here is that multi-grid</span></div>
<div class="line"><a name="l00224"></a><span class="lineno">  224</span>&#160;    <span class="comment">!         meters-grid simulations will be very rare: we will probably only</span></div>
<div class="line"><a name="l00225"></a><span class="lineno">  225</span>&#160;    <span class="comment">!         encounter them in the context of simple test cases. Strictly</span></div>
<div class="line"><a name="l00226"></a><span class="lineno">  226</span>&#160;    <span class="comment">!         speaking, this conversion does not even need to be physically</span></div>
<div class="line"><a name="l00227"></a><span class="lineno">  227</span>&#160;    <span class="comment">!         correct, e.g. we could say that 1000 km is 1 deg....as long as</span></div>
<div class="line"><a name="l00228"></a><span class="lineno">  228</span>&#160;    <span class="comment">!         we are consistent between grids.</span></div>
<div class="line"><a name="l00229"></a><span class="lineno">  229</span>&#160;    <span class="comment">!     Potential future improvement: make conv_dy and offset such that dst grid</span></div>
<div class="line"><a name="l00230"></a><span class="lineno">  230</span>&#160;    <span class="comment">!         covers a specific longitude range, e.g. 1 deg east to 2 deg east</span></div>
<div class="line"><a name="l00231"></a><span class="lineno">  231</span>&#160; </div>
<div class="line"><a name="l00232"></a><span class="lineno">  232</span>&#160;    <span class="comment">!</span></div>
<div class="line"><a name="l00233"></a><span class="lineno">  233</span>&#160;    <span class="comment">! START: set up src grid</span></div>
<div class="line"><a name="l00234"></a><span class="lineno">  234</span>&#160;    <span class="comment">!</span></div>
<div class="line"><a name="l00235"></a><span class="lineno">  235</span>&#160; </div>
<div class="line"><a name="l00236"></a><span class="lineno">  236</span>&#160;    <span class="comment">!notes: when we work out how to interface with an unstructured grid,</span></div>
<div class="line"><a name="l00237"></a><span class="lineno">  237</span>&#160;    <span class="comment">!       we will need to revisit this issue of how to set grid1_rank, etc.</span></div>
<div class="line"><a name="l00238"></a><span class="lineno">  238</span>&#160;    <span class="comment">!       strategy: declare variables in grid module, but allocate them here.</span></div>
<div class="line"><a name="l00239"></a><span class="lineno">  239</span>&#160;    <span class="comment">!</span></div>
<div class="line"><a name="l00240"></a><span class="lineno">  240</span>&#160;    <a class="code" href="namespacescrip__grids.html#a22212c8b2a76c6462d725ab5f9939273">grid1_units</a>=<span class="stringliteral">&#39;degrees&#39;</span> <span class="comment">! the other option is radians...we don&#39;t use this</span></div>
<div class="line"><a name="l00241"></a><span class="lineno">  241</span>&#160;    <a class="code" href="namespacescrip__grids.html#a45584a758eceac04cd253e9031a3bcea">grid1_name</a>=<span class="stringliteral">&#39;src&#39;</span> <span class="comment">! this is not used, except for netcdf output</span></div>
<div class="line"><a name="l00242"></a><span class="lineno">  242</span>&#160;    <span class="keyword">CALL </span><a class="code" href="namespacewmscrpmd.html#a1120b9c547b5baa010d3c8fad18490b9">get_scrip_info</a>(id_src,                                       &amp;</div>
<div class="line"><a name="l00243"></a><span class="lineno">  243</span>&#160;         &amp;   <a class="code" href="namespacescrip__grids.html#a774d24c1d380a7fbf23ca890a5deb899">grid1_center_lon</a>, <a class="code" href="namespacescrip__grids.html#af883cc28db3bfe80dd1828d1e8d4ed56">grid1_center_lat</a>,                            &amp;</div>
<div class="line"><a name="l00244"></a><span class="lineno">  244</span>&#160;         &amp;   <a class="code" href="namespacescrip__grids.html#a29fdc18739da00a0a55d53de07857d82">grid1_corner_lon</a>, <a class="code" href="namespacescrip__grids.html#aada42b13bda19b10e051e15898647b4a">grid1_corner_lat</a>, <a class="code" href="namespacescrip__grids.html#a5f682e4c9506e03107b95e89ace6a278">grid1_mask</a>,                &amp;</div>
<div class="line"><a name="l00245"></a><span class="lineno">  245</span>&#160;         &amp;   <a class="code" href="namespacescrip__grids.html#a49a55c679a77020469894049f721e39a">grid1_dims</a>, <a class="code" href="namespacescrip__grids.html#af254072284efe9fe5ffdf6e9fc202ea7">grid1_size</a>, <a class="code" href="namespacescrip__grids.html#a1c2f7e645efe5c86480d63170f781c84">grid1_corners</a>, <a class="code" href="namespacescrip__grids.html#a0fc6ffc27a89ff7d4c82b26f8471cada">grid1_rank</a>)</div>
<div class="line"><a name="l00246"></a><span class="lineno">  246</span>&#160;    <a class="code" href="namespacescrip__grids.html#a5d3d24c7d9e2f2aa02b386e4d812bc35">grid2_units</a>=<span class="stringliteral">&#39;degrees&#39;</span></div>
<div class="line"><a name="l00247"></a><span class="lineno">  247</span>&#160;    <a class="code" href="namespacescrip__grids.html#a3d95417da9f05ce713a020b09d2c9b0e">grid2_name</a>=<span class="stringliteral">&#39;dst&#39;</span></div>
<div class="line"><a name="l00248"></a><span class="lineno">  248</span>&#160;    <span class="keyword">CALL </span><a class="code" href="namespacewmscrpmd.html#a1120b9c547b5baa010d3c8fad18490b9">get_scrip_info</a>(id_dst,                                       &amp;</div>
<div class="line"><a name="l00249"></a><span class="lineno">  249</span>&#160;         &amp;   <a class="code" href="namespacescrip__grids.html#a5725ab44d2bf128d6ec20bfdbdbe7394">grid2_center_lon</a>, <a class="code" href="namespacescrip__grids.html#af2aef83426ddf9d48db7736a7a502dd4">grid2_center_lat</a>,                            &amp;</div>
<div class="line"><a name="l00250"></a><span class="lineno">  250</span>&#160;         &amp;   <a class="code" href="namespacescrip__grids.html#abd626ac8143111bb57d9a729442d0717">grid2_corner_lon</a>, <a class="code" href="namespacescrip__grids.html#aa194cce0777bf7c51b8b0ff644a4230a">grid2_corner_lat</a>, <a class="code" href="namespacescrip__grids.html#a2ba0682513564fd7ed3b4c4ca102cfdd">grid2_mask</a>,                &amp;</div>
<div class="line"><a name="l00251"></a><span class="lineno">  251</span>&#160;         &amp;   <a class="code" href="namespacescrip__grids.html#a13541701ddd4712917bbdb9d9c5c8b68">grid2_dims</a>, <a class="code" href="namespacescrip__grids.html#a8a39e6df61b3471d373773d2930bfed4">grid2_size</a>, <a class="code" href="namespacescrip__grids.html#ac07bc02943c33322df7a9dc114c91222">grid2_corners</a>, <a class="code" href="namespacescrip__grids.html#a26b4ef12e531c9693862e74d73b7ecac">grid2_rank</a>)</div>
<div class="line"><a name="l00252"></a><span class="lineno">  252</span>&#160; </div>
<div class="line"><a name="l00253"></a><span class="lineno">  253</span>&#160;    <span class="keywordflow">IF</span>(flagll)<span class="keywordflow">THEN</span></div>
<div class="line"><a name="l00254"></a><span class="lineno">  254</span>&#160;      conv_dx=<a class="code" href="namespacescrip__constants.html#a766bef5f354460e4fdd00aefd1b85bc3">one</a></div>
<div class="line"><a name="l00255"></a><span class="lineno">  255</span>&#160;      conv_dy=<a class="code" href="namespacescrip__constants.html#a766bef5f354460e4fdd00aefd1b85bc3">one</a></div>
<div class="line"><a name="l00256"></a><span class="lineno">  256</span>&#160;      offset=<a class="code" href="namespacescrip__constants.html#a8f7ef7b037191fbbeb9b568788a77405">zero</a></div>
<div class="line"><a name="l00257"></a><span class="lineno">  257</span>&#160;    <span class="keywordflow">ELSE</span></div>
<div class="line"><a name="l00258"></a><span class="lineno">  258</span>&#160;      lat_conversion=<a class="code" href="namespacescrip__constants.html#a8f7ef7b037191fbbeb9b568788a77405">zero</a> <span class="comment">! lat_conversion</span></div>
<div class="line"><a name="l00259"></a><span class="lineno">  259</span>&#160;      <span class="comment">! notes:    this is the latitude used for conversion everywhere</span></div>
<div class="line"><a name="l00260"></a><span class="lineno">  260</span>&#160;      <span class="comment">!           in the grid (approximation)</span></div>
<div class="line"><a name="l00261"></a><span class="lineno">  261</span>&#160;      <span class="comment">!           (in radians)</span></div>
<div class="line"><a name="l00262"></a><span class="lineno">  262</span>&#160;      <span class="comment">!           conv_dy=92.6*1200.0 ! physical, =92.6/(3/3600)=111000 m = 111 km</span></div>
<div class="line"><a name="l00263"></a><span class="lineno">  263</span>&#160;      conv_dy=1.0e+6_scrip_r8 <span class="comment">! non-physical, 1e+6=1 deg</span></div>
<div class="line"><a name="l00264"></a><span class="lineno">  264</span>&#160;      conv_dx=cos(lat_conversion)*conv_dy</div>
<div class="line"><a name="l00265"></a><span class="lineno">  265</span>&#160;      <span class="comment">! notes:    offset (in meters), is necessary so that our grid does</span></div>
<div class="line"><a name="l00266"></a><span class="lineno">  266</span>&#160;      <span class="comment">!           not lie on the branch cut</span></div>
<div class="line"><a name="l00267"></a><span class="lineno">  267</span>&#160;      offset=75000.0_scrip_r8-min(minval(<a class="code" href="namespacescrip__grids.html#a774d24c1d380a7fbf23ca890a5deb899">grid1_center_lon</a>),          &amp;</div>
<div class="line"><a name="l00268"></a><span class="lineno">  268</span>&#160;           &amp;                               minval(<a class="code" href="namespacescrip__grids.html#a5725ab44d2bf128d6ec20bfdbdbe7394">grid2_center_lon</a>))</div>
<div class="line"><a name="l00269"></a><span class="lineno">  269</span>&#160;<span class="keywordflow">    ENDIF</span></div>
<div class="line"><a name="l00270"></a><span class="lineno">  270</span>&#160; </div>
<div class="line"><a name="l00271"></a><span class="lineno">  271</span>&#160;    <span class="comment">!.....test output</span></div>
<div class="line"><a name="l00272"></a><span class="lineno">  272</span>&#160;<span class="preprocessor">#ifdef W3_T38</span></div>
<div class="line"><a name="l00273"></a><span class="lineno">  273</span>&#160;<span class="preprocessor"></span>    <span class="keyword">write</span>(*,*)<span class="stringliteral">&#39;l_master = &#39;</span>,l_master</div>
<div class="line"><a name="l00274"></a><span class="lineno">  274</span>&#160;    <span class="keywordflow">if</span>(l_master)<span class="keywordflow">then</span></div>
<div class="line"><a name="l00275"></a><span class="lineno">  275</span>&#160;      <span class="keyword">write</span>(*,*)<span class="stringliteral">&#39;conv_dx=&#39;</span>, conv_dx</div>
<div class="line"><a name="l00276"></a><span class="lineno">  276</span>&#160;      <span class="keyword">write</span>(*,*)<span class="stringliteral">&#39;conv_dy=&#39;</span>, conv_dy</div>
<div class="line"><a name="l00277"></a><span class="lineno">  277</span>&#160;      <span class="keyword">write</span>(*,*)<span class="stringliteral">&#39;offset = &#39;</span>,offset</div>
<div class="line"><a name="l00278"></a><span class="lineno">  278</span>&#160;      <span class="keyword">write</span>(*,*)<span class="stringliteral">&#39;grid1_size=&#39;</span>, <a class="code" href="namespacescrip__grids.html#af254072284efe9fe5ffdf6e9fc202ea7">grid1_size</a></div>
<div class="line"><a name="l00279"></a><span class="lineno">  279</span>&#160;      <span class="keyword">write</span>(*,*)<span class="stringliteral">&#39;grid2_size=&#39;</span>, <a class="code" href="namespacescrip__grids.html#a8a39e6df61b3471d373773d2930bfed4">grid2_size</a></div>
<div class="line"><a name="l00280"></a><span class="lineno">  280</span>&#160;      <span class="keyword">write</span>(*,*)<span class="stringliteral">&#39;l_read = &#39;</span>,l_read</div>
<div class="line"><a name="l00281"></a><span class="lineno">  281</span>&#160;      <span class="keyword">write</span>(*,*)<span class="stringliteral">&#39;minval(grid1_center_lon) = &#39;</span>,minval(<a class="code" href="namespacescrip__grids.html#a774d24c1d380a7fbf23ca890a5deb899">grid1_center_lon</a>)</div>
<div class="line"><a name="l00282"></a><span class="lineno">  282</span>&#160;      <span class="keyword">write</span>(*,*)<span class="stringliteral">&#39;maxval(grid1_center_lon) = &#39;</span>,maxval(<a class="code" href="namespacescrip__grids.html#a774d24c1d380a7fbf23ca890a5deb899">grid1_center_lon</a>)</div>
<div class="line"><a name="l00283"></a><span class="lineno">  283</span>&#160;      <span class="keyword">write</span>(*,*)<span class="stringliteral">&#39;minval(grid1_center_lat) = &#39;</span>,minval(<a class="code" href="namespacescrip__grids.html#af883cc28db3bfe80dd1828d1e8d4ed56">grid1_center_lat</a>)</div>
<div class="line"><a name="l00284"></a><span class="lineno">  284</span>&#160;      <span class="keyword">write</span>(*,*)<span class="stringliteral">&#39;maxval(grid1_center_lat) = &#39;</span>,maxval(<a class="code" href="namespacescrip__grids.html#af883cc28db3bfe80dd1828d1e8d4ed56">grid1_center_lat</a>)</div>
<div class="line"><a name="l00285"></a><span class="lineno">  285</span>&#160;      <span class="keyword">write</span>(*,*)<span class="stringliteral">&#39;minval(grid2_center_lon) = &#39;</span>,minval(<a class="code" href="namespacescrip__grids.html#a5725ab44d2bf128d6ec20bfdbdbe7394">grid2_center_lon</a>)</div>
<div class="line"><a name="l00286"></a><span class="lineno">  286</span>&#160;      <span class="keyword">write</span>(*,*)<span class="stringliteral">&#39;maxval(grid2_center_lon) = &#39;</span>,maxval(<a class="code" href="namespacescrip__grids.html#a5725ab44d2bf128d6ec20bfdbdbe7394">grid2_center_lon</a>)</div>
<div class="line"><a name="l00287"></a><span class="lineno">  287</span>&#160;      <span class="keyword">write</span>(*,*)<span class="stringliteral">&#39;minval(grid2_center_lat) = &#39;</span>,minval(<a class="code" href="namespacescrip__grids.html#af2aef83426ddf9d48db7736a7a502dd4">grid2_center_lat</a>)</div>
<div class="line"><a name="l00288"></a><span class="lineno">  288</span>&#160;      <span class="keyword">write</span>(*,*)<span class="stringliteral">&#39;maxval(grid2_center_lat) = &#39;</span>,maxval(<a class="code" href="namespacescrip__grids.html#af2aef83426ddf9d48db7736a7a502dd4">grid2_center_lat</a>)</div>
<div class="line"><a name="l00289"></a><span class="lineno">  289</span>&#160;<span class="keywordflow">    endif</span></div>
<div class="line"><a name="l00290"></a><span class="lineno">  290</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00291"></a><span class="lineno">  291</span>&#160;<span class="preprocessor"></span> </div>
<div class="line"><a name="l00292"></a><span class="lineno">  292</span>&#160;    <span class="keyword">CALL </span><a class="code" href="namespacewmscrpmd.html#aef31042879618e8470d8c73c942a1bdb">scrip_info_renormalization</a>(                                  &amp;</div>
<div class="line"><a name="l00293"></a><span class="lineno">  293</span>&#160;         &amp;   <a class="code" href="namespacescrip__grids.html#a774d24c1d380a7fbf23ca890a5deb899">grid1_center_lon</a>, <a class="code" href="namespacescrip__grids.html#af883cc28db3bfe80dd1828d1e8d4ed56">grid1_center_lat</a>,                            &amp;</div>
<div class="line"><a name="l00294"></a><span class="lineno">  294</span>&#160;         &amp;   <a class="code" href="namespacescrip__grids.html#a29fdc18739da00a0a55d53de07857d82">grid1_corner_lon</a>, <a class="code" href="namespacescrip__grids.html#aada42b13bda19b10e051e15898647b4a">grid1_corner_lat</a>, <a class="code" href="namespacescrip__grids.html#a5f682e4c9506e03107b95e89ace6a278">grid1_mask</a>,                &amp;</div>
<div class="line"><a name="l00295"></a><span class="lineno">  295</span>&#160;         &amp;   <a class="code" href="namespacescrip__grids.html#a49a55c679a77020469894049f721e39a">grid1_dims</a>, <a class="code" href="namespacescrip__grids.html#af254072284efe9fe5ffdf6e9fc202ea7">grid1_size</a>, <a class="code" href="namespacescrip__grids.html#a1c2f7e645efe5c86480d63170f781c84">grid1_corners</a>, <a class="code" href="namespacescrip__grids.html#a0fc6ffc27a89ff7d4c82b26f8471cada">grid1_rank</a>,             &amp;</div>
<div class="line"><a name="l00296"></a><span class="lineno">  296</span>&#160;         &amp;   conv_dx, conv_dy, offset, gridshift)</div>
<div class="line"><a name="l00297"></a><span class="lineno">  297</span>&#160;    <span class="keyword">CALL </span><a class="code" href="namespacewmscrpmd.html#aef31042879618e8470d8c73c942a1bdb">scrip_info_renormalization</a>(                                  &amp;</div>
<div class="line"><a name="l00298"></a><span class="lineno">  298</span>&#160;         &amp;   <a class="code" href="namespacescrip__grids.html#a5725ab44d2bf128d6ec20bfdbdbe7394">grid2_center_lon</a>, <a class="code" href="namespacescrip__grids.html#af2aef83426ddf9d48db7736a7a502dd4">grid2_center_lat</a>,                            &amp;</div>
<div class="line"><a name="l00299"></a><span class="lineno">  299</span>&#160;         &amp;   <a class="code" href="namespacescrip__grids.html#abd626ac8143111bb57d9a729442d0717">grid2_corner_lon</a>, <a class="code" href="namespacescrip__grids.html#aa194cce0777bf7c51b8b0ff644a4230a">grid2_corner_lat</a>, <a class="code" href="namespacescrip__grids.html#a2ba0682513564fd7ed3b4c4ca102cfdd">grid2_mask</a>,                &amp;</div>
<div class="line"><a name="l00300"></a><span class="lineno">  300</span>&#160;         &amp;   <a class="code" href="namespacescrip__grids.html#a13541701ddd4712917bbdb9d9c5c8b68">grid2_dims</a>, <a class="code" href="namespacescrip__grids.html#a8a39e6df61b3471d373773d2930bfed4">grid2_size</a>, <a class="code" href="namespacescrip__grids.html#ac07bc02943c33322df7a9dc114c91222">grid2_corners</a>, <a class="code" href="namespacescrip__grids.html#a26b4ef12e531c9693862e74d73b7ecac">grid2_rank</a>,             &amp;</div>
<div class="line"><a name="l00301"></a><span class="lineno">  301</span>&#160;         &amp;   conv_dx, conv_dy, offset, <a class="code" href="namespacescrip__constants.html#a8f7ef7b037191fbbeb9b568788a77405">zero</a>)</div>
<div class="line"><a name="l00302"></a><span class="lineno">  302</span>&#160; </div>
<div class="line"><a name="l00303"></a><span class="lineno">  303</span>&#160;    <span class="comment">!.....Set constants for thresholding weights:</span></div>
<div class="line"><a name="l00304"></a><span class="lineno">  304</span>&#160;    <a class="code" href="namespacescrip__remap__vars.html#a780180b4894791c1f12006d601f064f5">frac_lowest</a> =1.e-3_scrip_r8</div>
<div class="line"><a name="l00305"></a><span class="lineno">  305</span>&#160;    <a class="code" href="namespacescrip__remap__vars.html#a73d1c0b90bb410a4f40918c7269064c1">frac_highest</a>=<a class="code" href="namespacescrip__constants.html#a766bef5f354460e4fdd00aefd1b85bc3">one</a>+1.e-3_scrip_r8</div>
<div class="line"><a name="l00306"></a><span class="lineno">  306</span>&#160;    <a class="code" href="namespacescrip__remap__vars.html#afda72168df18e6df52fdf80ff2d34f31">wt_lowest</a>   =<a class="code" href="namespacescrip__constants.html#a8f7ef7b037191fbbeb9b568788a77405">zero</a></div>
<div class="line"><a name="l00307"></a><span class="lineno">  307</span>&#160;    <a class="code" href="namespacescrip__remap__vars.html#aab90a570130e3c5ac874ba03879e0745">wt_highest</a>  =<a class="code" href="namespacescrip__constants.html#a766bef5f354460e4fdd00aefd1b85bc3">one</a>+1.e-7_scrip_r8</div>
<div class="line"><a name="l00308"></a><span class="lineno">  308</span>&#160; </div>
<div class="line"><a name="l00309"></a><span class="lineno">  309</span>&#160;<span class="preprocessor">#ifdef W3_T38</span></div>
<div class="line"><a name="l00310"></a><span class="lineno">  310</span>&#160;<span class="preprocessor"></span>    <span class="keyword">call </span>date_and_time (cdate_time(1), cdate_time(2), cdate_time(3), date_time)</div>
<div class="line"><a name="l00311"></a><span class="lineno">  311</span>&#160;    beg_time = ((date_time(5)*60 + date_time(6))*60 +date_time(7))*1000 + date_time(8)</div>
<div class="line"><a name="l00312"></a><span class="lineno">  312</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00313"></a><span class="lineno">  313</span>&#160;<span class="preprocessor"></span>    <span class="keyword">CALL </span><a class="code" href="namespacescrip__interface.html#aa8bbf7fc42f06b95df90175758d5b32a">scrip</a>(id_src, id_dst, l_master, l_read, l_test)</div>
<div class="line"><a name="l00314"></a><span class="lineno">  314</span>&#160;<span class="preprocessor">#ifdef W3_T38</span></div>
<div class="line"><a name="l00315"></a><span class="lineno">  315</span>&#160;<span class="preprocessor"></span>    <span class="keyword">call </span>date_and_time (cdate_time(1), cdate_time(2), cdate_time(3), date_time)</div>
<div class="line"><a name="l00316"></a><span class="lineno">  316</span>&#160;    end_time = ((date_time(5)*60 + date_time(6))*60 +date_time(7))*1000 + date_time(8)</div>
<div class="line"><a name="l00317"></a><span class="lineno">  317</span>&#160;    elapsed_time = end_time - beg_time</div>
<div class="line"><a name="l00318"></a><span class="lineno">  318</span>&#160;    <span class="keyword">write</span>(0,*) <span class="stringliteral">&quot;SCRIP: &quot;</span>, elapsed_time, <span class="stringliteral">&quot; MSEC&quot;</span></div>
<div class="line"><a name="l00319"></a><span class="lineno">  319</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00320"></a><span class="lineno">  320</span>&#160;<span class="preprocessor"></span> </div>
<div class="line"><a name="l00321"></a><span class="lineno">  321</span>&#160;<span class="preprocessor">#ifdef W3_T38</span></div>
<div class="line"><a name="l00322"></a><span class="lineno">  322</span>&#160;<span class="preprocessor"></span>    <span class="keywordflow">if</span>(l_master)<span class="keyword">write</span>(*,*)<span class="stringliteral">&#39;new minval(grid1_center_lon) = &#39;</span>,minval(<a class="code" href="namespacescrip__grids.html#a774d24c1d380a7fbf23ca890a5deb899">grid1_center_lon</a>)</div>
<div class="line"><a name="l00323"></a><span class="lineno">  323</span>&#160;    <span class="keywordflow">if</span>(l_master)<span class="keyword">write</span>(*,*)<span class="stringliteral">&#39;new maxval(grid1_center_lon) = &#39;</span>,maxval(<a class="code" href="namespacescrip__grids.html#a774d24c1d380a7fbf23ca890a5deb899">grid1_center_lon</a>)</div>
<div class="line"><a name="l00324"></a><span class="lineno">  324</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00325"></a><span class="lineno">  325</span>&#160;<span class="preprocessor"></span> </div>
<div class="line"><a name="l00326"></a><span class="lineno">  326</span>&#160;    <span class="comment">!.....notes: at this point we have the following useful variables:</span></div>
<div class="line"><a name="l00327"></a><span class="lineno">  327</span>&#160;    <span class="comment">!       num_wts, e.g. num_wts=3....for first order conservative remapping,</span></div>
<div class="line"><a name="l00328"></a><span class="lineno">  328</span>&#160;    <span class="comment">!       only the first one is relevant, the other two are for second-order</span></div>
<div class="line"><a name="l00329"></a><span class="lineno">  329</span>&#160;    <span class="comment">!       remapping.</span></div>
<div class="line"><a name="l00330"></a><span class="lineno">  330</span>&#160;    <span class="comment">!       max_links_map1, e.g. max_links_map1=1369,</span></div>
<div class="line"><a name="l00331"></a><span class="lineno">  331</span>&#160;    <span class="comment">!       grid2_size, e.g. grid2_size=1849,</span></div>
<div class="line"><a name="l00332"></a><span class="lineno">  332</span>&#160;    <span class="comment">!       wts_map1(num_wts,max_links_map1), e.g. wts_map1(3,1369),</span></div>
<div class="line"><a name="l00333"></a><span class="lineno">  333</span>&#160;    <span class="comment">!       grid1_add_map1(max_links_map1),  e.g. grid1_add_map1(1369),</span></div>
<div class="line"><a name="l00334"></a><span class="lineno">  334</span>&#160;    <span class="comment">!       grid2_add_map1(max_links_map1), e.g. grid2_add_map1(1369),</span></div>
<div class="line"><a name="l00335"></a><span class="lineno">  335</span>&#160;    <span class="comment">!       grid2_frac(grid2_size), e.g. grid2_frac(1849),</span></div>
<div class="line"><a name="l00336"></a><span class="lineno">  336</span>&#160;    <span class="comment">!       (see earlier versions for notes re: equivalency in netcdf/matlab)</span></div>
<div class="line"><a name="l00337"></a><span class="lineno">  337</span>&#160;    <span class="comment">!</span></div>
<div class="line"><a name="l00338"></a><span class="lineno">  338</span>&#160;    <span class="comment">!.....test output (optional)</span></div>
<div class="line"><a name="l00339"></a><span class="lineno">  339</span>&#160;    <span class="comment">!</span></div>
<div class="line"><a name="l00340"></a><span class="lineno">  340</span>&#160;    <span class="comment">!.....note re: notation: I use k for the combined i/j array, similar to isea,</span></div>
<div class="line"><a name="l00341"></a><span class="lineno">  341</span>&#160;    <span class="comment">!            but not necessarily the same as isea since some points may</span></div>
<div class="line"><a name="l00342"></a><span class="lineno">  342</span>&#160;    <span class="comment">!            be land etc.</span></div>
<div class="line"><a name="l00343"></a><span class="lineno">  343</span>&#160;<span class="preprocessor">#ifdef W3_T38</span></div>
<div class="line"><a name="l00344"></a><span class="lineno">  344</span>&#160;<span class="preprocessor"></span>    <span class="keywordflow">if</span>(l_master)<span class="keywordflow">then</span></div>
<div class="line"><a name="l00345"></a><span class="lineno">  345</span>&#160;      <span class="keywordflow">do</span> k=1,<a class="code" href="namespacescrip__grids.html#a8a39e6df61b3471d373773d2930bfed4">grid2_size</a></div>
<div class="line"><a name="l00346"></a><span class="lineno">  346</span>&#160;        <span class="keyword">write</span>(403,*)<a class="code" href="namespacescrip__grids.html#ab021eaf3478695e3b5445f40eb854ca3">grid2_frac</a>(k)</div>
<div class="line"><a name="l00347"></a><span class="lineno">  347</span>&#160;<span class="keywordflow">      end do</span></div>
<div class="line"><a name="l00348"></a><span class="lineno">  348</span>&#160;      <span class="keywordflow">do</span> ilink=1,<a class="code" href="namespacescrip__remap__vars.html#af91c24c0b62106ae5b88148abdb29617">max_links_map1</a></div>
<div class="line"><a name="l00349"></a><span class="lineno">  349</span>&#160;        <span class="keyword">write</span>(405,<span class="stringliteral">&#39;(999(1x,f20.7))&#39;</span>)(<a class="code" href="namespacescrip__remap__vars.html#afd22f0785b80890e06fc9bcaa1b24f6c">wts_map1</a>(iw,ilink),iw=1,<a class="code" href="namespacescrip__remap__vars.html#aaa77ca76089d86a2850f6afc9f7cc2a5">num_wts</a>)</div>
<div class="line"><a name="l00350"></a><span class="lineno">  350</span>&#160;<span class="keywordflow">      end do</span></div>
<div class="line"><a name="l00351"></a><span class="lineno">  351</span>&#160;      <span class="keywordflow">do</span> ilink=1,<a class="code" href="namespacescrip__remap__vars.html#af91c24c0b62106ae5b88148abdb29617">max_links_map1</a></div>
<div class="line"><a name="l00352"></a><span class="lineno">  352</span>&#160;        <span class="keyword">write</span>(406,<span class="stringliteral">&#39;(i20)&#39;</span>)<a class="code" href="namespacescrip__remap__vars.html#a3492cb57b4a72d2577283e9a5f58a2d4">grid1_add_map1</a>(ilink) <span class="comment">! equivalent to</span></div>
<div class="line"><a name="l00353"></a><span class="lineno">  353</span>&#160;        <span class="comment">! my &quot;src_address&quot;</span></div>
<div class="line"><a name="l00354"></a><span class="lineno">  354</span>&#160;        <span class="keyword">write</span>(407,<span class="stringliteral">&#39;(i20)&#39;</span>)<a class="code" href="namespacescrip__remap__vars.html#aa9dacd55d1f7b09b342dbc020ce671ac">grid2_add_map1</a>(ilink) <span class="comment">! equivalent to</span></div>
<div class="line"><a name="l00355"></a><span class="lineno">  355</span>&#160;        <span class="comment">! my &quot;dst_address&quot;</span></div>
<div class="line"><a name="l00356"></a><span class="lineno">  356</span>&#160;<span class="keywordflow">      end do</span></div>
<div class="line"><a name="l00357"></a><span class="lineno">  357</span>&#160;<span class="keywordflow">    endif</span></div>
<div class="line"><a name="l00358"></a><span class="lineno">  358</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00359"></a><span class="lineno">  359</span>&#160;<span class="preprocessor"></span> </div>
<div class="line"><a name="l00360"></a><span class="lineno">  360</span>&#160;    <span class="comment">!.....organize results and return to wmghgh.</span></div>
<div class="line"><a name="l00361"></a><span class="lineno">  361</span>&#160; </div>
<div class="line"><a name="l00362"></a><span class="lineno">  362</span>&#160;    <span class="comment">! what we need, for purpose of feeding back to ww3, for each dst grid node:</span></div>
<div class="line"><a name="l00363"></a><span class="lineno">  363</span>&#160;    <span class="comment">!        a) the set of src grid nodes, in terms of isea, for which</span></div>
<div class="line"><a name="l00364"></a><span class="lineno">  364</span>&#160;    <span class="comment">!           weights are available</span></div>
<div class="line"><a name="l00365"></a><span class="lineno">  365</span>&#160;    <span class="comment">!        b) the corresponding set of weights</span></div>
<div class="line"><a name="l00366"></a><span class="lineno">  366</span>&#160; </div>
<div class="line"><a name="l00367"></a><span class="lineno">  367</span>&#160;    <span class="keyword">ALLOCATE</span> ( <a class="code" href="namespacescrip__interface.html#af95a61f45a2dde2aa5691a513f8ad158">wgtdata</a>(<a class="code" href="namespacescrip__grids.html#a8a39e6df61b3471d373773d2930bfed4">grid2_size</a>), stat=istat )</div>
<div class="line"><a name="l00368"></a><span class="lineno">  368</span>&#160;    check_alloc_status( istat )</div>
<div class="line"><a name="l00369"></a><span class="lineno">  369</span>&#160; </div>
<div class="line"><a name="l00370"></a><span class="lineno">  370</span>&#160;    <span class="comment">!.....step 1: count up NR0, NR1, NR2, NRL, NLOC (NR1 and NLOC are denoted</span></div>
<div class="line"><a name="l00371"></a><span class="lineno">  371</span>&#160;    <span class="comment">!             &quot;n&quot; here)</span></div>
<div class="line"><a name="l00372"></a><span class="lineno">  372</span>&#160;    <span class="comment">!     It is especially important to determine how large npnts gets,</span></div>
<div class="line"><a name="l00373"></a><span class="lineno">  373</span>&#160;    <span class="comment">!              so that we can allocate arrays properly</span></div>
<div class="line"><a name="l00374"></a><span class="lineno">  374</span>&#160;    <a class="code" href="namespacescrip__interface.html#af95a61f45a2dde2aa5691a513f8ad158">wgtdata</a>%NR0=0</div>
<div class="line"><a name="l00375"></a><span class="lineno">  375</span>&#160;    <a class="code" href="namespacescrip__interface.html#af95a61f45a2dde2aa5691a513f8ad158">wgtdata</a>%NR2=0</div>
<div class="line"><a name="l00376"></a><span class="lineno">  376</span>&#160;    <a class="code" href="namespacescrip__interface.html#af95a61f45a2dde2aa5691a513f8ad158">wgtdata</a>%NRL=0</div>
<div class="line"><a name="l00377"></a><span class="lineno">  377</span>&#160;    <a class="code" href="namespacescrip__interface.html#af95a61f45a2dde2aa5691a513f8ad158">wgtdata</a>%N=0</div>
<div class="line"><a name="l00378"></a><span class="lineno">  378</span>&#160; </div>
<div class="line"><a name="l00379"></a><span class="lineno">  379</span>&#160;    ni_src=<a class="code" href="namespacescrip__grids.html#a49a55c679a77020469894049f721e39a">grid1_dims</a>(1)</div>
<div class="line"><a name="l00380"></a><span class="lineno">  380</span>&#160;    ngoodpnts=0</div>
<div class="line"><a name="l00381"></a><span class="lineno">  381</span>&#160;    nbadpnts=0</div>
<div class="line"><a name="l00382"></a><span class="lineno">  382</span>&#160; </div>
<div class="line"><a name="l00383"></a><span class="lineno">  383</span>&#160;    <span class="keywordflow">DO</span> ilink=1,<a class="code" href="namespacescrip__remap__vars.html#af91c24c0b62106ae5b88148abdb29617">max_links_map1</a></div>
<div class="line"><a name="l00384"></a><span class="lineno">  384</span>&#160; </div>
<div class="line"><a name="l00385"></a><span class="lineno">  385</span>&#160;      <span class="comment">!........note that this pair of if-thens *must* be consistent with the</span></div>
<div class="line"><a name="l00386"></a><span class="lineno">  386</span>&#160;      <span class="comment">!........single if-then below</span></div>
<div class="line"><a name="l00387"></a><span class="lineno">  387</span>&#160;      <span class="keywordflow">IF</span> ((<a class="code" href="namespacescrip__grids.html#ab021eaf3478695e3b5445f40eb854ca3">grid2_frac</a>(<a class="code" href="namespacescrip__remap__vars.html#aa9dacd55d1f7b09b342dbc020ce671ac">grid2_add_map1</a>(ilink))&gt;<a class="code" href="namespacescrip__remap__vars.html#a780180b4894791c1f12006d601f064f5">frac_lowest</a>) .AND.     &amp;</div>
<div class="line"><a name="l00388"></a><span class="lineno">  388</span>&#160;           (<a class="code" href="namespacescrip__grids.html#ab021eaf3478695e3b5445f40eb854ca3">grid2_frac</a>(<a class="code" href="namespacescrip__remap__vars.html#aa9dacd55d1f7b09b342dbc020ce671ac">grid2_add_map1</a>(ilink))&lt;<a class="code" href="namespacescrip__remap__vars.html#a73d1c0b90bb410a4f40918c7269064c1">frac_highest</a>)) <span class="keywordflow">THEN</span></div>
<div class="line"><a name="l00389"></a><span class="lineno">  389</span>&#160;        <span class="comment">!     then consider this link either to include, or to print a warning</span></div>
<div class="line"><a name="l00390"></a><span class="lineno">  390</span>&#160;        <span class="keywordflow">IF</span>( (<a class="code" href="namespacescrip__remap__vars.html#afd22f0785b80890e06fc9bcaa1b24f6c">wts_map1</a>(1,ilink)&gt;=<a class="code" href="namespacescrip__remap__vars.html#afda72168df18e6df52fdf80ff2d34f31">wt_lowest</a>) .AND.                   &amp;</div>
<div class="line"><a name="l00391"></a><span class="lineno">  391</span>&#160;             (<a class="code" href="namespacescrip__remap__vars.html#afd22f0785b80890e06fc9bcaa1b24f6c">wts_map1</a>(1,ilink)&lt;=<a class="code" href="namespacescrip__remap__vars.html#aab90a570130e3c5ac874ba03879e0745">wt_highest</a>) )    <span class="keywordflow">THEN</span></div>
<div class="line"><a name="l00392"></a><span class="lineno">  392</span>&#160;          ksrc=<a class="code" href="namespacescrip__remap__vars.html#a3492cb57b4a72d2577283e9a5f58a2d4">grid1_add_map1</a>(ilink)</div>
<div class="line"><a name="l00393"></a><span class="lineno">  393</span>&#160;          jsrc=int((ksrc-1)/ni_src)+1</div>
<div class="line"><a name="l00394"></a><span class="lineno">  394</span>&#160;          isrc=ksrc-(jsrc-1)*ni_src</div>
<div class="line"><a name="l00395"></a><span class="lineno">  395</span>&#160; </div>
<div class="line"><a name="l00396"></a><span class="lineno">  396</span>&#160;          <span class="keywordflow">IF</span> (mapsta_src(jsrc,isrc).EQ.0) <span class="keywordflow">THEN</span> <span class="comment">! excluded point</span></div>
<div class="line"><a name="l00397"></a><span class="lineno">  397</span>&#160;            <a class="code" href="namespacescrip__interface.html#af95a61f45a2dde2aa5691a513f8ad158">wgtdata</a>(<a class="code" href="namespacescrip__remap__vars.html#aa9dacd55d1f7b09b342dbc020ce671ac">grid2_add_map1</a>(ilink))%NR0    =              &amp;</div>
<div class="line"><a name="l00398"></a><span class="lineno">  398</span>&#160;                 <a class="code" href="namespacescrip__interface.html#af95a61f45a2dde2aa5691a513f8ad158">wgtdata</a>(<a class="code" href="namespacescrip__remap__vars.html#aa9dacd55d1f7b09b342dbc020ce671ac">grid2_add_map1</a>(ilink))%NR0 + 1</div>
<div class="line"><a name="l00399"></a><span class="lineno">  399</span>&#160;            <span class="keywordflow">IF</span> (mapst2_src(jsrc,isrc).EQ.0)<span class="keywordflow">THEN</span></div>
<div class="line"><a name="l00400"></a><span class="lineno">  400</span>&#160;              <a class="code" href="namespacescrip__interface.html#af95a61f45a2dde2aa5691a513f8ad158">wgtdata</a>(<a class="code" href="namespacescrip__remap__vars.html#aa9dacd55d1f7b09b342dbc020ce671ac">grid2_add_map1</a>(ilink))%NRL =              &amp;</div>
<div class="line"><a name="l00401"></a><span class="lineno">  401</span>&#160;                   <a class="code" href="namespacescrip__interface.html#af95a61f45a2dde2aa5691a513f8ad158">wgtdata</a>(<a class="code" href="namespacescrip__remap__vars.html#aa9dacd55d1f7b09b342dbc020ce671ac">grid2_add_map1</a>(ilink))%NRL + 1</div>
<div class="line"><a name="l00402"></a><span class="lineno">  402</span>&#160;<span class="keywordflow">            ENDIF</span></div>
<div class="line"><a name="l00403"></a><span class="lineno">  403</span>&#160;          <span class="keywordflow">ELSE</span> <span class="keywordflow">IF</span> (abs(mapsta_src(jsrc,isrc)).EQ.1) <span class="keywordflow">THEN</span></div>
<div class="line"><a name="l00404"></a><span class="lineno">  404</span>&#160;            <span class="comment">! sea point</span></div>
<div class="line"><a name="l00405"></a><span class="lineno">  405</span>&#160;            <a class="code" href="namespacescrip__interface.html#af95a61f45a2dde2aa5691a513f8ad158">wgtdata</a>(<a class="code" href="namespacescrip__remap__vars.html#aa9dacd55d1f7b09b342dbc020ce671ac">grid2_add_map1</a>(ilink))%N=                    &amp;</div>
<div class="line"><a name="l00406"></a><span class="lineno">  406</span>&#160;                 <a class="code" href="namespacescrip__interface.html#af95a61f45a2dde2aa5691a513f8ad158">wgtdata</a>(<a class="code" href="namespacescrip__remap__vars.html#aa9dacd55d1f7b09b342dbc020ce671ac">grid2_add_map1</a>(ilink))%N+1</div>
<div class="line"><a name="l00407"></a><span class="lineno">  407</span>&#160;          <span class="keywordflow">ELSE</span> <span class="keywordflow">IF</span> (abs(mapsta_src(jsrc,isrc)).EQ.2) <span class="keywordflow">THEN</span></div>
<div class="line"><a name="l00408"></a><span class="lineno">  408</span>&#160;            <span class="comment">! bnd point</span></div>
<div class="line"><a name="l00409"></a><span class="lineno">  409</span>&#160;            <a class="code" href="namespacescrip__interface.html#af95a61f45a2dde2aa5691a513f8ad158">wgtdata</a>(<a class="code" href="namespacescrip__remap__vars.html#aa9dacd55d1f7b09b342dbc020ce671ac">grid2_add_map1</a>(ilink))%NR2    =              &amp;</div>
<div class="line"><a name="l00410"></a><span class="lineno">  410</span>&#160;                 <a class="code" href="namespacescrip__interface.html#af95a61f45a2dde2aa5691a513f8ad158">wgtdata</a>(<a class="code" href="namespacescrip__remap__vars.html#aa9dacd55d1f7b09b342dbc020ce671ac">grid2_add_map1</a>(ilink))%NR2 + 1</div>
<div class="line"><a name="l00411"></a><span class="lineno">  411</span>&#160;<span class="keywordflow">          END IF</span></div>
<div class="line"><a name="l00412"></a><span class="lineno">  412</span>&#160;          ngoodpnts=ngoodpnts+1</div>
<div class="line"><a name="l00413"></a><span class="lineno">  413</span>&#160;        <span class="keywordflow">ELSEIF</span> ( (<a class="code" href="namespacescrip__grids.html#af8624712a67a3746f365c42f8266de92">grid1_frac</a>(<a class="code" href="namespacescrip__remap__vars.html#a3492cb57b4a72d2577283e9a5f58a2d4">grid1_add_map1</a>(ilink))&gt;<a class="code" href="namespacescrip__remap__vars.html#a780180b4894791c1f12006d601f064f5">frac_lowest</a>)   &amp;</div>
<div class="line"><a name="l00414"></a><span class="lineno">  414</span>&#160;             .AND. (<a class="code" href="namespacescrip__grids.html#af8624712a67a3746f365c42f8266de92">grid1_frac</a>(<a class="code" href="namespacescrip__remap__vars.html#a3492cb57b4a72d2577283e9a5f58a2d4">grid1_add_map1</a>(ilink))&lt;<a class="code" href="namespacescrip__remap__vars.html#a73d1c0b90bb410a4f40918c7269064c1">frac_highest</a>)&amp;</div>
<div class="line"><a name="l00415"></a><span class="lineno">  415</span>&#160;             ) <span class="keywordflow">THEN</span></div>
<div class="line"><a name="l00416"></a><span class="lineno">  416</span>&#160;          <span class="comment">! note that we don&#39;t bother giving a warning for the</span></div>
<div class="line"><a name="l00417"></a><span class="lineno">  417</span>&#160;          <span class="comment">! cases where grid1_frac is strange.</span></div>
<div class="line"><a name="l00418"></a><span class="lineno">  418</span>&#160;          nbadpnts=nbadpnts+1</div>
<div class="line"><a name="l00419"></a><span class="lineno">  419</span>&#160;          <span class="comment">! we also don&#39;t bother giving a warning if we&#39;ve already</span></div>
<div class="line"><a name="l00420"></a><span class="lineno">  420</span>&#160;          <span class="comment">! given a lot of warnings (we keep counting, though)</span></div>
<div class="line"><a name="l00421"></a><span class="lineno">  421</span>&#160;          <span class="keywordflow">IF</span>((nbadpnts.LT.5).AND.l_master)<span class="keywordflow">THEN</span> <span class="comment">! print warnings</span></div>
<div class="line"><a name="l00422"></a><span class="lineno">  422</span>&#160;            <span class="keyword">WRITE</span>(*,<span class="stringliteral">&#39;(A)&#39;</span>)<span class="stringliteral">&#39;%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%&#39;</span></div>
<div class="line"><a name="l00423"></a><span class="lineno">  423</span>&#160;            <span class="keyword">WRITE</span>(*,<span class="stringliteral">&#39;(A)&#39;</span>)<span class="stringliteral">&#39;WARNING: SCRIP weight problem &#39;</span></div>
<div class="line"><a name="l00424"></a><span class="lineno">  424</span>&#160;            <span class="keyword">WRITE</span>(*,<span class="stringliteral">&#39;(4x,A,I7,A,I7)&#39;</span>)<span class="stringliteral">&#39;ilink = &#39;</span>,ilink,<span class="stringliteral">&#39; out of &#39;</span>,&amp;</div>
<div class="line"><a name="l00425"></a><span class="lineno">  425</span>&#160;                 <a class="code" href="namespacescrip__remap__vars.html#af91c24c0b62106ae5b88148abdb29617">max_links_map1</a></div>
<div class="line"><a name="l00426"></a><span class="lineno">  426</span>&#160;            <span class="keyword">WRITE</span>(*,<span class="stringliteral">&#39;(4x,A,I7)&#39;</span>)<span class="stringliteral">&#39;grid1_add_map1(ilink) = &#39;</span>,      &amp;</div>
<div class="line"><a name="l00427"></a><span class="lineno">  427</span>&#160;                 <a class="code" href="namespacescrip__remap__vars.html#a3492cb57b4a72d2577283e9a5f58a2d4">grid1_add_map1</a>(ilink)</div>
<div class="line"><a name="l00428"></a><span class="lineno">  428</span>&#160;            <span class="keyword">WRITE</span>(*,<span class="stringliteral">&#39;(4x,A,I7)&#39;</span>)<span class="stringliteral">&#39;grid2_add_map1(ilink) = &#39;</span>,      &amp;</div>
<div class="line"><a name="l00429"></a><span class="lineno">  429</span>&#160;                 <a class="code" href="namespacescrip__remap__vars.html#aa9dacd55d1f7b09b342dbc020ce671ac">grid2_add_map1</a>(ilink)</div>
<div class="line"><a name="l00430"></a><span class="lineno">  430</span>&#160;            <span class="keyword">WRITE</span>(*,<span class="stringliteral">&#39;(4x,A,E12.4)&#39;</span>)<span class="stringliteral">&#39;wts_map1(1,ilink) = &#39;</span>,       &amp;</div>
<div class="line"><a name="l00431"></a><span class="lineno">  431</span>&#160;                 <a class="code" href="namespacescrip__remap__vars.html#afd22f0785b80890e06fc9bcaa1b24f6c">wts_map1</a>(1,ilink)</div>
<div class="line"><a name="l00432"></a><span class="lineno">  432</span>&#160;            <span class="keyword">WRITE</span>(*,<span class="stringliteral">&#39;(4x,A,F10.5)&#39;</span>)                              &amp;</div>
<div class="line"><a name="l00433"></a><span class="lineno">  433</span>&#160;                 <span class="stringliteral">&#39;grid1_frac(grid1_add_map1(ilink)) = &#39;</span>,              &amp;</div>
<div class="line"><a name="l00434"></a><span class="lineno">  434</span>&#160;                 <a class="code" href="namespacescrip__grids.html#af8624712a67a3746f365c42f8266de92">grid1_frac</a>(<a class="code" href="namespacescrip__remap__vars.html#a3492cb57b4a72d2577283e9a5f58a2d4">grid1_add_map1</a>(ilink))</div>
<div class="line"><a name="l00435"></a><span class="lineno">  435</span>&#160;            <span class="keyword">WRITE</span>(*,<span class="stringliteral">&#39;(4x,A,F10.5)&#39;</span>)                              &amp;</div>
<div class="line"><a name="l00436"></a><span class="lineno">  436</span>&#160;                 <span class="stringliteral">&#39;grid2_frac(grid2_add_map1(ilink)) = &#39;</span>,              &amp;</div>
<div class="line"><a name="l00437"></a><span class="lineno">  437</span>&#160;                 <a class="code" href="namespacescrip__grids.html#ab021eaf3478695e3b5445f40eb854ca3">grid2_frac</a>(<a class="code" href="namespacescrip__remap__vars.html#aa9dacd55d1f7b09b342dbc020ce671ac">grid2_add_map1</a>(ilink))</div>
<div class="line"><a name="l00438"></a><span class="lineno">  438</span>&#160;            <span class="keyword">WRITE</span>(*,<span class="stringliteral">&#39;(4x,A,F10.5)&#39;</span>)<span class="stringliteral">&#39;grid1_center_lat = &#39;</span>,        &amp;</div>
<div class="line"><a name="l00439"></a><span class="lineno">  439</span>&#160;                 <a class="code" href="namespacescrip__grids.html#af883cc28db3bfe80dd1828d1e8d4ed56">grid1_center_lat</a>(<a class="code" href="namespacescrip__remap__vars.html#a3492cb57b4a72d2577283e9a5f58a2d4">grid1_add_map1</a>(ilink))</div>
<div class="line"><a name="l00440"></a><span class="lineno">  440</span>&#160;            <span class="keyword">WRITE</span>(*,<span class="stringliteral">&#39;(4x,A,F10.5)&#39;</span>)<span class="stringliteral">&#39;grid1_center_lon = &#39;</span>,        &amp;</div>
<div class="line"><a name="l00441"></a><span class="lineno">  441</span>&#160;                 <a class="code" href="namespacescrip__grids.html#a774d24c1d380a7fbf23ca890a5deb899">grid1_center_lon</a>(<a class="code" href="namespacescrip__remap__vars.html#a3492cb57b4a72d2577283e9a5f58a2d4">grid1_add_map1</a>(ilink))</div>
<div class="line"><a name="l00442"></a><span class="lineno">  442</span>&#160;            <span class="keyword">WRITE</span>(*,<span class="stringliteral">&#39;(4x,A,F10.5)&#39;</span>)<span class="stringliteral">&#39;grid2_center_lat = &#39;</span>,        &amp;</div>
<div class="line"><a name="l00443"></a><span class="lineno">  443</span>&#160;                 <a class="code" href="namespacescrip__grids.html#af2aef83426ddf9d48db7736a7a502dd4">grid2_center_lat</a>(<a class="code" href="namespacescrip__remap__vars.html#aa9dacd55d1f7b09b342dbc020ce671ac">grid2_add_map1</a>(ilink))</div>
<div class="line"><a name="l00444"></a><span class="lineno">  444</span>&#160;            <span class="keyword">WRITE</span>(*,<span class="stringliteral">&#39;(4x,A,F10.5)&#39;</span>)<span class="stringliteral">&#39;grid2_center_lon = &#39;</span>,        &amp;</div>
<div class="line"><a name="l00445"></a><span class="lineno">  445</span>&#160;                 <a class="code" href="namespacescrip__grids.html#a5725ab44d2bf128d6ec20bfdbdbe7394">grid2_center_lon</a>(<a class="code" href="namespacescrip__remap__vars.html#aa9dacd55d1f7b09b342dbc020ce671ac">grid2_add_map1</a>(ilink))</div>
<div class="line"><a name="l00446"></a><span class="lineno">  446</span>&#160;            <span class="keyword">WRITE</span>(*,<span class="stringliteral">&#39;(A)&#39;</span>)<span class="stringliteral">&#39;%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%&#39;</span></div>
<div class="line"><a name="l00447"></a><span class="lineno">  447</span>&#160;<span class="keywordflow">          ENDIF</span></div>
<div class="line"><a name="l00448"></a><span class="lineno">  448</span>&#160;<span class="keywordflow">        ENDIF</span></div>
<div class="line"><a name="l00449"></a><span class="lineno">  449</span>&#160;<span class="keywordflow">      ENDIF</span></div>
<div class="line"><a name="l00450"></a><span class="lineno">  450</span>&#160;<span class="keywordflow">    END DO</span></div>
<div class="line"><a name="l00451"></a><span class="lineno">  451</span>&#160;    <span class="keywordflow">IF</span>((nbadpnts.GT.0).AND.l_master)<span class="keywordflow">THEN</span></div>
<div class="line"><a name="l00452"></a><span class="lineno">  452</span>&#160;      <span class="keyword">WRITE</span>(*,<span class="stringliteral">&#39;(4x,A,I5,A)&#39;</span>)<span class="stringliteral">&#39;We had problems in &#39;</span>,nbadpnts, &amp;</div>
<div class="line"><a name="l00453"></a><span class="lineno">  453</span>&#160;           <span class="stringliteral">&#39; points.&#39;</span></div>
<div class="line"><a name="l00454"></a><span class="lineno">  454</span>&#160;      <span class="keyword">WRITE</span>(*,<span class="stringliteral">&#39;(4x,I8,A)&#39;</span>)ngoodpnts,<span class="stringliteral">&#39; points appear to be OK.&#39;</span></div>
<div class="line"><a name="l00455"></a><span class="lineno">  455</span>&#160;<span class="keywordflow">    ENDIF</span></div>
<div class="line"><a name="l00456"></a><span class="lineno">  456</span>&#160;    <span class="keywordflow">IF</span>( (nbadpnts.GT.(ngoodpnts/30)) .AND.l_master )<span class="keywordflow">THEN</span></div>
<div class="line"><a name="l00457"></a><span class="lineno">  457</span>&#160;      <span class="keyword">WRITE</span>(*,<span class="stringliteral">&#39;(4x,A)&#39;</span>)<span class="stringliteral">&#39;Error: excessive SCRIP failure. Stopping.&#39;</span></div>
<div class="line"><a name="l00458"></a><span class="lineno">  458</span>&#160;      stop <span class="stringliteral">&#39;wmscrpmd, case 1&#39;</span></div>
<div class="line"><a name="l00459"></a><span class="lineno">  459</span>&#160;<span class="keywordflow">    ENDIF</span></div>
<div class="line"><a name="l00460"></a><span class="lineno">  460</span>&#160; </div>
<div class="line"><a name="l00461"></a><span class="lineno">  461</span>&#160;    <span class="comment">!.....step 2: allocate according to the size &quot;n&quot; determined above</span></div>
<div class="line"><a name="l00462"></a><span class="lineno">  462</span>&#160;    <span class="keywordflow">DO</span> kdst=1,<a class="code" href="namespacescrip__grids.html#a8a39e6df61b3471d373773d2930bfed4">grid2_size</a></div>
<div class="line"><a name="l00463"></a><span class="lineno">  463</span>&#160;      <span class="keyword">ALLOCATE</span> ( <a class="code" href="namespacescrip__interface.html#af95a61f45a2dde2aa5691a513f8ad158">wgtdata</a>(kdst)%W(<a class="code" href="namespacescrip__interface.html#af95a61f45a2dde2aa5691a513f8ad158">wgtdata</a>(kdst)%N), stat=istat )</div>
<div class="line"><a name="l00464"></a><span class="lineno">  464</span>&#160;      check_alloc_status( istat )</div>
<div class="line"><a name="l00465"></a><span class="lineno">  465</span>&#160;      <span class="keyword">ALLOCATE</span> ( <a class="code" href="namespacescrip__interface.html#af95a61f45a2dde2aa5691a513f8ad158">wgtdata</a>(kdst)%K(<a class="code" href="namespacescrip__interface.html#af95a61f45a2dde2aa5691a513f8ad158">wgtdata</a>(kdst)%N), stat=istat )</div>
<div class="line"><a name="l00466"></a><span class="lineno">  466</span>&#160;      check_alloc_status( istat )</div>
<div class="line"><a name="l00467"></a><span class="lineno">  467</span>&#160;      <a class="code" href="namespacescrip__interface.html#af95a61f45a2dde2aa5691a513f8ad158">wgtdata</a>(kdst)%N=0</div>
<div class="line"><a name="l00468"></a><span class="lineno">  468</span>&#160;<span class="keywordflow">    END DO</span></div>
<div class="line"><a name="l00469"></a><span class="lineno">  469</span>&#160; </div>
<div class="line"><a name="l00470"></a><span class="lineno">  470</span>&#160;    <span class="comment">!.....step 3: save weights</span></div>
<div class="line"><a name="l00471"></a><span class="lineno">  471</span>&#160;    <span class="keywordflow">DO</span> ilink=1,<a class="code" href="namespacescrip__remap__vars.html#af91c24c0b62106ae5b88148abdb29617">max_links_map1</a></div>
<div class="line"><a name="l00472"></a><span class="lineno">  472</span>&#160; </div>
<div class="line"><a name="l00473"></a><span class="lineno">  473</span>&#160;      ksrc=<a class="code" href="namespacescrip__remap__vars.html#a3492cb57b4a72d2577283e9a5f58a2d4">grid1_add_map1</a>(ilink)</div>
<div class="line"><a name="l00474"></a><span class="lineno">  474</span>&#160;      jsrc=int((ksrc-1)/ni_src)+1</div>
<div class="line"><a name="l00475"></a><span class="lineno">  475</span>&#160;      isrc=ksrc-(jsrc-1)*ni_src</div>
<div class="line"><a name="l00476"></a><span class="lineno">  476</span>&#160; </div>
<div class="line"><a name="l00477"></a><span class="lineno">  477</span>&#160;      <span class="comment">!........note that this single if-then *must* be consistent with the</span></div>
<div class="line"><a name="l00478"></a><span class="lineno">  478</span>&#160;      <span class="comment">!........pair of if-thens above</span></div>
<div class="line"><a name="l00479"></a><span class="lineno">  479</span>&#160;      <span class="keywordflow">IF</span> ((<a class="code" href="namespacescrip__grids.html#ab021eaf3478695e3b5445f40eb854ca3">grid2_frac</a>(<a class="code" href="namespacescrip__remap__vars.html#aa9dacd55d1f7b09b342dbc020ce671ac">grid2_add_map1</a>(ilink))&gt;<a class="code" href="namespacescrip__remap__vars.html#a780180b4894791c1f12006d601f064f5">frac_lowest</a>) .AND.      &amp;</div>
<div class="line"><a name="l00480"></a><span class="lineno">  480</span>&#160;           &amp;       (<a class="code" href="namespacescrip__grids.html#ab021eaf3478695e3b5445f40eb854ca3">grid2_frac</a>(<a class="code" href="namespacescrip__remap__vars.html#aa9dacd55d1f7b09b342dbc020ce671ac">grid2_add_map1</a>(ilink))&lt;<a class="code" href="namespacescrip__remap__vars.html#a73d1c0b90bb410a4f40918c7269064c1">frac_highest</a>) .AND.     &amp;</div>
<div class="line"><a name="l00481"></a><span class="lineno">  481</span>&#160;           &amp;       (<a class="code" href="namespacescrip__remap__vars.html#afd22f0785b80890e06fc9bcaa1b24f6c">wts_map1</a>(1,ilink)&gt;=<a class="code" href="namespacescrip__remap__vars.html#afda72168df18e6df52fdf80ff2d34f31">wt_lowest</a>) .AND.                       &amp;</div>
<div class="line"><a name="l00482"></a><span class="lineno">  482</span>&#160;           &amp;       (<a class="code" href="namespacescrip__remap__vars.html#afd22f0785b80890e06fc9bcaa1b24f6c">wts_map1</a>(1,ilink)&lt;=<a class="code" href="namespacescrip__remap__vars.html#aab90a570130e3c5ac874ba03879e0745">wt_highest</a>))<span class="keywordflow">THEN</span></div>
<div class="line"><a name="l00483"></a><span class="lineno">  483</span>&#160;        <span class="keywordflow">IF</span> (abs(mapsta_src(jsrc,isrc)).EQ.1) <span class="keywordflow">THEN</span> <span class="comment">! sea point</span></div>
<div class="line"><a name="l00484"></a><span class="lineno">  484</span>&#160;          <a class="code" href="namespacescrip__interface.html#af95a61f45a2dde2aa5691a513f8ad158">wgtdata</a>(<a class="code" href="namespacescrip__remap__vars.html#aa9dacd55d1f7b09b342dbc020ce671ac">grid2_add_map1</a>(ilink))%N=                        &amp;</div>
<div class="line"><a name="l00485"></a><span class="lineno">  485</span>&#160;               &amp;             <a class="code" href="namespacescrip__interface.html#af95a61f45a2dde2aa5691a513f8ad158">wgtdata</a>(<a class="code" href="namespacescrip__remap__vars.html#aa9dacd55d1f7b09b342dbc020ce671ac">grid2_add_map1</a>(ilink))%N+1</div>
<div class="line"><a name="l00486"></a><span class="lineno">  486</span>&#160;          <a class="code" href="namespacescrip__interface.html#af95a61f45a2dde2aa5691a513f8ad158">wgtdata</a>(<a class="code" href="namespacescrip__remap__vars.html#aa9dacd55d1f7b09b342dbc020ce671ac">grid2_add_map1</a>(ilink))%W(<a class="code" href="namespacescrip__interface.html#af95a61f45a2dde2aa5691a513f8ad158">wgtdata</a>(                &amp;</div>
<div class="line"><a name="l00487"></a><span class="lineno">  487</span>&#160;               &amp;             <a class="code" href="namespacescrip__remap__vars.html#aa9dacd55d1f7b09b342dbc020ce671ac">grid2_add_map1</a>(ilink))%N)=<a class="code" href="namespacescrip__remap__vars.html#afd22f0785b80890e06fc9bcaa1b24f6c">wts_map1</a>(1,ilink)</div>
<div class="line"><a name="l00488"></a><span class="lineno">  488</span>&#160;          <a class="code" href="namespacescrip__interface.html#af95a61f45a2dde2aa5691a513f8ad158">wgtdata</a>(<a class="code" href="namespacescrip__remap__vars.html#aa9dacd55d1f7b09b342dbc020ce671ac">grid2_add_map1</a>(ilink))%K(<a class="code" href="namespacescrip__interface.html#af95a61f45a2dde2aa5691a513f8ad158">wgtdata</a>(                &amp;</div>
<div class="line"><a name="l00489"></a><span class="lineno">  489</span>&#160;               &amp;             <a class="code" href="namespacescrip__remap__vars.html#aa9dacd55d1f7b09b342dbc020ce671ac">grid2_add_map1</a>(ilink))%N)=<a class="code" href="namespacescrip__remap__vars.html#a3492cb57b4a72d2577283e9a5f58a2d4">grid1_add_map1</a>(ilink)</div>
<div class="line"><a name="l00490"></a><span class="lineno">  490</span>&#160;<span class="keywordflow">        ENDIF</span></div>
<div class="line"><a name="l00491"></a><span class="lineno">  491</span>&#160;<span class="keywordflow">      ENDIF</span></div>
<div class="line"><a name="l00492"></a><span class="lineno">  492</span>&#160;<span class="keywordflow">    END DO</span></div>
<div class="line"><a name="l00493"></a><span class="lineno">  493</span>&#160; </div>
<div class="line"><a name="l00494"></a><span class="lineno">  494</span>&#160;    <span class="comment">!.....step 4: re-normalize weights. This is necessary because we called</span></div>
<div class="line"><a name="l00495"></a><span class="lineno">  495</span>&#160;    <span class="comment">!.....scrip without the mask. Now that we have the mask in place, we need</span></div>
<div class="line"><a name="l00496"></a><span class="lineno">  496</span>&#160;    <span class="comment">!.....to re-normalize the weights.</span></div>
<div class="line"><a name="l00497"></a><span class="lineno">  497</span>&#160;    <span class="keywordflow">DO</span> kdst=1,<a class="code" href="namespacescrip__grids.html#a8a39e6df61b3471d373773d2930bfed4">grid2_size</a></div>
<div class="line"><a name="l00498"></a><span class="lineno">  498</span>&#160;      <span class="keywordflow">IF</span> (<a class="code" href="namespacescrip__interface.html#af95a61f45a2dde2aa5691a513f8ad158">wgtdata</a>(kdst)%N &gt; 0) <span class="keywordflow">THEN</span></div>
<div class="line"><a name="l00499"></a><span class="lineno">  499</span>&#160;        wtsum=<a class="code" href="namespacescrip__constants.html#a8f7ef7b037191fbbeb9b568788a77405">zero</a></div>
<div class="line"><a name="l00500"></a><span class="lineno">  500</span>&#160;        <span class="keywordflow">DO</span> ipnt=1,<a class="code" href="namespacescrip__interface.html#af95a61f45a2dde2aa5691a513f8ad158">wgtdata</a>(kdst)%N</div>
<div class="line"><a name="l00501"></a><span class="lineno">  501</span>&#160;          wtsum=wtsum+<a class="code" href="namespacescrip__interface.html#af95a61f45a2dde2aa5691a513f8ad158">wgtdata</a>(kdst)%W(ipnt)</div>
<div class="line"><a name="l00502"></a><span class="lineno">  502</span>&#160;<span class="keywordflow">        END DO</span></div>
<div class="line"><a name="l00503"></a><span class="lineno">  503</span>&#160;        <span class="keywordflow">DO</span> ipnt=1,<a class="code" href="namespacescrip__interface.html#af95a61f45a2dde2aa5691a513f8ad158">wgtdata</a>(kdst)%N</div>
<div class="line"><a name="l00504"></a><span class="lineno">  504</span>&#160;          <a class="code" href="namespacescrip__interface.html#af95a61f45a2dde2aa5691a513f8ad158">wgtdata</a>(kdst)%W(ipnt)=<a class="code" href="namespacescrip__interface.html#af95a61f45a2dde2aa5691a513f8ad158">wgtdata</a>(kdst)%W(ipnt)/wtsum</div>
<div class="line"><a name="l00505"></a><span class="lineno">  505</span>&#160;<span class="keywordflow">        END DO</span></div>
<div class="line"><a name="l00506"></a><span class="lineno">  506</span>&#160;<span class="keywordflow">      END IF</span></div>
<div class="line"><a name="l00507"></a><span class="lineno">  507</span>&#160;<span class="keywordflow">    END DO</span></div>
<div class="line"><a name="l00508"></a><span class="lineno">  508</span>&#160; </div>
<div class="line"><a name="l00509"></a><span class="lineno">  509</span>&#160;    <span class="keyword">CALL </span><a class="code" href="namespacescrip__interface.html#a076464e2dc386bc08443fbe23ff33fe8">scrip_clear</a></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="w3servmd_8F90_source.html#l00736">w3servmd::extcde()</a>, <a class="el" href="scrip__remap__vars_8f_source.html#l00087">scrip_remap_vars::frac_highest</a>, <a class="el" href="scrip__remap__vars_8f_source.html#l00087">scrip_remap_vars::frac_lowest</a>, <a class="el" href="wmscrpmd_8F90_source.html#l01165">get_scrip_info()</a>, <a class="el" href="scrip__remap__vars_8f_source.html#l00077">scrip_remap_vars::grid1_add_map1</a>, <a class="el" href="scrip__grids_8f_source.html#l00103">scrip_grids::grid1_center_lat</a>, <a class="el" href="scrip__grids_8f_source.html#l00103">scrip_grids::grid1_center_lon</a>, <a class="el" href="scrip__grids_8f_source.html#l00120">scrip_grids::grid1_corner_lat</a>, <a class="el" href="scrip__grids_8f_source.html#l00120">scrip_grids::grid1_corner_lon</a>, <a class="el" href="scrip__grids_8f_source.html#l00068">scrip_grids::grid1_corners</a>, <a class="el" href="scrip__grids_8f_source.html#l00074">scrip_grids::grid1_dims</a>, <a class="el" href="scrip__grids_8f_source.html#l00103">scrip_grids::grid1_frac</a>, <a class="el" href="scrip__grids_8f_source.html#l00093">scrip_grids::grid1_mask</a>, <a class="el" href="scrip__grids_8f_source.html#l00077">scrip_grids::grid1_name</a>, <a class="el" href="scrip__grids_8f_source.html#l00068">scrip_grids::grid1_rank</a>, <a class="el" href="scrip__grids_8f_source.html#l00068">scrip_grids::grid1_size</a>, <a class="el" href="scrip__grids_8f_source.html#l00080">scrip_grids::grid1_units</a>, <a class="el" href="scrip__remap__vars_8f_source.html#l00077">scrip_remap_vars::grid2_add_map1</a>, <a class="el" href="scrip__grids_8f_source.html#l00103">scrip_grids::grid2_center_lat</a>, <a class="el" href="scrip__grids_8f_source.html#l00103">scrip_grids::grid2_center_lon</a>, <a class="el" href="scrip__grids_8f_source.html#l00120">scrip_grids::grid2_corner_lat</a>, <a class="el" href="scrip__grids_8f_source.html#l00120">scrip_grids::grid2_corner_lon</a>, <a class="el" href="scrip__grids_8f_source.html#l00068">scrip_grids::grid2_corners</a>, <a class="el" href="scrip__grids_8f_source.html#l00074">scrip_grids::grid2_dims</a>, <a class="el" href="scrip__grids_8f_source.html#l00103">scrip_grids::grid2_frac</a>, <a class="el" href="scrip__grids_8f_source.html#l00093">scrip_grids::grid2_mask</a>, <a class="el" href="scrip__grids_8f_source.html#l00077">scrip_grids::grid2_name</a>, <a class="el" href="scrip__grids_8f_source.html#l00068">scrip_grids::grid2_rank</a>, <a class="el" href="scrip__grids_8f_source.html#l00068">scrip_grids::grid2_size</a>, <a class="el" href="scrip__grids_8f_source.html#l00080">scrip_grids::grid2_units</a>, <a class="el" href="scrip__remap__vars_8f_source.html#l00066">scrip_remap_vars::max_links_map1</a>, <a class="el" href="scrip__remap__vars_8f_source.html#l00066">scrip_remap_vars::num_wts</a>, <a class="el" href="scrip__constants_8f_source.html#l00050">scrip_constants::one</a>, <a class="el" href="scrip__interface_8F90_source.html#l00330">scrip_interface::scrip()</a>, <a class="el" href="scrip__interface_8F90_source.html#l00082">scrip_interface::scrip_clear()</a>, <a class="el" href="wmscrpmd_8F90_source.html#l01313">scrip_info_renormalization()</a>, <a class="el" href="scrip__interface_8F90_source.html#l00073">scrip_interface::wgtdata</a>, <a class="el" href="scrip__remap__vars_8f_source.html#l00088">scrip_remap_vars::wt_highest</a>, <a class="el" href="scrip__remap__vars_8f_source.html#l00088">scrip_remap_vars::wt_lowest</a>, <a class="el" href="scrip__remap__vars_8f_source.html#l00083">scrip_remap_vars::wts_map1</a>, and <a class="el" href="scrip__constants_8f_source.html#l00050">scrip_constants::zero</a>.</p>

<p class="reference">Referenced by <a class="el" href="wmgridmd_8F90_source.html#l01100">wmgridmd::wmghgh()</a>.</p>

</div>
</div>
<a id="a4a23dd15cca3e4b295529c8318932be3"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a4a23dd15cca3e4b295529c8318932be3">&#9670;&nbsp;</a></span>triang_indexes()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">subroutine wmscrpmd::triang_indexes </td>
          <td>(</td>
          <td class="paramtype">integer, intent(in)&#160;</td>
          <td class="paramname"><em>I</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">integer, intent(out)&#160;</td>
          <td class="paramname"><em>INEXT</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">integer, intent(out)&#160;</td>
          <td class="paramname"><em>IPREV</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Desc not available. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">I</td><td></td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">INEXT</td><td></td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">IPREV</td><td></td></tr>
  </table>
  </dd>
</dl>
<dl class="section author"><dt>Author</dt><dd>M. Dutour </dd>
<dd>
A. Roland </dd></dl>
<dl class="section date"><dt>Date</dt><dd>NA </dd></dl>

<p class="definition">Definition at line <a class="el" href="wmscrpmd_8F90_source.html#l01413">1413</a> of file <a class="el" href="wmscrpmd_8F90_source.html">wmscrpmd.F90</a>.</p>
<div class="fragment"><div class="line"><a name="l01413"></a><span class="lineno"> 1413</span>&#160;    <span class="comment">!  1. Original author :</span></div>
<div class="line"><a name="l01414"></a><span class="lineno"> 1414</span>&#160;    <span class="comment">!</span></div>
<div class="line"><a name="l01415"></a><span class="lineno"> 1415</span>&#160;    <span class="comment">!     Mathieu Dutour Sikiric, IRB &amp; Aron Roland, Z&amp;P</span></div>
<div class="line"><a name="l01416"></a><span class="lineno"> 1416</span>&#160;    <span class="comment">!</span></div>
<div class="line"><a name="l01417"></a><span class="lineno"> 1417</span>&#160;    <span class="keywordtype">INTEGER</span>, <span class="keywordtype">INTENT(IN)</span>  :: I</div>
<div class="line"><a name="l01418"></a><span class="lineno"> 1418</span>&#160;    <span class="keywordtype">INTEGER</span>, <span class="keywordtype">INTENT(OUT)</span> :: INEXT, IPREV</div>
<div class="line"><a name="l01419"></a><span class="lineno"> 1419</span>&#160;    <span class="keywordflow">IF</span> (i.EQ.1) <span class="keywordflow">THEN</span></div>
<div class="line"><a name="l01420"></a><span class="lineno"> 1420</span>&#160;      inext=3</div>
<div class="line"><a name="l01421"></a><span class="lineno"> 1421</span>&#160;    <span class="keywordflow">ELSE</span></div>
<div class="line"><a name="l01422"></a><span class="lineno"> 1422</span>&#160;      inext=i-1</div>
<div class="line"><a name="l01423"></a><span class="lineno"> 1423</span>&#160;<span class="keywordflow">    END IF</span></div>
<div class="line"><a name="l01424"></a><span class="lineno"> 1424</span>&#160;    <span class="keywordflow">IF</span> (i.EQ.3) <span class="keywordflow">THEN</span></div>
<div class="line"><a name="l01425"></a><span class="lineno"> 1425</span>&#160;      iprev=1</div>
<div class="line"><a name="l01426"></a><span class="lineno"> 1426</span>&#160;    <span class="keywordflow">ELSE</span></div>
<div class="line"><a name="l01427"></a><span class="lineno"> 1427</span>&#160;      iprev=i+1</div>
<div class="line"><a name="l01428"></a><span class="lineno"> 1428</span>&#160;<span class="keywordflow">    END IF</span></div>
</div><!-- fragment -->
<p class="reference">Referenced by <a class="el" href="wmscrpmd_8F90_source.html#l01502">get_boundary()</a>, and <a class="el" href="wmscrpmd_8F90_source.html#l00551">get_scrip_info_unstructured()</a>.</p>

</div>
</div>
</div><!-- contents -->
</div><!-- doc-content -->
<div class="ttc" id="anamespacescrip__grids_html_a1c2f7e645efe5c86480d63170f781c84"><div class="ttname"><a href="namespacescrip__grids.html#a1c2f7e645efe5c86480d63170f781c84">scrip_grids::grid1_corners</a></div><div class="ttdeci">integer(scrip_i4), save grid1_corners</div><div class="ttdef"><b>Definition:</b> <a href="scrip__grids_8f_source.html#l00068">scrip_grids.f:68</a></div></div>
<div class="ttc" id="anamespacescrip__remap__vars_html_a3492cb57b4a72d2577283e9a5f58a2d4"><div class="ttname"><a href="namespacescrip__remap__vars.html#a3492cb57b4a72d2577283e9a5f58a2d4">scrip_remap_vars::grid1_add_map1</a></div><div class="ttdeci">integer(scrip_i4), dimension(:), allocatable, save grid1_add_map1</div><div class="ttdef"><b>Definition:</b> <a href="scrip__remap__vars_8f_source.html#l00077">scrip_remap_vars.f:77</a></div></div>
<div class="ttc" id="anamespacew3triamd_html_a03614b889485266f84a023e4c4de6843"><div class="ttname"><a href="namespacew3triamd.html#a03614b889485266f84a023e4c4de6843">w3triamd::triang_indexes</a></div><div class="ttdeci">subroutine triang_indexes(I, INEXT, IPREV)</div><div class="ttdoc">Set indices of the triangle.</div><div class="ttdef"><b>Definition:</b> <a href="w3triamd_8F90_source.html#l02720">w3triamd.F90:2720</a></div></div>
<div class="ttc" id="anamespacescrip__constants_html_a99a1a0f01091bf19bea3be8dfdd6147f"><div class="ttname"><a href="namespacescrip__constants.html#a99a1a0f01091bf19bea3be8dfdd6147f">scrip_constants::half</a></div><div class="ttdeci">real(kind=scrip_r8), parameter half</div><div class="ttdef"><b>Definition:</b> <a href="scrip__constants_8f_source.html#l00050">scrip_constants.f:50</a></div></div>
<div class="ttc" id="anamespacescrip__grids_html_a5f682e4c9506e03107b95e89ace6a278"><div class="ttname"><a href="namespacescrip__grids.html#a5f682e4c9506e03107b95e89ace6a278">scrip_grids::grid1_mask</a></div><div class="ttdeci">logical(scrip_logical), dimension(:), allocatable, target, save grid1_mask</div><div class="ttdef"><b>Definition:</b> <a href="scrip__grids_8f_source.html#l00093">scrip_grids.f:93</a></div></div>
<div class="ttc" id="anamespacescrip__remap__vars_html_afda72168df18e6df52fdf80ff2d34f31"><div class="ttname"><a href="namespacescrip__remap__vars.html#afda72168df18e6df52fdf80ff2d34f31">scrip_remap_vars::wt_lowest</a></div><div class="ttdeci">real(kind=scrip_r8) wt_lowest</div><div class="ttdef"><b>Definition:</b> <a href="scrip__remap__vars_8f_source.html#l00088">scrip_remap_vars.f:88</a></div></div>
<div class="ttc" id="anamespacew3gdatmd_html_ab1451f01c0706fb65b2c7e1fa1ad1ba6"><div class="ttname"><a href="namespacew3gdatmd.html#ab1451f01c0706fb65b2c7e1fa1ad1ba6">w3gdatmd::ungtype</a></div><div class="ttdeci">integer, parameter ungtype</div><div class="ttdef"><b>Definition:</b> <a href="w3gdatmd_8F90_source.html#l00626">w3gdatmd.F90:626</a></div></div>
<div class="ttc" id="anamespacescrip__remap__vars_html_aab90a570130e3c5ac874ba03879e0745"><div class="ttname"><a href="namespacescrip__remap__vars.html#aab90a570130e3c5ac874ba03879e0745">scrip_remap_vars::wt_highest</a></div><div class="ttdeci">real(kind=scrip_r8) wt_highest</div><div class="ttdef"><b>Definition:</b> <a href="scrip__remap__vars_8f_source.html#l00088">scrip_remap_vars.f:88</a></div></div>
<div class="ttc" id="anamespacescrip__grids_html_a5d3d24c7d9e2f2aa02b386e4d812bc35"><div class="ttname"><a href="namespacescrip__grids.html#a5d3d24c7d9e2f2aa02b386e4d812bc35">scrip_grids::grid2_units</a></div><div class="ttdeci">character(scrip_charlength), save grid2_units</div><div class="ttdef"><b>Definition:</b> <a href="scrip__grids_8f_source.html#l00080">scrip_grids.f:80</a></div></div>
<div class="ttc" id="anamespacescrip__grids_html_a26b4ef12e531c9693862e74d73b7ecac"><div class="ttname"><a href="namespacescrip__grids.html#a26b4ef12e531c9693862e74d73b7ecac">scrip_grids::grid2_rank</a></div><div class="ttdeci">integer(scrip_i4), save grid2_rank</div><div class="ttdef"><b>Definition:</b> <a href="scrip__grids_8f_source.html#l00068">scrip_grids.f:68</a></div></div>
<div class="ttc" id="anamespacescrip__grids_html_a2ba0682513564fd7ed3b4c4ca102cfdd"><div class="ttname"><a href="namespacescrip__grids.html#a2ba0682513564fd7ed3b4c4ca102cfdd">scrip_grids::grid2_mask</a></div><div class="ttdeci">logical(scrip_logical), dimension(:), allocatable, target, save grid2_mask</div><div class="ttdef"><b>Definition:</b> <a href="scrip__grids_8f_source.html#l00093">scrip_grids.f:93</a></div></div>
<div class="ttc" id="anamespacescrip__grids_html_af2aef83426ddf9d48db7736a7a502dd4"><div class="ttname"><a href="namespacescrip__grids.html#af2aef83426ddf9d48db7736a7a502dd4">scrip_grids::grid2_center_lat</a></div><div class="ttdeci">real(scrip_r8), dimension(:), allocatable, target, save grid2_center_lat</div><div class="ttdef"><b>Definition:</b> <a href="scrip__grids_8f_source.html#l00103">scrip_grids.f:103</a></div></div>
<div class="ttc" id="anamespacew3gdatmd_html_a4e0be685c06d5b77285bb227dd2b8ac9"><div class="ttname"><a href="namespacew3gdatmd.html#a4e0be685c06d5b77285bb227dd2b8ac9">w3gdatmd::grids</a></div><div class="ttdeci">type(grid), dimension(:), allocatable, target grids</div><div class="ttdef"><b>Definition:</b> <a href="w3gdatmd_8F90_source.html#l01088">w3gdatmd.F90:1088</a></div></div>
<div class="ttc" id="anamespacescrip__grids_html_a0ed0b6d39c8ec373a2e8ca8a2ea11df6"><div class="ttname"><a href="namespacescrip__grids.html#a0ed0b6d39c8ec373a2e8ca8a2ea11df6">scrip_grids::deg2rad</a></div><div class="ttdeci">real(scrip_r8), parameter deg2rad</div><div class="ttdef"><b>Definition:</b> <a href="scrip__grids_8f_source.html#l00084">scrip_grids.f:84</a></div></div>
<div class="ttc" id="anamespacescrip__grids_html_a0fc6ffc27a89ff7d4c82b26f8471cada"><div class="ttname"><a href="namespacescrip__grids.html#a0fc6ffc27a89ff7d4c82b26f8471cada">scrip_grids::grid1_rank</a></div><div class="ttdeci">integer(scrip_i4), save grid1_rank</div><div class="ttdef"><b>Definition:</b> <a href="scrip__grids_8f_source.html#l00068">scrip_grids.f:68</a></div></div>
<div class="ttc" id="anamespacescrip__constants_html_a766bef5f354460e4fdd00aefd1b85bc3"><div class="ttname"><a href="namespacescrip__constants.html#a766bef5f354460e4fdd00aefd1b85bc3">scrip_constants::one</a></div><div class="ttdeci">real(kind=scrip_r8), parameter one</div><div class="ttdef"><b>Definition:</b> <a href="scrip__constants_8f_source.html#l00050">scrip_constants.f:50</a></div></div>
<div class="ttc" id="anamespacescrip__grids_html"><div class="ttname"><a href="namespacescrip__grids.html">scrip_grids</a></div><div class="ttdef"><b>Definition:</b> <a href="scrip__grids_8f_source.html#l00049">scrip_grids.f:49</a></div></div>
<div class="ttc" id="anamespacescrip__timers_html_a13e5d8b1f71ebc95443c31da01c7d687"><div class="ttname"><a href="namespacescrip__timers.html#a13e5d8b1f71ebc95443c31da01c7d687">scrip_timers::status</a></div><div class="ttdeci">character(len=8), dimension(max_timers), save status</div><div class="ttdef"><b>Definition:</b> <a href="scrip__timers_8f_source.html#l00063">scrip_timers.f:63</a></div></div>
<div class="ttc" id="anamespacescrip__grids_html_ac07bc02943c33322df7a9dc114c91222"><div class="ttname"><a href="namespacescrip__grids.html#ac07bc02943c33322df7a9dc114c91222">scrip_grids::grid2_corners</a></div><div class="ttdeci">integer(scrip_i4), save grid2_corners</div><div class="ttdef"><b>Definition:</b> <a href="scrip__grids_8f_source.html#l00068">scrip_grids.f:68</a></div></div>
<div class="ttc" id="anamespacewmscrpmd_html_aef31042879618e8470d8c73c942a1bdb"><div class="ttname"><a href="namespacewmscrpmd.html#aef31042879618e8470d8c73c942a1bdb">wmscrpmd::scrip_info_renormalization</a></div><div class="ttdeci">subroutine scrip_info_renormalization(GRID_CENTER_LON, GRID_CENTER_LAT, GRID_CORNER_LON, GRID_CORNER_LAT, GRID_MASK, GRID_DIMS, GRID_SIZE, GRID_CORNERS, GRID_RANK, CONV_DX, CONV_DY, OFFSET, GRIDSHIFT)</div><div class="ttdoc">Rescale according to whether the grid is spherical or not.</div><div class="ttdef"><b>Definition:</b> <a href="wmscrpmd_8F90_source.html#l01313">wmscrpmd.F90:1313</a></div></div>
<div class="ttc" id="anamespacescrip__constants_html_a8f7ef7b037191fbbeb9b568788a77405"><div class="ttname"><a href="namespacescrip__constants.html#a8f7ef7b037191fbbeb9b568788a77405">scrip_constants::zero</a></div><div class="ttdeci">real(kind=scrip_r8), parameter zero</div><div class="ttdef"><b>Definition:</b> <a href="scrip__constants_8f_source.html#l00050">scrip_constants.f:50</a></div></div>
<div class="ttc" id="anamespacew3triamd_html_a864329ce5e5bb1ba165095fb128241f0"><div class="ttname"><a href="namespacew3triamd.html#a864329ce5e5bb1ba165095fb128241f0">w3triamd::fix_periodcity</a></div><div class="ttdeci">subroutine fix_periodcity(I1, I2, I3, XGRD, YGRD, PT)</div><div class="ttdoc">Adjust element longitude coordinates for elements straddling the dateline with distance of ~360 degre...</div><div class="ttdef"><b>Definition:</b> <a href="w3triamd_8F90_source.html#l03059">w3triamd.F90:3059</a></div></div>
<div class="ttc" id="anamespacescrip__interface_html"><div class="ttname"><a href="namespacescrip__interface.html">scrip_interface</a></div><div class="ttdef"><b>Definition:</b> <a href="scrip__interface_8F90_source.html#l00002">scrip_interface.F90:2</a></div></div>
<div class="ttc" id="anamespacew3servmd_html"><div class="ttname"><a href="namespacew3servmd.html">w3servmd</a></div><div class="ttdef"><b>Definition:</b> <a href="w3servmd_8F90_source.html#l00003">w3servmd.F90:3</a></div></div>
<div class="ttc" id="anamespacescrip__grids_html_aa194cce0777bf7c51b8b0ff644a4230a"><div class="ttname"><a href="namespacescrip__grids.html#aa194cce0777bf7c51b8b0ff644a4230a">scrip_grids::grid2_corner_lat</a></div><div class="ttdeci">real(scrip_r8), dimension(:,:), allocatable, target, save grid2_corner_lat</div><div class="ttdef"><b>Definition:</b> <a href="scrip__grids_8f_source.html#l00120">scrip_grids.f:120</a></div></div>
<div class="ttc" id="anamespacescrip__grids_html_a49a55c679a77020469894049f721e39a"><div class="ttname"><a href="namespacescrip__grids.html#a49a55c679a77020469894049f721e39a">scrip_grids::grid1_dims</a></div><div class="ttdeci">integer(scrip_i4), dimension(:), allocatable, save grid1_dims</div><div class="ttdef"><b>Definition:</b> <a href="scrip__grids_8f_source.html#l00074">scrip_grids.f:74</a></div></div>
<div class="ttc" id="anamespacescrip__remap__vars_html_af91c24c0b62106ae5b88148abdb29617"><div class="ttname"><a href="namespacescrip__remap__vars.html#af91c24c0b62106ae5b88148abdb29617">scrip_remap_vars::max_links_map1</a></div><div class="ttdeci">integer(scrip_i4), save max_links_map1</div><div class="ttdef"><b>Definition:</b> <a href="scrip__remap__vars_8f_source.html#l00066">scrip_remap_vars.f:66</a></div></div>
<div class="ttc" id="anamespacescrip__grids_html_a774d24c1d380a7fbf23ca890a5deb899"><div class="ttname"><a href="namespacescrip__grids.html#a774d24c1d380a7fbf23ca890a5deb899">scrip_grids::grid1_center_lon</a></div><div class="ttdeci">real(scrip_r8), dimension(:), allocatable, target, save grid1_center_lon</div><div class="ttdef"><b>Definition:</b> <a href="scrip__grids_8f_source.html#l00103">scrip_grids.f:103</a></div></div>
<div class="ttc" id="anamespacescrip__grids_html_aada42b13bda19b10e051e15898647b4a"><div class="ttname"><a href="namespacescrip__grids.html#aada42b13bda19b10e051e15898647b4a">scrip_grids::grid1_corner_lat</a></div><div class="ttdeci">real(scrip_r8), dimension(:,:), allocatable, target, save grid1_corner_lat</div><div class="ttdef"><b>Definition:</b> <a href="scrip__grids_8f_source.html#l00120">scrip_grids.f:120</a></div></div>
<div class="ttc" id="anamespacescrip__remap__vars_html_a73d1c0b90bb410a4f40918c7269064c1"><div class="ttname"><a href="namespacescrip__remap__vars.html#a73d1c0b90bb410a4f40918c7269064c1">scrip_remap_vars::frac_highest</a></div><div class="ttdeci">real(kind=scrip_r8) frac_highest</div><div class="ttdef"><b>Definition:</b> <a href="scrip__remap__vars_8f_source.html#l00087">scrip_remap_vars.f:87</a></div></div>
<div class="ttc" id="anamespacescrip__grids_html_a8a39e6df61b3471d373773d2930bfed4"><div class="ttname"><a href="namespacescrip__grids.html#a8a39e6df61b3471d373773d2930bfed4">scrip_grids::grid2_size</a></div><div class="ttdeci">integer(scrip_i4), save grid2_size</div><div class="ttdef"><b>Definition:</b> <a href="scrip__grids_8f_source.html#l00068">scrip_grids.f:68</a></div></div>
<div class="ttc" id="anamespacescrip__grids_html_a45584a758eceac04cd253e9031a3bcea"><div class="ttname"><a href="namespacescrip__grids.html#a45584a758eceac04cd253e9031a3bcea">scrip_grids::grid1_name</a></div><div class="ttdeci">character(scrip_charlength), save grid1_name</div><div class="ttdef"><b>Definition:</b> <a href="scrip__grids_8f_source.html#l00077">scrip_grids.f:77</a></div></div>
<div class="ttc" id="anamespacescrip__remap__vars_html_a780180b4894791c1f12006d601f064f5"><div class="ttname"><a href="namespacescrip__remap__vars.html#a780180b4894791c1f12006d601f064f5">scrip_remap_vars::frac_lowest</a></div><div class="ttdeci">real(kind=scrip_r8) frac_lowest</div><div class="ttdef"><b>Definition:</b> <a href="scrip__remap__vars_8f_source.html#l00087">scrip_remap_vars.f:87</a></div></div>
<div class="ttc" id="anamespacescrip__interface_html_aa8bbf7fc42f06b95df90175758d5b32a"><div class="ttname"><a href="namespacescrip__interface.html#aa8bbf7fc42f06b95df90175758d5b32a">scrip_interface::scrip</a></div><div class="ttdeci">subroutine scrip(src_num, dst_num, l_master, l_read, l_test)</div><div class="ttdef"><b>Definition:</b> <a href="scrip__interface_8F90_source.html#l00330">scrip_interface.F90:330</a></div></div>
<div class="ttc" id="anamespacescrip__grids_html_a3d95417da9f05ce713a020b09d2c9b0e"><div class="ttname"><a href="namespacescrip__grids.html#a3d95417da9f05ce713a020b09d2c9b0e">scrip_grids::grid2_name</a></div><div class="ttdeci">character(scrip_charlength), save grid2_name</div><div class="ttdef"><b>Definition:</b> <a href="scrip__grids_8f_source.html#l00077">scrip_grids.f:77</a></div></div>
<div class="ttc" id="anamespacescrip__interface_html_af95a61f45a2dde2aa5691a513f8ad158"><div class="ttname"><a href="namespacescrip__interface.html#af95a61f45a2dde2aa5691a513f8ad158">scrip_interface::wgtdata</a></div><div class="ttdeci">type(weight_data), dimension(:), allocatable wgtdata</div><div class="ttdef"><b>Definition:</b> <a href="scrip__interface_8F90_source.html#l00073">scrip_interface.F90:73</a></div></div>
<div class="ttc" id="anamespacescrip__remap__vars_html_afd22f0785b80890e06fc9bcaa1b24f6c"><div class="ttname"><a href="namespacescrip__remap__vars.html#afd22f0785b80890e06fc9bcaa1b24f6c">scrip_remap_vars::wts_map1</a></div><div class="ttdeci">real(scrip_r8), dimension(:,:), allocatable, save wts_map1</div><div class="ttdef"><b>Definition:</b> <a href="scrip__remap__vars_8f_source.html#l00083">scrip_remap_vars.f:83</a></div></div>
<div class="ttc" id="anamespacescrip__constants_html"><div class="ttname"><a href="namespacescrip__constants.html">scrip_constants</a></div><div class="ttdef"><b>Definition:</b> <a href="scrip__constants_8f_source.html#l00038">scrip_constants.f:38</a></div></div>
<div class="ttc" id="anamespacescrip__grids_html_a13541701ddd4712917bbdb9d9c5c8b68"><div class="ttname"><a href="namespacescrip__grids.html#a13541701ddd4712917bbdb9d9c5c8b68">scrip_grids::grid2_dims</a></div><div class="ttdeci">integer(scrip_i4), dimension(:), allocatable, save grid2_dims</div><div class="ttdef"><b>Definition:</b> <a href="scrip__grids_8f_source.html#l00074">scrip_grids.f:74</a></div></div>
<div class="ttc" id="anamespacescrip__grids_html_af883cc28db3bfe80dd1828d1e8d4ed56"><div class="ttname"><a href="namespacescrip__grids.html#af883cc28db3bfe80dd1828d1e8d4ed56">scrip_grids::grid1_center_lat</a></div><div class="ttdeci">real(scrip_r8), dimension(:), allocatable, target, save grid1_center_lat</div><div class="ttdef"><b>Definition:</b> <a href="scrip__grids_8f_source.html#l00103">scrip_grids.f:103</a></div></div>
<div class="ttc" id="anamespacescrip__kindsmod_html"><div class="ttname"><a href="namespacescrip__kindsmod.html">scrip_kindsmod</a></div><div class="ttdef"><b>Definition:</b> <a href="scrip__kindsmod_8f90_source.html#l00003">scrip_kindsmod.f90:3</a></div></div>
<div class="ttc" id="anamespacescrip__grids_html_a29fdc18739da00a0a55d53de07857d82"><div class="ttname"><a href="namespacescrip__grids.html#a29fdc18739da00a0a55d53de07857d82">scrip_grids::grid1_corner_lon</a></div><div class="ttdeci">real(scrip_r8), dimension(:,:), allocatable, target, save grid1_corner_lon</div><div class="ttdef"><b>Definition:</b> <a href="scrip__grids_8f_source.html#l00120">scrip_grids.f:120</a></div></div>
<div class="ttc" id="anamespacescrip__remap__vars_html_aa9dacd55d1f7b09b342dbc020ce671ac"><div class="ttname"><a href="namespacescrip__remap__vars.html#aa9dacd55d1f7b09b342dbc020ce671ac">scrip_remap_vars::grid2_add_map1</a></div><div class="ttdeci">integer(scrip_i4), dimension(:), allocatable, save grid2_add_map1</div><div class="ttdef"><b>Definition:</b> <a href="scrip__remap__vars_8f_source.html#l00077">scrip_remap_vars.f:77</a></div></div>
<div class="ttc" id="anamespacewmscrpmd_html_afc26be2e4edc36071a5fd6ab661e29b2"><div class="ttname"><a href="namespacewmscrpmd.html#afc26be2e4edc36071a5fd6ab661e29b2">wmscrpmd::get_scrip_info_structured</a></div><div class="ttdeci">subroutine get_scrip_info_structured(ID_GRD, GRID_CENTER_LON, GRID_CENTER_LAT, GRID_CORNER_LON, GRID_CORNER_LAT, GRID_MASK, GRID_DIMS, GRID_SIZE, GRID_CORNERS, GRID_RANK)</div><div class="ttdoc">Compute grid arrays needed for scrip for a specific structured grid.</div><div class="ttdef"><b>Definition:</b> <a href="wmscrpmd_8F90_source.html#l00974">wmscrpmd.F90:974</a></div></div>
<div class="ttc" id="anamespacew3gdatmd_html"><div class="ttname"><a href="namespacew3gdatmd.html">w3gdatmd</a></div><div class="ttdef"><b>Definition:</b> <a href="w3gdatmd_8F90_source.html#l00016">w3gdatmd.F90:16</a></div></div>
<div class="ttc" id="anamespacescrip__grids_html_af254072284efe9fe5ffdf6e9fc202ea7"><div class="ttname"><a href="namespacescrip__grids.html#af254072284efe9fe5ffdf6e9fc202ea7">scrip_grids::grid1_size</a></div><div class="ttdeci">integer(scrip_i4), save grid1_size</div><div class="ttdef"><b>Definition:</b> <a href="scrip__grids_8f_source.html#l00068">scrip_grids.f:68</a></div></div>
<div class="ttc" id="anamespacewmscrpmd_html_a209b96841918917341cee8884ed16b38"><div class="ttname"><a href="namespacewmscrpmd.html#a209b96841918917341cee8884ed16b38">wmscrpmd::get_scrip_info_unstructured</a></div><div class="ttdeci">subroutine get_scrip_info_unstructured(ID_GRD, GRID_CENTER_LON, GRID_CENTER_LAT, GRID_CORNER_LON, GRID_CORNER_LAT, GRID_MASK, GRID_DIMS, GRID_SIZE, GRID_CORNERS, GRID_RANK)</div><div class="ttdoc">Compute grid arrays for scrip for a specific unstructured grid.</div><div class="ttdef"><b>Definition:</b> <a href="wmscrpmd_8F90_source.html#l00551">wmscrpmd.F90:551</a></div></div>
<div class="ttc" id="anamespacew3triamd_html_a196c111258770cf6c369c05994e6f92d"><div class="ttname"><a href="namespacew3triamd.html#a196c111258770cf6c369c05994e6f92d">w3triamd::get_boundary</a></div><div class="ttdeci">subroutine get_boundary(MNP, MNE, TRIGP, IOBP, NEIGHBOR_PREV, NEIGHBOR_NEXT)</div><div class="ttdoc">Find boundary points.</div><div class="ttdef"><b>Definition:</b> <a href="w3triamd_8F90_source.html#l02481">w3triamd.F90:2481</a></div></div>
<div class="ttc" id="anamespacescrip__interface_html_a076464e2dc386bc08443fbe23ff33fe8"><div class="ttname"><a href="namespacescrip__interface.html#a076464e2dc386bc08443fbe23ff33fe8">scrip_interface::scrip_clear</a></div><div class="ttdeci">subroutine scrip_clear</div><div class="ttdef"><b>Definition:</b> <a href="scrip__interface_8F90_source.html#l00082">scrip_interface.F90:82</a></div></div>
<div class="ttc" id="anamespacewmscrpmd_html_ad4af6c395fa4aceb01ca07579be7c212"><div class="ttname"><a href="namespacewmscrpmd.html#ad4af6c395fa4aceb01ca07579be7c212">wmscrpmd::get_unstructured_vertex_degree</a></div><div class="ttdeci">subroutine get_unstructured_vertex_degree(MNP, MNE, TRIGP, TRIGINCD)</div><div class="ttdoc">This function returns the list of incidences.</div><div class="ttdef"><b>Definition:</b> <a href="wmscrpmd_8F90_source.html#l01448">wmscrpmd.F90:1448</a></div></div>
<div class="ttc" id="anamespacescrip__grids_html_abd626ac8143111bb57d9a729442d0717"><div class="ttname"><a href="namespacescrip__grids.html#abd626ac8143111bb57d9a729442d0717">scrip_grids::grid2_corner_lon</a></div><div class="ttdeci">real(scrip_r8), dimension(:,:), allocatable, target, save grid2_corner_lon</div><div class="ttdef"><b>Definition:</b> <a href="scrip__grids_8f_source.html#l00120">scrip_grids.f:120</a></div></div>
<div class="ttc" id="anamespacescrip__grids_html_af8624712a67a3746f365c42f8266de92"><div class="ttname"><a href="namespacescrip__grids.html#af8624712a67a3746f365c42f8266de92">scrip_grids::grid1_frac</a></div><div class="ttdeci">real(scrip_r8), dimension(:), allocatable, target, save grid1_frac</div><div class="ttdef"><b>Definition:</b> <a href="scrip__grids_8f_source.html#l00103">scrip_grids.f:103</a></div></div>
<div class="ttc" id="anamespacescrip__remap__vars_html"><div class="ttname"><a href="namespacescrip__remap__vars.html">scrip_remap_vars</a></div><div class="ttdef"><b>Definition:</b> <a href="scrip__remap__vars_8f_source.html#l00040">scrip_remap_vars.f:40</a></div></div>
<div class="ttc" id="anamespacewmscrpmd_html_a1120b9c547b5baa010d3c8fad18490b9"><div class="ttname"><a href="namespacewmscrpmd.html#a1120b9c547b5baa010d3c8fad18490b9">wmscrpmd::get_scrip_info</a></div><div class="ttdeci">subroutine get_scrip_info(ID_GRD, GRID_CENTER_LON, GRID_CENTER_LAT, GRID_CORNER_LON, GRID_CORNER_LAT, GRID_MASK, GRID_DIMS, GRID_SIZE, GRID_CORNERS, GRID_RANK)</div><div class="ttdoc">Compute grid for scrip for a specific structured grid.</div><div class="ttdef"><b>Definition:</b> <a href="wmscrpmd_8F90_source.html#l01165">wmscrpmd.F90:1165</a></div></div>
<div class="ttc" id="anamespacescrip__grids_html_a22212c8b2a76c6462d725ab5f9939273"><div class="ttname"><a href="namespacescrip__grids.html#a22212c8b2a76c6462d725ab5f9939273">scrip_grids::grid1_units</a></div><div class="ttdeci">character(scrip_charlength), save grid1_units</div><div class="ttdef"><b>Definition:</b> <a href="scrip__grids_8f_source.html#l00080">scrip_grids.f:80</a></div></div>
<div class="ttc" id="anamespacescrip__remap__vars_html_aaa77ca76089d86a2850f6afc9f7cc2a5"><div class="ttname"><a href="namespacescrip__remap__vars.html#aaa77ca76089d86a2850f6afc9f7cc2a5">scrip_remap_vars::num_wts</a></div><div class="ttdeci">integer(scrip_i4), save num_wts</div><div class="ttdef"><b>Definition:</b> <a href="scrip__remap__vars_8f_source.html#l00066">scrip_remap_vars.f:66</a></div></div>
<div class="ttc" id="anamespacescrip__grids_html_ab021eaf3478695e3b5445f40eb854ca3"><div class="ttname"><a href="namespacescrip__grids.html#ab021eaf3478695e3b5445f40eb854ca3">scrip_grids::grid2_frac</a></div><div class="ttdeci">real(scrip_r8), dimension(:), allocatable, target, save grid2_frac</div><div class="ttdef"><b>Definition:</b> <a href="scrip__grids_8f_source.html#l00103">scrip_grids.f:103</a></div></div>
<div class="ttc" id="anamespacescrip__grids_html_a5725ab44d2bf128d6ec20bfdbdbe7394"><div class="ttname"><a href="namespacescrip__grids.html#a5725ab44d2bf128d6ec20bfdbdbe7394">scrip_grids::grid2_center_lon</a></div><div class="ttdeci">real(scrip_r8), dimension(:), allocatable, target, save grid2_center_lon</div><div class="ttdef"><b>Definition:</b> <a href="scrip__grids_8f_source.html#l00103">scrip_grids.f:103</a></div></div>
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="namespacewmscrpmd.html">wmscrpmd</a></li>
    <li class="footer">Generated by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.17 </li>
  </ul>
</div>
</body>
</html>
