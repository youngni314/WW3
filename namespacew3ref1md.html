<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.17"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>WAVEWATCH III: w3ref1md Module Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
  $(document).ready(function() { init_search(); });
/* @license-end */
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">WAVEWATCH III
   &#160;<span id="projectnumber">beta 0.0.1</span>
   </div>
  </td>
   <td>        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
</td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.17 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('namespacew3ref1md.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="summary">
<a href="#func-members">Functions/Subroutines</a>  </div>
  <div class="headertitle">
<div class="title">w3ref1md Module Reference</div>  </div>
</div><!--header-->
<div class="contents">

<p>This module computes shoreline reflection, and unresolved islands and iceberg reflections.  
<a href="namespacew3ref1md.html#details">More...</a></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions/Subroutines</h2></td></tr>
<tr class="memitem:ab460d0d55fb25024aea761be94e6d36c"><td class="memItemLeft" align="right" valign="top">subroutine&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacew3ref1md.html#ab460d0d55fb25024aea761be94e6d36c">w3sref</a> (A, CG, WN, EMEAN, FMEAN, DEPTH, CX1, CY1, REFLC, REFLD, TRNX, TRNY, BERG, DT, IX, IY, JSEA, S)</td></tr>
<tr class="memdesc:ab460d0d55fb25024aea761be94e6d36c"><td class="mdescLeft">&#160;</td><td class="mdescRight">Computes coastal and iceberg/island reflections and adds free IG energy.  <a href="namespacew3ref1md.html#ab460d0d55fb25024aea761be94e6d36c">More...</a><br /></td></tr>
<tr class="separator:ab460d0d55fb25024aea761be94e6d36c"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>This module computes shoreline reflection, and unresolved islands and iceberg reflections. </p>
<dl class="section author"><dt>Author</dt><dd>F. Ardhuin </dd></dl>
<dl class="section date"><dt>Date</dt><dd>27-Jun-2014</dd></dl>
<dl class="section copyright"><dt>Copyright</dt><dd>Copyright 2009-2022 National Weather Service (NWS), National Oceanic and Atmospheric Administration. All rights reserved. WAVEWATCH III is a trademark of the NWS. No unauthorized use without permission. </dd></dl>
</div><h2 class="groupheader">Function/Subroutine Documentation</h2>
<a id="ab460d0d55fb25024aea761be94e6d36c"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ab460d0d55fb25024aea761be94e6d36c">&#9670;&nbsp;</a></span>w3sref()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">subroutine w3ref1md::w3sref </td>
          <td>(</td>
          <td class="paramtype">real, dimension(nspec), intent(inout)&#160;</td>
          <td class="paramname"><em>A</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension(nk), intent(in)&#160;</td>
          <td class="paramname"><em>CG</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension(nk), intent(in)&#160;</td>
          <td class="paramname"><em>WN</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, intent(in)&#160;</td>
          <td class="paramname"><em>EMEAN</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, intent(in)&#160;</td>
          <td class="paramname"><em>FMEAN</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, intent(in)&#160;</td>
          <td class="paramname"><em>DEPTH</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, intent(in)&#160;</td>
          <td class="paramname"><em>CX1</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, intent(in)&#160;</td>
          <td class="paramname"><em>CY1</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension(4), intent(in)&#160;</td>
          <td class="paramname"><em>REFLC</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">integer, dimension(6), intent(in)&#160;</td>
          <td class="paramname"><em>REFLD</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, intent(in)&#160;</td>
          <td class="paramname"><em>TRNX</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, intent(in)&#160;</td>
          <td class="paramname"><em>TRNY</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, intent(in)&#160;</td>
          <td class="paramname"><em>BERG</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, intent(in)&#160;</td>
          <td class="paramname"><em>DT</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">integer, intent(in)&#160;</td>
          <td class="paramname"><em>IX</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">integer, intent(in)&#160;</td>
          <td class="paramname"><em>IY</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">integer, intent(in)&#160;</td>
          <td class="paramname"><em>JSEA</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension(nspec), intent(out)&#160;</td>
          <td class="paramname"><em>S</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Computes coastal and iceberg/island reflections and adds free IG energy. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in,out]</td><td class="paramname">A</td><td>Action density spectrum (1-D). </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">CG</td><td>Group velocities. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">WN</td><td>Wavenumbers. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">EMEAN</td><td></td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">FMEAN</td><td></td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">DEPTH</td><td>Mean water depth. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">CX1</td><td></td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">CY1</td><td></td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">REFLC</td><td></td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">REFLD</td><td></td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">TRNX</td><td></td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">TRNY</td><td></td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">BERG</td><td></td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">DT</td><td></td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">IX</td><td></td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">IY</td><td></td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">S</td><td>Source term (1-D version).</td></tr>
  </table>
  </dd>
</dl>
<dl class="section author"><dt>Author</dt><dd>F. Ardhuin </dd></dl>
<dl class="section date"><dt>Date</dt><dd>11-Jun-2014 </dd></dl>

<p class="definition">Definition at line <a class="el" href="w3ref1md_8F90_source.html#l00113">113</a> of file <a class="el" href="w3ref1md_8F90_source.html">w3ref1md.F90</a>.</p>
<div class="fragment"><div class="line"><a name="l00113"></a><span class="lineno">  113</span>&#160;    <span class="comment">!/</span></div>
<div class="line"><a name="l00114"></a><span class="lineno">  114</span>&#160;    <span class="comment">!/                  +-----------------------------------+</span></div>
<div class="line"><a name="l00115"></a><span class="lineno">  115</span>&#160;    <span class="comment">!/                  | WAVEWATCH III           NOAA/NCEP |</span></div>
<div class="line"><a name="l00116"></a><span class="lineno">  116</span>&#160;    <span class="comment">!/                  |            F. Ardhuin             |</span></div>
<div class="line"><a name="l00117"></a><span class="lineno">  117</span>&#160;    <span class="comment">!/                  |                        FORTRAN 90 |</span></div>
<div class="line"><a name="l00118"></a><span class="lineno">  118</span>&#160;    <span class="comment">!/                  | Last update :         11-Jun-2014 |</span></div>
<div class="line"><a name="l00119"></a><span class="lineno">  119</span>&#160;    <span class="comment">!/                  +-----------------------------------+</span></div>
<div class="line"><a name="l00120"></a><span class="lineno">  120</span>&#160;    <span class="comment">!/</span></div>
<div class="line"><a name="l00121"></a><span class="lineno">  121</span>&#160;    <span class="comment">!/    06-May-2010 : Origination.                          ( version 3.14-Ifremer )</span></div>
<div class="line"><a name="l00122"></a><span class="lineno">  122</span>&#160;    <span class="comment">!/    31-May-2011 : Introduction of amplitude-dependent R ( version 4.05 )</span></div>
<div class="line"><a name="l00123"></a><span class="lineno">  123</span>&#160;    <span class="comment">!/    27-Jul-2013 : Adding free infragravity waves        ( version 4.11 )</span></div>
<div class="line"><a name="l00124"></a><span class="lineno">  124</span>&#160;    <span class="comment">!/    11-Nov-2013 : Expands IG energy frequency range     ( version 4.13 )</span></div>
<div class="line"><a name="l00125"></a><span class="lineno">  125</span>&#160;    <span class="comment">!/    05-Mar-2014 : Fixing bug with ICALC = 1 and IG1     ( version 4.18 )</span></div>
<div class="line"><a name="l00126"></a><span class="lineno">  126</span>&#160;    <span class="comment">!/    11-Jun-2014 : Put reflection by subgrids back       ( version 5.01 )</span></div>
<div class="line"><a name="l00127"></a><span class="lineno">  127</span>&#160;    <span class="comment">!/</span></div>
<div class="line"><a name="l00128"></a><span class="lineno">  128</span>&#160;    <span class="comment">!  1. Purpose :</span></div>
<div class="line"><a name="l00129"></a><span class="lineno">  129</span>&#160;    <span class="comment">!</span></div>
<div class="line"><a name="l00130"></a><span class="lineno">  130</span>&#160;    <span class="comment">!     Computes coastal and iceberg/island reflections and adds free IG energy</span></div>
<div class="line"><a name="l00131"></a><span class="lineno">  131</span>&#160;    <span class="comment">!</span></div>
<div class="line"><a name="l00132"></a><span class="lineno">  132</span>&#160;    <span class="comment">!  2. Method :</span></div>
<div class="line"><a name="l00133"></a><span class="lineno">  133</span>&#160;    <span class="comment">!</span></div>
<div class="line"><a name="l00134"></a><span class="lineno">  134</span>&#160;    <span class="comment">!     Adds the reflected components from 2 types of sources:</span></div>
<div class="line"><a name="l00135"></a><span class="lineno">  135</span>&#160;    <span class="comment">!        shoreline reflection, subgrid obstruction and icebergs</span></div>
<div class="line"><a name="l00136"></a><span class="lineno">  136</span>&#160;    <span class="comment">!</span></div>
<div class="line"><a name="l00137"></a><span class="lineno">  137</span>&#160;    <span class="comment">!     In the case where the IG switch is present, there are two passes:</span></div>
<div class="line"><a name="l00138"></a><span class="lineno">  138</span>&#160;    <span class="comment">!        - ICALC = 1, only the wind sea and swell are reflected (no IG added)</span></div>
<div class="line"><a name="l00139"></a><span class="lineno">  139</span>&#160;    <span class="comment">!        - ICALC = 2, IG energy is added into all frequency bands</span></div>
<div class="line"><a name="l00140"></a><span class="lineno">  140</span>&#160;    <span class="comment">!</span></div>
<div class="line"><a name="l00141"></a><span class="lineno">  141</span>&#160;    <span class="comment">!</span></div>
<div class="line"><a name="l00142"></a><span class="lineno">  142</span>&#160;    <span class="comment">!     When IG energy is put in the entire spectrum ( NINT(IGPARS(4)).EQ.2 )</span></div>
<div class="line"><a name="l00143"></a><span class="lineno">  143</span>&#160;    <span class="comment">!        two passes are done: the first for the reflection of windsea and swell</span></div>
<div class="line"><a name="l00144"></a><span class="lineno">  144</span>&#160;    <span class="comment">!                             the second for the addition of IG and IG reflection alone</span></div>
<div class="line"><a name="l00145"></a><span class="lineno">  145</span>&#160;    <span class="comment">!</span></div>
<div class="line"><a name="l00146"></a><span class="lineno">  146</span>&#160;    <span class="comment">!</span></div>
<div class="line"><a name="l00147"></a><span class="lineno">  147</span>&#160;    <span class="comment">!  3. Parameters :</span></div>
<div class="line"><a name="l00148"></a><span class="lineno">  148</span>&#160;    <span class="comment">!</span></div>
<div class="line"><a name="l00149"></a><span class="lineno">  149</span>&#160;    <span class="comment">!     Parameter list</span></div>
<div class="line"><a name="l00150"></a><span class="lineno">  150</span>&#160;    <span class="comment">!     ----------------------------------------------------------------</span></div>
<div class="line"><a name="l00151"></a><span class="lineno">  151</span>&#160;    <span class="comment">!       A         R.A.  I   Action density spectrum (1-D)</span></div>
<div class="line"><a name="l00152"></a><span class="lineno">  152</span>&#160;    <span class="comment">!       CG        R.A.  I   Group velocities.</span></div>
<div class="line"><a name="l00153"></a><span class="lineno">  153</span>&#160;    <span class="comment">!       WN        R.A.  I   Wavenumbers.</span></div>
<div class="line"><a name="l00154"></a><span class="lineno">  154</span>&#160;    <span class="comment">!       DEPTH     Real  I   Mean water depth.</span></div>
<div class="line"><a name="l00155"></a><span class="lineno">  155</span>&#160;    <span class="comment">!       S         R.A.  O   Source term (1-D version).</span></div>
<div class="line"><a name="l00156"></a><span class="lineno">  156</span>&#160;    <span class="comment">!       D         R.A.  O   Diagonal term of derivative (1-D version).</span></div>
<div class="line"><a name="l00157"></a><span class="lineno">  157</span>&#160;    <span class="comment">!     ----------------------------------------------------------------</span></div>
<div class="line"><a name="l00158"></a><span class="lineno">  158</span>&#160;    <span class="comment">!</span></div>
<div class="line"><a name="l00159"></a><span class="lineno">  159</span>&#160;    <span class="comment">!  4. Subroutines used :</span></div>
<div class="line"><a name="l00160"></a><span class="lineno">  160</span>&#160;    <span class="comment">!</span></div>
<div class="line"><a name="l00161"></a><span class="lineno">  161</span>&#160;    <span class="comment">!      Name      Type  Module   Description</span></div>
<div class="line"><a name="l00162"></a><span class="lineno">  162</span>&#160;    <span class="comment">!     ----------------------------------------------------------------</span></div>
<div class="line"><a name="l00163"></a><span class="lineno">  163</span>&#160;    <span class="comment">!      STRACE    Subr. W3SERVMD Subroutine tracing.</span></div>
<div class="line"><a name="l00164"></a><span class="lineno">  164</span>&#160;    <span class="comment">!     ----------------------------------------------------------------</span></div>
<div class="line"><a name="l00165"></a><span class="lineno">  165</span>&#160;    <span class="comment">!</span></div>
<div class="line"><a name="l00166"></a><span class="lineno">  166</span>&#160;    <span class="comment">!  5. Called by :</span></div>
<div class="line"><a name="l00167"></a><span class="lineno">  167</span>&#160;    <span class="comment">!</span></div>
<div class="line"><a name="l00168"></a><span class="lineno">  168</span>&#160;    <span class="comment">!      Name      Type  Module   Description</span></div>
<div class="line"><a name="l00169"></a><span class="lineno">  169</span>&#160;    <span class="comment">!     ----------------------------------------------------------------</span></div>
<div class="line"><a name="l00170"></a><span class="lineno">  170</span>&#160;    <span class="comment">!      W3SRCE    Subr. W3SRCEMD Source term integration.</span></div>
<div class="line"><a name="l00171"></a><span class="lineno">  171</span>&#160;    <span class="comment">!      W3EXPO    Subr.   N/A    Point output post-processor.</span></div>
<div class="line"><a name="l00172"></a><span class="lineno">  172</span>&#160;    <span class="comment">!      GXEXPO    Subr.   N/A    GrADS point output post-processor.</span></div>
<div class="line"><a name="l00173"></a><span class="lineno">  173</span>&#160;    <span class="comment">!     ----------------------------------------------------------------</span></div>
<div class="line"><a name="l00174"></a><span class="lineno">  174</span>&#160;    <span class="comment">!</span></div>
<div class="line"><a name="l00175"></a><span class="lineno">  175</span>&#160;    <span class="comment">!  6. Error messages :</span></div>
<div class="line"><a name="l00176"></a><span class="lineno">  176</span>&#160;    <span class="comment">!</span></div>
<div class="line"><a name="l00177"></a><span class="lineno">  177</span>&#160;    <span class="comment">!       None.</span></div>
<div class="line"><a name="l00178"></a><span class="lineno">  178</span>&#160;    <span class="comment">!</span></div>
<div class="line"><a name="l00179"></a><span class="lineno">  179</span>&#160;    <span class="comment">!  7. Remarks :</span></div>
<div class="line"><a name="l00180"></a><span class="lineno">  180</span>&#160;    <span class="comment">!</span></div>
<div class="line"><a name="l00181"></a><span class="lineno">  181</span>&#160;    <span class="comment">!  8. Structure :</span></div>
<div class="line"><a name="l00182"></a><span class="lineno">  182</span>&#160;    <span class="comment">!</span></div>
<div class="line"><a name="l00183"></a><span class="lineno">  183</span>&#160;    <span class="comment">!     See source code.</span></div>
<div class="line"><a name="l00184"></a><span class="lineno">  184</span>&#160;    <span class="comment">!</span></div>
<div class="line"><a name="l00185"></a><span class="lineno">  185</span>&#160;    <span class="comment">!  9. Switches :</span></div>
<div class="line"><a name="l00186"></a><span class="lineno">  186</span>&#160;    <span class="comment">!</span></div>
<div class="line"><a name="l00187"></a><span class="lineno">  187</span>&#160;    <span class="comment">!     !/S  Enable subroutine tracing.</span></div>
<div class="line"><a name="l00188"></a><span class="lineno">  188</span>&#160;    <span class="comment">!</span></div>
<div class="line"><a name="l00189"></a><span class="lineno">  189</span>&#160;    <span class="comment">! 10. Source code :</span></div>
<div class="line"><a name="l00190"></a><span class="lineno">  190</span>&#160;    <span class="comment">!</span></div>
<div class="line"><a name="l00191"></a><span class="lineno">  191</span>&#160;    <span class="comment">!/ ------------------------------------------------------------------- /</span></div>
<div class="line"><a name="l00192"></a><span class="lineno">  192</span>&#160;    <span class="keywordtype">USE </span><a class="code" href="namespaceconstants.html">constants</a></div>
<div class="line"><a name="l00193"></a><span class="lineno">  193</span>&#160;    <span class="keywordtype">USE </span><a class="code" href="namespacew3gdatmd.html">w3gdatmd</a>, <span class="keywordtype">ONLY</span>: nk, nth, nspec, <a class="code" href="namespacew3gdatmd.html#ad451ba3fd6cfdb044986de89e4e4e4f8">sig</a>, <a class="code" href="namespacew3gdatmd.html#a4b6f7577a00b480afcec77e672fb25b2">dth</a>, <a class="code" href="namespacew3gdatmd.html#aead1aecac711ead3469d954b2bd60fc2">dden</a>,  <a class="code" href="namespacew3gdatmd.html#a44cb2e659c5f016ce0a8da57489d6a67">smctype</a>, &amp;</div>
<div class="line"><a name="l00194"></a><span class="lineno">  194</span>&#160;         <a class="code" href="namespacew3gdatmd.html#ad1fe2b09feabedff12f7e4bf9c62b4b8">refpars</a>, <a class="code" href="namespacew3gdatmd.html#a77230bde44d23a91e680520547fcaeb9">ecos</a>, <a class="code" href="namespacew3gdatmd.html#a345f95d975f7c29614d7096b4a2c4073">esin</a>, <a class="code" href="namespacew3gdatmd.html#a5cbed3f13d9dfa812a468e69b77b8271">ec2</a>, <a class="code" href="namespacew3gdatmd.html#a5c38b5b943ce3e737e3cc0f1edc5b157">mapth</a>, <a class="code" href="namespacew3gdatmd.html#a4551e9fa53585b84b3d1130dac7c0bac">mapwn</a>, <a class="code" href="namespacew3gdatmd.html#aacc0010db11c3f9311b00a816a0e20c2">flagll</a>, &amp;</div>
<div class="line"><a name="l00195"></a><span class="lineno">  195</span>&#160;         <a class="code" href="namespacew3gdatmd.html#a87981ee1fa941ca919854b529a9e3a02">sig2</a>, <a class="code" href="namespacew3gdatmd.html#a923f717f20c2c0991fa3798768f3526a">dsii</a>, <a class="code" href="namespacew3gdatmd.html#a980e242bf67b9984dc6e1a4d28df6c92">iobpd</a>, <a class="code" href="namespacew3gdatmd.html#a77210c5b64d791072462f4d3948210aa">gtype</a>, <a class="code" href="namespacew3gdatmd.html#ab1451f01c0706fb65b2c7e1fa1ad1ba6">ungtype</a>, mapfs, <a class="code" href="namespacew3gdatmd.html#a063c55199a8786edf383f3c6359108f2">clgtype</a>, <a class="code" href="namespacew3gdatmd.html#a79e88ab04db1d3ac00f3e45d2625312c">rlgtype</a></div>
<div class="line"><a name="l00196"></a><span class="lineno">  196</span>&#160;    <span class="keywordtype">USE </span><a class="code" href="namespacew3gdatmd.html">w3gdatmd</a>, <span class="keywordtype">ONLY</span> : <a class="code" href="namespacew3gdatmd.html#aad204763c51cb0df15891498f423285b">clats</a>, <a class="code" href="namespacew3gdatmd.html#a26759ceeed28f07100b31cab17d5c7ea">hpfac</a>, <a class="code" href="namespacew3gdatmd.html#ad0202e8b0d4d789838ffaf63de3be312">hqfac</a>, <a class="code" href="namespacew3gdatmd.html#ace4b7064f5b270ac5564b3484566042d">sx</a>, <a class="code" href="namespacew3gdatmd.html#ae8e13cd23548b33eaaae230040049539">sy</a>, <a class="code" href="namespacew3gdatmd.html#a40498c232ed5b8289e921f09acc96760">si</a></div>
<div class="line"><a name="l00197"></a><span class="lineno">  197</span>&#160;<span class="preprocessor">#ifdef W3_PDLIB</span></div>
<div class="line"><a name="l00198"></a><span class="lineno">  198</span>&#160;<span class="preprocessor"></span>    <span class="keywordtype">USE </span><a class="code" href="namespaceyownodepool.html">yownodepool</a>, <span class="keywordtype">ONLY</span>: <a class="code" href="namespaceyownodepool.html#ac6a6629b5194a1b6761c06d6eb433ed5">pdlib_si</a></div>
<div class="line"><a name="l00199"></a><span class="lineno">  199</span>&#160;    <span class="keywordtype">USE </span><a class="code" href="namespacew3gdatmd.html">w3gdatmd</a>, <span class="keywordtype">ONLY</span>: <a class="code" href="namespacew3gdatmd.html#a1f30ee4349738120d2f73c56f6ea2923">iobp_loc</a>, <a class="code" href="namespacew3gdatmd.html#a03c93522e79707dbb6333c3606526fd3">iobpd_loc</a>, <a class="code" href="namespacew3gdatmd.html#a053ddee2f7e044c9686b2b7b85bff174">iobpa_loc</a>, <a class="code" href="namespacew3gdatmd.html#a17c65bd93b90119883caf84c7fa448df">iobdp_loc</a></div>
<div class="line"><a name="l00200"></a><span class="lineno">  200</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00201"></a><span class="lineno">  201</span>&#160;<span class="preprocessor"></span><span class="preprocessor">#ifdef W3_IG1</span></div>
<div class="line"><a name="l00202"></a><span class="lineno">  202</span>&#160;<span class="preprocessor"></span>    <span class="keywordtype">USE </span><a class="code" href="namespacew3gdatmd.html">w3gdatmd</a>, <span class="keywordtype">ONLY</span> : <a class="code" href="namespacew3gdatmd.html#a3439026c6e1260ce40ad1d4cbb405694">igpars</a></div>
<div class="line"><a name="l00203"></a><span class="lineno">  203</span>&#160;    <span class="keywordtype">USE </span><a class="code" href="namespacew3gig1md.html">w3gig1md</a></div>
<div class="line"><a name="l00204"></a><span class="lineno">  204</span>&#160;    <span class="keywordtype">USE </span><a class="code" href="namespacew3canomd.html">w3canomd</a>, <span class="keywordtype">ONLY</span> : <a class="code" href="namespacew3canomd.html#a0024389a271c1adccd88c4ff24b76e0e">w3add2ndorder</a></div>
<div class="line"><a name="l00205"></a><span class="lineno">  205</span>&#160;    <span class="keywordtype">USE </span><a class="code" href="namespacew3dispmd.html">w3dispmd</a>, <span class="keywordtype">ONLY</span>: <a class="code" href="namespacew3dispmd.html#a46fe0eb1a06309ed580662f3863b7668">nar1d</a>, dfac, <a class="code" href="namespacew3dispmd.html#a50de12651fb8eeb08c4007b9e4ad7c1d">n1max</a>, <a class="code" href="namespacew3dispmd.html#a2d8d5f061b663f6e27c5f474e661a592">ecg1</a>, <a class="code" href="namespacew3dispmd.html#ad7a1721bb6048f62402f14cb3e69e219">ewn1</a>, <a class="code" href="namespacew3dispmd.html#a347c04da9af6016c1dbb0a6aaed6e9ba">dsie</a></div>
<div class="line"><a name="l00206"></a><span class="lineno">  206</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00207"></a><span class="lineno">  207</span>&#160;<span class="preprocessor"></span><span class="preprocessor">#ifdef W3_S</span></div>
<div class="line"><a name="l00208"></a><span class="lineno">  208</span>&#160;<span class="preprocessor"></span>    <span class="keywordtype">USE </span><a class="code" href="namespacew3servmd.html">w3servmd</a>, <span class="keywordtype">ONLY</span>: <a class="code" href="namespacew3servmd.html#a3b050f1196ad182ba44915b0c7bfb22f">strace</a></div>
<div class="line"><a name="l00209"></a><span class="lineno">  209</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00210"></a><span class="lineno">  210</span>&#160;<span class="preprocessor"></span>    <span class="comment">!/</span></div>
<div class="line"><a name="l00211"></a><span class="lineno">  211</span>&#160;    <span class="comment">!</span></div>
<div class="line"><a name="l00212"></a><span class="lineno">  212</span>&#160;    <span class="keywordtype">IMPLICIT NONE</span></div>
<div class="line"><a name="l00213"></a><span class="lineno">  213</span>&#160;    <span class="comment">!/</span></div>
<div class="line"><a name="l00214"></a><span class="lineno">  214</span>&#160;    <span class="comment">!/ ------------------------------------------------------------------- /</span></div>
<div class="line"><a name="l00215"></a><span class="lineno">  215</span>&#160;    <span class="comment">!/ Parameter list</span></div>
<div class="line"><a name="l00216"></a><span class="lineno">  216</span>&#160;    <span class="comment">!/</span></div>
<div class="line"><a name="l00217"></a><span class="lineno">  217</span>&#160;<span class="keywordtype">    REAL</span>, <span class="keywordtype">INTENT(IN)</span>        :: CG(NK), WN(NK), DEPTH, EMEAN, FMEAN</div>
<div class="line"><a name="l00218"></a><span class="lineno">  218</span>&#160;<span class="keywordtype">    REAL</span>, <span class="keywordtype">INTENT(INOUT)</span>     :: A(NSPEC)</div>
<div class="line"><a name="l00219"></a><span class="lineno">  219</span>&#160;<span class="keywordtype">    REAL</span>, <span class="keywordtype">INTENT(IN)</span>        :: CX1, CY1, DT</div>
<div class="line"><a name="l00220"></a><span class="lineno">  220</span>&#160;    <span class="keywordtype">INTEGER</span>, <span class="keywordtype">INTENT(IN)</span>     :: REFLD(6), IX, IY, JSEA</div>
<div class="line"><a name="l00221"></a><span class="lineno">  221</span>&#160;<span class="keywordtype">    REAL</span>, <span class="keywordtype">INTENT(IN)</span>        :: REFLC(4), TRNX, &amp;</div>
<div class="line"><a name="l00222"></a><span class="lineno">  222</span>&#160;         TRNY, BERG</div>
<div class="line"><a name="l00223"></a><span class="lineno">  223</span>&#160;<span class="keywordtype">    REAL</span>, <span class="keywordtype">INTENT(OUT)</span>       :: S(NSPEC)</div>
<div class="line"><a name="l00224"></a><span class="lineno">  224</span>&#160;    <span class="comment">!/</span></div>
<div class="line"><a name="l00225"></a><span class="lineno">  225</span>&#160;    <span class="comment">!/ ------------------------------------------------------------------- /</span></div>
<div class="line"><a name="l00226"></a><span class="lineno">  226</span>&#160;    <span class="comment">!/ Local parameters</span></div>
<div class="line"><a name="l00227"></a><span class="lineno">  227</span>&#160;    <span class="comment">!/</span></div>
<div class="line"><a name="l00228"></a><span class="lineno">  228</span>&#160;    <span class="keywordtype">INTEGER</span>         :: ISPECI, ISPEC, IK, ITH, ITH2, ITH3, ITH2X, ITH2Y, &amp;</div>
<div class="line"><a name="l00229"></a><span class="lineno">  229</span>&#160;         NRS, IK1</div>
<div class="line"><a name="l00230"></a><span class="lineno">  230</span>&#160;    <span class="keywordtype">INTEGER</span>         :: ISEA, ICALC, IOBPDIP(NTH)</div>
<div class="line"><a name="l00231"></a><span class="lineno">  231</span>&#160;    <span class="keywordtype">LOGICAL</span>         :: IGBCOVERWRITE, IGSWELLMAX</div>
<div class="line"><a name="l00232"></a><span class="lineno">  232</span>&#160;<span class="keywordtype">    REAL</span>            :: R1, R2, R3, R4, R2X, R2Y, DEPTHIG</div>
<div class="line"><a name="l00233"></a><span class="lineno">  233</span>&#160;<span class="keywordtype">    REAL</span>            :: DELA, DELX, DELY, FACX</div>
<div class="line"><a name="l00234"></a><span class="lineno">  234</span>&#160;<span class="keywordtype">    REAL</span>            :: FAC1, FAC2, FAC3, FAC4, RAMP0, RAMP, &amp;</div>
<div class="line"><a name="l00235"></a><span class="lineno">  235</span>&#160;         RAMP1, RAMP2, RAMP4, MICHEFAC, SLOPE</div>
<div class="line"><a name="l00236"></a><span class="lineno">  236</span>&#160;<span class="keywordtype">    REAL</span>             :: HS, HIG, HIG1, HIG2, EB, SB, EMEANA, FMEAN2,   &amp;</div>
<div class="line"><a name="l00237"></a><span class="lineno">  237</span>&#160;         FMEANA, FREQIG, EFIG, EFIG1, SQRTH, SMEANA</div>
<div class="line"><a name="l00238"></a><span class="lineno">  238</span>&#160;<span class="preprocessor">#ifdef W3_IG1</span></div>
<div class="line"><a name="l00239"></a><span class="lineno">  239</span>&#160;<span class="preprocessor"></span>    <span class="keywordtype">INTEGER</span>        :: NKIG,NSPECIG,NSPECIGSTART, I1, I2</div>
<div class="line"><a name="l00240"></a><span class="lineno">  240</span>&#160;<span class="keywordtype">    REAL</span>           :: ATMP(NSPEC),ATMP2(NSPEC), STMP1(NSPEC),      &amp;</div>
<div class="line"><a name="l00241"></a><span class="lineno">  241</span>&#160;         STMP2(NSPEC), WNB(NK), CGB(NK), SIX, IGFAC1, IGFAC2</div>
<div class="line"><a name="l00242"></a><span class="lineno">  242</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00243"></a><span class="lineno">  243</span>&#160;<span class="preprocessor"></span><span class="preprocessor">#ifdef W3_S</span></div>
<div class="line"><a name="l00244"></a><span class="lineno">  244</span>&#160;<span class="preprocessor"></span>    <span class="keywordtype">INTEGER</span>, <span class="keywordtype">SAVE</span>           :: IENT = 0</div>
<div class="line"><a name="l00245"></a><span class="lineno">  245</span>&#160;    <span class="keyword">CALL </span><a class="code" href="namespacew3servmd.html#a3b050f1196ad182ba44915b0c7bfb22f">strace</a> (ient, <span class="stringliteral">&#39;W3SREF&#39;</span>)</div>
<div class="line"><a name="l00246"></a><span class="lineno">  246</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00247"></a><span class="lineno">  247</span>&#160;<span class="preprocessor"></span>    <span class="comment">!</span></div>
<div class="line"><a name="l00248"></a><span class="lineno">  248</span>&#160;    <span class="comment">! 0.  Initializations ------------------------------------------------ *</span></div>
<div class="line"><a name="l00249"></a><span class="lineno">  249</span>&#160;    <span class="comment">!</span></div>
<div class="line"><a name="l00250"></a><span class="lineno">  250</span>&#160;<span class="preprocessor">#ifdef W3_IG1</span></div>
<div class="line"><a name="l00251"></a><span class="lineno">  251</span>&#160;<span class="preprocessor"></span>    igbcoverwrite =(mod( nint(<a class="code" href="namespacew3gdatmd.html#a3439026c6e1260ce40ad1d4cbb405694">igpars</a>(4)),2).EQ.1)</div>
<div class="line"><a name="l00252"></a><span class="lineno">  252</span>&#160;    igswellmax =( nint(<a class="code" href="namespacew3gdatmd.html#a3439026c6e1260ce40ad1d4cbb405694">igpars</a>(4)).GE.2)</div>
<div class="line"><a name="l00253"></a><span class="lineno">  253</span>&#160;    <span class="comment">! This following line is a quick fix before the bug is understood ....</span></div>
<div class="line"><a name="l00254"></a><span class="lineno">  254</span>&#160;    <span class="keywordflow">IF</span> (gtype.EQ.ungtype) igswellmax =.false.</div>
<div class="line"><a name="l00255"></a><span class="lineno">  255</span>&#160;    igfac1 = 0.25</div>
<div class="line"><a name="l00256"></a><span class="lineno">  256</span>&#160;    igfac2 = 0.25</div>
<div class="line"><a name="l00257"></a><span class="lineno">  257</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00258"></a><span class="lineno">  258</span>&#160;<span class="preprocessor"></span>    emeana  = 0.</div>
<div class="line"><a name="l00259"></a><span class="lineno">  259</span>&#160;    fmeana  = 0.</div>
<div class="line"><a name="l00260"></a><span class="lineno">  260</span>&#160;    fmean2  = 0.</div>
<div class="line"><a name="l00261"></a><span class="lineno">  261</span>&#160; </div>
<div class="line"><a name="l00262"></a><span class="lineno">  262</span>&#160;    delx=1.</div>
<div class="line"><a name="l00263"></a><span class="lineno">  263</span>&#160;    dely=1.</div>
<div class="line"><a name="l00264"></a><span class="lineno">  264</span>&#160;    <span class="comment">! set FACx for all grid types</span></div>
<div class="line"><a name="l00265"></a><span class="lineno">  265</span>&#160;    <span class="keywordflow">IF</span> (flagll) <span class="keywordflow">THEN</span></div>
<div class="line"><a name="l00266"></a><span class="lineno">  266</span>&#160;      facx   =  1./(<a class="code" href="namespaceconstants.html#a7ca2bfab88e5cd9e0eda00a6147d1806">dera</a> * <a class="code" href="namespaceconstants.html#a4dceccc29b7e5529102409498706a17f">radius</a>)</div>
<div class="line"><a name="l00267"></a><span class="lineno">  267</span>&#160;    <span class="keywordflow">ELSE</span></div>
<div class="line"><a name="l00268"></a><span class="lineno">  268</span>&#160;      facx   =  1.</div>
<div class="line"><a name="l00269"></a><span class="lineno">  269</span>&#160;<span class="keywordflow">    END IF</span></div>
<div class="line"><a name="l00270"></a><span class="lineno">  270</span>&#160; </div>
<div class="line"><a name="l00271"></a><span class="lineno">  271</span>&#160;    isea = mapfs(iy,ix)</div>
<div class="line"><a name="l00272"></a><span class="lineno">  272</span>&#160;    <span class="comment">!!Li  SMCTYPE shares info with RLGTYPE.  JGLi12Oct2020</span></div>
<div class="line"><a name="l00273"></a><span class="lineno">  273</span>&#160;    <span class="keywordflow">IF</span> (gtype.EQ.rlgtype .OR. gtype.EQ.smctype) <span class="keywordflow">THEN</span></div>
<div class="line"><a name="l00274"></a><span class="lineno">  274</span>&#160;      delx=sx*clats(isea)/facx</div>
<div class="line"><a name="l00275"></a><span class="lineno">  275</span>&#160;      dely=sy/facx</div>
<div class="line"><a name="l00276"></a><span class="lineno">  276</span>&#160;<span class="keywordflow">    END IF</span></div>
<div class="line"><a name="l00277"></a><span class="lineno">  277</span>&#160; </div>
<div class="line"><a name="l00278"></a><span class="lineno">  278</span>&#160;    <span class="keywordflow">IF</span> (gtype.EQ.clgtype) <span class="keywordflow">THEN</span></div>
<div class="line"><a name="l00279"></a><span class="lineno">  279</span>&#160;      <span class="comment">! Maybe what follows works also for RLGTYPE ... to be verified</span></div>
<div class="line"><a name="l00280"></a><span class="lineno">  280</span>&#160;      delx=hpfac(iy,ix)/ facx</div>
<div class="line"><a name="l00281"></a><span class="lineno">  281</span>&#160;      dely=hqfac(iy,ix)/ facx</div>
<div class="line"><a name="l00282"></a><span class="lineno">  282</span>&#160;<span class="keywordflow">    END IF</span></div>
<div class="line"><a name="l00283"></a><span class="lineno">  283</span>&#160; </div>
<div class="line"><a name="l00284"></a><span class="lineno">  284</span>&#160;    <span class="keywordflow">IF</span> (gtype.EQ.ungtype) <span class="keywordflow">THEN</span></div>
<div class="line"><a name="l00285"></a><span class="lineno">  285</span>&#160;      <span class="keywordflow">IF</span> (<a class="code" href="namespaceconstants.html#ad8b244917fc2f2b94d397086522af7a1">lpdlib</a>) <span class="keywordflow">THEN</span></div>
<div class="line"><a name="l00286"></a><span class="lineno">  286</span>&#160;<span class="preprocessor">#ifdef W3_PDLIB</span></div>
<div class="line"><a name="l00287"></a><span class="lineno">  287</span>&#160;<span class="preprocessor"></span>        delx=5.*sqrt(<a class="code" href="namespaceyownodepool.html#ac6a6629b5194a1b6761c06d6eb433ed5">pdlib_si</a>(jsea))*(<a class="code" href="namespaceconstants.html#a7ca2bfab88e5cd9e0eda00a6147d1806">dera</a> * <a class="code" href="namespaceconstants.html#a4dceccc29b7e5529102409498706a17f">radius</a>)    <span class="comment">! first approximation ...</span></div>
<div class="line"><a name="l00288"></a><span class="lineno">  288</span>&#160;        dely=5.*sqrt(<a class="code" href="namespaceyownodepool.html#ac6a6629b5194a1b6761c06d6eb433ed5">pdlib_si</a>(jsea))*(<a class="code" href="namespaceconstants.html#a7ca2bfab88e5cd9e0eda00a6147d1806">dera</a> * <a class="code" href="namespaceconstants.html#a4dceccc29b7e5529102409498706a17f">radius</a>)    <span class="comment">! first approximation ...</span></div>
<div class="line"><a name="l00289"></a><span class="lineno">  289</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00290"></a><span class="lineno">  290</span>&#160;<span class="preprocessor"></span>      <span class="keywordflow">ELSE</span></div>
<div class="line"><a name="l00291"></a><span class="lineno">  291</span>&#160;        delx=5.*sqrt(si(ix))*(<a class="code" href="namespaceconstants.html#a7ca2bfab88e5cd9e0eda00a6147d1806">dera</a> * <a class="code" href="namespaceconstants.html#a4dceccc29b7e5529102409498706a17f">radius</a>)    <span class="comment">! first approximation ...</span></div>
<div class="line"><a name="l00292"></a><span class="lineno">  292</span>&#160;        dely=5.*sqrt(si(ix))*(<a class="code" href="namespaceconstants.html#a7ca2bfab88e5cd9e0eda00a6147d1806">dera</a> * <a class="code" href="namespaceconstants.html#a4dceccc29b7e5529102409498706a17f">radius</a>)    <span class="comment">! first approximation ...</span></div>
<div class="line"><a name="l00293"></a><span class="lineno">  293</span>&#160;<span class="keywordflow">      ENDIF</span></div>
<div class="line"><a name="l00294"></a><span class="lineno">  294</span>&#160;<span class="keywordflow">    END IF</span></div>
<div class="line"><a name="l00295"></a><span class="lineno">  295</span>&#160; </div>
<div class="line"><a name="l00296"></a><span class="lineno">  296</span>&#160;    ik1=1</div>
<div class="line"><a name="l00297"></a><span class="lineno">  297</span>&#160;<span class="preprocessor">#ifdef W3_IG1</span></div>
<div class="line"><a name="l00298"></a><span class="lineno">  298</span>&#160;<span class="preprocessor"></span>    ik1=nint(<a class="code" href="namespacew3gdatmd.html#a3439026c6e1260ce40ad1d4cbb405694">igpars</a>(5))+1</div>
<div class="line"><a name="l00299"></a><span class="lineno">  299</span>&#160;    nspecigstart = nint(<a class="code" href="namespacew3gdatmd.html#a3439026c6e1260ce40ad1d4cbb405694">igpars</a>(5))*nth</div>
<div class="line"><a name="l00300"></a><span class="lineno">  300</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00301"></a><span class="lineno">  301</span>&#160;<span class="preprocessor"></span>    <span class="keywordflow">DO</span> ik=ik1, nk</div>
<div class="line"><a name="l00302"></a><span class="lineno">  302</span>&#160;      eb  = 0.</div>
<div class="line"><a name="l00303"></a><span class="lineno">  303</span>&#160;      <span class="keywordflow">DO</span> ith=1, nth</div>
<div class="line"><a name="l00304"></a><span class="lineno">  304</span>&#160;        eb = eb + a(ith+(ik-1)*nth)</div>
<div class="line"><a name="l00305"></a><span class="lineno">  305</span>&#160;<span class="keywordflow">      END DO</span></div>
<div class="line"><a name="l00306"></a><span class="lineno">  306</span>&#160;      eb   = eb * dden(ik) / cg(ik)</div>
<div class="line"><a name="l00307"></a><span class="lineno">  307</span>&#160;      emeana    = emeana  + eb</div>
<div class="line"><a name="l00308"></a><span class="lineno">  308</span>&#160;      fmean2    = fmean2  + eb /sig(ik)**2</div>
<div class="line"><a name="l00309"></a><span class="lineno">  309</span>&#160;      fmeana    = fmeana  + eb /sig(ik)</div>
<div class="line"><a name="l00310"></a><span class="lineno">  310</span>&#160;<span class="keywordflow">    END DO</span></div>
<div class="line"><a name="l00311"></a><span class="lineno">  311</span>&#160;    fmeana  = <a class="code" href="namespaceconstants.html#ab81445207bb044b4a638d50ecf4470e5">tpiinv</a> * (emeana / max( 1.e-7 , fmeana ))</div>
<div class="line"><a name="l00312"></a><span class="lineno">  312</span>&#160;    fmean2  = <a class="code" href="namespaceconstants.html#ab81445207bb044b4a638d50ecf4470e5">tpiinv</a> * sqrt(emeana / max( 1.e-7 , fmean2 ))</div>
<div class="line"><a name="l00313"></a><span class="lineno">  313</span>&#160;    fmeana  = max(fmeana,sig(1))</div>
<div class="line"><a name="l00314"></a><span class="lineno">  314</span>&#160;    <span class="comment">!</span></div>
<div class="line"><a name="l00315"></a><span class="lineno">  315</span>&#160;    <span class="comment">! 1.  Sets reflection term to zero</span></div>
<div class="line"><a name="l00316"></a><span class="lineno">  316</span>&#160;    <span class="comment">!</span></div>
<div class="line"><a name="l00317"></a><span class="lineno">  317</span>&#160;    icalc=1</div>
<div class="line"><a name="l00318"></a><span class="lineno">  318</span>&#160;<span class="preprocessor">#ifdef W3_IG1</span></div>
<div class="line"><a name="l00319"></a><span class="lineno">  319</span>&#160;<span class="preprocessor"></span>    stmp1 = 0.</div>
<div class="line"><a name="l00320"></a><span class="lineno">  320</span>&#160;    stmp2 = 0.</div>
<div class="line"><a name="l00321"></a><span class="lineno">  321</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00322"></a><span class="lineno">  322</span>&#160;<span class="preprocessor"></span>    hs=4.*sqrt(emeana)</div>
<div class="line"><a name="l00323"></a><span class="lineno">  323</span>&#160;<span class="preprocessor">#ifdef W3_IG1</span></div>
<div class="line"><a name="l00324"></a><span class="lineno">  324</span>&#160;<span class="preprocessor"></span>    atmp(:)=a(:)      <span class="comment">! the IG energy will be added to this ATMP</span></div>
<div class="line"><a name="l00325"></a><span class="lineno">  325</span>&#160;    atmp2(:)=a(:)     <span class="comment">! this is really to keep in memory the original spectrum</span></div>
<div class="line"><a name="l00326"></a><span class="lineno">  326</span>&#160;    <span class="keywordflow">IF</span> (igbcoverwrite.AND.reflc(1).GT.0) <span class="keywordflow">THEN</span></div>
<div class="line"><a name="l00327"></a><span class="lineno">  327</span>&#160;      igfac1 = 1.</div>
<div class="line"><a name="l00328"></a><span class="lineno">  328</span>&#160;      atmp2(1:nspecigstart) = 0.</div>
<div class="line"><a name="l00329"></a><span class="lineno">  329</span>&#160;<span class="keywordflow">    END IF</span></div>
<div class="line"><a name="l00330"></a><span class="lineno">  330</span>&#160;    <span class="comment">!</span></div>
<div class="line"><a name="l00331"></a><span class="lineno">  331</span>&#160;    <span class="comment">! resets IG band energy to zero</span></div>
<div class="line"><a name="l00332"></a><span class="lineno">  332</span>&#160;    <span class="comment">!</span></div>
<div class="line"><a name="l00333"></a><span class="lineno">  333</span>&#160;    <span class="keywordflow">DO</span> icalc=1,2</div>
<div class="line"><a name="l00334"></a><span class="lineno">  334</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00335"></a><span class="lineno">  335</span>&#160;<span class="preprocessor"></span>      s = 0.</div>
<div class="line"><a name="l00336"></a><span class="lineno">  336</span>&#160;<span class="preprocessor">#ifdef W3_IG1</span></div>
<div class="line"><a name="l00337"></a><span class="lineno">  337</span>&#160;<span class="preprocessor"></span>      <span class="keywordflow">IF</span> (igbcoverwrite) a(1:nspecigstart)=0.</div>
<div class="line"><a name="l00338"></a><span class="lineno">  338</span>&#160;      <span class="keywordflow">IF</span> (icalc.EQ.1) a=atmp2</div>
<div class="line"><a name="l00339"></a><span class="lineno">  339</span>&#160;      <span class="keywordflow">IF</span> (icalc.EQ.2) <span class="keywordflow">THEN</span></div>
<div class="line"><a name="l00340"></a><span class="lineno">  340</span>&#160;        <span class="comment">!</span></div>
<div class="line"><a name="l00341"></a><span class="lineno">  341</span>&#160;        <span class="comment">! 1.1 Replaces IG part by forced IG</span></div>
<div class="line"><a name="l00342"></a><span class="lineno">  342</span>&#160;        <span class="comment">!</span></div>
<div class="line"><a name="l00343"></a><span class="lineno">  343</span>&#160;        <span class="comment">! determines highest IG frequency</span></div>
<div class="line"><a name="l00344"></a><span class="lineno">  344</span>&#160;        <span class="comment">!</span></div>
<div class="line"><a name="l00345"></a><span class="lineno">  345</span>&#160;        <span class="keywordflow">IF</span> (igswellmax) <span class="keywordflow">THEN</span></div>
<div class="line"><a name="l00346"></a><span class="lineno">  346</span>&#160;          nkig=nk</div>
<div class="line"><a name="l00347"></a><span class="lineno">  347</span>&#160;        <span class="keywordflow">ELSE</span></div>
<div class="line"><a name="l00348"></a><span class="lineno">  348</span>&#160;          nkig=nint(<a class="code" href="namespacew3gdatmd.html#a3439026c6e1260ce40ad1d4cbb405694">igpars</a>(5))</div>
<div class="line"><a name="l00349"></a><span class="lineno">  349</span>&#160;<span class="keywordflow">        ENDIF</span></div>
<div class="line"><a name="l00350"></a><span class="lineno">  350</span>&#160;        freqig=sig(nint(<a class="code" href="namespacew3gdatmd.html#a3439026c6e1260ce40ad1d4cbb405694">igpars</a>(5)))*<a class="code" href="namespaceconstants.html#ab81445207bb044b4a638d50ecf4470e5">tpiinv</a></div>
<div class="line"><a name="l00351"></a><span class="lineno">  351</span>&#160;        <span class="comment">!</span></div>
<div class="line"><a name="l00352"></a><span class="lineno">  352</span>&#160;        nspecig=nkig*nth</div>
<div class="line"><a name="l00353"></a><span class="lineno">  353</span>&#160;        atmp(1:nspecigstart)=0.               <span class="comment">! flat bottom approximation (Hasselmann 1962)</span></div>
<div class="line"><a name="l00354"></a><span class="lineno">  354</span>&#160;        <span class="comment">!                 is not valid for long waves</span></div>
<div class="line"><a name="l00355"></a><span class="lineno">  355</span>&#160;        <span class="keywordflow">IF</span> (nint(<a class="code" href="namespacew3gdatmd.html#a3439026c6e1260ce40ad1d4cbb405694">igpars</a>(3)).EQ.1) <span class="keywordflow">THEN</span>        <span class="comment">! IGPARS(3) = IGSOURCE</span></div>
<div class="line"><a name="l00356"></a><span class="lineno">  356</span>&#160;          <span class="keywordflow">IF</span> (nint(<a class="code" href="namespacew3gdatmd.html#a3439026c6e1260ce40ad1d4cbb405694">igpars</a>(8)).EQ.1) <span class="keywordflow">THEN</span>      <span class="comment">! in this case, uses depth at break point</span></div>
<div class="line"><a name="l00357"></a><span class="lineno">  357</span>&#160;            depthig=max(1.,hs/0.3)            <span class="comment">! to be modified later with a proper gamma</span></div>
<div class="line"><a name="l00358"></a><span class="lineno">  358</span>&#160;          <span class="keywordflow">ELSE</span></div>
<div class="line"><a name="l00359"></a><span class="lineno">  359</span>&#160;            depthig=depth</div>
<div class="line"><a name="l00360"></a><span class="lineno">  360</span>&#160;<span class="keywordflow">          END IF</span></div>
<div class="line"><a name="l00361"></a><span class="lineno">  361</span>&#160;          <span class="keywordflow">IF</span> (<a class="code" href="namespacew3gdatmd.html#a3439026c6e1260ce40ad1d4cbb405694">igpars</a>(10).GT.0.) depthig = <a class="code" href="namespacew3gdatmd.html#a3439026c6e1260ce40ad1d4cbb405694">igpars</a>(10) <span class="comment">! fixed depth for 2nd order calculation</span></div>
<div class="line"><a name="l00362"></a><span class="lineno">  362</span>&#160;          <span class="comment">!</span></div>
<div class="line"><a name="l00363"></a><span class="lineno">  363</span>&#160;          <span class="comment">!/ --- INLINED WAVNU1 (START) ---------------------------------------- /</span></div>
<div class="line"><a name="l00364"></a><span class="lineno">  364</span>&#160;          <span class="comment">!</span></div>
<div class="line"><a name="l00365"></a><span class="lineno">  365</span>&#160;          <span class="keywordflow">DO</span> ik=1, nk</div>
<div class="line"><a name="l00366"></a><span class="lineno">  366</span>&#160;            sqrth  = sqrt(depthig)</div>
<div class="line"><a name="l00367"></a><span class="lineno">  367</span>&#160;            six    = sig(ik) * sqrth</div>
<div class="line"><a name="l00368"></a><span class="lineno">  368</span>&#160;            i1     = int(six/<a class="code" href="namespacew3dispmd.html#a347c04da9af6016c1dbb0a6aaed6e9ba">dsie</a>)</div>
<div class="line"><a name="l00369"></a><span class="lineno">  369</span>&#160;            <span class="keywordflow">IF</span> (i1.LE.<a class="code" href="namespacew3dispmd.html#a50de12651fb8eeb08c4007b9e4ad7c1d">n1max</a>) <span class="keywordflow">THEN</span></div>
<div class="line"><a name="l00370"></a><span class="lineno">  370</span>&#160;              i2 = i1 + 1</div>
<div class="line"><a name="l00371"></a><span class="lineno">  371</span>&#160;              r1 = six/<a class="code" href="namespacew3dispmd.html#a347c04da9af6016c1dbb0a6aaed6e9ba">dsie</a> - real(i1)</div>
<div class="line"><a name="l00372"></a><span class="lineno">  372</span>&#160;              r2 = 1. - r1</div>
<div class="line"><a name="l00373"></a><span class="lineno">  373</span>&#160;              wnb(ik) = ( r2*<a class="code" href="namespacew3dispmd.html#ad7a1721bb6048f62402f14cb3e69e219">ewn1</a>(i1) + r1*<a class="code" href="namespacew3dispmd.html#ad7a1721bb6048f62402f14cb3e69e219">ewn1</a>(i2) ) / depth</div>
<div class="line"><a name="l00374"></a><span class="lineno">  374</span>&#160;              cgb(ik) = ( r2*<a class="code" href="namespacew3dispmd.html#a2d8d5f061b663f6e27c5f474e661a592">ecg1</a>(i1) + r1*<a class="code" href="namespacew3dispmd.html#a2d8d5f061b663f6e27c5f474e661a592">ecg1</a>(i2) ) * sqrth</div>
<div class="line"><a name="l00375"></a><span class="lineno">  375</span>&#160;            <span class="keywordflow">ELSE</span></div>
<div class="line"><a name="l00376"></a><span class="lineno">  376</span>&#160;              wnb(ik) = sig(ik)*sig(ik)/<a class="code" href="namespaceconstants.html#a27ed315e4f5c61762387c7fae2eb0c38">grav</a></div>
<div class="line"><a name="l00377"></a><span class="lineno">  377</span>&#160;              cgb(ik) = 0.5 * <a class="code" href="namespaceconstants.html#a27ed315e4f5c61762387c7fae2eb0c38">grav</a> / sig(ik)</div>
<div class="line"><a name="l00378"></a><span class="lineno">  378</span>&#160;<span class="keywordflow">            END IF</span></div>
<div class="line"><a name="l00379"></a><span class="lineno">  379</span>&#160;<span class="keywordflow">          END DO</span></div>
<div class="line"><a name="l00380"></a><span class="lineno">  380</span>&#160;          <span class="comment">!</span></div>
<div class="line"><a name="l00381"></a><span class="lineno">  381</span>&#160;          <span class="comment">!/ --- INLINED WAVNU1 (END) ------------------------------------------ /</span></div>
<div class="line"><a name="l00382"></a><span class="lineno">  382</span>&#160;          <span class="comment">!</span></div>
<div class="line"><a name="l00383"></a><span class="lineno">  383</span>&#160;          <span class="keywordflow">IF</span> (nint(<a class="code" href="namespacew3gdatmd.html#a3439026c6e1260ce40ad1d4cbb405694">igpars</a>(1)).EQ.1) <span class="keywordflow">THEN</span>         <span class="comment">! IGPARS(1) = IGMETHOD</span></div>
<div class="line"><a name="l00384"></a><span class="lineno">  384</span>&#160;            <span class="keyword">CALL </span><a class="code" href="namespacew3gig1md.html#a2161ef813f9e8fdef57a2446e14ac5bb">w3addig</a>(atmp,depthig,wnb,cgb,1)</div>
<div class="line"><a name="l00385"></a><span class="lineno">  385</span>&#160;          <span class="keywordflow">ELSE</span></div>
<div class="line"><a name="l00386"></a><span class="lineno">  386</span>&#160;            <span class="keyword">CALL </span><a class="code" href="namespacew3canomd.html#a0024389a271c1adccd88c4ff24b76e0e">w3add2ndorder</a>(atmp,depthig,wnb,cgb,1)</div>
<div class="line"><a name="l00387"></a><span class="lineno">  387</span>&#160;<span class="keywordflow">          END IF</span></div>
<div class="line"><a name="l00388"></a><span class="lineno">  388</span>&#160;          <span class="comment">! Transforms energy back to proper depth</span></div>
<div class="line"><a name="l00389"></a><span class="lineno">  389</span>&#160;          <span class="keywordflow">DO</span> ik=1,nkig</div>
<div class="line"><a name="l00390"></a><span class="lineno">  390</span>&#160;            atmp(1+(ik-1)*nth:ik*nth)=atmp(1+(ik-1)*nth:ik*nth)*(cgb(ik)*wn(ik))/(cg(ik)*wnb(ik))</div>
<div class="line"><a name="l00391"></a><span class="lineno">  391</span>&#160;<span class="keywordflow">          END DO</span></div>
<div class="line"><a name="l00392"></a><span class="lineno">  392</span>&#160;          a(1:nspecig)=atmp(1:nspecig)</div>
<div class="line"><a name="l00393"></a><span class="lineno">  393</span>&#160;          <span class="keywordflow">IF</span> (igswellmax) <span class="keywordflow">THEN</span></div>
<div class="line"><a name="l00394"></a><span class="lineno">  394</span>&#160;            <span class="keywordflow">DO</span> ispec=1,nspecig</div>
<div class="line"><a name="l00395"></a><span class="lineno">  395</span>&#160;              a(ispec)=max(atmp(ispec)-a(ispec),0.)</div>
<div class="line"><a name="l00396"></a><span class="lineno">  396</span>&#160;<span class="keywordflow">            END DO</span></div>
<div class="line"><a name="l00397"></a><span class="lineno">  397</span>&#160;          <span class="keywordflow">ELSE</span></div>
<div class="line"><a name="l00398"></a><span class="lineno">  398</span>&#160;            a(1:nspecig)=atmp(1:nspecig)</div>
<div class="line"><a name="l00399"></a><span class="lineno">  399</span>&#160;<span class="keywordflow">          ENDIF</span></div>
<div class="line"><a name="l00400"></a><span class="lineno">  400</span>&#160;          <span class="comment">!</span></div>
<div class="line"><a name="l00401"></a><span class="lineno">  401</span>&#160;        <span class="keywordflow">ELSEIF</span> (nint(<a class="code" href="namespacew3gdatmd.html#a3439026c6e1260ce40ad1d4cbb405694">igpars</a>(3)).EQ.2) <span class="keywordflow">THEN</span>   <span class="comment">! Empirical source of IG energy</span></div>
<div class="line"><a name="l00402"></a><span class="lineno">  402</span>&#160;          <span class="comment">!</span></div>
<div class="line"><a name="l00403"></a><span class="lineno">  403</span>&#160;          <span class="comment">! This empirical source was adjusted to Waimea and Duck data</span></div>
<div class="line"><a name="l00404"></a><span class="lineno">  404</span>&#160;          <span class="comment">! When applied to deep water the 1/Depth must be replaced with k/Cg</span></div>
<div class="line"><a name="l00405"></a><span class="lineno">  405</span>&#160;          <span class="comment">! Hence the proper coefficient is WN(IK)/CG(IK)*GRAV**2/SIG(IK)</span></div>
<div class="line"><a name="l00406"></a><span class="lineno">  406</span>&#160;          <span class="comment">!</span></div>
<div class="line"><a name="l00407"></a><span class="lineno">  407</span>&#160;          <span class="comment">! The empirical form is HIG = IGEMPIRICAL * ...</span></div>
<div class="line"><a name="l00408"></a><span class="lineno">  408</span>&#160;          <span class="comment">! this is not quite yet a wave height: multiplied below by MIN(0.0036, ...</span></div>
<div class="line"><a name="l00409"></a><span class="lineno">  409</span>&#160;          <span class="comment">!</span></div>
<div class="line"><a name="l00410"></a><span class="lineno">  410</span>&#160;          hig= hs/(max(fmean2,freqig)**2)</div>
<div class="line"><a name="l00411"></a><span class="lineno">  411</span>&#160;          efig=(hig*0.25)**2/0.0279  <span class="comment">! this is (HsIG/4)^2 / df</span></div>
<div class="line"><a name="l00412"></a><span class="lineno">  412</span>&#160;          hig2 = 0.</div>
<div class="line"><a name="l00413"></a><span class="lineno">  413</span>&#160;          <span class="keywordflow">DO</span> ik=1,nkig</div>
<div class="line"><a name="l00414"></a><span class="lineno">  414</span>&#160;            <span class="comment">!</span></div>
<div class="line"><a name="l00415"></a><span class="lineno">  415</span>&#160;            <span class="comment">! First approximation: constant IG spectrum  with frequency</span></div>
<div class="line"><a name="l00416"></a><span class="lineno">  416</span>&#160;            <span class="comment">!</span></div>
<div class="line"><a name="l00417"></a><span class="lineno">  417</span>&#160;            efig1=efig*min(0.0036,<a class="code" href="namespacew3gdatmd.html#a3439026c6e1260ce40ad1d4cbb405694">igpars</a>(11)*wn(ik)/cg(ik)*<a class="code" href="namespaceconstants.html#a27ed315e4f5c61762387c7fae2eb0c38">grav</a>**2/sig(ik))</div>
<div class="line"><a name="l00418"></a><span class="lineno">  418</span>&#160;            <span class="comment">!</span></div>
<div class="line"><a name="l00419"></a><span class="lineno">  419</span>&#160;            <span class="comment">! Correction: gives a frequency shape ...</span></div>
<div class="line"><a name="l00420"></a><span class="lineno">  420</span>&#160;            <span class="comment">!</span></div>
<div class="line"><a name="l00421"></a><span class="lineno">  421</span>&#160;            <span class="keywordflow">IF</span> (ik.LT.ik1) <span class="keywordflow">THEN</span></div>
<div class="line"><a name="l00422"></a><span class="lineno">  422</span>&#160;              <span class="comment">! The 1.5 exponent of Ardhuin et al. 2014 (see figure 8.a) was probably too high  ... now reduced to 1.0</span></div>
<div class="line"><a name="l00423"></a><span class="lineno">  423</span>&#160;              efig1=efig1*igfac1*1.2*min(1.,0.013/(sig(ik)*<a class="code" href="namespaceconstants.html#ab81445207bb044b4a638d50ecf4470e5">tpiinv</a>))**1.0</div>
<div class="line"><a name="l00424"></a><span class="lineno">  424</span>&#160;            <span class="keywordflow">ELSE</span></div>
<div class="line"><a name="l00425"></a><span class="lineno">  425</span>&#160;              efig1=efig1*igfac2*1.2*min(1.,0.013/(sig(ik)*<a class="code" href="namespaceconstants.html#ab81445207bb044b4a638d50ecf4470e5">tpiinv</a>))**1.0</div>
<div class="line"><a name="l00426"></a><span class="lineno">  426</span>&#160;<span class="keywordflow">            END IF</span></div>
<div class="line"><a name="l00427"></a><span class="lineno">  427</span>&#160;            <span class="comment">!</span></div>
<div class="line"><a name="l00428"></a><span class="lineno">  428</span>&#160;            <span class="comment">! Conversion to action spectral density A(k,theta), assuming isotropic dir.</span></div>
<div class="line"><a name="l00429"></a><span class="lineno">  429</span>&#160;            <span class="comment">!</span></div>
<div class="line"><a name="l00430"></a><span class="lineno">  430</span>&#160;            a(1+(ik-1)*nth:ik*nth)=efig1*cg(ik)/((sig(ik)*<a class="code" href="namespaceconstants.html#a5729459787df1ec9fac855545e0faaea">tpi</a>)*<a class="code" href="namespaceconstants.html#a5729459787df1ec9fac855545e0faaea">tpi</a>)</div>
<div class="line"><a name="l00431"></a><span class="lineno">  431</span>&#160;            hig2 = hig2 + efig1*dsii(ik)*<a class="code" href="namespaceconstants.html#ab81445207bb044b4a638d50ecf4470e5">tpiinv</a></div>
<div class="line"><a name="l00432"></a><span class="lineno">  432</span>&#160;<span class="keywordflow">          END DO</span></div>
<div class="line"><a name="l00433"></a><span class="lineno">  433</span>&#160;        <span class="keywordflow">ELSE</span></div>
<div class="line"><a name="l00434"></a><span class="lineno">  434</span>&#160;          nspecig=0</div>
<div class="line"><a name="l00435"></a><span class="lineno">  435</span>&#160;<span class="keywordflow">        END IF</span></div>
<div class="line"><a name="l00436"></a><span class="lineno">  436</span>&#160;        <span class="comment">!</span></div>
<div class="line"><a name="l00437"></a><span class="lineno">  437</span>&#160;<span class="keywordflow">      END IF</span> <span class="comment">! ICALC EQ 2</span></div>
<div class="line"><a name="l00438"></a><span class="lineno">  438</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00439"></a><span class="lineno">  439</span>&#160;<span class="preprocessor"></span>      <span class="comment">!</span></div>
<div class="line"><a name="l00440"></a><span class="lineno">  440</span>&#160;      nrs=nint(refpars(8))</div>
<div class="line"><a name="l00441"></a><span class="lineno">  441</span>&#160;      <span class="keywordflow">IF</span> (refpars(6).GT.0) <span class="keywordflow">THEN</span></div>
<div class="line"><a name="l00442"></a><span class="lineno">  442</span>&#160;        <span class="comment">!</span></div>
<div class="line"><a name="l00443"></a><span class="lineno">  443</span>&#160;        <span class="comment">! This is the Miche parameter for a beach slope of REFLC(3)</span></div>
<div class="line"><a name="l00444"></a><span class="lineno">  444</span>&#160;        <span class="comment">!</span></div>
<div class="line"><a name="l00445"></a><span class="lineno">  445</span>&#160;        <span class="keywordflow">IF</span>(reflc(3)/=reflc(3)) <span class="keywordflow">THEN</span> <span class="comment">! isnan test</span></div>
<div class="line"><a name="l00446"></a><span class="lineno">  446</span>&#160;          slope=0.001</div>
<div class="line"><a name="l00447"></a><span class="lineno">  447</span>&#160;        <span class="keywordflow">ELSE</span></div>
<div class="line"><a name="l00448"></a><span class="lineno">  448</span>&#160;          slope=max(0.001,reflc(3))</div>
<div class="line"><a name="l00449"></a><span class="lineno">  449</span>&#160;<span class="keywordflow">        END IF</span></div>
<div class="line"><a name="l00450"></a><span class="lineno">  450</span>&#160;        michefac=0.0001*<a class="code" href="namespaceconstants.html#a27ed315e4f5c61762387c7fae2eb0c38">grav</a>**2*(slope**5)  &amp;</div>
<div class="line"><a name="l00451"></a><span class="lineno">  451</span>&#160;             /(max(emeana,1e-4)*max(fmeana,0.001)**4)</div>
<div class="line"><a name="l00452"></a><span class="lineno">  452</span>&#160;        ramp0=max(0.07*(alog10(michefac)+4.5)+1.5*michefac,0.005)   <span class="comment">! IF REFLC(1)=1, 0.07 should be 0.007</span></div>
<div class="line"><a name="l00453"></a><span class="lineno">  453</span>&#160;        <span class="comment">! NB: these constants are adjusted for REFLC(1) = 0.1. If  REFLC(1)=1, 0.07 should be 0.007</span></div>
<div class="line"><a name="l00454"></a><span class="lineno">  454</span>&#160;      <span class="keywordflow">ELSE</span></div>
<div class="line"><a name="l00455"></a><span class="lineno">  455</span>&#160;        ramp0=1.</div>
<div class="line"><a name="l00456"></a><span class="lineno">  456</span>&#160;<span class="keywordflow">      ENDIF</span></div>
<div class="line"><a name="l00457"></a><span class="lineno">  457</span>&#160; </div>
<div class="line"><a name="l00458"></a><span class="lineno">  458</span>&#160;      <span class="comment">!</span></div>
<div class="line"><a name="l00459"></a><span class="lineno">  459</span>&#160;      <span class="comment">! 2.  Shoreline reflection =============================================== *</span></div>
<div class="line"><a name="l00460"></a><span class="lineno">  460</span>&#160;      <span class="comment">!</span></div>
<div class="line"><a name="l00461"></a><span class="lineno">  461</span>&#160;      <span class="keywordflow">IF</span> (reflc(1).GT.0) <span class="keywordflow">THEN</span></div>
<div class="line"><a name="l00462"></a><span class="lineno">  462</span>&#160;        fac1=1/(0.5*real(nth))</div>
<div class="line"><a name="l00463"></a><span class="lineno">  463</span>&#160;        fac2=1.57/(0.5*real(nth))</div>
<div class="line"><a name="l00464"></a><span class="lineno">  464</span>&#160;        <span class="comment">!           FAC3=2.6/(0.5*REAL(NTH))  ! this is for NRS=4</span></div>
<div class="line"><a name="l00465"></a><span class="lineno">  465</span>&#160;        fac3=2./sum(abs(ecos(1:nth))**nrs)</div>
<div class="line"><a name="l00466"></a><span class="lineno">  466</span>&#160;        fac4=1.</div>
<div class="line"><a name="l00467"></a><span class="lineno">  467</span>&#160;        <span class="comment">!</span></div>
<div class="line"><a name="l00468"></a><span class="lineno">  468</span>&#160;        <span class="keywordflow">DO</span> ik=1, nk</div>
<div class="line"><a name="l00469"></a><span class="lineno">  469</span>&#160;          <span class="comment">!</span></div>
<div class="line"><a name="l00470"></a><span class="lineno">  470</span>&#160;          <span class="comment">! Includes frequency dependence (see Elgar et al. JPO 1994)</span></div>
<div class="line"><a name="l00471"></a><span class="lineno">  471</span>&#160;          <span class="comment">!</span></div>
<div class="line"><a name="l00472"></a><span class="lineno">  472</span>&#160;          <span class="keywordflow">IF</span> (refpars(6).GT.0) <span class="keywordflow">THEN</span></div>
<div class="line"><a name="l00473"></a><span class="lineno">  473</span>&#160;            ramp=(max((0.75*<a class="code" href="namespaceconstants.html#a5729459787df1ec9fac855545e0faaea">tpi</a>*fmeana/sig(ik)),1.)**refpars(10))*ramp0</div>
<div class="line"><a name="l00474"></a><span class="lineno">  474</span>&#160;            ramp1=min(refpars(9),reflc(1)*ramp)</div>
<div class="line"><a name="l00475"></a><span class="lineno">  475</span>&#160;            ramp2=min(refpars(9),reflc(2)*ramp)</div>
<div class="line"><a name="l00476"></a><span class="lineno">  476</span>&#160;          <span class="keywordflow">ELSE</span></div>
<div class="line"><a name="l00477"></a><span class="lineno">  477</span>&#160;            ramp1=ramp0*reflc(1)</div>
<div class="line"><a name="l00478"></a><span class="lineno">  478</span>&#160;            ramp2=ramp0*reflc(2)</div>
<div class="line"><a name="l00479"></a><span class="lineno">  479</span>&#160;<span class="keywordflow">          END IF</span></div>
<div class="line"><a name="l00480"></a><span class="lineno">  480</span>&#160;          <span class="comment">!</span></div>
<div class="line"><a name="l00481"></a><span class="lineno">  481</span>&#160;          <span class="comment">! Special treatment for unstructured grids when not using source term</span></div>
<div class="line"><a name="l00482"></a><span class="lineno">  482</span>&#160;          <span class="comment">!</span></div>
<div class="line"><a name="l00483"></a><span class="lineno">  483</span>&#160;          <span class="keywordflow">IF</span> (gtype.EQ.ungtype.AND.refpars(3).LT.0.5) <span class="keywordflow">THEN</span></div>
<div class="line"><a name="l00484"></a><span class="lineno">  484</span>&#160;            <span class="keywordflow">IF</span> (<a class="code" href="namespaceconstants.html#ad8b244917fc2f2b94d397086522af7a1">lpdlib</a>) <span class="keywordflow">THEN</span></div>
<div class="line"><a name="l00485"></a><span class="lineno">  485</span>&#160;<span class="preprocessor">#ifdef W3_PDLIB</span></div>
<div class="line"><a name="l00486"></a><span class="lineno">  486</span>&#160;<span class="preprocessor"></span>              iobpdip = iobpd_loc(:,jsea)</div>
<div class="line"><a name="l00487"></a><span class="lineno">  487</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00488"></a><span class="lineno">  488</span>&#160;<span class="preprocessor"></span>            <span class="keywordflow">ELSE</span></div>
<div class="line"><a name="l00489"></a><span class="lineno">  489</span>&#160;              iobpdip = iobpd(:,ix)</div>
<div class="line"><a name="l00490"></a><span class="lineno">  490</span>&#160;<span class="keywordflow">            ENDIF</span></div>
<div class="line"><a name="l00491"></a><span class="lineno">  491</span>&#160;            <span class="keywordflow">DO</span> ith=1, nth</div>
<div class="line"><a name="l00492"></a><span class="lineno">  492</span>&#160;              ispeci=ith+(ik-1)*nth</div>
<div class="line"><a name="l00493"></a><span class="lineno">  493</span>&#160;              a(ispeci)=a(ispeci)*iobpdip(ith) <span class="comment">!puts to zero the energy not going to coast</span></div>
<div class="line"><a name="l00494"></a><span class="lineno">  494</span>&#160;<span class="keywordflow">            END DO</span></div>
<div class="line"><a name="l00495"></a><span class="lineno">  495</span>&#160;            <span class="comment">!</span></div>
<div class="line"><a name="l00496"></a><span class="lineno">  496</span>&#160;            <span class="keywordflow">DO</span> ith=1, nth</div>
<div class="line"><a name="l00497"></a><span class="lineno">  497</span>&#160;              r1=ecos(1+mod(abs(ith-refld(1)),nth))</div>
<div class="line"><a name="l00498"></a><span class="lineno">  498</span>&#160;              r1=iobpdip(ith)</div>
<div class="line"><a name="l00499"></a><span class="lineno">  499</span>&#160;              ispeci=ith+(ik-1)*nth</div>
<div class="line"><a name="l00500"></a><span class="lineno">  500</span>&#160;              r2=ramp1*a(ispeci)</div>
<div class="line"><a name="l00501"></a><span class="lineno">  501</span>&#160;              <span class="keywordflow">IF</span> (r1.GT.0.AND.r2.GT.0) <span class="keywordflow">THEN</span></div>
<div class="line"><a name="l00502"></a><span class="lineno">  502</span>&#160;                <span class="comment">!</span></div>
<div class="line"><a name="l00503"></a><span class="lineno">  503</span>&#160;                <span class="comment">! Determines direction of specular reflection: th3=pi+2*n-th1</span></div>
<div class="line"><a name="l00504"></a><span class="lineno">  504</span>&#160;                <span class="comment">!</span></div>
<div class="line"><a name="l00505"></a><span class="lineno">  505</span>&#160;                ith3=1+mod(nth/2+nth+2*refld(1)-ith-1,nth)</div>
<div class="line"><a name="l00506"></a><span class="lineno">  506</span>&#160;                <span class="keywordflow">DO</span> ith2=1,nth</div>
<div class="line"><a name="l00507"></a><span class="lineno">  507</span>&#160;                  <span class="comment">!</span></div>
<div class="line"><a name="l00508"></a><span class="lineno">  508</span>&#160;                  <span class="comment">!  Adds energy into reflected directions (ITH2)</span></div>
<div class="line"><a name="l00509"></a><span class="lineno">  509</span>&#160;                  <span class="comment">!</span></div>
<div class="line"><a name="l00510"></a><span class="lineno">  510</span>&#160;                  ispec=ith2+(ik-1)*nth</div>
<div class="line"><a name="l00511"></a><span class="lineno">  511</span>&#160;                  r3=ecos(1+mod(abs(ith2-refld(1)),nth))</div>
<div class="line"><a name="l00512"></a><span class="lineno">  512</span>&#160;                  <span class="keywordflow">IF</span> (r3.LT.0) <span class="keywordflow">THEN</span></div>
<div class="line"><a name="l00513"></a><span class="lineno">  513</span>&#160;                    r4=ecos(1+mod(abs(ith2-ith3),nth))*(1-iobpdip(ith2))</div>
<div class="line"><a name="l00514"></a><span class="lineno">  514</span>&#160;                    <span class="keywordflow">IF</span> (r4.GT.0.) <span class="keywordflow">THEN</span></div>
<div class="line"><a name="l00515"></a><span class="lineno">  515</span>&#160;                      <span class="comment">!</span></div>
<div class="line"><a name="l00516"></a><span class="lineno">  516</span>&#160;                      <span class="comment">! Tests the type of shoreline geometry</span></div>
<div class="line"><a name="l00517"></a><span class="lineno">  517</span>&#160;                      <span class="comment">!</span></div>
<div class="line"><a name="l00518"></a><span class="lineno">  518</span>&#160;                      <span class="keywordflow">SELECT CASE</span> (refld(2))</div>
<div class="line"><a name="l00519"></a><span class="lineno">  519</span>&#160;                      <span class="keywordflow">CASE</span> (0)</div>
<div class="line"><a name="l00520"></a><span class="lineno">  520</span>&#160;                        <span class="comment">! Sharp corner: broad reflection</span></div>
<div class="line"><a name="l00521"></a><span class="lineno">  521</span>&#160;                        s(ispec)=s(ispec)+r2*fac1/dt</div>
<div class="line"><a name="l00522"></a><span class="lineno">  522</span>&#160; </div>
<div class="line"><a name="l00523"></a><span class="lineno">  523</span>&#160;                        <span class="comment">! FA: analog to following lines to be swapped in if reflection method changed</span></div>
<div class="line"><a name="l00524"></a><span class="lineno">  524</span>&#160;                        <span class="comment">! RECT CASE:</span></div>
<div class="line"><a name="l00525"></a><span class="lineno">  525</span>&#160;                        <span class="comment">!  S(ISPEC)=S(ISPEC)+    &amp;</span></div>
<div class="line"><a name="l00526"></a><span class="lineno">  526</span>&#160;                        <span class="comment">!    REAL(REFLD(3))*R2*CG(IK)*ABS(ECOS(ITH2X)/DELX)*FAC1   &amp;</span></div>
<div class="line"><a name="l00527"></a><span class="lineno">  527</span>&#160;                        <span class="comment">!   +REAL(REFLD(4))*R2*CG(IK)*ABS(ESIN(ITH2Y)/DELY)*FAC1</span></div>
<div class="line"><a name="l00528"></a><span class="lineno">  528</span>&#160; </div>
<div class="line"><a name="l00529"></a><span class="lineno">  529</span>&#160; </div>
<div class="line"><a name="l00530"></a><span class="lineno">  530</span>&#160;                      <span class="keywordflow">CASE</span> (1)</div>
<div class="line"><a name="l00531"></a><span class="lineno">  531</span>&#160;                        <span class="comment">! mild corner: average reflection</span></div>
<div class="line"><a name="l00532"></a><span class="lineno">  532</span>&#160;                        s(ispec)=s(ispec)+r2*abs(r4)*fac2/dt</div>
<div class="line"><a name="l00533"></a><span class="lineno">  533</span>&#160;                      <span class="keywordflow">CASE</span> (2)</div>
<div class="line"><a name="l00534"></a><span class="lineno">  534</span>&#160;                        <span class="comment">! straight coast: narrow reflection</span></div>
<div class="line"><a name="l00535"></a><span class="lineno">  535</span>&#160;                        <span class="comment">!     IF(ITH3.EQ.ITH2) S(ISPEC)=S(ISPEC)+R2/DT  ! THIS IS FOR SPECULAR REF.</span></div>
<div class="line"><a name="l00536"></a><span class="lineno">  536</span>&#160;                        s(ispec)=s(ispec)+r2*(r4**nrs) *fac3/dt</div>
<div class="line"><a name="l00537"></a><span class="lineno">  537</span>&#160;<span class="keywordflow">                      END SELECT</span></div>
<div class="line"><a name="l00538"></a><span class="lineno">  538</span>&#160;<span class="keywordflow">                    END IF</span>  <span class="comment">! (R4.GT.0.)</span></div>
<div class="line"><a name="l00539"></a><span class="lineno">  539</span>&#160;<span class="keywordflow">                  END IF</span>  <span class="comment">! (R3.LT.0)</span></div>
<div class="line"><a name="l00540"></a><span class="lineno">  540</span>&#160;<span class="keywordflow">                END DO</span> <span class="comment">! ITH2=1,NTH</span></div>
<div class="line"><a name="l00541"></a><span class="lineno">  541</span>&#160;<span class="keywordflow">              END IF</span>  <span class="comment">! (R1.GT.0.AND.R2.GT.0)</span></div>
<div class="line"><a name="l00542"></a><span class="lineno">  542</span>&#160;<span class="keywordflow">            END DO</span>  <span class="comment">! ITH=1, NTH</span></div>
<div class="line"><a name="l00543"></a><span class="lineno">  543</span>&#160;          <span class="keywordflow">ELSE</span> <span class="comment">! (GTYPE.NE.UNGTYPE)</span></div>
<div class="line"><a name="l00544"></a><span class="lineno">  544</span>&#160;            <span class="comment">!</span></div>
<div class="line"><a name="l00545"></a><span class="lineno">  545</span>&#160;            <span class="comment">! This is for structured grids ....</span></div>
<div class="line"><a name="l00546"></a><span class="lineno">  546</span>&#160;            <span class="comment">!</span></div>
<div class="line"><a name="l00547"></a><span class="lineno">  547</span>&#160;            <span class="comment">!</span></div>
<div class="line"><a name="l00548"></a><span class="lineno">  548</span>&#160;            <span class="comment">!  Loop on  incident wave direction (ITH)</span></div>
<div class="line"><a name="l00549"></a><span class="lineno">  549</span>&#160;            <span class="comment">!</span></div>
<div class="line"><a name="l00550"></a><span class="lineno">  550</span>&#160;            <span class="keywordflow">DO</span> ith=1, nth</div>
<div class="line"><a name="l00551"></a><span class="lineno">  551</span>&#160;              r1=ecos(1+mod(abs(ith-refld(1)),nth))</div>
<div class="line"><a name="l00552"></a><span class="lineno">  552</span>&#160;              r2=ramp1*a(ith+(ik-1)*nth)</div>
<div class="line"><a name="l00553"></a><span class="lineno">  553</span>&#160;              <span class="keywordflow">IF</span> (r1.GT.0.AND.r2.GT.0) <span class="keywordflow">THEN</span></div>
<div class="line"><a name="l00554"></a><span class="lineno">  554</span>&#160;                <span class="keywordflow">DO</span> ith2=1,nth</div>
<div class="line"><a name="l00555"></a><span class="lineno">  555</span>&#160;                  <span class="comment">!</span></div>
<div class="line"><a name="l00556"></a><span class="lineno">  556</span>&#160;                  <span class="comment">!  Adds energy into reflected directions (ITH2)</span></div>
<div class="line"><a name="l00557"></a><span class="lineno">  557</span>&#160;                  <span class="comment">!</span></div>
<div class="line"><a name="l00558"></a><span class="lineno">  558</span>&#160;                  ispec=ith2+(ik-1)*nth</div>
<div class="line"><a name="l00559"></a><span class="lineno">  559</span>&#160;                  ith2x=1+mod(nth+ith2-refld(5)-1,nth)</div>
<div class="line"><a name="l00560"></a><span class="lineno">  560</span>&#160;                  ith2y=1+mod(nth+ith2-refld(6)-1,nth)</div>
<div class="line"><a name="l00561"></a><span class="lineno">  561</span>&#160;                  r3=ecos(1+mod(abs(ith2-refld(1)),nth))</div>
<div class="line"><a name="l00562"></a><span class="lineno">  562</span>&#160;                  <span class="keywordflow">IF</span> (r3.LT.0) <span class="keywordflow">THEN</span></div>
<div class="line"><a name="l00563"></a><span class="lineno">  563</span>&#160;                    <span class="comment">!</span></div>
<div class="line"><a name="l00564"></a><span class="lineno">  564</span>&#160;                    <span class="comment">! Determines direction of specular reflection: th3=pi+2*n-th1</span></div>
<div class="line"><a name="l00565"></a><span class="lineno">  565</span>&#160;                    <span class="comment">!</span></div>
<div class="line"><a name="l00566"></a><span class="lineno">  566</span>&#160;                    ith3=1+mod(nth/2+nth+2*refld(1)-ith-1,nth)</div>
<div class="line"><a name="l00567"></a><span class="lineno">  567</span>&#160;                    r4=ecos(1+mod(abs(ith2-ith3),nth))</div>
<div class="line"><a name="l00568"></a><span class="lineno">  568</span>&#160;                    <span class="keywordflow">IF</span> (r4.GT.0.) <span class="keywordflow">THEN</span></div>
<div class="line"><a name="l00569"></a><span class="lineno">  569</span>&#160;                      <span class="comment">!</span></div>
<div class="line"><a name="l00570"></a><span class="lineno">  570</span>&#160;                      <span class="comment">! Tests the type of shoreline geometry</span></div>
<div class="line"><a name="l00571"></a><span class="lineno">  571</span>&#160;                      <span class="comment">! NB: REFLD(3) or REFLD(4) is equal to 1 if the reflection is applied (real land neighbor)</span></div>
<div class="line"><a name="l00572"></a><span class="lineno">  572</span>&#160;                      <span class="keywordflow">SELECT CASE</span> (refld(2))</div>
<div class="line"><a name="l00573"></a><span class="lineno">  573</span>&#160;                      <span class="keywordflow">CASE</span> (0)</div>
<div class="line"><a name="l00574"></a><span class="lineno">  574</span>&#160;                        <span class="comment">! Sharp corner: broad reflection</span></div>
<div class="line"><a name="l00575"></a><span class="lineno">  575</span>&#160;                        s(ispec)=s(ispec)+    &amp;</div>
<div class="line"><a name="l00576"></a><span class="lineno">  576</span>&#160;<span class="keywordtype">                             REAL</span>(REFLD(3))*R2*CG(IK)*ABS(ECOS(ITH2X)/DELX)*FAC1   &amp;</div>
<div class="line"><a name="l00577"></a><span class="lineno">  577</span>&#160;                             +<span class="keywordtype">REAL</span>(REFLD(4))*R2*CG(IK)*ABS(ESIN(ITH2Y)/DELY)*FAC1</div>
<div class="line"><a name="l00578"></a><span class="lineno">  578</span>&#160;                      <span class="keywordflow">CASE</span> (1)</div>
<div class="line"><a name="l00579"></a><span class="lineno">  579</span>&#160;                        <span class="comment">! mild corner: average reflection</span></div>
<div class="line"><a name="l00580"></a><span class="lineno">  580</span>&#160;                        <span class="comment">!</span></div>
<div class="line"><a name="l00581"></a><span class="lineno">  581</span>&#160;                        s(ispec)=s(ispec)+    &amp;</div>
<div class="line"><a name="l00582"></a><span class="lineno">  582</span>&#160;<span class="keywordtype">                             REAL</span>(REFLD(3))*R2*CG(IK)*ABS(ECOS(ITH2X)/DELX)*ABS(R4)*FAC2 &amp;</div>
<div class="line"><a name="l00583"></a><span class="lineno">  583</span>&#160;                             + <span class="keywordtype">REAL</span>(REFLD(4))*R2*CG(IK)*ABS(ESIN(ITH2Y)/DELY)*ABS(R4)*FAC2</div>
<div class="line"><a name="l00584"></a><span class="lineno">  584</span>&#160;                      <span class="keywordflow">CASE</span> (2)</div>
<div class="line"><a name="l00585"></a><span class="lineno">  585</span>&#160;                        <span class="comment">! straight coast: narrow reflection</span></div>
<div class="line"><a name="l00586"></a><span class="lineno">  586</span>&#160;                        <span class="comment">! Specular for tests</span></div>
<div class="line"><a name="l00587"></a><span class="lineno">  587</span>&#160;                        <span class="comment">!                   S(ISPEC)=S(ISPEC)+REAL(REFLD(3))*R2*CG(IK)*ABS(ECOS(ITH2)/DELX)  &amp;</span></div>
<div class="line"><a name="l00588"></a><span class="lineno">  588</span>&#160;                        <span class="comment">!                                    +REAL(REFLD(4))*R2*CG(IK)*ABS(ESIN(ITH2)/DELY)</span></div>
<div class="line"><a name="l00589"></a><span class="lineno">  589</span>&#160;                        <span class="comment">!</span></div>
<div class="line"><a name="l00590"></a><span class="lineno">  590</span>&#160;                        s(ispec)=s(ispec)+real(refld(3))*r2*cg(ik)*abs(ecos(ith2x)/delx) &amp;</div>
<div class="line"><a name="l00591"></a><span class="lineno">  591</span>&#160;                             *(r4**nrs) *fac3                          &amp;</div>
<div class="line"><a name="l00592"></a><span class="lineno">  592</span>&#160;                             +real(refld(4))*r2*cg(ik)*abs(esin(ith2y)/dely) &amp;</div>
<div class="line"><a name="l00593"></a><span class="lineno">  593</span>&#160;                             *(r4**nrs) *fac3</div>
<div class="line"><a name="l00594"></a><span class="lineno">  594</span>&#160;<span class="keywordflow">                      END SELECT</span></div>
<div class="line"><a name="l00595"></a><span class="lineno">  595</span>&#160;<span class="keywordflow">                    END IF</span> <span class="comment">! (R4.GT.0.)</span></div>
<div class="line"><a name="l00596"></a><span class="lineno">  596</span>&#160;<span class="keywordflow">                  END IF</span>  <span class="comment">! (R3.LT.0)</span></div>
<div class="line"><a name="l00597"></a><span class="lineno">  597</span>&#160;<span class="keywordflow">                END DO</span>  <span class="comment">! ITH2=1,NTH</span></div>
<div class="line"><a name="l00598"></a><span class="lineno">  598</span>&#160;<span class="keywordflow">              END IF</span>  <span class="comment">! (R1.GT.0.AND.R2.GT.0)</span></div>
<div class="line"><a name="l00599"></a><span class="lineno">  599</span>&#160;<span class="keywordflow">            END DO</span>  <span class="comment">! ITH=1,NTH</span></div>
<div class="line"><a name="l00600"></a><span class="lineno">  600</span>&#160;<span class="keywordflow">          END IF</span>  <span class="comment">! UNGTYPE</span></div>
<div class="line"><a name="l00601"></a><span class="lineno">  601</span>&#160; </div>
<div class="line"><a name="l00602"></a><span class="lineno">  602</span>&#160;<span class="keywordflow">        END DO</span> <span class="comment">! loop on IK</span></div>
<div class="line"><a name="l00603"></a><span class="lineno">  603</span>&#160;<span class="keywordflow">      END IF</span>   <span class="comment">! end of test on REFLC(1)</span></div>
<div class="line"><a name="l00604"></a><span class="lineno">  604</span>&#160;      <span class="comment">!</span></div>
<div class="line"><a name="l00605"></a><span class="lineno">  605</span>&#160;      <span class="comment">!  Add diffuse reflection due to subgrid islands and icebergs</span></div>
<div class="line"><a name="l00606"></a><span class="lineno">  606</span>&#160;      <span class="comment">!  At present this feature is not supported for unstructured grids.</span></div>
<div class="line"><a name="l00607"></a><span class="lineno">  607</span>&#160;      <span class="comment">!</span></div>
<div class="line"><a name="l00608"></a><span class="lineno">  608</span>&#160;      <span class="keywordflow">IF</span> (    ((refpars(2).GT.0.).AND.((trnx+trny).LT.2))     &amp;</div>
<div class="line"><a name="l00609"></a><span class="lineno">  609</span>&#160;           .OR.((refpars(4).GT.0.).AND.(berg.GT.0)       )   ) <span class="keywordflow">THEN</span></div>
<div class="line"><a name="l00610"></a><span class="lineno">  610</span>&#160;        <span class="comment">!</span></div>
<div class="line"><a name="l00611"></a><span class="lineno">  611</span>&#160;        <span class="comment">! Includes frequency dependence (see Elgar et al. JPO 1994)</span></div>
<div class="line"><a name="l00612"></a><span class="lineno">  612</span>&#160;        <span class="comment">!</span></div>
<div class="line"><a name="l00613"></a><span class="lineno">  613</span>&#160;        <span class="keywordflow">IF</span> (refpars(6).GT.0) <span class="keywordflow">THEN</span></div>
<div class="line"><a name="l00614"></a><span class="lineno">  614</span>&#160;          ramp=(max((0.75*<a class="code" href="namespaceconstants.html#a5729459787df1ec9fac855545e0faaea">tpi</a>*fmeana/sig(ik)),1.)**refpars(10))*ramp0</div>
<div class="line"><a name="l00615"></a><span class="lineno">  615</span>&#160;          ramp2=min(refpars(9),reflc(2)*ramp)</div>
<div class="line"><a name="l00616"></a><span class="lineno">  616</span>&#160;          <span class="comment">!</span></div>
<div class="line"><a name="l00617"></a><span class="lineno">  617</span>&#160;          <span class="comment">! recomputes coefficients for iceberg slope given by REFLC(4)</span></div>
<div class="line"><a name="l00618"></a><span class="lineno">  618</span>&#160;          <span class="comment">!</span></div>
<div class="line"><a name="l00619"></a><span class="lineno">  619</span>&#160;          slope=max(0.001,reflc(4))</div>
<div class="line"><a name="l00620"></a><span class="lineno">  620</span>&#160;          michefac=0.0001*<a class="code" href="namespaceconstants.html#a27ed315e4f5c61762387c7fae2eb0c38">grav</a>**2*(slope**5)  &amp;</div>
<div class="line"><a name="l00621"></a><span class="lineno">  621</span>&#160;               /(max(emeana,1e-4)*max(fmeana,0.001)**4)</div>
<div class="line"><a name="l00622"></a><span class="lineno">  622</span>&#160;          ramp0=max(0.007*(alog10(michefac)+4.5)+1.5*michefac,0.005)   <span class="comment">! IF REFLC(1)=1, 0.07 should be 0.007</span></div>
<div class="line"><a name="l00623"></a><span class="lineno">  623</span>&#160;          ramp=(max((0.75*<a class="code" href="namespaceconstants.html#a5729459787df1ec9fac855545e0faaea">tpi</a>*fmeana/sig(ik)),1.)**refpars(10))*ramp0</div>
<div class="line"><a name="l00624"></a><span class="lineno">  624</span>&#160;          ramp4=min(refpars(9),ramp)</div>
<div class="line"><a name="l00625"></a><span class="lineno">  625</span>&#160;        <span class="keywordflow">ELSE</span></div>
<div class="line"><a name="l00626"></a><span class="lineno">  626</span>&#160;          ramp2=ramp0*reflc(2)</div>
<div class="line"><a name="l00627"></a><span class="lineno">  627</span>&#160;          ramp4=ramp0*reflc(4)</div>
<div class="line"><a name="l00628"></a><span class="lineno">  628</span>&#160;<span class="keywordflow">        END IF</span></div>
<div class="line"><a name="l00629"></a><span class="lineno">  629</span>&#160;        <span class="comment">!</span></div>
<div class="line"><a name="l00630"></a><span class="lineno">  630</span>&#160;        <span class="comment">!</span></div>
<div class="line"><a name="l00631"></a><span class="lineno">  631</span>&#160;        r2x=  ramp2*refpars(2)*max(0.,min(1.,(1-trnx)))  &amp;</div>
<div class="line"><a name="l00632"></a><span class="lineno">  632</span>&#160;             + ramp4*refpars(4)*max(0.,min(1.,(1-exp(-berg*delx*0.0001))))</div>
<div class="line"><a name="l00633"></a><span class="lineno">  633</span>&#160;        r2y=  ramp2*refpars(2)*max(0.,min(1.,(1-trny)))  &amp;</div>
<div class="line"><a name="l00634"></a><span class="lineno">  634</span>&#160;             + ramp4*refpars(4)*max(0.,min(1.,(1-exp(-berg*dely*0.0001))))</div>
<div class="line"><a name="l00635"></a><span class="lineno">  635</span>&#160;        fac1=1/(0.5*real(nth))</div>
<div class="line"><a name="l00636"></a><span class="lineno">  636</span>&#160;        <span class="keywordflow">DO</span> ik=1, nk</div>
<div class="line"><a name="l00637"></a><span class="lineno">  637</span>&#160;          <span class="keywordflow">DO</span> ith=1, nth</div>
<div class="line"><a name="l00638"></a><span class="lineno">  638</span>&#160;            r2=a(ith+(ik-1)*nth)</div>
<div class="line"><a name="l00639"></a><span class="lineno">  639</span>&#160;            <span class="keywordflow">IF</span> (r2.GT.0.) <span class="keywordflow">THEN</span></div>
<div class="line"><a name="l00640"></a><span class="lineno">  640</span>&#160; </div>
<div class="line"><a name="l00641"></a><span class="lineno">  641</span>&#160;              <span class="keywordflow">DO</span> ith2=1,nth</div>
<div class="line"><a name="l00642"></a><span class="lineno">  642</span>&#160;                ispec=ith2+(ik-1)*nth</div>
<div class="line"><a name="l00643"></a><span class="lineno">  643</span>&#160;                r3=ecos(1+mod(nth+ith2-ith,nth))</div>
<div class="line"><a name="l00644"></a><span class="lineno">  644</span>&#160;                <span class="keywordflow">IF</span> (r3.LT.0) <span class="keywordflow">THEN</span></div>
<div class="line"><a name="l00645"></a><span class="lineno">  645</span>&#160;                  s(ispec)=s(ispec)+ &amp;</div>
<div class="line"><a name="l00646"></a><span class="lineno">  646</span>&#160;                       cg(ik)*r2x*r2*abs(ecos(ith2)/delx)*fac1 &amp;</div>
<div class="line"><a name="l00647"></a><span class="lineno">  647</span>&#160;                       + cg(ik)*r2y*r2*abs(esin(ith2)/dely)*fac1</div>
<div class="line"><a name="l00648"></a><span class="lineno">  648</span>&#160;<span class="keywordflow">                END IF</span></div>
<div class="line"><a name="l00649"></a><span class="lineno">  649</span>&#160;<span class="keywordflow">              END DO</span></div>
<div class="line"><a name="l00650"></a><span class="lineno">  650</span>&#160;<span class="keywordflow">            END IF</span></div>
<div class="line"><a name="l00651"></a><span class="lineno">  651</span>&#160;<span class="keywordflow">          END DO</span></div>
<div class="line"><a name="l00652"></a><span class="lineno">  652</span>&#160;<span class="keywordflow">        END DO</span></div>
<div class="line"><a name="l00653"></a><span class="lineno">  653</span>&#160;<span class="keywordflow">      END IF</span></div>
<div class="line"><a name="l00654"></a><span class="lineno">  654</span>&#160; </div>
<div class="line"><a name="l00655"></a><span class="lineno">  655</span>&#160;<span class="preprocessor">#ifdef W3_IG1</span></div>
<div class="line"><a name="l00656"></a><span class="lineno">  656</span>&#160;<span class="preprocessor"></span>      <span class="keywordflow">IF</span> (icalc.EQ.1) <span class="keywordflow">THEN</span></div>
<div class="line"><a name="l00657"></a><span class="lineno">  657</span>&#160;        stmp1(nspecigstart+1:nspec) = s(nspecigstart+1:nspec)</div>
<div class="line"><a name="l00658"></a><span class="lineno">  658</span>&#160;      <span class="keywordflow">ELSE</span></div>
<div class="line"><a name="l00659"></a><span class="lineno">  659</span>&#160;        stmp2 = s</div>
<div class="line"><a name="l00660"></a><span class="lineno">  660</span>&#160;        <span class="keywordflow">DO</span> ispec = 1, nspec</div>
<div class="line"><a name="l00661"></a><span class="lineno">  661</span>&#160;          s(ispec) = max(stmp2(ispec),stmp1(ispec))</div>
<div class="line"><a name="l00662"></a><span class="lineno">  662</span>&#160;<span class="keywordflow">        END DO</span></div>
<div class="line"><a name="l00663"></a><span class="lineno">  663</span>&#160;<span class="keywordflow">      END IF</span></div>
<div class="line"><a name="l00664"></a><span class="lineno">  664</span>&#160;<span class="keywordflow">    ENDDO</span> <span class="comment">! ICALC = 1,2</span></div>
<div class="line"><a name="l00665"></a><span class="lineno">  665</span>&#160;    a(1:nspecig)=atmp2(1:nspecig)   <span class="comment">! removes bound IG components ...</span></div>
<div class="line"><a name="l00666"></a><span class="lineno">  666</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00667"></a><span class="lineno">  667</span>&#160;<span class="preprocessor"></span>    <span class="comment">!/</span></div>
<div class="line"><a name="l00668"></a><span class="lineno">  668</span>&#160;    <span class="comment">!/ End of W3SREF ----------------------------------------------------- /</span></div>
<div class="line"><a name="l00669"></a><span class="lineno">  669</span>&#160;    <span class="comment">!/</span></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="w3gdatmd_8F90_source.html#l01196">w3gdatmd::clats</a>, <a class="el" href="w3gdatmd_8F90_source.html#l00625">w3gdatmd::clgtype</a>, <a class="el" href="w3gdatmd_8F90_source.html#l01234">w3gdatmd::dden</a>, <a class="el" href="constants_8F90_source.html#l00077">constants::dera</a>, <a class="el" href="w3dispmd_8F90_source.html#l00075">w3dispmd::dfac</a>, <a class="el" href="w3dispmd_8F90_source.html#l00078">w3dispmd::dsie</a>, <a class="el" href="w3gdatmd_8F90_source.html#l01234">w3gdatmd::dsii</a>, <a class="el" href="w3gdatmd_8F90_source.html#l01232">w3gdatmd::dth</a>, <a class="el" href="w3gdatmd_8F90_source.html#l01234">w3gdatmd::ec2</a>, <a class="el" href="w3dispmd_8F90_source.html#l00078">w3dispmd::ecg1</a>, <a class="el" href="w3gdatmd_8F90_source.html#l01234">w3gdatmd::ecos</a>, <a class="el" href="w3gdatmd_8F90_source.html#l01234">w3gdatmd::esin</a>, <a class="el" href="w3dispmd_8F90_source.html#l00078">w3dispmd::ewn1</a>, <a class="el" href="w3gdatmd_8F90_source.html#l01219">w3gdatmd::flagll</a>, <a class="el" href="constants_8F90_source.html#l00061">constants::grav</a>, <a class="el" href="w3gdatmd_8F90_source.html#l01094">w3gdatmd::gtype</a>, <a class="el" href="w3gdatmd_8F90_source.html#l01211">w3gdatmd::hpfac</a>, <a class="el" href="w3gdatmd_8F90_source.html#l01212">w3gdatmd::hqfac</a>, <a class="el" href="w3gdatmd_8F90_source.html#l01142">w3gdatmd::igpars</a>, <a class="el" href="w3gdatmd_8F90_source.html#l01118">w3gdatmd::iobdp_loc</a>, <a class="el" href="w3gdatmd_8F90_source.html#l01117">w3gdatmd::iobp_loc</a>, <a class="el" href="w3gdatmd_8F90_source.html#l01119">w3gdatmd::iobpa_loc</a>, <a class="el" href="w3gdatmd_8F90_source.html#l01130">w3gdatmd::iobpd</a>, <a class="el" href="w3gdatmd_8F90_source.html#l01116">w3gdatmd::iobpd_loc</a>, <a class="el" href="constants_8F90_source.html#l00101">constants::lpdlib</a>, <a class="el" href="w3gdatmd_8F90_source.html#l01163">w3gdatmd::mapfs</a>, <a class="el" href="w3gdatmd_8F90_source.html#l01231">w3gdatmd::mapth</a>, <a class="el" href="w3gdatmd_8F90_source.html#l01231">w3gdatmd::mapwn</a>, <a class="el" href="w3dispmd_8F90_source.html#l00077">w3dispmd::n1max</a>, <a class="el" href="w3dispmd_8F90_source.html#l00074">w3dispmd::nar1d</a>, <a class="el" href="w3gdatmd_8F90_source.html#l01230">w3gdatmd::nk</a>, <a class="el" href="w3gdatmd_8F90_source.html#l01230">w3gdatmd::nspec</a>, <a class="el" href="w3gdatmd_8F90_source.html#l01230">w3gdatmd::nth</a>, <a class="el" href="yownodepool_8F90_source.html#l00080">yownodepool::pdlib_si</a>, <a class="el" href="constants_8F90_source.html#l00079">constants::radius</a>, <a class="el" href="w3gdatmd_8F90_source.html#l01139">w3gdatmd::refpars</a>, <a class="el" href="w3gdatmd_8F90_source.html#l00624">w3gdatmd::rlgtype</a>, <a class="el" href="w3gdatmd_8F90_source.html#l01122">w3gdatmd::si</a>, <a class="el" href="w3gdatmd_8F90_source.html#l01234">w3gdatmd::sig</a>, <a class="el" href="w3gdatmd_8F90_source.html#l01234">w3gdatmd::sig2</a>, <a class="el" href="w3gdatmd_8F90_source.html#l00627">w3gdatmd::smctype</a>, <a class="el" href="w3servmd_8F90_source.html#l00148">w3servmd::strace()</a>, <a class="el" href="w3gdatmd_8F90_source.html#l01183">w3gdatmd::sx</a>, <a class="el" href="w3gdatmd_8F90_source.html#l01183">w3gdatmd::sy</a>, <a class="el" href="constants_8F90_source.html#l00072">constants::tpi</a>, <a class="el" href="constants_8F90_source.html#l00074">constants::tpiinv</a>, <a class="el" href="w3gdatmd_8F90_source.html#l00626">w3gdatmd::ungtype</a>, <a class="el" href="w3canomd_8F90_source.html#l00153">w3canomd::w3add2ndorder()</a>, and <a class="el" href="w3gig1md_8F90_source.html#l00147">w3gig1md::w3addig()</a>.</p>

<p class="reference">Referenced by <a class="el" href="w3srcemd_8F90_source.html#l00195">w3srcemd::w3srce()</a>.</p>

</div>
</div>
</div><!-- contents -->
</div><!-- doc-content -->
<div class="ttc" id="anamespacew3gdatmd_html_a4b6f7577a00b480afcec77e672fb25b2"><div class="ttname"><a href="namespacew3gdatmd.html#a4b6f7577a00b480afcec77e672fb25b2">w3gdatmd::dth</a></div><div class="ttdeci">real, pointer dth</div><div class="ttdef"><b>Definition:</b> <a href="w3gdatmd_8F90_source.html#l01232">w3gdatmd.F90:1232</a></div></div>
<div class="ttc" id="anamespaceconstants_html_a7ca2bfab88e5cd9e0eda00a6147d1806"><div class="ttname"><a href="namespaceconstants.html#a7ca2bfab88e5cd9e0eda00a6147d1806">constants::dera</a></div><div class="ttdeci">real, parameter dera</div><div class="ttdoc">DERA Conversion factor from degrees to radians.</div><div class="ttdef"><b>Definition:</b> <a href="constants_8F90_source.html#l00077">constants.F90:77</a></div></div>
<div class="ttc" id="anamespacew3gdatmd_html_ab1451f01c0706fb65b2c7e1fa1ad1ba6"><div class="ttname"><a href="namespacew3gdatmd.html#ab1451f01c0706fb65b2c7e1fa1ad1ba6">w3gdatmd::ungtype</a></div><div class="ttdeci">integer, parameter ungtype</div><div class="ttdef"><b>Definition:</b> <a href="w3gdatmd_8F90_source.html#l00626">w3gdatmd.F90:626</a></div></div>
<div class="ttc" id="anamespacew3gdatmd_html_a79e88ab04db1d3ac00f3e45d2625312c"><div class="ttname"><a href="namespacew3gdatmd.html#a79e88ab04db1d3ac00f3e45d2625312c">w3gdatmd::rlgtype</a></div><div class="ttdeci">integer, parameter rlgtype</div><div class="ttdef"><b>Definition:</b> <a href="w3gdatmd_8F90_source.html#l00624">w3gdatmd.F90:624</a></div></div>
<div class="ttc" id="anamespacew3gdatmd_html_a5c38b5b943ce3e737e3cc0f1edc5b157"><div class="ttname"><a href="namespacew3gdatmd.html#a5c38b5b943ce3e737e3cc0f1edc5b157">w3gdatmd::mapth</a></div><div class="ttdeci">integer, dimension(:), pointer mapth</div><div class="ttdef"><b>Definition:</b> <a href="w3gdatmd_8F90_source.html#l01231">w3gdatmd.F90:1231</a></div></div>
<div class="ttc" id="anamespacew3gdatmd_html_a03c93522e79707dbb6333c3606526fd3"><div class="ttname"><a href="namespacew3gdatmd.html#a03c93522e79707dbb6333c3606526fd3">w3gdatmd::iobpd_loc</a></div><div class="ttdeci">integer *1, dimension(:,:), pointer iobpd_loc</div><div class="ttdef"><b>Definition:</b> <a href="w3gdatmd_8F90_source.html#l01116">w3gdatmd.F90:1116</a></div></div>
<div class="ttc" id="anamespacew3gdatmd_html_ad451ba3fd6cfdb044986de89e4e4e4f8"><div class="ttname"><a href="namespacew3gdatmd.html#ad451ba3fd6cfdb044986de89e4e4e4f8">w3gdatmd::sig</a></div><div class="ttdeci">real, dimension(:), pointer sig</div><div class="ttdef"><b>Definition:</b> <a href="w3gdatmd_8F90_source.html#l01234">w3gdatmd.F90:1234</a></div></div>
<div class="ttc" id="anamespacew3gdatmd_html_ae8e13cd23548b33eaaae230040049539"><div class="ttname"><a href="namespacew3gdatmd.html#ae8e13cd23548b33eaaae230040049539">w3gdatmd::sy</a></div><div class="ttdeci">real, pointer sy</div><div class="ttdef"><b>Definition:</b> <a href="w3gdatmd_8F90_source.html#l01183">w3gdatmd.F90:1183</a></div></div>
<div class="ttc" id="anamespacew3gdatmd_html_a77230bde44d23a91e680520547fcaeb9"><div class="ttname"><a href="namespacew3gdatmd.html#a77230bde44d23a91e680520547fcaeb9">w3gdatmd::ecos</a></div><div class="ttdeci">real, dimension(:), pointer ecos</div><div class="ttdef"><b>Definition:</b> <a href="w3gdatmd_8F90_source.html#l01234">w3gdatmd.F90:1234</a></div></div>
<div class="ttc" id="anamespacew3gdatmd_html_a1f30ee4349738120d2f73c56f6ea2923"><div class="ttname"><a href="namespacew3gdatmd.html#a1f30ee4349738120d2f73c56f6ea2923">w3gdatmd::iobp_loc</a></div><div class="ttdeci">integer *2, dimension(:), pointer iobp_loc</div><div class="ttdef"><b>Definition:</b> <a href="w3gdatmd_8F90_source.html#l01117">w3gdatmd.F90:1117</a></div></div>
<div class="ttc" id="anamespacew3gdatmd_html_a17c65bd93b90119883caf84c7fa448df"><div class="ttname"><a href="namespacew3gdatmd.html#a17c65bd93b90119883caf84c7fa448df">w3gdatmd::iobdp_loc</a></div><div class="ttdeci">integer *1, dimension(:), pointer iobdp_loc</div><div class="ttdef"><b>Definition:</b> <a href="w3gdatmd_8F90_source.html#l01118">w3gdatmd.F90:1118</a></div></div>
<div class="ttc" id="anamespacew3gdatmd_html_ad0202e8b0d4d789838ffaf63de3be312"><div class="ttname"><a href="namespacew3gdatmd.html#ad0202e8b0d4d789838ffaf63de3be312">w3gdatmd::hqfac</a></div><div class="ttdeci">real, dimension(:,:), pointer hqfac</div><div class="ttdef"><b>Definition:</b> <a href="w3gdatmd_8F90_source.html#l01212">w3gdatmd.F90:1212</a></div></div>
<div class="ttc" id="anamespaceyownodepool_html_ac6a6629b5194a1b6761c06d6eb433ed5"><div class="ttname"><a href="namespaceyownodepool.html#ac6a6629b5194a1b6761c06d6eb433ed5">yownodepool::pdlib_si</a></div><div class="ttdeci">real(rkind), dimension(:), allocatable, target, public pdlib_si</div><div class="ttdef"><b>Definition:</b> <a href="yownodepool_8F90_source.html#l00080">yownodepool.F90:80</a></div></div>
<div class="ttc" id="anamespacew3dispmd_html_ad7a1721bb6048f62402f14cb3e69e219"><div class="ttname"><a href="namespacew3dispmd.html#ad7a1721bb6048f62402f14cb3e69e219">w3dispmd::ewn1</a></div><div class="ttdeci">real, dimension(0:nar1d) ewn1</div><div class="ttdef"><b>Definition:</b> <a href="w3dispmd_8F90_source.html#l00078">w3dispmd.F90:78</a></div></div>
<div class="ttc" id="anamespacew3gdatmd_html_a345f95d975f7c29614d7096b4a2c4073"><div class="ttname"><a href="namespacew3gdatmd.html#a345f95d975f7c29614d7096b4a2c4073">w3gdatmd::esin</a></div><div class="ttdeci">real, dimension(:), pointer esin</div><div class="ttdef"><b>Definition:</b> <a href="w3gdatmd_8F90_source.html#l01234">w3gdatmd.F90:1234</a></div></div>
<div class="ttc" id="anamespaceyownodepool_html"><div class="ttname"><a href="namespaceyownodepool.html">yownodepool</a></div><div class="ttdoc">Has data that belong to nodes.</div><div class="ttdef"><b>Definition:</b> <a href="yownodepool_8F90_source.html#l00039">yownodepool.F90:39</a></div></div>
<div class="ttc" id="anamespaceconstants_html_ad8b244917fc2f2b94d397086522af7a1"><div class="ttname"><a href="namespaceconstants.html#ad8b244917fc2f2b94d397086522af7a1">constants::lpdlib</a></div><div class="ttdeci">logical lpdlib</div><div class="ttdoc">LPDLIB Logical for using the PDLIB library.</div><div class="ttdef"><b>Definition:</b> <a href="constants_8F90_source.html#l00101">constants.F90:101</a></div></div>
<div class="ttc" id="anamespacew3gdatmd_html_a063c55199a8786edf383f3c6359108f2"><div class="ttname"><a href="namespacew3gdatmd.html#a063c55199a8786edf383f3c6359108f2">w3gdatmd::clgtype</a></div><div class="ttdeci">integer, parameter clgtype</div><div class="ttdef"><b>Definition:</b> <a href="w3gdatmd_8F90_source.html#l00625">w3gdatmd.F90:625</a></div></div>
<div class="ttc" id="anamespacew3canomd_html"><div class="ttname"><a href="namespacew3canomd.html">w3canomd</a></div><div class="ttdoc">Calculation of the second order correction to the surface gravity wave spectrum.</div><div class="ttdef"><b>Definition:</b> <a href="w3canomd_8F90_source.html#l00023">w3canomd.F90:23</a></div></div>
<div class="ttc" id="anamespacew3servmd_html"><div class="ttname"><a href="namespacew3servmd.html">w3servmd</a></div><div class="ttdef"><b>Definition:</b> <a href="w3servmd_8F90_source.html#l00003">w3servmd.F90:3</a></div></div>
<div class="ttc" id="anamespacew3gdatmd_html_a923f717f20c2c0991fa3798768f3526a"><div class="ttname"><a href="namespacew3gdatmd.html#a923f717f20c2c0991fa3798768f3526a">w3gdatmd::dsii</a></div><div class="ttdeci">real, dimension(:), pointer dsii</div><div class="ttdef"><b>Definition:</b> <a href="w3gdatmd_8F90_source.html#l01234">w3gdatmd.F90:1234</a></div></div>
<div class="ttc" id="anamespaceconstants_html_ab81445207bb044b4a638d50ecf4470e5"><div class="ttname"><a href="namespaceconstants.html#ab81445207bb044b4a638d50ecf4470e5">constants::tpiinv</a></div><div class="ttdeci">real, parameter tpiinv</div><div class="ttdoc">TPIINV Inverse of 2*Pi.</div><div class="ttdef"><b>Definition:</b> <a href="constants_8F90_source.html#l00074">constants.F90:74</a></div></div>
<div class="ttc" id="anamespacew3gig1md_html"><div class="ttname"><a href="namespacew3gig1md.html">w3gig1md</a></div><div class="ttdef"><b>Definition:</b> <a href="w3gig1md_8F90_source.html#l00003">w3gig1md.F90:3</a></div></div>
<div class="ttc" id="anamespacew3dispmd_html_a2d8d5f061b663f6e27c5f474e661a592"><div class="ttname"><a href="namespacew3dispmd.html#a2d8d5f061b663f6e27c5f474e661a592">w3dispmd::ecg1</a></div><div class="ttdeci">real, dimension(0:nar1d) ecg1</div><div class="ttdef"><b>Definition:</b> <a href="w3dispmd_8F90_source.html#l00078">w3dispmd.F90:78</a></div></div>
<div class="ttc" id="anamespacew3gdatmd_html_aad204763c51cb0df15891498f423285b"><div class="ttname"><a href="namespacew3gdatmd.html#aad204763c51cb0df15891498f423285b">w3gdatmd::clats</a></div><div class="ttdeci">real, dimension(:), pointer clats</div><div class="ttdef"><b>Definition:</b> <a href="w3gdatmd_8F90_source.html#l01196">w3gdatmd.F90:1196</a></div></div>
<div class="ttc" id="anamespacew3gig1md_html_a2161ef813f9e8fdef57a2446e14ac5bb"><div class="ttname"><a href="namespacew3gig1md.html#a2161ef813f9e8fdef57a2446e14ac5bb">w3gig1md::w3addig</a></div><div class="ttdeci">subroutine w3addig(E, DEPTH, WN, CG, IACTION)</div><div class="ttdef"><b>Definition:</b> <a href="w3gig1md_8F90_source.html#l00147">w3gig1md.F90:147</a></div></div>
<div class="ttc" id="anamespacew3gdatmd_html_a44cb2e659c5f016ce0a8da57489d6a67"><div class="ttname"><a href="namespacew3gdatmd.html#a44cb2e659c5f016ce0a8da57489d6a67">w3gdatmd::smctype</a></div><div class="ttdeci">integer, parameter smctype</div><div class="ttdef"><b>Definition:</b> <a href="w3gdatmd_8F90_source.html#l00627">w3gdatmd.F90:627</a></div></div>
<div class="ttc" id="anamespaceconstants_html_a4dceccc29b7e5529102409498706a17f"><div class="ttname"><a href="namespaceconstants.html#a4dceccc29b7e5529102409498706a17f">constants::radius</a></div><div class="ttdeci">real, parameter radius</div><div class="ttdoc">RADIUS Radius of the earth (m).</div><div class="ttdef"><b>Definition:</b> <a href="constants_8F90_source.html#l00079">constants.F90:79</a></div></div>
<div class="ttc" id="anamespacew3gdatmd_html_a980e242bf67b9984dc6e1a4d28df6c92"><div class="ttname"><a href="namespacew3gdatmd.html#a980e242bf67b9984dc6e1a4d28df6c92">w3gdatmd::iobpd</a></div><div class="ttdeci">integer *1, dimension(:,:), pointer iobpd</div><div class="ttdef"><b>Definition:</b> <a href="w3gdatmd_8F90_source.html#l01130">w3gdatmd.F90:1130</a></div></div>
<div class="ttc" id="anamespacew3gdatmd_html_a87981ee1fa941ca919854b529a9e3a02"><div class="ttname"><a href="namespacew3gdatmd.html#a87981ee1fa941ca919854b529a9e3a02">w3gdatmd::sig2</a></div><div class="ttdeci">real, dimension(:), pointer sig2</div><div class="ttdef"><b>Definition:</b> <a href="w3gdatmd_8F90_source.html#l01234">w3gdatmd.F90:1234</a></div></div>
<div class="ttc" id="anamespaceconstants_html_a5729459787df1ec9fac855545e0faaea"><div class="ttname"><a href="namespaceconstants.html#a5729459787df1ec9fac855545e0faaea">constants::tpi</a></div><div class="ttdeci">real, parameter tpi</div><div class="ttdoc">TPI 2*Pi.</div><div class="ttdef"><b>Definition:</b> <a href="constants_8F90_source.html#l00072">constants.F90:72</a></div></div>
<div class="ttc" id="anamespacew3servmd_html_a3b050f1196ad182ba44915b0c7bfb22f"><div class="ttname"><a href="namespacew3servmd.html#a3b050f1196ad182ba44915b0c7bfb22f">w3servmd::strace</a></div><div class="ttdeci">subroutine strace(IENT, SNAME)</div><div class="ttdef"><b>Definition:</b> <a href="w3servmd_8F90_source.html#l00148">w3servmd.F90:148</a></div></div>
<div class="ttc" id="anamespacew3gdatmd_html_a77210c5b64d791072462f4d3948210aa"><div class="ttname"><a href="namespacew3gdatmd.html#a77210c5b64d791072462f4d3948210aa">w3gdatmd::gtype</a></div><div class="ttdeci">integer, pointer gtype</div><div class="ttdef"><b>Definition:</b> <a href="w3gdatmd_8F90_source.html#l01094">w3gdatmd.F90:1094</a></div></div>
<div class="ttc" id="anamespacew3gdatmd_html_a4551e9fa53585b84b3d1130dac7c0bac"><div class="ttname"><a href="namespacew3gdatmd.html#a4551e9fa53585b84b3d1130dac7c0bac">w3gdatmd::mapwn</a></div><div class="ttdeci">integer, dimension(:), pointer mapwn</div><div class="ttdef"><b>Definition:</b> <a href="w3gdatmd_8F90_source.html#l01231">w3gdatmd.F90:1231</a></div></div>
<div class="ttc" id="anamespacew3gdatmd_html_a053ddee2f7e044c9686b2b7b85bff174"><div class="ttname"><a href="namespacew3gdatmd.html#a053ddee2f7e044c9686b2b7b85bff174">w3gdatmd::iobpa_loc</a></div><div class="ttdeci">integer *1, dimension(:), pointer iobpa_loc</div><div class="ttdef"><b>Definition:</b> <a href="w3gdatmd_8F90_source.html#l01119">w3gdatmd.F90:1119</a></div></div>
<div class="ttc" id="anamespacew3gdatmd_html_a26759ceeed28f07100b31cab17d5c7ea"><div class="ttname"><a href="namespacew3gdatmd.html#a26759ceeed28f07100b31cab17d5c7ea">w3gdatmd::hpfac</a></div><div class="ttdeci">real, dimension(:,:), pointer hpfac</div><div class="ttdef"><b>Definition:</b> <a href="w3gdatmd_8F90_source.html#l01211">w3gdatmd.F90:1211</a></div></div>
<div class="ttc" id="anamespacew3gdatmd_html_a40498c232ed5b8289e921f09acc96760"><div class="ttname"><a href="namespacew3gdatmd.html#a40498c232ed5b8289e921f09acc96760">w3gdatmd::si</a></div><div class="ttdeci">real(8), dimension(:), pointer si</div><div class="ttdef"><b>Definition:</b> <a href="w3gdatmd_8F90_source.html#l01122">w3gdatmd.F90:1122</a></div></div>
<div class="ttc" id="anamespacew3gdatmd_html_ace4b7064f5b270ac5564b3484566042d"><div class="ttname"><a href="namespacew3gdatmd.html#ace4b7064f5b270ac5564b3484566042d">w3gdatmd::sx</a></div><div class="ttdeci">real, pointer sx</div><div class="ttdef"><b>Definition:</b> <a href="w3gdatmd_8F90_source.html#l01183">w3gdatmd.F90:1183</a></div></div>
<div class="ttc" id="anamespaceconstants_html"><div class="ttname"><a href="namespaceconstants.html">constants</a></div><div class="ttdoc">Define some much-used constants for global use (all defined as PARAMETER).</div><div class="ttdef"><b>Definition:</b> <a href="constants_8F90_source.html#l00020">constants.F90:20</a></div></div>
<div class="ttc" id="anamespacew3gdatmd_html_aead1aecac711ead3469d954b2bd60fc2"><div class="ttname"><a href="namespacew3gdatmd.html#aead1aecac711ead3469d954b2bd60fc2">w3gdatmd::dden</a></div><div class="ttdeci">real, dimension(:), pointer dden</div><div class="ttdef"><b>Definition:</b> <a href="w3gdatmd_8F90_source.html#l01234">w3gdatmd.F90:1234</a></div></div>
<div class="ttc" id="anamespacew3gdatmd_html"><div class="ttname"><a href="namespacew3gdatmd.html">w3gdatmd</a></div><div class="ttdef"><b>Definition:</b> <a href="w3gdatmd_8F90_source.html#l00016">w3gdatmd.F90:16</a></div></div>
<div class="ttc" id="anamespacew3dispmd_html_a46fe0eb1a06309ed580662f3863b7668"><div class="ttname"><a href="namespacew3dispmd.html#a46fe0eb1a06309ed580662f3863b7668">w3dispmd::nar1d</a></div><div class="ttdeci">integer, parameter nar1d</div><div class="ttdef"><b>Definition:</b> <a href="w3dispmd_8F90_source.html#l00074">w3dispmd.F90:74</a></div></div>
<div class="ttc" id="anamespacew3gdatmd_html_a3439026c6e1260ce40ad1d4cbb405694"><div class="ttname"><a href="namespacew3gdatmd.html#a3439026c6e1260ce40ad1d4cbb405694">w3gdatmd::igpars</a></div><div class="ttdeci">real, dimension(:), pointer igpars</div><div class="ttdef"><b>Definition:</b> <a href="w3gdatmd_8F90_source.html#l01142">w3gdatmd.F90:1142</a></div></div>
<div class="ttc" id="anamespacew3gdatmd_html_ad1fe2b09feabedff12f7e4bf9c62b4b8"><div class="ttname"><a href="namespacew3gdatmd.html#ad1fe2b09feabedff12f7e4bf9c62b4b8">w3gdatmd::refpars</a></div><div class="ttdeci">real, dimension(:), pointer refpars</div><div class="ttdef"><b>Definition:</b> <a href="w3gdatmd_8F90_source.html#l01139">w3gdatmd.F90:1139</a></div></div>
<div class="ttc" id="anamespacew3canomd_html_a0024389a271c1adccd88c4ff24b76e0e"><div class="ttname"><a href="namespacew3canomd.html#a0024389a271c1adccd88c4ff24b76e0e">w3canomd::w3add2ndorder</a></div><div class="ttdeci">subroutine w3add2ndorder(E, DEPTH, WN, CG, IACTION)</div><div class="ttdoc">Adds second order spectrum on top of first order spectrum.</div><div class="ttdef"><b>Definition:</b> <a href="w3canomd_8F90_source.html#l00153">w3canomd.F90:153</a></div></div>
<div class="ttc" id="anamespacew3gdatmd_html_a5cbed3f13d9dfa812a468e69b77b8271"><div class="ttname"><a href="namespacew3gdatmd.html#a5cbed3f13d9dfa812a468e69b77b8271">w3gdatmd::ec2</a></div><div class="ttdeci">real, dimension(:), pointer ec2</div><div class="ttdef"><b>Definition:</b> <a href="w3gdatmd_8F90_source.html#l01234">w3gdatmd.F90:1234</a></div></div>
<div class="ttc" id="anamespacew3dispmd_html"><div class="ttname"><a href="namespacew3dispmd.html">w3dispmd</a></div><div class="ttdef"><b>Definition:</b> <a href="w3dispmd_8F90_source.html#l00003">w3dispmd.F90:3</a></div></div>
<div class="ttc" id="anamespacew3dispmd_html_a50de12651fb8eeb08c4007b9e4ad7c1d"><div class="ttname"><a href="namespacew3dispmd.html#a50de12651fb8eeb08c4007b9e4ad7c1d">w3dispmd::n1max</a></div><div class="ttdeci">integer n1max</div><div class="ttdef"><b>Definition:</b> <a href="w3dispmd_8F90_source.html#l00077">w3dispmd.F90:77</a></div></div>
<div class="ttc" id="anamespaceconstants_html_a27ed315e4f5c61762387c7fae2eb0c38"><div class="ttname"><a href="namespaceconstants.html#a27ed315e4f5c61762387c7fae2eb0c38">constants::grav</a></div><div class="ttdeci">real, parameter grav</div><div class="ttdoc">GRAV Acc.</div><div class="ttdef"><b>Definition:</b> <a href="constants_8F90_source.html#l00061">constants.F90:61</a></div></div>
<div class="ttc" id="anamespacew3dispmd_html_a347c04da9af6016c1dbb0a6aaed6e9ba"><div class="ttname"><a href="namespacew3dispmd.html#a347c04da9af6016c1dbb0a6aaed6e9ba">w3dispmd::dsie</a></div><div class="ttdeci">real dsie</div><div class="ttdef"><b>Definition:</b> <a href="w3dispmd_8F90_source.html#l00078">w3dispmd.F90:78</a></div></div>
<div class="ttc" id="anamespacew3gdatmd_html_aacc0010db11c3f9311b00a816a0e20c2"><div class="ttname"><a href="namespacew3gdatmd.html#aacc0010db11c3f9311b00a816a0e20c2">w3gdatmd::flagll</a></div><div class="ttdeci">logical, pointer flagll</div><div class="ttdef"><b>Definition:</b> <a href="w3gdatmd_8F90_source.html#l01219">w3gdatmd.F90:1219</a></div></div>
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="namespacew3ref1md.html">w3ref1md</a></li>
    <li class="footer">Generated by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.17 </li>
  </ul>
</div>
</body>
</html>
